/* --- Automatischer Live-Sync & Statusanzeige --- */
const foot = document.querySelector('.foot');
let syncState = document.createElement('div');
syncState.style.textAlign = 'center';
syncState.style.marginTop = '6px';
syncState.style.fontSize = '.9rem';
syncState.style.color = '#2563eb';
foot.insertAdjacentElement('afterend', syncState);

function setSyncState(msg, color='#2563eb'){
  syncState.textContent = msg;
  syncState.style.color = color;
  syncState.style.opacity = 1;
  setTimeout(()=>{ syncState.style.transition='opacity 1s'; syncState.style.opacity=0.4; },4000);
}

async function checkRemoteUpdate(){
  try{
    const r = await fetch("https://beeferino.github.io/vokabeltrainer/vokabeln.json",{cache:"no-store"});
    const j = await r.json();
    const local = JSON.parse(localStorage.getItem("vokabeln")||"[]");
    if(JSON.stringify(j)!==JSON.stringify(local)){
      localStorage.setItem("vokabeln",JSON.stringify(j));
      localStorage.setItem("vokabeln_updated",new Date().toISOString());
      setSyncState('üîÑ Neue Daten aus Cloud geladen', '#22c55e');
      data = j;
      renderRecent();
    } else {
      setSyncState('üü¢ Daten aktuell', '#22c55e');
    }
  }catch{
    setSyncState('‚ö†Ô∏è Offline / kein Update m√∂glich', '#ef4444');
  }
}
setSyncState('üü° Pr√ºfe auf Updates...');
setInterval(checkRemoteUpdate,30000);
checkRemoteUpdate();
