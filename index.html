<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>🧠 Vokabeltrainer</title>
<style>
  body{font-family:"Segoe UI",Roboto,sans-serif;background:#f7f9fb;margin:0;padding:20px;text-align:center;color:#111;}
  .app{max-width:900px;margin:auto;}
  h1{font-size:2rem;margin-bottom:1rem}
  .tiles{display:flex;flex-wrap:wrap;justify-content:center;gap:14px;margin:18px 0;}
  .tile{flex:1 1 260px;background:#fff;border-radius:14px;padding:20px 10px;box-shadow:0 2px 8px rgba(0,0,0,.08);cursor:pointer;transition:transform .1s ease,background .2s ease;}
  .tile:hover{background:#ecf5ff;transform:translateY(-2px);}
  .tile h2{margin:0;font-size:1.2rem;color:#2980b9;}
  .tile p{margin:6px 0 0;font-size:.95rem;color:#444;}
  .game{background:#fff;border-radius:14px;box-shadow:0 2px 8px rgba(0,0,0,.08);padding:20px;margin-top:20px;display:none;}
  input[type=text]{padding:10px 12px;font-size:1rem;width:80%;max-width:300px;border-radius:8px;border:1px solid #ccc;margin-top:10px;}
  button{padding:8px 14px;font-size:1rem;border-radius:8px;border:none;cursor:pointer;background:#2980b9;color:#fff;transition:background .2s;}
  button:hover{background:#3498db;}
  .result{font-size:1.2rem;margin-top:10px;}
  .feedback{font-size:1.4rem;margin-top:12px;font-weight:600;}
  .feedback.correct{color:#2ecc71;}
  .feedback.wrong{color:#e74c3c;}
  .card{position:relative;width:280px;height:160px;margin:20px auto;perspective:1000px;}
  .card-inner{position:absolute;width:100%;height:100%;transition:transform .6s;transform-style:preserve-3d;}
  .card.flip .card-inner{transform:rotateY(180deg);}
  .card-face{position:absolute;width:100%;height:100%;backface-visibility:hidden;display:flex;align-items:center;justify-content:center;font-size:1.4rem;border-radius:12px;background:#fff;box-shadow:0 2px 6px rgba(0,0,0,.1);}
  .card-back{transform:rotateY(180deg);}
  .footer{margin-top:30px;font-size:.95rem;color:#555;}
  .collapsible{margin-top:30px;text-align:center;}
  .collapsible button{background:#74b9ff;color:#000;font-weight:600;}
  .collapsible-content{display:none;margin-top:10px;}
  .vocab-item{margin:4px 0;}
  .chip{padding:2px 8px;border-radius:8px;color:#fff;font-size:.9rem;}
  hr{border:0;border-top:3px solid #e3e7ef;margin:24px 0;}
</style>
</head>
<body>
<div class="app">
  <h1>🧠 Vokabeltrainer</h1>
  <div id="syncStatus" style="font-size:.9rem;color:#555;opacity:.8;">🔄 Synchronisiere Daten...</div>

  <!-- Auswahl-Kacheln -->
  <div class="tiles">
    <div class="tile" id="startAbfrage"><h2>📝 Vokabel-Abfrage starten</h2><p>Englisch → Deutsch (mit Feedback)</p></div>
    <div class="tile" id="startKartei"><h2>🎴 Karteikarten spielen</h2><p>Einfach umdrehen & merken</p></div>
    <div class="tile" id="startLetzte"><h2>🕓 Letzte 30 Vokabeln</h2><p>Wiederhole deine neuesten Einträge</p></div>
  </div>

  <!-- Spielbereich -->
  <div id="game" class="game"></div>

  <!-- Zuletzt hinzugefügt -->
  <div class="collapsible">
    <button id="toggleLast">🧾 Zuletzt hinzugefügt anzeigen</button>
    <div id="lastAdded" class="collapsible-content">–</div>
  </div>

  <hr>

  <div class="footer">
    <button onclick="location.href='vokabeln.html'">📘 Zur Vokabelübersicht</button>
    <p>© 2025 @Beefi</p>
  </div>
</div>

<script>
(() => {
  const REMOTE_JSON_URL = 'vokabeln.json';
  const CATEGORY_NAMES = {
    Gelb:"Grundwerkzeuge Metallverarbeitung", Pink:"Werkzeugkasten Mechaniker",
    Blau:"Blech- / Kunststoffarbeiten", Gruen:"Drehen / Fräsen",
    HellesPink:"Hydraulik / Pneumatik", Orange:"Elektrotechnik",
    Dunkelgruen:"Fluggerätemechanik allgemein", Rot:"Verwechslungsgefahr"
  };
  const COLOR_MAP = { Gelb:"#F4D03F", Pink:"#E91E63", Blau:"#1976D2", Gruen:"#1E8449",
                      HellesPink:"#F54927", Orange:"#E67E22", Dunkelgruen:"#117A65", Rot:"#C0392B" };

  const $=s=>document.querySelector(s);
  let vocab=[], mode=null, idx=0, wrong=0, feedbackTime=3000;

  /* === Sync === */
  async function syncVocab(){
    $("#syncStatus").textContent="🔄 Lade vokabeln.json...";
    try{
      const r=await fetch(REMOTE_JSON_URL,{cache:'no-store'});
      if(r.ok){
        const remote=await r.json();
        const local=JSON.parse(localStorage.getItem("vokabeln")||"[]");
        const merged=mergeLists(remote,local);
        vocab=merged;
        localStorage.setItem("vokabeln",JSON.stringify(merged));
        $("#syncStatus").textContent="✅ Synchronisiert (GitHub + Lokal)";
      }else throw new Error();
    }catch{
      vocab=JSON.parse(localStorage.getItem("vokabeln")||"[]");
      $("#syncStatus").textContent="💾 Offline: Lokale Daten";
    }
    renderLastAdded();
  }
  function mergeLists(remote,local){
    const map=new Map();
    remote.forEach(v=>map.set((v[0]+v[1]).toLowerCase(),v));
    local.forEach(v=>map.set((v[0]+v[1]).toLowerCase(),v));
    return Array.from(map.values());
  }

  /* === Spiele === */
  function startGame(type){
    $("#game").style.display="block";
    $("#game").innerHTML="";
    mode=type; idx=0; wrong=0;
    let set=[...vocab];
    if(type==="last30") set=set.slice(-30);
    else set.sort(()=>Math.random()-0.5);
    const subset=set.slice(0,15);
    if(type==="abfrage") runAbfrage(subset);
    if(type==="kartei") runKartei(subset);
  }

  /* === Abfrage-Spiel === */
  function runAbfrage(list){
    const g=$("#game");
    g.innerHTML=`<h2>📝 Englisch → Deutsch</h2>
      <div id="question"></div>
      <input id="answer" type="text" placeholder="Übersetzung eingeben">
      <div><button id="checkBtn">Prüfen</button></div>
      <div id="progress"></div><div id="feedback" class="feedback"></div>`;
    const q=$("#question"),a=$("#answer"),f=$("#feedback"),p=$("#progress");
    let i=0;wrong=0;
    function next(){
      if(i>=list.length){
        g.innerHTML=`<h2>Fertig!</h2><p>Du hattest ${wrong} Fehler.</p><button onclick="location.reload()">🔁 Neustart</button>`;
        return;
      }
      const v=list[i];
      q.textContent=v[0];
      a.value="";f.textContent="";p.textContent=`Frage ${i+1}/${list.length} | Fehler: ${wrong}`;
      $("#checkBtn").onclick=()=>{
        const val=a.value.trim().toLowerCase(),sol=(v[1]||"").toLowerCase();
        if(!val)return;
        if(val===sol){f.textContent="✅ Richtig!";f.className="feedback correct";}
        else{f.textContent=`❌ Falsch – ${v[1]}`;f.className="feedback wrong";wrong++;}
        i++;
        setTimeout(next,feedbackTime);
      };
    }
    next();
  }

  /* === Karteikarten-Spiel === */
  function runKartei(list){
    const g=$("#game");
    g.innerHTML=`<h2>🎴 Karteikarten</h2><div id="cardBox" class="card"><div class="card-inner">
      <div class="card-face card-front"></div>
      <div class="card-face card-back"></div></div></div>
      <div><button id="flipBtn">🔁 Umdrehen</button> <button id="nextBtn">➡️ Weiter</button></div>
      <div id="progress"></div>`;
    const card=$("#cardBox"),front=$(".card-front"),back=$(".card-back"),p=$("#progress");
    let i=0;
    function showCard(){
      if(i>=list.length){
        g.innerHTML=`<h2>Alle durch!</h2><button onclick="location.reload()">🔁 Neustart</button>`;
        return;
      }
      const v=list[i];
      front.textContent=v[0];
      back.innerHTML=`${v[1]}<br><small style="color:${COLOR_MAP[v[2]]}">(${CATEGORY_NAMES[v[2]]})</small>`;
      card.classList.remove("flip");
      p.textContent=`Karte ${i+1}/${list.length}`;
    }
    $("#flipBtn").onclick=()=>card.classList.toggle("flip");
    $("#nextBtn").onclick=()=>{i++;showCard();};
    showCard();
  }

  /* === Zuletzt hinzugefügt === */
  function renderLastAdded(){
    const div=$("#lastAdded");
    if(!vocab.length){div.textContent="Keine Vokabeln vorhanden.";return;}
    const last=vocab.slice(-5).reverse();
    div.innerHTML=last.map(v=>`<div class="vocab-item"><b>${v[0]}</b> – ${v[1]} <span class="chip" style="background:${COLOR_MAP[v[2]]}">${CATEGORY_NAMES[v[2]]}</span></div>`).join("");
  }

  /* === Events === */
  $("#startAbfrage").onclick=()=>startGame("abfrage");
  $("#startKartei").onclick=()=>startGame("kartei");
  $("#startLetzte").onclick=()=>startGame("last30");
  $("#toggleLast").onclick=()=>{
    const c=$("#lastAdded");c.style.display=c.style.display==="block"?"none":"block";
  };

  syncVocab();
})();
</script>
</body>
</html>
