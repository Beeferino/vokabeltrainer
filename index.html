<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Vokabeltrainer</title>
<style>
  body {
    font-family: system-ui, Arial, sans-serif;
    background: #f5f7fb;
    margin: 0;
    text-align: center;
  }
  .app {
    max-width: 600px;
    margin: 40px auto;
    background: #fff;
    border-radius: 14px;
    padding: 30px 25px;
    box-shadow: 0 4px 14px rgba(0,0,0,0.08);
  }
  h1 {
    margin-top: 0;
    font-size: 1.9rem;
  }
  select {
    padding: 8px 10px;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 1rem;
    margin: 5px;
  }
  button {
    display: inline-block;
    padding: 14px 22px;
    border-radius: 12px;
    border: none;
    background: #f9f9fb;
    box-shadow: 0 4px 6px rgba(0,0,0,0.06), inset 0 2px 4px rgba(255,255,255,0.7);
    font-size: 1rem;
    font-weight: 500;
    cursor: pointer;
    transition: 0.2s;
  }
  button:hover {
    background: #eef2f8;
    transform: translateY(-1px);
  }
  .row { margin: 10px 0; }
  .main-buttons { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-top: 15px; }
  .linkbtn {
    background: #74b9ff;
    color: #000;
    text-decoration: none;
    padding: 10px 18px;
    border-radius: 8px;
    display: inline-block;
    margin-top: 16px;
    font-weight: 600;
  }
  .linkbtn:hover { background: #a6d4ff; }
  footer { margin-top: 20px; font-size: 0.9rem; color: #666; }

  /* Aufklappbare Box */
  #recentBox {
    margin-top: 20px;
    background: #fafbff;
    border-radius: 10px;
    box-shadow: inset 0 1px 2px rgba(0,0,0,0.05);
    padding: 10px 15px;
    max-width: 500px;
    margin-inline: auto;
    display: none;
  }
  #recentList {
    list-style: none;
    padding: 0;
    margin: 10px 0 0;
  }
  #recentList li {
    border-bottom: 1px dashed #ddd;
    padding: 5px 0;
  }
  #recentList li:last-child { border-bottom: none; }
  .catLabel { font-size: 0.9rem; opacity: 0.75; }

  #toggleRecent {
    background: #edf3ff;
    color: #0d3b66;
    font-weight: 600;
    margin-top: 15px;
    border: 1px solid #d3def2;
  }
  #toggleRecent:hover { background: #e5edff; }

  .divider {
    border-top: 2px solid #e5e9f0;
    margin: 25px 0;
  }
</style>
</head>
<body>
  <div class="app">
    <h1>üéØ Vokabeltrainer</h1>

    <div class="row">
      <label>Kategorie:
        <select id="filterCategory">
          <option value="Alle">Alle (bunt gemischt)</option>
        </select>
      </label>
      <label>Modus:
        <select id="modeSelect">
          <option value="en-de">Englisch ‚Üí Deutsch</option>
          <option value="de-en">Deutsch ‚Üí Englisch</option>
        </select>
      </label>
    </div>

    <div class="main-buttons">
      <button id="startQuiz">‚úçÔ∏è Vokabel-Abfrage starten</button>
      <button id="last30">üìö Letzte 30 Vokabeln</button>
      <button id="cards">üß† Karteikarten starten</button>
    </div>

    <div class="row" style="margin-top:15px;">
      <label><input type="checkbox" id="showFeedback" checked /> Sofortiges Feedback anzeigen</label>
      <label> Toast-Dauer:
        <select id="toastTime">
          <option value="1000">1 s</option>
          <option value="1500">1,5 s</option>
          <option value="2000">2 s</option>
          <option value="3000">3 s</option>
        </select>
      </label>
    </div>

    <div class="divider"></div>

    <a href="vokabeln.html" class="linkbtn">üìò Vokabel√ºbersicht √∂ffnen</a>

    <button id="toggleRecent">üìú Zuletzt hinzugef√ºgt (anzeigen)</button>
    <div id="recentBox">
      <ul id="recentList"><li><em>Keine Vokabeln vorhanden.</em></li></ul>
    </div>

    <footer>¬© 2025 @Beefi</footer>
  </div>

<script>
(() => {
  const CATEGORY_NAMES = {
    Gelb:"Grundwerkzeuge Metallverarbeitung",
    Pink:"Werkzeugkasten Mechaniker",
    Blau:"Blech- / Kunststoffarbeiten",
    Gruen:"Drehen / Fr√§sen",
    HellesPink:"Hydraulik / Pneumatik",
    Orange:"Elektrotechnik",
    Dunkelgruen:"Flugger√§temechanik allgemein",
    Rot:"Verwechslungsgefahr"
  };
  const COLOR_MAP = {
    Gelb:"#F4D03F", Pink:"#E91E63", Blau:"#1976D2", Gruen:"#1E8449",
    HellesPink:"#F54927", Orange:"#E67E22", Dunkelgruen:"#117A65", Rot:"#C0392B"
  };

  const normalize = v => [v[0]||"", v[1]||"", v[2]||"Gelb", v[3]||"", v[4]||"", v[5]||new Date().toISOString()];
  const loadLocal = () => JSON.parse(localStorage.getItem("vokabeln")||"[]").map(normalize);
  const saveLocal = v => { localStorage.setItem("vokabeln",JSON.stringify(v)); localStorage.setItem("vokabeln_updated",new Date().toISOString()); };

  async function trySyncFromJson(){
    const urls=["./vokabeln.json","vokabeln.json",window.location.origin+"/vokabeln.json",window.location.origin+"/vokabeltrainer/vokabeln.json"];
    let remote=null;
    for(const u of urls){
      try{
        const r=await fetch(u,{cache:"no-store"});
        if(r.ok){ const d=await r.json(); if(Array.isArray(d)){remote=d;break;} }
      }catch{}
    }
    const local=loadLocal();
    if(!remote && local.length===0){
      const def=[["hammer","Hammer","Pink","","","2025-01-01T00:00:00Z"],["file","Feile","Gelb","","","2025-01-01T00:00:00Z"]];
      saveLocal(def);
    } else if(remote){
      const merged=merge(remote,local);
      saveLocal(merged);
    }
    renderRecent();
  }

  function merge(remote,local){
    const map=new Map();
    remote.map(normalize).forEach(v=>map.set(v[0].toLowerCase()+"|"+v[1].toLowerCase(),v));
    local.map(normalize).forEach(v=>{
      const k=v[0].toLowerCase()+"|"+v[1].toLowerCase();
      if(!map.has(k))map.set(k,v);
    });
    return Array.from(map.values());
  }

  function renderRecent(){
    const list=loadLocal();
    const last=list.slice(-5).reverse();
    const ul=document.getElementById("recentList");
    ul.innerHTML="";
    if(!last.length){ ul.innerHTML="<li><em>Keine Vokabeln vorhanden.</em></li>"; return; }
    last.forEach(([en,de,cat])=>{
      const li=document.createElement("li");
      li.innerHTML=`<b>${en}</b> ‚Äì ${de} <span class='catLabel' style='color:${COLOR_MAP[cat]||"#555"}'>(${CATEGORY_NAMES[cat]||cat})</span>`;
      ul.appendChild(li);
    });
  }

  document.getElementById("toggleRecent").onclick=()=>{
    const box=document.getElementById("recentBox");
    const btn=document.getElementById("toggleRecent");
    const visible=box.style.display==="block";
    box.style.display=visible?"none":"block";
    btn.textContent=visible?"üìú Zuletzt hinzugef√ºgt (anzeigen)":"üìú Zuletzt hinzugef√ºgt (verbergen)";
  };

  // Navigation:
  document.getElementById("startQuiz").onclick=()=>window.location.href="vokabeln.html?mode=quiz";
  document.getElementById("last30").onclick=()=>window.location.href="vokabeln.html?mode=last30";
  document.getElementById("cards").onclick=()=>window.location.href="vokabeln.html?mode=cards";

  trySyncFromJson();
})();
</script>
</body>
</html>
