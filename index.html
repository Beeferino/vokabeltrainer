<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>üéØ Vokabeltrainer</title>
<style>
  body {
    font-family: "Inter", system-ui, sans-serif;
    background: linear-gradient(180deg, #eef3f8 0%, #f9fbfd 100%);
    color: #222;
    margin: 0;
    padding: 30px 10px;
    text-align: center;
  }

  .app {
    max-width: 900px;
    margin: auto;
    background: #ffffff;
    border-radius: 18px;
    box-shadow: 0 4px 18px rgba(0,0,0,0.08);
    padding: 25px 30px;
    transition: box-shadow 0.2s ease;
  }

  h1 {
    margin-bottom: 18px;
    font-weight: 700;
    font-size: 1.8rem;
    color: #1e6ed8;
  }

  .controls label { margin: 0 10px; font-size: 1rem; }
  select {
    padding: 6px 10px;
    border-radius: 8px;
    border: 1px solid #cfd6e4;
    background: #f9fbfd;
  }

  .functions {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 15px;
    margin: 25px 0;
  }
  .kachel {
    background: #1e6ed8;
    color: #fff;
    padding: 14px 22px;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.25s ease;
    font-weight: 500;
    box-shadow: 0 2px 4px rgba(0,0,0,0.08);
  }
  .kachel:hover { background: #2980b9; transform: translateY(-3px); }

  .feedback-settings { margin-bottom: 10px; }

  .progress {
    font-weight: bold;
    color: #1e6ed8;
    margin-top: 20px;
    letter-spacing: 0.3px;
  }

  .card {
    background: #f8fafc;
    border-radius: 16px;
    padding: 35px 25px;
    box-shadow: 0 2px 12px rgba(0,0,0,0.06);
    margin-top: 25px;
    transition: all 0.2s ease;
    animation: fadeIn 0.5s ease;
  }
  @keyframes fadeIn { from {opacity:0; transform:translateY(8px);} to {opacity:1; transform:translateY(0);} }

  .category-badge {
    display: inline-block;
    padding: 8px 16px;
    border-radius: 50px;
    color: #fff;
    font-weight: 600;
    font-size: 0.95rem;
    box-shadow: 0 3px 8px rgba(0,0,0,0.08);
  }

  .word {
    font-size: 2rem;
    font-weight: 700;
    margin: 20px 0 10px;
  }

  .feedback {
    font-size: 1.2rem;
    color: #333;
    margin: 10px 0;
    min-height: 30px;
    transition: 0.3s;
  }

  #cardButtons { margin-top: 16px; }

  #cardButtons button {
    padding: 10px 22px;
    margin: 6px;
    border-radius: 10px;
    border: none;
    cursor: pointer;
    font-weight: 600;
    font-size: 1rem;
    transition: all 0.25s ease;
  }
  #rightBtn { background: #27ae60; color: white; }
  #wrongBtn { background: #e74c3c; color: white; }
  #skipBtn { background: #95a5a6; color: white; }
  #rightBtn:hover { background: #2ecc71; transform: translateY(-2px);}
  #wrongBtn:hover { background: #ff4e4e; transform: translateY(-2px);}
  #skipBtn:hover { background: #b0b8bb; transform: translateY(-2px);}

  .input-card {
    display: inline-flex;
    align-items: center;
    border: 2px solid #dce3ec;
    border-radius: 12px;
    padding: 10px 14px;
    background: #fff;
    box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    margin-top: 10px;
    transition: 0.2s;
  }
  .input-card:focus-within {
    border-color: #1e6ed8;
    box-shadow: 0 0 0 3px rgba(30,110,216,0.15);
  }
  .input-card input {
    border: none;
    outline: none;
    font-size: 1.1rem;
    padding: 6px;
    flex: 1;
  }
  .input-card .enter-icon {
    font-size: 1.2rem;
    color: #1e6ed8;
    margin-left: 6px;
  }

  .bottom-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 20px;
  }

  .restart {
    background: #1e6ed8;
    color: #fff;
    border: none;
    padding: 12px 26px;
    border-radius: 10px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.25s ease;
  }
  .restart:hover { background: #2980b9; transform: translateY(-2px); }

  .linkbtn {
    text-decoration: none;
    color: #1e6ed8;
    font-weight: 600;
  }

  .correct { animation: flashGreen 0.5s ease; }
  .wrong { animation: flashRed 0.5s ease; }

  @keyframes flashGreen {
    0%{box-shadow:0 0 0 rgba(46,204,113,0);}
    50%{box-shadow:0 0 20px rgba(46,204,113,0.5);}
    100%{box-shadow:0 0 0 rgba(46,204,113,0);}
  }
  @keyframes flashRed {
    0%{box-shadow:0 0 0 rgba(231,76,60,0);}
    50%{box-shadow:0 0 20px rgba(231,76,60,0.5);}
    100%{box-shadow:0 0 0 rgba(231,76,60,0);}
  }

  .footer { margin-top: 40px; font-size: 0.9rem; color: #666; }
  #datasourceStatus { margin-top: 10px; color: #666; font-size: 0.9rem; }

  #lastAddedBox {
    margin-top: 25px;
    background: #f4f7fb;
    border-radius: 10px;
    padding: 10px;
  }
</style>
</head>

<body>
<div class="app">
  <h1>üéØ Vokabeltrainer</h1>

  <div class="controls">
    <label>Kategorie:
      <select id="category"><option value="Alle">Alle (bunt gemischt)</option></select>
    </label>
    <label>Modus:
      <select id="mode">
        <option value="toGerman">Englisch ‚Üí Deutsch</option>
        <option value="toEnglish">Deutsch ‚Üí Englisch</option>
        <option value="mixed">Gemischt</option>
      </select>
    </label>
  </div>

  <div class="functions">
    <div class="kachel" id="learnBtn">‚úçÔ∏è Vokabel-Abfrage</div>
    <div class="kachel" id="last30Btn">üìö Letzte 30</div>
    <div class="kachel" id="cardsBtn">üß† Karteikarten</div>
  </div>

  <div class="feedback-settings">
    <label><input type="checkbox" id="feedbackToggle" checked> Feedback anzeigen</label>
    <label>Dauer:
      <select id="delayTime">
        <option value="1000">1 s</option>
        <option value="3000" selected>3 s</option>
        <option value="5000">5 s</option>
      </select>
    </label>
  </div>

  <div class="progress" id="progress" style="display:none"></div>

  <div id="trainer" style="display:none">
    <div class="card" id="card">
      <div id="categoryBadge" class="category-badge"></div>
      <div id="word" class="word"></div>
      <div id="feedback" class="feedback"></div>
      <div id="cardButtons">
        <button id="rightBtn" style="display:none">Richtig</button>
        <button id="wrongBtn" style="display:none">Falsch</button>
        <button id="skipBtn" style="display:none">√úberspringen</button>
      </div>
    </div>

    <div class="bottom-bar">
      <button class="restart" id="restartBtn">üîÑ Neustart</button>
      <a href="vokabeln.html" class="linkbtn">üìò Vokabeln</a>
    </div>
  </div>

  <div id="result" style="display:none" class="card"></div>

  <div class="footer">
    <small>¬© 2025 @Beefi</small>

    <div id="lastAddedBox">
      <h3 style="cursor:pointer;">üÜï Zuletzt hinzugef√ºgt ‚ñ≤</h3>
      <div id="lastAddedList" style="display:none;">‚Äì</div>
    </div>
  </div>
</div>

<div id="datasourceStatus">üíæ Datenquelle: Lokaler Speicher</div>

<script>
document.addEventListener("DOMContentLoaded",()=>{
  const C={"Gelb":"Grundwerkzeuge Metallverarbeitung","Pink":"Werkzeugkasten Mechaniker","Blau":"Blech-/ Kunststoffarbeiten","Gruen":"Drehen / Fr√§sen","HellesPink":"Hydraulik / Pneumatik","Orange":"Elektrotechnik","Dunkelgruen":"Flugger√§temechanik allgemein","Rot":"Verwechslungsgefahr"};
  const M={"Gelb":"#F4D03F","Pink":"#E91E63","Blau":"#1976D2","Gruen":"#1E8449","HellesPink":"#F54927","Orange":"#E67E22","Dunkelgruen":"#117A65","Rot":"#C0392B"};

  const cat=document.getElementById("category"), mSel=document.getElementById("mode"),
  fT=document.getElementById("feedbackToggle"), dT=document.getElementById("delayTime"),
  learn=document.getElementById("learnBtn"), cards=document.getElementById("cardsBtn"),
  last30=document.getElementById("last30Btn"), restart=document.getElementById("restartBtn"),
  word=document.getElementById("word"), feedback=document.getElementById("feedback"),
  right=document.getElementById("rightBtn"), wrong=document.getElementById("wrongBtn"),
  skip=document.getElementById("skipBtn"), progress=document.getElementById("progress"),
  trainer=document.getElementById("trainer"), result=document.getElementById("result"),
  card=document.getElementById("card"), badge=document.getElementById("categoryBadge"),
  status=document.getElementById("datasourceStatus");

  let list=[],round=[],i=0,errors=[],skipped=[],mode="mixed",game="learn",trap=false;

  async function sync(){
    try{
      const r=await fetch("https://beeferino.github.io/vokabeltrainer/vokabeln.json",{cache:"no-store"});
      if(!r.ok) throw new Error();
      const d=await r.json();
      localStorage.setItem("vokabeln",JSON.stringify(d));
      status.textContent="üåê Datenquelle: GitHub (Online)";
    }catch{
      status.textContent="üíæ Datenquelle: Lokaler Speicher";
    }
  }

  const S=k=>JSON.parse(localStorage.getItem(k)||"[]");
  function flash(cls){if(!fT.checked)return;card.classList.add(cls);setTimeout(()=>card.classList.remove(cls),400);}
  function updateProg(){progress.style.display="block";progress.textContent=`Vokabel ${i+1}/${round.length} | Fehler: ${errors.length}`;}

  function start(sel,type,custom=null){
    list=S("vokabeln");
    if(!list.length){alert("Keine Vokabeln gefunden.");return;}
    mode=sel;game=type;
    let f=(cat.value==="Alle"?list:list.filter(v=>v[2]===cat.value));
    if(custom)f=custom;
    round=f.slice(0,15);i=0;errors=[];skipped=[];
    trainer.style.display="block";result.style.display="none";
    showNext();
  }

  function showNext(){
    const delay=parseInt(dT.value,10);
    if(i>=round.length){
      if(skipped.length){round=skipped;skipped=[];i=0;feedback.textContent="üìò Jetzt die √ºbersprungenen!";updateProg();showNext();return;}
      trainer.style.display="none";progress.style.display="none";
      let h="<h3>Runde beendet</h3>";
      h+=errors.length?`<p>${errors.length} Fehler:</p><ul>${errors.map(([q,a])=>`<li>${q} ‚Üí ${a}</li>`).join("")}</ul>`:"<p>Keine Fehler üéâ</p>";
      h+='<button class="restart" onclick="location.reload()">üîÑ Neue Runde</button>';
      result.innerHTML=h;result.style.display="block";return;
    }

    updateProg();
    const [en,de,catg]=round[i];
    let ask,answ;
    if(mode==="toGerman"){ask=en;answ=de;} else if(mode==="toEnglish"){ask=de;answ=en;}
    else{if(Math.random()<.5){ask=en;answ=de;}else{ask=de;answ=en;}}

    const c=M[catg]||"#ccc";
    badge.style.background=c; badge.textContent=C[catg];
    word.textContent=ask; feedback.textContent="";

    if(game==="learn"){
      right.style.display="none"; wrong.style.display="none"; skip.style.display="inline-block";
      feedback.innerHTML=`
        <div class="input-card">
          <input id="answerInput" type="text" placeholder="√úbersetzung eingeben...">
          <span class="enter-icon">‚èé</span>
        </div>`;
      const input=document.getElementById("answerInput");
      input.focus();
      input.onkeydown=e=>{
        if(e.key==="Enter"){
          const ok=input.value.trim().toLowerCase()===answ.toLowerCase();
          feedback.textContent=ok?"‚úÖ Richtig!":`‚ùå Falsch! ‚Üí ${answ}`;
          flash(ok?"correct":"wrong");
          if(!ok)errors.push([ask,answ]);
          i++;setTimeout(showNext,delay);
        }
      };
      skip.onclick=()=>{skipped.push([en,de,catg]);i++;showNext();};
    } else {
      right.style.display="inline-block";wrong.style.display="inline-block";skip.style.display="inline-block";
      trap=Math.random()<.3;const curr=trap?getWrong(answ):answ;
      feedback.innerHTML=`üí° <b>${curr}</b>`;
      right.onclick=()=>{const ok=!trap;if(fT.checked){feedback.textContent=ok?"‚úÖ Richtig!":"‚ùå Falsch!";flash(ok?"correct":"wrong");}if(!ok)errors.push([ask,answ]);i++;setTimeout(showNext,delay);};
      wrong.onclick=()=>{const ok=trap;if(fT.checked){feedback.textContent=ok?"‚úÖ Richtig!":"‚ùå Falsch!";flash(ok?"correct":"wrong");}if(!ok)errors.push([ask,answ]);i++;setTimeout(showNext,delay);};
      skip.onclick=()=>{skipped.push([en,de,catg]);i++;showNext();};
    }
  }

  function getWrong(correct){
    const pool=list.map(v=>v[1]);
    let wrong;do{wrong=pool[Math.floor(Math.random()*pool.length)];}while(wrong===correct);
    return wrong;
  }

  learn.onclick=()=>start(mSel.value,"learn");
  cards.onclick=()=>start(mSel.value,"cards");
  last30.onclick=()=>{const all=S("vokabeln");if(!all.length){alert("Keine Vokabeln.");return;}const last=all.slice(-30);const choice=confirm("üìö Letzte 30:\nOK = Karteikarten\nAbbrechen = Eingabe");start(mSel.value,choice?"cards":"learn",last);};
  restart.onclick=()=>location.reload();

  function renderCats(){for(const k in C){const o=document.createElement("option");o.value=k;o.textContent=" "+C[k];o.style.backgroundColor=M[k];o.style.color="#fff";cat.appendChild(o);}}
  function lastAdded(){const box=document.getElementById("lastAddedList"),all=S("vokabeln");if(!all.length){box.textContent="Keine Vokabeln.";return;}const last=all.slice(-5).reverse();box.innerHTML=last.map(v=>`<div><b>${v[0]}</b> ‚Äì ${v[1]} <span style="color:${M[v[2]]}">(${C[v[2]]})</span></div>`).join("");}

  (async()=>{await sync();renderCats();lastAdded();})();
  const header=document.querySelector("#lastAddedBox h3"),listBox=document.getElementById("lastAddedList");
  let open=false;header.onclick=()=>{open=!open;listBox.style.display=open?"block":"none";header.innerHTML=open?"üÜï Zuletzt hinzugef√ºgt ‚ñº":"üÜï Zuletzt hinzugef√ºgt ‚ñ≤";};
});
</script>
</body>
</html>
