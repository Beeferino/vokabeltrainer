<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Vokabeltrainer</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --blue:#2563eb;--blue2:#1d4ed8;--ink:#0f172a;
  --glass:rgba(255,255,255,.88);
  --ok:#22c55e;--bad:#ef4444;--muted:#9ca3af
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter,system-ui,sans-serif;
  background:linear-gradient(145deg,#eef4ff,#dbeafe);
  color:var(--ink)
}
.app{
  max-width:960px;margin:32px auto;
  padding:22px;background:var(--glass);
  border-radius:22px;
  box-shadow:0 10px 32px rgba(0,0,0,.10);
  backdrop-filter:blur(8px)
}
h1{
  margin:0;text-align:center;
  font-size:2rem;font-weight:800;color:#1e3a8a
}
.hr{
  width:160px;height:4px;background:var(--blue);
  border-radius:4px;margin:10px auto 20px
}
.controls,.functions{
  display:flex;flex-wrap:wrap;justify-content:center;gap:12px
}
.controls label{display:flex;align-items:center;gap:6px}
select{
  padding:8px 12px;border:1px solid #d1d5db;
  border-radius:10px;font-size:1rem;background:#fff
}
.kachel{
  flex:1 1 240px;text-align:center;
  background:var(--blue);color:#fff;
  padding:14px 18px;border-radius:14px;
  font-weight:700;cursor:pointer;
  box-shadow:0 6px 16px rgba(37,99,235,.25);
  transition:transform .15s,background .15s, box-shadow .15s
}
.kachel small{display:block;margin-top:6px;font-weight:600;opacity:.9}
.kachel:hover{transform:translateY(-1px);background:var(--blue2);box-shadow:0 8px 18px rgba(37,99,235,.30)}
.progress{text-align:center;font-weight:700;margin:8px 0 12px;min-height:1.2em}
#stage{
  display:none;margin-top:14px;padding:28px;border-radius:20px;
  background:rgba(255,255,255,.95);
  box-shadow:inset 0 0 10px rgba(0,0,0,.05);
  text-align:center;transition:background .2s ease
}
.chip{display:inline-block;font-weight:800;padding:8px 14px;border-radius:999px;margin-bottom:10px}
.word{font-size:1.9rem;font-weight:800;margin:8px 0 6px}
.offer{font-size:1.1rem;color:#1f2937;margin:6px 0 12px;min-height:1.3em}
.btnrow{display:flex;justify-content:center;gap:12px;flex-wrap:wrap}
.btn{
  border:none;border-radius:12px;padding:10px 20px;
  font-weight:700;font-size:1rem;cursor:pointer
}
.ok{background:var(--ok);color:#fff}
.bad{background:var(--bad);color:#fff}
.skip{background:var(--muted);color:#fff}
.inprow{
  display:none;gap:8px;justify-content:center;margin-top:12px
}
.inprow input{
  width:60%;min-width:260px;padding:10px 14px;
  border:1px solid #d1d5db;border-radius:12px;font-size:1rem
}
.inprow button{
  background:var(--blue);color:#fff;border:none;
  border-radius:12px;padding:10px 16px;font-weight:700
}
.flash-correct{animation:good .4s}
.flash-wrong{animation:bad .4s}
@keyframes good{from{background:#dcfce7}to{background:rgba(255,255,255,.95)}}
@keyframes bad{from{background:#fee2e2}to{background:rgba(255,255,255,.95)}}
.footer-actions {
  display: flex;
  justify-content: space-between;
  gap: 12px;
  margin-top: 24px;
}
.footer-actions a,
.footer-actions button {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  background: linear-gradient(135deg, #eaf0ff, #f8faff);
  border: 1px solid #dbe3ff;
  color: #1f2937;
  padding: 10px 16px;
  border-radius: 12px;
  font-weight: 700;
  cursor: pointer;
  text-decoration: none;
  font-size: 1rem;
  box-shadow: 0 3px 8px rgba(0,0,0,0.05);
  transition: all 0.25s ease;
}
.footer-actions a:hover,
.footer-actions button:hover {
  background: linear-gradient(135deg, #e0e7ff, #f1f5ff);
  transform: translateY(-1px);
  box-shadow: 0 5px 12px rgba(37,99,235,0.15);
}
.feedback-toggle{
  display:flex;align-items:center;justify-content:center;
  gap:10px;margin:8px 0 6px;
  padding:12px 18px;border-radius:16px;
  background: linear-gradient(135deg, #f8fafc, #eef2ff);
  box-shadow: 0 2px 8px rgba(0,0,0,.08);
  transition: all .25s ease;
}
.feedback-toggle:hover {
  box-shadow: 0 4px 12px rgba(37,99,235,.15);
  transform: translateY(-1px);
}
.feedback-toggle label {
  font-weight: 700;
  color: #1e3a8a;
  font-size: 1.05rem;
  letter-spacing: 0.3px;
  cursor: pointer;
}
#chkFeedback {
  appearance: none;
  width: 44px;height:24px;background:#d1d5db;border-radius:999px;
  position:relative;outline:none;cursor:pointer;transition:background .3s ease
}
#chkFeedback::before{
  content:"";position:absolute;top:3px;left:3px;width:18px;height:18px;
  background:#fff;border-radius:50%;transition:all .3s ease;box-shadow:0 1px 4px rgba(0,0,0,.2)
}
#chkFeedback:checked{background:#2563eb}
#chkFeedback:checked::before{left:23px;background:#fff}
.controls{margin-bottom:5px}
.trenner{
  height:3px;width:60%;margin:50px auto 20px;
  background:linear-gradient(90deg,transparent,#93c5fd,#2563eb,#93c5fd,transparent);
  border-radius:2px;animation:shine 5s linear infinite
}
@keyframes shine{0%{background-position:0 0}100%{background-position:400px 0}}
details.recent-section{
  background:rgba(255,255,255,.9);
  border-radius:20px;padding:22px;
  margin-top:10px;text-align:center;
  box-shadow:0 8px 28px rgba(0,0,0,.08);
  backdrop-filter:blur(12px);
  transition:all .3s ease;
}
details.recent-section[open]{background:rgba(255,255,255,1);box-shadow:0 10px 32px rgba(0,0,0,.12)}
details.recent-section summary{
  font-weight:800;font-size:1.15rem;color:#1e3a8a;
  cursor:pointer;list-style:none;letter-spacing:.5px;text-transform:uppercase;
  transition:color .3s ease;
}
details.recent-section summary:hover{color:#2563eb}
#recent{
  margin-top:18px;text-align:center;line-height:1.8;
  display:flex;flex-wrap:wrap;justify-content:center;
  gap:12px;transition:opacity .4s ease;
}
.recent-item{
  display:inline-block;min-width:160px;
  border-radius:14px;padding:12px 18px;
  font-weight:700;color:#111827;
  box-shadow:0 4px 12px rgba(0,0,0,.1);
  transition:transform .25s ease,box-shadow .25s ease;
}
.recent-item:hover{
  transform:translateY(-3px) scale(1.02);
  box-shadow:0 6px 16px rgba(0,0,0,.15);
}
.recent-item small{
  display:block;font-weight:500;font-size:.85rem;
  margin-top:4px;opacity:.8
}
.foot{text-align:center;margin-top:14px;color:#6b7280;font-size:.92rem}
@media (max-width:520px){
  .kachel{flex:1 1 100%}
  .inprow input{width:100%}
}
</style>
</head>
<body>
<div class="app">
  <h1>üéØ Vokabeltrainer</h1>
  <div class="hr"></div>

  <div class="controls">
    <label>Kategorie:
      <select id="selCat">
        <option value="Alle">Alle (bunt gemischt)</option>
        <option value="Gelb" style="background:#F4D03F;color:#000">Grundwerkzeuge Metallverarbeitung</option>
        <option value="Pink" style="background:#E91E63;color:#fff">Werkzeugkasten Mechaniker</option>
        <option value="Blau" style="background:#1976D2;color:#fff">Blech- / Kunststoffarbeiten</option>
        <option value="Gruen" style="background:#1E8449;color:#fff">Drehen / Fr√§sen</option>
        <option value="HellesPink" style="background:#F54927;color:#fff">Hydraulik / Pneumatik</option>
        <option value="Orange" style="background:#E67E22;color:#fff">Elektrotechnik</option>
        <option value="Dunkelgruen" style="background:#117A65;color:#fff">Flugger√§temechanik allgemein</option>
        <option value="Rot" style="background:#C0392B;color:#fff">Verwechslungsgefahr</option>
      </select>
    </label>
    <label>Modus:
      <select id="selMode">
        <option value="mixed">Gemischt</option>
        <option value="toGerman">Englisch ‚Üí Deutsch</option>
        <option value="toEnglish">Deutsch ‚Üí Englisch</option>
      </select>
    </label>
    <label>Delay:
      <select id="selDelay">
        <option value="1000">1 s</option>
        <option value="3000" selected>3 s</option>
        <option value="5000">5 s</option>
      </select>
    </label>
  </div>

  <div class="feedback-toggle">
    <input type="checkbox" id="chkFeedback" checked>
    <label for="chkFeedback">Feedback anzeigen</label>
  </div>

  <div class="functions">
    <div id="btnLearn" class="kachel">‚úçÔ∏è Vokabel-Abfrage starten</div>
    <div id="btnLast30" class="kachel">üìó Letzte eingebene Vokabeln</div>
    <div id="btnCards" class="kachel">
      üß† Karteikarten
      <small><i style="display:block;text-align:center">Mitdenker&nbsp;Edition</i></small>
    </div>
  </div>

  <div id="progress" class="progress"></div>

  <section id="stage">
    <div id="chip" class="chip">Kategorie</div>
    <div id="q" class="word"></div>
    <div id="offer" class="offer"></div>

    <div id="rowButtons" class="btnrow">
      <button id="btnRight" class="btn ok">Richtig</button>
      <button id="btnDec" class="btn bad">T√§uschung erkannt</button>
      <button id="btnSkip" class="btn skip">√úberspringen</button>
    </div>

    <div id="rowInput" class="inprow">
      <input id="inp" type="text" placeholder="√úbersetzung eingeben ‚Ä¶">
      <button id="btnSub">Eingabe</button>
    </div>
  </section>

  <div class="footer-actions">
    <a href="vokabeln.html">üìÇ Vokabeln</a>
    <button id="btnRestart">üîÑ Neustart</button>
  </div>

  <div class="trenner"></div>

  <details class="recent-section" open>
    <summary>Zuletzt hinzugef√ºgt</summary>
    <div id="recent">‚Äì</div>
  </details>

  <div class="foot">¬© 2025 Beeferino ‚Ä¢ Datenquelle: GitHub / lokal</div>
  <div id="syncState" style="text-align:center;margin-top:6px;font-size:.9rem;color:#22c55e;opacity:.4;transition:opacity 1s;">üü¢ Daten aktuell</div>
</div>

<script>
(function(){
/* Kategorien */
const CATS={
  Gelb:["Grundwerkzeuge Metallverarbeitung","#F4D03F","#000"],
  Pink:["Werkzeugkasten Mechaniker","#E91E63","#fff"],
  Blau:["Blech- / Kunststoffarbeiten","#1976D2","#fff"],
  Gruen:["Drehen / Fr√§sen","#1E8449","#fff"],
  HellesPink:["Hydraulik / Pneumatik","#F54927","#fff"],
  Orange:["Elektrotechnik","#E67E22","#fff"],
  Dunkelgruen:["Flugger√§temechanik allgemein","#117A65","#fff"],
  Rot:["Verwechslungsgefahr","#C0392B","#fff"]
};
const $=id=>document.getElementById(id);

/* DOM */
const selCat=$("selCat"), selDelay=$("selDelay"), chkFeedback=$("chkFeedback"), selMode=$("selMode");
const btnLearn=$("btnLearn"), btnCards=$("btnCards"), btnLast30=$("btnLast30"), btnRestart=$("btnRestart");
const progress=$("progress"), stage=$("stage"), chip=$("chip"), q=$("q"), offer=$("offer");
const btnRight=$("btnRight"), btnDec=$("btnDec"), btnSkip=$("btnSkip");
const rowButtons=$("rowButtons"), rowInput=$("rowInput"), inp=$("inp"), btnSub=$("btnSub"), recent=$("recent");
const syncState=$("syncState");

/* Daten */
let data=[], lastSync=null;

/* Laden & Sync */
async function fetchFromGitHub(){
  try{
    const r=await fetch("https://beeferino.github.io/vokabeltrainer/vokabeln.json",{cache:"no-store"});
    if(!r.ok) throw new Error("fetch failed");
    const j=await r.json();
    localStorage.setItem("vokabeln",JSON.stringify(j));
    localStorage.setItem("vokabeln_updated",new Date().toISOString());
    data=j; lastSync=new Date();
  }catch(e){
    data=JSON.parse(localStorage.getItem("vokabeln")||"[]");
  }
}
async function loadData(){
  const localUpd=localStorage.getItem("vokabeln_updated");
  const lastUsed=localStorage.getItem("index_last_sync");
  const localNewer = localUpd && (!lastUsed || new Date(localUpd) > new Date(lastUsed));
  if(localNewer){
    data=JSON.parse(localStorage.getItem("vokabeln")||"[]");
  }else{
    await fetchFromGitHub();
  }
  localStorage.setItem("index_last_sync",new Date().toISOString());
  renderRecent();
}
function setSync(msg,color="#22c55e"){syncState.textContent=msg;syncState.style.color=color;syncState.style.opacity=1;setTimeout(()=>syncState.style.opacity=.4,1200);}
async function poll(){
  try{
    const r=await fetch("https://beeferino.github.io/vokabeltrainer/vokabeln.json",{cache:"no-store"});
    const j=await r.json();
    const local=JSON.parse(localStorage.getItem("vokabeln")||"[]");
    if(JSON.stringify(j)!==JSON.stringify(local)){
      localStorage.setItem("vokabeln",JSON.stringify(j));
      localStorage.setItem("vokabeln_updated",new Date().toISOString());
      data=j; renderRecent(); setSync("üîÑ Neue Daten aus Cloud geladen");
    }else{
      setSync("üü¢ Daten aktuell");
    }
  }catch{
    setSync("‚ö†Ô∏è Offline / kein Update m√∂glich","#ef4444");
  }
}

/* Helpers Spiel */
function shuffle(a){for(let i=a.length-1;i>0;i--){const r=Math.floor(Math.random()*(i+1));[a[i],a[r]]=[a[r],a[i]];}}
function pick(list){let l=selCat.value==="Alle"?list:list.filter(v=>v[2]===selCat.value);shuffle(l);return l.slice(0,15);}
function setProg(){progress.textContent=`Vokabel ${idx+1}/${round.length} | Fehler: ${errorsList.length}`;}
function showStage(show){stage.style.display=show?"block":"none";}

/* Flash mit Feedback-Respekt */
function flash(ok){
  if(!chkFeedback.checked){
    idx++; next(); return;
  }
  stage.classList.add(ok?"flash-correct":"flash-wrong");
  setTimeout(()=>{stage.classList.remove(ok?"flash-correct":"flash-wrong");idx++;next();}, delay);
}

/* Buttons mischen f√ºr Karteikarten */
function randomizeButtons(){
  const btns=[btnRight,btnDec,btnSkip];
  const order=[0,1,2].sort(()=>Math.random()-0.5);
  rowButtons.innerHTML="";
  order.forEach(i=>rowButtons.appendChild(btns[i]));
}

/* Spiel-States */
let round=[], idx=0, game="learn", delay=3000, trap=false, correct="";
let errorsList=[];

/* N√§chste Frage */
function next(){
  if(idx>=round.length){
    if(errorsList.length){
      alert(`‚ùó ${errorsList.length} Fehler ‚Äì Wiederholungsrunde startet.`);
      round=errorsList.slice(); errorsList=[]; idx=0;
      btnSkip.style.display="none";
      next(); return;
    }else{
      showStage(false);
      alert("üéâ Runde beendet ‚Äì alles korrekt!");
      return;
    }
  }

  delay=parseInt(selDelay.value,10);

  const [en,de,cat]=round[idx];
  const meta=CATS[cat]||["Kategorie","#ddd","#000"];
  chip.textContent=meta[0];
  chip.style.background=meta[1];
  chip.style.color=meta[2];
  stage.style.background="linear-gradient(0deg, rgba(0,0,0,.02), rgba(0,0,0,.02)), " + meta[1] + "22";

  const askEN = selMode.value==="toGerman" ? true : selMode.value==="toEnglish" ? false : Math.random()<0.5;
  const question=askEN?en:de;
  const answer  =askEN?de:en;
  correct=answer;

  q.textContent=question;

  if(game==="cards"){
    trap=false;
    if(Math.random()<0.30){
      const pool=data.map(v=>askEN?v[1]:v[0]);
      let wrong;
      do{ wrong = pool[Math.floor(Math.random()*pool.length)]; }while(wrong===answer);
      offer.textContent="üí° "+wrong;
      trap=true;
    }else{
      offer.textContent="üí° "+answer;
    }
    rowButtons.style.display="flex";
    rowInput.style.display="none";
    inp.value="";
    randomizeButtons();
  }else{
    offer.textContent="";
    trap=false;
    rowButtons.style.display="flex";
    btnRight.style.display="none";
    btnDec.style.display="none";
    btnSkip.style.display="inline-block";
    rowInput.style.display="flex";
    inp.value="";
    inp.focus();
    // F√ºr Learn: Enter auf Eingabe
  }

  setProg();
  showStage(true);
}

/* Events ‚Äì Karteikarten */
btnRight.onclick = ()=>{
  const ok = !trap;
  if(!ok) errorsList.push(round[idx]);
  flash(ok);
};

btnDec.onclick = ()=>{
  if(game!=="cards") return;
  if(trap){
    // T√§uschung korrekt erkannt ‚Üí Eingabe aktivieren
    rowInput.style.display="flex";
    inp.value="";
    inp.focus();
    btnSub.onclick=()=>{
      const ok = inp.value.trim().toLowerCase() === correct.toLowerCase();
      if(ok){
        // korrekt gel√∂st
        flash(true);
      }else{
        // falsch ‚Üí L√∂sung zeigen, dann bewerten
        offer.innerHTML = `‚ùå Richtige Antwort: <b>${correct}</b>`;
        errorsList.push(round[idx]);
        setTimeout(()=>flash(false), delay);
      }
    };
  }else{
    // T√§uschung f√§lschlich erkannt ‚Üí Fehler
    errorsList.push(round[idx]);
    flash(false);
  }
};

btnSkip.onclick = ()=>{
  errorsList.push(round[idx]);
  idx++; next();
};

/* Eingabepr√ºfung (Learn + ggf. nach T√§uschung) */
btnSub.onclick = ()=>{
  const ok = inp.value.trim().toLowerCase() === correct.toLowerCase();
  if(!ok) errorsList.push(round[idx]);
  flash(ok);
};
inp.addEventListener("keydown",e=>{ if(e.key==="Enter") btnSub.click(); });

/* Start-Buttons */
btnLearn.onclick = ()=>{
  game="learn"; idx=0; errorsList=[]; round=pick(data);
  btnRight.style.display="none";
  btnDec.style.display="none";
  btnSkip.style.display="inline-block";
  next();
};
btnCards.onclick = ()=>{
  game="cards"; idx=0; errorsList=[]; round=pick(data);
  btnRight.style.display="inline-block";
  btnDec.style.display="inline-block";
  btnSkip.style.display="inline-block";
  next();
};
btnLast30.onclick = ()=>{
  const l=data.slice(-30);
  if(!l.length){ alert("Keine Vokabeln vorhanden"); return; }
  const mitdenker = confirm("Mitdenker Edition aktivieren?\nOK = Karteikarten ‚Ä¢ Abbrechen = Eingabe");
  game = mitdenker ? "cards" : "learn";
  round=l; idx=0; errorsList=[];
  btnRight.style.display = game==="cards" ? "inline-block":"none";
  btnDec.style.display   = game==="cards" ? "inline-block":"none";
  btnSkip.style.display="inline-block";
  next();
};

/* Neustart */
btnRestart.onclick = ()=>location.reload();

/* Recent */
function renderRecent(){
  const last=data.slice(-5).reverse();
  if(!last.length){ recent.textContent="‚Äì"; return; }
  recent.innerHTML = last.map(v=>{
    const c=CATS[v[2]]||["","#ccc","#000"];
    return `<div class="recent-item" style="background:${c[1]};color:${c[2]}">
      <b>${v[0]}</b> ‚Äì ${v[1]}<br><small>${c[0]}</small>
    </div>`;
  }).join("");
}

/* Init */
loadData();
setTimeout(poll,800);
setInterval(poll,30000);
})();
</script>
</body>
</html>
