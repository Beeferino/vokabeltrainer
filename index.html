<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Vokabeltrainer</title>
<style>
body{font-family:sans-serif;background:#f7f9fb;margin:0;padding:20px;}
.app{max-width:900px;margin:auto;text-align:center;}
h1{font-size:1.8rem;margin-bottom:1rem;}
button,input,select{font-size:1rem;padding:8px 12px;border-radius:8px;border:1px solid #ccc;margin:5px;}
button{cursor:pointer;background:#2980b9;color:#fff;border:none;transition:background .2s ease,transform .1s ease;}
button:hover{background:#3498db;transform:translateY(-1px);}
.card{background:#fff;padding:20px;border-radius:16px;box-shadow:0 2px 6px rgba(0,0,0,0.1);margin-top:20px;}
.word{font-size:1.6rem;margin:20px 0;font-weight:600;}
.feedback{font-size:1.1rem;margin:10px 0;min-height:1.2em;}
.controls{display:flex;flex-wrap:wrap;gap:12px;align-items:center;justify-content:center;margin-bottom:25px;}
.functions{display:flex;flex-wrap:wrap;justify-content:center;gap:20px;margin:30px 0 10px;}
.kachel{flex:1 1 300px;max-width:360px;background:linear-gradient(145deg,#fff,#f0f4ff);border-radius:14px;box-shadow:0 3px 6px rgba(0,0,0,0.08);padding:16px;text-align:center;font-size:1.1rem;cursor:pointer;transition:all .25s ease;border:1px solid #dce3ef;}
.kachel:hover{background:linear-gradient(145deg,#e7f1ff,#ffffff);transform:translateY(-2px);box-shadow:0 6px 12px rgba(0,0,0,0.12);}
.feedback-settings{background:#f1f3f6;border-radius:12px;padding:12px 20px;margin:25px auto;max-width:600px;box-shadow:0 2px 5px rgba(0,0,0,0.08);display:flex;flex-wrap:wrap;justify-content:center;gap:15px;align-items:center;}
.progress{margin-top:10px;font-weight:600;font-size:1.05rem;min-height:1.2em;}
#cardButtons{display:flex;gap:12px;justify-content:center;align-items:center;margin-top:15px;}
#rightBtn{background:#2ECC71;color:#fff;}
#wrongBtn{background:#E74C3C;color:#fff;}
#skipBtn{background:#bdc3c7;color:#000;}
.footer{margin-top:30px;font-size:0.95rem;color:#555;}
a.linkbtn{display:inline-block;padding:10px 16px;border-radius:8px;background:#74b9ff;color:#000;text-decoration:none;font-weight:600;}
a.linkbtn:hover{background:#a6d4ff;}
.details-box{margin-top:10px;}
summary{cursor:pointer;font-weight:600;}
ul.last5{list-style:none;padding:0;margin-top:10px;}
ul.last5 li{margin:4px 0;}
.catLabel{font-size:0.9rem;}
#datasourceStatus{position:fixed;right:12px;bottom:10px;font-size:.8rem;opacity:.75;color:#555;}
</style>
</head>
<body>
<div class="app">
<h1>ğŸ¯ Vokabeltrainer</h1>

<div class="controls">
  <label>Kategorie:
    <select id="category">
      <option value="Alle">Alle (bunt gemischt)</option>
      <option value="Gelb" style="background:#F4D03F;color:#fff;">Grundwerkzeuge Metallverarbeitung</option>
      <option value="Pink" style="background:#E91E63;color:#fff;">Werkzeugkasten Mechaniker</option>
      <option value="Blau" style="background:#1976D2;color:#fff;">Blech- / Kunststoffarbeiten</option>
      <option value="Gruen" style="background:#1E8449;color:#fff;">Drehen / FrÃ¤sen</option>
      <option value="HellesPink" style="background:#F54927;color:#fff;">Hydraulik / Pneumatik</option>
      <option value="Orange" style="background:#E67E22;color:#fff;">Elektrotechnik</option>
      <option value="Dunkelgruen" style="background:#117A65;color:#fff;">FluggerÃ¤temechanik allgemein</option>
      <option value="Rot" style="background:#C0392B;color:#fff;">Verwechslungsgefahr</option>
    </select>
  </label>
  <label>Modus:
    <select id="mode">
      <option value="toGerman">Englisch â†’ Deutsch</option>
      <option value="toEnglish">Deutsch â†’ Englisch</option>
      <option value="mixed">Gemischt</option>
    </select>
  </label>
</div>

<div class="functions">
  <div class="kachel" id="learnBtn">âœï¸ Vokabel-Abfrage starten</div>
  <div class="kachel" id="last30Btn">ğŸ“š Letzte 30 Vokabeln</div>
  <div class="kachel" id="cardsBtn">ğŸ§  Karteikarten starten</div>
</div>

<details class="details-box">
  <summary>ğŸ“œ Zuletzt hinzugefÃ¼gt anzeigen</summary>
  <ul id="lastAdded" class="last5"></ul>
</details>

<div class="feedback-settings">
  <label><input type="checkbox" id="feedbackToggle" checked> Sofortiges Feedback anzeigen</label>
  <label>Feedback-Dauer:
    <select id="toastTime">
      <option value="400" selected>0,4 s</option>
      <option value="700">0,7 s</option>
      <option value="1000">1 s</option>
      <option value="1500">1,5 s</option>
    </select>
  </label>
</div>

<div class="progress" id="progress" style="display:none;"></div>

<div id="trainer" style="display:none;">
  <div class="card" id="card">
    <div id="word" class="word"></div>
    <input id="answerInput" type="text" placeholder="Ãœbersetzung eingeben..." style="display:none;">
    <div id="feedback" class="feedback"></div>
    <div id="cardButtons">
      <button id="rightBtn" style="display:none;">Richtig</button>
      <button id="wrongBtn" style="display:none;">Falsch</button>
      <button id="skipBtn" style="display:none;">Ãœberspringen</button>
    </div>
  </div>
  <button id="restartBtn" style="margin-top:10px;">ğŸ”„ Neustart</button>
</div>

<div id="result" style="display:none;" class="card"></div>

<div class="footer">
  <a href="vokabeln.html" class="linkbtn">ğŸ“˜ VokabelÃ¼bersicht Ã¶ffnen</a><br><br>
  <small>Â© 2025 @Beefi</small>
</div>
</div>

<div id="datasourceStatus">ğŸ’¾ Datenquelle: Lokaler Speicher</div>

<script>
(()=>{
const CATEGORY_NAMES={"Gelb":"Grundwerkzeuge Metallverarbeitung","Pink":"Werkzeugkasten Mechaniker","Blau":"Blech- / Kunststoffarbeiten","Gruen":"Drehen / FrÃ¤sen","HellesPink":"Hydraulik / Pneumatik","Orange":"Elektrotechnik","Dunkelgruen":"FluggerÃ¤temechanik allgemein","Rot":"Verwechslungsgefahr"};
const COLOR_MAP={"Gelb":"#F4D03F","Pink":"#E91E63","Blau":"#1976D2","Gruen":"#1E8449","HellesPink":"#F54927","Orange":"#E67E22","Dunkelgruen":"#117A65","Rot":"#C0392B"};
const $=s=>document.querySelector(s);

async function tryLoadFromJson(){
  try{
    const r=await fetch("vokabeln.json",{cache:"no-store"});
    if(r.ok){
      const data=await r.json();
      localStorage.setItem("vokabeln",JSON.stringify(data));
      $("#datasourceStatus").textContent="ğŸ“‚ JSON geladen";
    }
  }catch{}
  renderLastAdded();
}

function loadList(){
  const data=localStorage.getItem("vokabeln");
  if(!data) return [];
  try{return JSON.parse(data);}catch{return [];}
}
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}

let list=[],round=[],idx=0,errors=[],skipped=[],mode="mixed",gameType="learn";

function updateProgress(){document.getElementById("progress").textContent=`Frage ${idx+1}/${round.length} | Fehler: ${errors.length}`;}
function flash(c){const card=document.getElementById("card");card.classList.add(c);setTimeout(()=>card.classList.remove(c),300);}

function startRound(m,gt,custom=null){
  list=loadList();if(!list.length)return alert("Keine Vokabeln vorhanden!");
  const cat=$("#category").value;mode=m;gameType=gt;
  let f=cat==="Alle"?list:list.filter(v=>v[2]===cat);
  if(custom)f=custom;shuffle(f);
  round=f.slice(0,15); // 15 Vokabeln pro Runde
  idx=0;errors=[];skipped=[];
  $("#trainer").style.display="block";
  $("#progress").style.display="block";
  $("#result").style.display="none";
  showNext();
}

function showNext(){
  const card=$("#card"),input=$("#answerInput"),feedback=$("#feedback"),
        right=$("#rightBtn"),wrong=$("#wrongBtn"),skip=$("#skipBtn");
  if(idx>=round.length){
    $("#trainer").style.display="none";
    const res=$("#result");
    let html=`<h3>Runde beendet</h3>`;
    html+=errors.length?`<p>${errors.length} Fehler:</p><ul>${errors.map(e=>`<li>${e[0]} â†’ ${e[1]}</li>`).join("")}</ul>`:"<p>ğŸ‰ Keine Fehler!</p>";
    html+=`<br><button id='restartBtn2'>ğŸ”„ Neustart</button>`;
    res.innerHTML=html;res.style.display="block";
    document.getElementById("restartBtn2").onclick=()=>location.reload();
    return;
  }
  updateProgress();
  const [en,de,cat]=round[idx];
  let ask,answer;
  if(mode==="toGerman"){ask=en;answer=de;}
  else if(mode==="toEnglish"){ask=de;answer=en;}
  else{if(Math.random()<0.5){ask=en;answer=de;}else{ask=de;answer=en;}}
  $("#word").innerHTML=`<div style="background:${COLOR_MAP[cat]};color:#fff;border-radius:10px;padding:5px 10px;display:inline-block;">${CATEGORY_NAMES[cat]}</div><br><br>${ask}`;
  feedback.textContent="";

  if(gameType==="learn"){
    input.style.display="inline-block";right.style.display="none";wrong.style.display="none";skip.style.display="inline-block";
    input.value="";input.focus();
    input.onkeydown=e=>{
      if(e.key==="Enter"){
        const correct=input.value.trim().toLowerCase()===answer.toLowerCase();
        if($("#feedbackToggle").checked){feedback.textContent=correct?"âœ… Richtig!":`âŒ Falsch! (${answer})`;flash(correct?"correct":"wrong");}
        if(!correct)errors.push([ask,answer]);
        idx++;setTimeout(showNext,$("#toastTime").value);
      }
    };
    skip.onclick=()=>{skipped.push([en,de,cat]);idx++;showNext();};
  }else{
    input.style.display="none";right.style.display="inline-block";wrong.style.display="inline-block";skip.style.display="inline-block";
    const trap=Math.random()<0.3;const wrongAns=list[Math.floor(Math.random()*list.length)][1];
    const shown=trap?wrongAns:answer;feedback.innerHTML=`ğŸ’¡ <b>${shown}</b>`;
    const handle=isCorrect=>{
      const correct=(isCorrect&&!trap)||(!isCorrect&&trap);
      if($("#feedbackToggle").checked){feedback.textContent=correct?"âœ… Richtig!":"âŒ Falsch!";flash(correct?"correct":"wrong");}
      if(!correct)errors.push([ask,answer]);
      idx++;setTimeout(showNext,$("#toastTime").value);
    };
    right.onclick=()=>handle(true);wrong.onclick=()=>handle(false);skip.onclick=()=>{skipped.push([en,de,cat]);idx++;showNext();};
  }
}

function renderLastAdded(){
  const all=loadList();const ul=$("#lastAdded");if(!ul)return;
  const last=all.slice(-5).reverse();
  ul.innerHTML=last.map(([en,de,cat])=>`<li><b>${en}</b> â€“ ${de} <span class='catLabel' style='color:${COLOR_MAP[cat]}'>(${CATEGORY_NAMES[cat]})</span></li>`).join("");
}

// ğŸ”„ Echtzeit-Sync mit vokabeln.html
window.addEventListener("storage", e => {
  if(e.key==="vokabeln" && e.newValue){
    console.log("ğŸ”„ Neue Vokabel erkannt â€“ aktualisiere Anzeige");
    renderLastAdded();
  }
});

$("#learnBtn").onclick=()=>startRound($("#mode").value,"learn");
$("#cardsBtn").onclick=()=>startRound($("#mode").value,"cards");
$("#last30Btn").onclick=()=>{
  const all=loadList();if(!all.length)return alert("Keine Vokabeln vorhanden!");
  const last30=all.slice(-30);
  const choice=confirm("ğŸ“š Letzte 30 als Karteikarten?\nOK=Karteikarten, Abbrechen=Eingabe");
  startRound($("#mode").value,choice?"cards":"learn",last30);
};
$("#restartBtn").onclick=()=>location.reload();

tryLoadFromJson();
})();
</script>
</body>
</html>
