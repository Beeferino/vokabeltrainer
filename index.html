<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Vokabeltrainer</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

<style>
:root{
  /* brand */
  --ink:#0f172a;
  --muted:#6b7280;
  --ring:#93c5fd;
  --blue:#2563eb;
  --blue-2:#1d4ed8;
  --red:#ef4444;
  --glass:rgba(255,255,255,.92);

  /* category fallbacks */
  --c-Gelb:#F4D03F;       --t-Gelb:#000;
  --c-Pink:#E91E63;       --t-Pink:#fff;
  --c-Blau:#1976D2;       --t-Blau:#fff;
  --c-Gruen:#1E8449;      --t-Gruen:#fff;
  --c-HellesPink:#F54927; --t-HellesPink:#fff;
  --c-Orange:#E67E22;     --t-Orange:#fff;
  --c-Dunkelgruen:#117A65;--t-Dunkelgruen:#fff;
  --c-Rot:#C0392B;        --t-Rot:#fff;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,sans-serif;
  color:var(--ink);
  background:
     radial-gradient(1200px 600px at 75% -200px,#dbeafe 0,#e9efff 30%,transparent 60%),
     radial-gradient(800px 400px at -200px 80%,#e0e7ff 0,#eef2ff 40%,transparent 70%),
     #f6f8ff;
}

/* ---------- header ---------- */
.header{
  text-align:center;
  padding:28px 16px 8px;
}
.title{
  font-weight:800;
  letter-spacing:.3px;
  font-size: clamp(1.6rem, 2vw + 1rem, 2.2rem);
  color:#1e3a8a;
  margin:0;
}
.hr{
  width:180px; height:4px; margin:10px auto 0;
  background:linear-gradient(90deg,#60a5fa,#2563eb,#60a5fa);
  border-radius:4px;
}

/* ---------- control panel ---------- */
.panel{
  max-width:1100px;
  margin:18px auto 8px;
  padding:18px;
  background:var(--glass);
  border-radius:18px;
  box-shadow:0 12px 34px rgba(0,0,0,.10);
  backdrop-filter: blur(8px);
}

.row{
  display:flex; flex-wrap:wrap; gap:12px; justify-content:center;
}

.select, .pill{
  border:1px solid #dbe3ff;
  border-radius:12px;
  padding:10px 12px;
  background:#fff;
  min-width:220px;
  font-weight:600;
  box-shadow:0 4px 14px rgba(37,99,235,.06);
}
.select:focus-within{ outline:3px solid rgba(37,99,235,.2) }
select{
  appearance:none;
  border:none;
  background:transparent;
  width:100%;
  font:inherit;
  color:inherit;
  outline:none;
}
.select.colored{ color:#fff; font-weight:800 }
.select.colored select{ color:inherit }

/* big CTA cards */
.ctas{
  margin-top:10px;
  display:grid; grid-template-columns:repeat(3,minmax(240px,1fr));
  gap:14px;
}
@media (max-width:980px){ .ctas{grid-template-columns:1fr} }

.cardbtn{
  position:relative;
  border:none; color:#fff;
  font-weight:800; font-size:1.05rem;
  border-radius:16px;
  padding:18px 18px;
  cursor:pointer;
  box-shadow:0 18px 28px rgba(0,0,0,.12);
  transform: translateY(0);
  transition: transform .18s ease, box-shadow .18s ease, filter .18s ease;
}
.cardbtn:hover{ transform: translateY(-3px); box-shadow:0 22px 36px rgba(0,0,0,.16); filter:saturate(1.06) }
.cardbtn:active{ transform:translateY(0) scale(.98) }
.card-blue{ background:linear-gradient(135deg,#3b82f6,#1d4ed8) }
.card-gray{ background:linear-gradient(135deg,#64748b,#475569) }
.card-red { background:linear-gradient(135deg,#f87171,#ef4444) }

.cardbtn small{
  position:absolute; left:18px; bottom:8px;
  font-weight:600; font-style:italic; opacity:.9; font-size:.92rem
}

/* feedback toggle */
.feedback{
  margin-top:14px;
  display:flex; justify-content:center;
}
.toggle{
  background:#1d4ed8; color:#fff; border:none; font-weight:800;
  letter-spacing:.2px; padding:10px 14px; border-radius:999px; cursor:pointer;
  box-shadow:0 6px 16px rgba(29,78,216,.25);
}
.toggle[data-off="true"]{ background:#64748b }

/* ---------- stage ---------- */
.stage-wrap{
  max-width:1100px; margin:18px auto 28px;
  border-radius:22px; overflow:hidden;
  box-shadow:0 12px 34px rgba(0,0,0,.10);
  background:#fff;
}
.stage{
  padding:30px 18px 34px; text-align:center;
}

/* game card colored background */
.card{
  margin:0 auto; max-width:900px;
  border-radius:18px; padding:28px 22px 30px;
  color:#111; background:#fff;
  transition: background .25s ease, color .25s ease;
  position:relative;
  animation:fadeIn .25s ease;
}
@keyframes fadeIn{ from{opacity:0; transform:translateY(8px)} to{opacity:1; transform:none} }

.category-chip{
  display:inline-block; font-weight:800; padding:8px 14px;
  border-radius:999px; background:#111; color:#fff; margin-bottom:14px;
  box-shadow:0 6px 14px rgba(0,0,0,.18)
}
.word{
  font-weight:800; font-size: clamp(1.6rem, 2.6vw + 1rem, 3rem);
}
.sub{
  margin-top:6px; opacity:.9; font-weight:700
}

.progress{
  position:absolute; right:14px; top:12px;
  font-weight:800; opacity:.9
}

.btnbar{ margin-top:16px; display:flex; justify-content:center; gap:12px; flex-wrap:wrap }
.btn{
  border:none; border-radius:12px; padding:11px 16px; cursor:pointer; font-weight:800; color:#fff
}
.btn-ok{ background:#22c55e } .btn-bad{ background:#ef4444 }
.btn-skip{ background:#9ca3af } .btn-primary{ background:#2563eb }

/* input row (learn + mitdenker nach T√§uschung) */
.inputrow{ margin-top:16px; display:flex; gap:8px; justify-content:center; flex-wrap:wrap }
.inputrow input{
  min-width:280px; width:min(540px,80%);
  padding:12px 14px; border-radius:12px; border:1px solid #cfd6e4; font:inherit
}

.flash-correct{ animation:flashOK .5s }
.flash-wrong{ animation:flashBAD .5s }
@keyframes flashOK{ from{background:rgba(34,197,94,.20)} to{background:transparent} }
@keyframes flashBAD{ from{background:rgba(239,68,68,.25)} to{background:transparent} }

.helper{
  text-align:center; color:var(--muted); font-weight:700; margin-top:12px
}

.footer{
  text-align:center; color:#6b7280; padding:10px 0 30px; font-size:.95rem
}
.footer a{ text-decoration:none; font-weight:800; color:#1e40af }

/* small screens tweaks */
@media (max-width:560px){
  .select{ min-width:unset; width:100% }
  .toggle{ width:100% }
}
</style>
</head>

<body>
  <header class="header">
    <h1 class="title">Vokabeltrainer</h1>
    <div class="hr"></div>
  </header>

  <!-- CONTROL PANEL -->
  <section class="panel" aria-label="Steuerung">
    <div class="row">
      <div id="selCatWrap" class="select"><select id="selCat"></select></div>
      <div class="select">
        <select id="selMode">
          <option value="mixed">Gemischt</option>
          <option value="toGerman">Englisch ‚Üí Deutsch</option>
          <option value="toEnglish">Deutsch ‚Üí Englisch</option>
        </select>
      </div>
      <div class="select">
        <select id="selDelay">
          <option value="1000">1 Sekunde</option>
          <option value="3000" selected>3 Sekunden</option>
          <option value="5000">5 Sekunden</option>
        </select>
      </div>
    </div>

    <div class="ctas">
      <button id="btnLearn" class="cardbtn card-blue">‚úçÔ∏è Vokabel-Abfrage starten</button>
      <button id="btnCards" class="cardbtn card-gray">üß† Karteikarten<small>Mitdenker&nbsp;Edition</small></button>
      <button id="btnLast30" class="cardbtn card-red">üìó Letzte&nbsp;30&nbsp;Vokabeln</button>
    </div>

    <div class="feedback">
      <button id="btnFeedback" class="toggle" aria-pressed="true">Feedback: AN</button>
    </div>
  </section>

  <!-- STAGE -->
  <section class="stage-wrap" id="stageWrap" style="display:none">
    <div class="stage">
      <div id="card" class="card">
        <div class="progress" id="progress">Runde 1 / 15</div>
        <div id="chip" class="category-chip">Kategorie</div>
        <div id="word" class="word">‚Äî</div>
        <div id="offer" class="sub"> </div>

        <div class="btnbar" id="btnbarCards" style="display:none">
          <button class="btn btn-ok"   id="btnRight">Richtig</button>
          <button class="btn btn-bad"  id="btnDec">T√§uschung erkannt</button>
          <button class="btn btn-skip" id="btnSkip">√úberspringen</button>
        </div>

        <div class="inputrow" id="rowInput" style="display:none">
          <input id="inp" type="text" placeholder="√úbersetzung eingeben ‚Ä¶" />
          <button class="btn btn-primary" id="btnSubmit">Eingabe</button>
          <button class="btn btn-skip" id="btnSkip2">√úberspringen</button>
        </div>

        <div class="helper" id="helper" aria-live="polite"></div>
      </div>
    </div>
  </section>

  <div class="footer">
    <a href="vokabeln.html">üìò Vokabelliste √∂ffnen</a><br>
    ¬© 2025 ‚Ä¢ Online-Datenquelle: GitHub
  </div>

<script>
(() => {
  /* ---------- categories ---------- */
  const CATS = {
    Gelb:["Grundwerkzeuge Metallverarbeitung", getCSS('--c-Gelb'), getCSS('--t-Gelb')],
    Pink:["Werkzeugkasten Mechaniker",        getCSS('--c-Pink'), getCSS('--t-Pink')],
    Blau:["Blech- / Kunststoffarbeiten",      getCSS('--c-Blau'), getCSS('--t-Blau')],
    Gruen:["Drehen / Fr√§sen",                 getCSS('--c-Gruen'), getCSS('--t-Gruen')],
    HellesPink:["Hydraulik / Pneumatik",      getCSS('--c-HellesPink'), getCSS('--t-HellesPink')],
    Orange:["Elektrotechnik",                 getCSS('--c-Orange'), getCSS('--t-Orange')],
    Dunkelgruen:["Flugger√§temechanik allgemein", getCSS('--c-Dunkelgruen'), getCSS('--t-Dunkelgruen')],
    Rot:["Verwechslungsgefahr",               getCSS('--c-Rot'), getCSS('--t-Rot')]
  };

  function getCSS(name){
    return getComputedStyle(document.documentElement).getPropertyValue(name).trim();
  }

  // DOM refs
  const selCat = document.getElementById('selCat');
  const selCatWrap = document.getElementById('selCatWrap');
  const selMode = document.getElementById('selMode');
  const selDelay = document.getElementById('selDelay');
  const btnLearn = document.getElementById('btnLearn');
  const btnCards = document.getElementById('btnCards');
  const btnLast30 = document.getElementById('btnLast30');
  const btnFeedback = document.getElementById('btnFeedback');

  const stageWrap = document.getElementById('stageWrap');
  const card = document.getElementById('card');
  const chip = document.getElementById('chip');
  const word = document.getElementById('word');
  const offer = document.getElementById('offer');
  const progress = document.getElementById('progress');
  const btnbarCards = document.getElementById('btnbarCards');
  const rowInput = document.getElementById('rowInput');
  const inp = document.getElementById('inp');
  const btnSubmit = document.getElementById('btnSubmit');
  const btnSkip2 = document.getElementById('btnSkip2');
  const btnRight = document.getElementById('btnRight');
  const btnDec = document.getElementById('btnDec');
  const btnSkip = document.getElementById('btnSkip');
  const helper = document.getElementById('helper');

  // state
  let all = [];
  let round = [];
  let i = 0;
  let errors = [];
  let game = null;              // 'learn' | 'cards'
  let askEN = true;             // current question direction
  let correct = "";             // expected answer
  let trap = false;             // deceptive option in cards
  let feedback = true;

  // fill categories
  (function initCategories(){
    const optionAll = new Option("Alle (bunt gemischt)","Alle");
    selCat.appendChild(optionAll);
    Object.entries(CATS).forEach(([key,[name,bg,fg]])=>{
      const opt = new Option(name, key);
      opt.style.background = bg;
      opt.style.color = fg;
      selCat.appendChild(opt);
    });
    setSelectColor();
    selCat.addEventListener('change', setSelectColor);
  })();

  function setSelectColor(){
    const val = selCat.value;
    if(val==="Alle"){
      selCatWrap.classList.remove('colored');
      selCatWrap.style.background = "#fff";
      selCatWrap.style.color = "inherit";
    }else{
      const [name,bg,fg] = CATS[val] || ["","#fff","#111"];
      selCatWrap.classList.add('colored');
      selCatWrap.style.background = bg;
      selCatWrap.style.color = fg;
    }
  }

  // fetch vocab
  const RAW = "https://beeferino.github.io/vokabeltrainer/vokabeln.json";
  loadVocab();

  async function loadVocab(){
    try{
      const res = await fetch(RAW,{cache:'no-store'});
      all = await res.json();
      localStorage.setItem('vokabeln', JSON.stringify(all));
    }catch(e){
      all = JSON.parse(localStorage.getItem('vokabeln')||"[]");
    }
  }

  // helpers
  const rnd = n => Math.floor(Math.random()*n);
  function shuffle(a){ for(let j=a.length-1;j>0;j--){ const r=rnd(j+1); [a[j],a[r]]=[a[r],a[j]] } }
  function choose(list){
    let L = selCat.value==="Alle" ? list : list.filter(v=>v[2]===selCat.value);
    shuffle(L);
    return L.slice(0, Math.min(15, L.length || 0));
  }

  function setCardColor(catKey){
    const meta = CATS[catKey] || ["","#fff","#111"];
    chip.textContent = meta[0];
    chip.style.background = meta[1];
    chip.style.color = meta[2];

    // whole card
    card.style.background = meta[1];
    card.style.color = meta[2];
  }

  function setProgress(){
    progress.textContent = `Vokabel ${Math.min(i+1, round.length)} / ${round.length} | Fehler: ${errors.length}`;
  }

  function showStage(on=true){
    stageWrap.style.display = on ? "block" : "none";
  }

  function clearHelper(){ helper.textContent = ""; }

  function announce(text){ helper.textContent = text; }

  function next(){
    clearHelper();
    if(i >= round.length){
      if(errors.length){
        announce(`‚ùó ${errors.length} Fehler ‚Äì Wiederholungsrunde startet.`);
        round = errors.slice(); errors = []; i = 0;
        setTimeout(()=>{ next(); }, Math.max(+selDelay.value, 800));
        return;
      }
      showStage(false);
      alert("üéâ Runde beendet ‚Äì alles korrekt!");
      return;
    }

    const [en,de,cat] = round[i];
    setCardColor(cat);
    setProgress();

    // direction
    askEN = selMode.value==="toGerman" ? true :
            selMode.value==="toEnglish" ? false :
            Math.random()<.5;

    correct = askEN? de : en;
    word.textContent = askEN ? en : de;

    if(game === "cards"){
      // 30% deception
      trap = Math.random() < .30;
      const pool = all.map(v=> askEN ? v[1] : v[0]);
      const wrong = pool[rnd(pool.length)];
      offer.textContent = "üí° " + (trap ? wrong : correct);
      btnbarCards.style.display = "flex";
      rowInput.style.display = "none";
    }else{
      trap = false;
      offer.textContent = "";
      btnbarCards.style.display = "none";
      rowInput.style.display = "flex";
      inp.value = "";
      inp.focus();
    }
  }

  // feedback flash then advance
  function flash(ok){
    if(!feedback){
      i++;
      return next();
    }
    card.classList.remove('flash-correct','flash-wrong');
    void card.offsetWidth; // reflow
    card.classList.add(ok ? 'flash-correct' : 'flash-wrong');
    setTimeout(()=>{ i++; next(); }, (+selDelay.value) + 300);
  }

  // events ‚Äì CTAs
  btnFeedback.addEventListener('click', ()=>{
    feedback = !feedback;
    btnFeedback.dataset.off = (!feedback).toString();
    btnFeedback.textContent = "Feedback: " + (feedback? "AN":"AUS");
  });

  btnLearn.addEventListener('click', ()=>{
    game = "learn";
    errors = [];
    round = choose(all);
    i = 0; showStage(true); next();
  });

  btnCards.addEventListener('click', ()=>{
    game = "cards";
    errors = [];
    round = choose(all);
    i = 0; showStage(true); next();
  });

  btnLast30.addEventListener('click', ()=>{
    const last = all.slice(-30);
    if(!last.length) return alert("Keine Vokabeln vorhanden.");
    const useCards = confirm("Mitdenker Edition f√ºr die letzten 30?\nOK = Karteikarten ‚Ä¢ Abbrechen = Eingabe");
    game = useCards? "cards" : "learn";
    round = last;
    errors=[]; i=0; showStage(true); next();
  });

  // events ‚Äì learn / input
  btnSubmit.addEventListener('click', ()=>{
    const val = inp.value.trim();
    if(!val) return;
    const ok = normalize(val) === normalize(correct);
    if(!ok) errors.push(round[i]);
    if(ok) announce("‚úîÔ∏è Richtig");
    else announce(`‚ùå Falsch ‚Äì richtig w√§re: ‚Äú${correct}‚Äù`);
    flash(ok);
  });

  inp.addEventListener('keydown', (e)=>{
    if(e.key==="Enter") btnSubmit.click();
  });

  btnSkip2.addEventListener('click', ()=>{
    errors.push(round[i]); i++; next();
  });

  // events ‚Äì cards
  btnRight.addEventListener('click', ()=>{
    const ok = !trap;
    if(!ok) errors.push(round[i]);
    if(!ok) announce("Das war eine T√§uschung!");
    flash(ok);
  });

  btnDec.addEventListener('click', ()=>{
    if(!trap){
      errors.push(round[i]);
      announce("Keine T√§uschung ‚Äì das Paar war korrekt.");
      return flash(false);
    }
    // correct deception ‚Üí open input
    announce("T√§uschung erkannt ‚úÖ ‚Äì gib die richtige √úbersetzung ein.");
    btnbarCards.style.display="none";
    rowInput.style.display="flex";
    inp.value=""; inp.focus();
  });

  btnSkip.addEventListener('click', ()=>{
    errors.push(round[i]); i++; next();
  });

  // utils
  function normalize(s){ return (s||"").toString().trim().toLowerCase(); }
})();
</script>
</body>
</html>
