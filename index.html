<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Vokabeltrainer</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --ink:#0f172a; --muted:#6b7280; --glass:rgba(255,255,255,.9);
  --blue:#2563eb; --blue2:#1d4ed8; --ok:#22c55e; --bad:#ef4444; --grey:#9ca3af;
  --card:#fff; --shadow:0 12px 32px rgba(0,0,0,.12);
}
*{box-sizing:border-box}
html,body{margin:0;height:100%}
body{
  font-family:Inter,system-ui,sans-serif; color:var(--ink);
  background:linear-gradient(145deg,#eef4ff,#dbeafe);
}
.wrap{max-width:1100px;margin:32px auto;padding:16px}

/* Title */
h1{margin:0;text-align:center;font-weight:800;color:#1e3a8a;font-size:2rem}
.hr{width:180px;height:4px;background:var(--blue);border-radius:4px;margin:10px auto 24px}

/* Top controls */
.toolbar{
  display:grid;gap:10px;grid-template-columns:1fr 1fr 1fr auto;
  background:var(--glass);backdrop-filter:blur(10px);
  border-radius:18px;padding:16px;box-shadow:var(--shadow)
}
select{
  width:100%;padding:12px;border:1px solid #dbe3ff;border-radius:12px;
  font-weight:600; appearance:none; background:#fff; cursor:pointer;
}
.btn-kachel{
  display:flex;align-items:center;justify-content:center;gap:10px;
  border:none;border-radius:14px;padding:16px 18px;
  font-weight:800;color:#fff;cursor:pointer;transition:.18s transform, .18s filter;
  box-shadow:0 10px 24px rgba(37,99,235,.20)
}
.btn-kachel:hover{transform:translateY(-1px);filter:brightness(1.02)}
.k1{background:var(--blue)}
.k2{background:#3b82f6aa;color:#111}
.k3{background:#ef4444}
.krow{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;margin-top:8px}
.krow small{display:block;text-align:center;margin-top:2px;color:#334155;font-style:italic}

/* Feedback switch */
.fb-wrap{display:flex;align-items:center;gap:10px;justify-content:flex-end}
.switch{
  --w:64px; --h:34px;
  width:var(--w);height:var(--h);border-radius:999px;position:relative;background:#e5e7eb;cursor:pointer
}
.switch::after{
  content:"";position:absolute;inset:3px;left:3px;width:28px;height:28px;border-radius:50%;
  background:#fff;box-shadow:0 2px 8px rgba(0,0,0,.2);transition:.22s left, .22s background
}
.switch.on{background:var(--blue)}
.switch.on::after{left:calc(var(--w) - 31px)}

/* Mobile placement for feedback */
@media (max-width:820px){
  .toolbar{grid-template-columns:1fr;gap:12px}
  .krow{grid-template-columns:1fr}
  .fb-wrap{justify-content:center}
}

/* Stage (game area) */
.stage-outer{
  margin-top:20px;background:var(--glass);backdrop-filter:blur(8px);
  border-radius:18px;padding:26px;box-shadow:var(--shadow)
}
.progress{text-align:center;font-weight:800;margin-bottom:8px;min-height:1.3em}
.stage{
  margin:0 auto;max-width:900px;border-radius:18px;padding:28px;
  background:var(--card);box-shadow:inset 0 0 0 9999px rgba(255,255,255,.0);
  transition:background-color .25s ease, color .25s ease;
}
.cat-chip{
  display:inline-block;font-weight:800;padding:8px 16px;border-radius:999px;margin-bottom:14px;
  color:#111;background:#e5e7eb
}
.round-chip{display:inline-flex;align-items:center;gap:8px;padding:6px 12px;border-radius:999px;background:#00000022;color:#fff;font-weight:700}
.word{font-size:2.2rem;font-weight:900;margin:10px 0 8px}
.offer{font-size:1.2rem;margin:8px 0 14px}
.btnrow{display:flex;gap:12px;flex-wrap:wrap;justify-content:center;margin-top:8px}
.btn{
  border:none;border-radius:12px;padding:12px 18px;font-weight:800;cursor:pointer;transition:.15s transform
}
.btn:active{transform:scale(.98)}
.ok{background:var(--ok);color:#fff}
.bad{background:var(--bad);color:#fff}
.skip{background:var(--grey);color:#fff}
.inputrow{display:flex;gap:10px;justify-content:center;margin-top:14px}
.inputrow input{
  width:60%;min-width:260px;max-width:620px;padding:12px 14px;border:1px solid #dbe3ff;border-radius:12px;font-size:1rem
}
.inputrow button{background:var(--blue);color:#fff;border:none;border-radius:12px;padding:12px 16px;font-weight:800}

/* Flash feedback */
.flash-good{animation:good .35s}
.flash-bad{animation:bad .35s}
@keyframes good{from{filter:brightness(1.05)}to{filter:brightness(1)}}
@keyframes bad{from{filter:contrast(1.15)}to{filter:contrast(1)}}

/* Footer */
.footer{text-align:center;margin:18px 0;color:#64748b;font-weight:600}
.footer a{font-weight:800;text-decoration:none}
</style>
</head>
<body>
<div class="wrap">
  <h1>Vokabeltrainer</h1>
  <div class="hr"></div>

  <!-- Controls -->
  <div class="toolbar">
    <select id="selCat" title="Kategorie"></select>
    <select id="selMode" title="Abfrageart">
      <option value="mixed" selected>Gemischt</option>
      <option value="toGerman">Englisch ‚Üí Deutsch</option>
      <option value="toEnglish">Deutsch ‚Üí Englisch</option>
    </select>
    <select id="selDelay" title="Delay">
      <option value="1000">1 Sekunde</option>
      <option value="3000" selected>3 Sekunden</option>
      <option value="5000">5 Sekunden</option>
    </select>

    <div class="fb-wrap">
      <span style="font-weight:800;color:#1e3a8a">Feedback:</span>
      <div id="fbSwitch" class="switch"></div>
    </div>

    <div class="krow" id="krow">
      <button id="btnLearn" class="btn-kachel k1">‚úçÔ∏è Vokabel-Abfrage starten</button>
      <button id="btnCards" class="btn-kachel k2">üß† Karteikarten</button>
      <button id="btnLast30" class="btn-kachel k3">üìó Letzte 30 Vokabeln</button>
      <div style="grid-column:1/-1"><small>Mitdenker Edition</small></div>
    </div>
  </div>

  <!-- Stage -->
  <div class="stage-outer">
    <div id="progress" class="progress"></div>
    <div id="stage" class="stage" style="display:none">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:8px;flex-wrap:wrap">
        <div id="chip" class="cat-chip">Kategorie</div>
        <div id="roundChip" class="round-chip" style="display:none">‚ô¶ Runde 1 / 1</div>
      </div>
      <div id="q" class="word"></div>
      <div id="offer" class="offer"></div>

      <div id="rowButtons" class="btnrow">
        <button id="btnRight" class="btn ok">Richtig</button>
        <button id="btnDecoy" class="btn bad">T√§uschung erkannt</button>
        <button id="btnSkip" class="btn skip">√úberspringen</button>
      </div>

      <div id="rowInput" class="inputrow">
        <input id="inp" type="text" placeholder="√úbersetzung eingeben ‚Ä¶">
        <button id="btnSubmit">Eingabe</button>
      </div>
    </div>
  </div>

  <div class="footer">
    <a href="vokabeln.html">üìÇ Vokabelliste √∂ffnen</a><br>
    ¬© 2025 Beeferino ‚Ä¢ Online-Datenquelle: GitHub
  </div>
</div>

<script>
/* ===== Kategorien (Name, bg, fg) ===== */
const CATS = {
  Gelb:        ["Grundwerkzeuge Metallverarbeitung", "#F4D03F", "#000"],
  Pink:        ["Werkzeugkasten Mechaniker",         "#E91E63", "#fff"],
  Blau:        ["Blech- / Kunststoffarbeiten",       "#1976D2", "#fff"],
  Gruen:       ["Drehen / Fr√§sen",                   "#1E8449", "#fff"],
  HellesPink:  ["Hydraulik / Pneumatik",             "#F54927", "#fff"],
  Orange:      ["Elektrotechnik",                     "#E67E22", "#fff"],
  Dunkelgruen: ["Flugger√§temechanik allgemein",      "#117A65", "#fff"],
  Rot:         ["Verwechslungsgefahr",               "#C0392B", "#fff"]
};
const RAW_URL = "https://beeferino.github.io/vokabeltrainer/vokabeln.json";

/* ===== Helpers ===== */
const el = id => document.getElementById(id);
const selCat = el("selCat"), selMode = el("selMode"), selDelay = el("selDelay");
const fbSwitch = el("fbSwitch");
const progress = el("progress"), stage = el("stage"), chip = el("chip");
const roundChip = el("roundChip"), q = el("q"), offer = el("offer");
const rowButtons = el("rowButtons"), btnRight = el("btnRight"), btnDecoy = el("btnDecoy"), btnSkip = el("btnSkip");
const rowInput = el("rowInput"), inp = el("inp"), btnSubmit = el("btnSubmit");
const btnLearn = el("btnLearn"), btnCards = el("btnCards"), btnLast30 = el("btnLast30");

/* ===== State ===== */
let data = [];
let game = null; // 'learn' | 'cards'
let round = [];
let i = 0;
let errors = [];
let roundIndex = 1, totalRounds = 1;
let trap = false;
let correct = "";
let feedbackOn = JSON.parse(localStorage.getItem("fb_on") ?? "true");

/* ===== Init ===== */
(function init(){
  // fill category select
  selCat.innerHTML = `<option value="Alle">Alle (bunt gemischt)</option>` +
    Object.keys(CATS).map(k=>{
      const [name,bg,fg]=CATS[k];
      return `<option value="${k}" style="background:${bg};color:${fg}">${name}</option>`;
    }).join("");
  attachCatBG(); // paints the select according to chosen cat

  fbSwitch.classList.toggle("on", feedbackOn);

  loadData().then(()=>{
    // noop
  });

  /* events */
  fbSwitch.addEventListener("click", ()=>{
    feedbackOn = !feedbackOn;
    fbSwitch.classList.toggle("on", feedbackOn);
    localStorage.setItem("fb_on", JSON.stringify(feedbackOn));
  });

  selCat.addEventListener("change", attachCatBG);

  btnLearn.addEventListener("click", ()=> startLearn(pick(data)));
  btnCards.addEventListener("click", ()=> startCards(pick(data)));
  btnLast30.addEventListener("click", ()=> {
    const last = data.slice(-30);
    if(!last.length){ alert("Keine Vokabeln vorhanden."); return; }
    const useCards = confirm("Mitdenker Edition?\nOK = Karteikarten ‚Ä¢ Abbrechen = Eingabe");
    useCards ? startCards(last) : startLearn(last);
  });

  btnRight.addEventListener("click", ()=> judgeCards(true));
  btnDecoy.addEventListener("click", ()=> {
    if(game!=="cards") return;
    if(trap){
      // open input to fix
      rowInput.style.display="flex"; inp.value=""; inp.focus();
    }else{
      // wrong ‚Äì user dachte T√§uschung, war aber korrekt
      errors.push(round[i]);
      flash(false);
    }
  });
  btnSkip.addEventListener("click", ()=> {
    errors.push(round[i]);
    i++; next();
  });

  btnSubmit.addEventListener("click", submitInput);
  inp.addEventListener("keydown", e=>{ if(e.key==="Enter") submitInput(); });
})();

function attachCatBG(){
  const v = selCat.value;
  if(v==="Alle"){
    selCat.style.background="#fff"; selCat.style.color="#111";
  }else{
    const c = CATS[v]; selCat.style.background=c[1]; selCat.style.color=c[2];
  }
}

/* ===== Data ===== */
async function loadData(){
  try{
    const r = await fetch(RAW_URL,{cache:"no-store"});
    data = await r.json();
    localStorage.setItem("vokabeln", JSON.stringify(data));
  }catch(e){
    data = JSON.parse(localStorage.getItem("vokabeln")||"[]");
  }
}

function shuffle(a){ for(let j=a.length-1;j>0;j--){ const r=Math.floor(Math.random()*(j+1)); [a[j],a[r]]=[a[r],a[j]]; } }
function pick(list){
  const cat = selCat.value;
  let l = (cat==="Alle") ? list.slice() : list.filter(v=>v[2]===cat);
  shuffle(l);
  return l.slice(0,15);
}

/* ===== Gameplay ===== */
function startLearn(list){
  game = "learn";
  round = list.slice();
  i=0; errors=[]; roundIndex=1; totalRounds=1;
  btnRight.style.display="none"; btnDecoy.style.display="none"; btnSkip.style.display="inline-block";
  rowInput.style.display="flex"; inp.value="";
  next();
}
function startCards(list){
  game = "cards";
  round = list.slice();
  i=0; errors=[]; roundIndex=1; totalRounds=1;
  rowInput.style.display="none";
  btnRight.style.display="inline-block"; btnDecoy.style.display="inline-block"; btnSkip.style.display="inline-block";
  next();
}

function setProgress(){
  progress.textContent = `Vokabel ${Math.min(i+1, round.length)} / ${round.length} | Fehler: ${errors.length}`;
  roundChip.style.display = (totalRounds>1||roundIndex>1) ? "inline-flex" : "none";
  roundChip.textContent = `‚ô¶ Runde ${roundIndex} / ${totalRounds}`;
}

function colorStage(catKey){
  const meta = CATS[catKey] || ["","#e5e7eb","#111"];
  chip.textContent = meta[0];
  chip.style.background = meta[1];
  chip.style.color = meta[2];
  // tint card
  stage.style.background = meta[1];
  stage.style.color = meta[2];
  // overlay for readability
  stage.style.boxShadow = "inset 0 0 0 9999px rgba(255,255,255,.08)";
}

function randomizeButtons(){
  const arr = [btnRight, btnDecoy, btnSkip];
  const order = [0,1,2].sort(()=>Math.random()-0.5);
  rowButtons.innerHTML = "";
  order.forEach(ix=> rowButtons.appendChild(arr[ix]));
}

function next(){
  if(i>=round.length){
    if(errors.length){
      // start errors again
      round = errors.slice();
      errors = [];
      i=0; roundIndex++; totalRounds++;
      setProgress(); next();
      return;
    }else{
      stage.style.display="none";
      alert("üéâ Runde beendet!");
      return;
    }
  }

  const [en,de,catKey] = round[i];
  colorStage(catKey);
  setProgress();
  stage.style.display="block";

  const askEN = selMode.value==="toGerman" ? true : (selMode.value==="toEnglish" ? false : Math.random()<0.5);
  const question = askEN ? en : de;
  const answer   = askEN ? de : en;
  correct = answer;

  q.textContent = question;

  if(game==="cards"){
    // 30% decoy
    trap = Math.random()<0.30;
    if(trap){
      // propose wrong
      const pool = data.map(v=> askEN ? v[1] : v[0]);
      let wrong;
      do { wrong = pool[Math.floor(Math.random()*pool.length)]; } while(wrong===answer);
      offer.textContent = "üí° " + wrong;
    }else{
      offer.textContent = "üí° " + answer;
    }
    rowInput.style.display = "none";
    randomizeButtons();
  }else{
    // learn: no decoy, input required
    trap = false;
    offer.textContent = "";
    rowInput.style.display = "flex";
    btnRight.style.display="none"; btnDecoy.style.display="none"; btnSkip.style.display="inline-block";
    inp.value=""; inp.focus();
  }
}

function flash(ok){
  if(!feedbackOn){
    i++; next(); return;
  }
  stage.classList.add(ok ? "flash-good" : "flash-bad");
  const delay = parseInt(selDelay.value,10);
  setTimeout(()=>{
    stage.classList.remove(ok ? "flash-good" : "flash-bad");
    i++; next();
  }, delay);
}

function judgeCards(userSaysCorrect){
  if(game!=="cards") return;
  const isCorrect = userSaysCorrect && !trap;
  if(isCorrect){ flash(true); }
  else{
    errors.push(round[i]);
    flash(false);
  }
}

function submitInput(){
  const val = inp.value.trim();
  if(!val) return;
  const ok = val.toLowerCase() === correct.toLowerCase();
  if(!ok) errors.push(round[i]);
  flash(ok);
}

/* ===== small niceties ===== */
window.addEventListener("keydown", e=>{
  if(e.key===" " && game==="cards"){ e.preventDefault(); btnSkip.click(); }
});
</script>
</body>
</html>
