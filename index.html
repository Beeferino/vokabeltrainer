<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>üéØ Vokabeltrainer</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
  :root {
    --accent:#1e6ed8;
    --accent-light:#4a90e2;
    --bg:#f7f9fb;
    --card:#fff;
    --radius:14px;
    --shadow:0 4px 14px rgba(0,0,0,.08);
  }
  * {box-sizing:border-box;}
  body {
    font-family:'Inter',system-ui,sans-serif;
    background:var(--bg);
    margin:0;
    color:#222;
  }
  .app {
    max-width:700px;
    margin:30px auto;
    background:var(--card);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    padding:20px;
    text-align:center;
  }
  h1 {
    color:var(--accent);
    margin-bottom:6px;
  }
  .divider {
    width:70px;height:4px;margin:0 auto 20px;
    border-radius:3px;
    background:linear-gradient(90deg,var(--accent-light),var(--accent));
  }
  select, input[type="checkbox"] {
    border-radius:8px;
    padding:6px;
    border:1px solid #cfd6e4;
    font-family:'Inter';
  }
  label {margin:0 8px;}
  .functions {
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    justify-content:center;
    margin:20px 0;
  }
  .kachel {
    background:linear-gradient(135deg,var(--accent-light),var(--accent));
    color:#fff;
    padding:14px 18px;
    border-radius:var(--radius);
    cursor:pointer;
    box-shadow:0 2px 8px rgba(0,0,0,.12);
    transition:transform .2s,box-shadow .2s;
  }
  .kachel:hover {
    transform:translateY(-2px);
    box-shadow:0 4px 12px rgba(0,0,0,.18);
  }
  .settings {
    display:flex;
    justify-content:center;
    flex-wrap:wrap;
    gap:10px;
    align-items:center;
  }
  .card {
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    padding:20px;
    margin-top:20px;
    background:#fff;
    position:relative;
  }
  .card.fake::before {
    content:"‚ö†Ô∏è";
    position:absolute;
    top:10px;
    right:12px;
    font-size:1.2rem;
    opacity:.7;
  }
  .card.fake {
    background:#f2f2f2;
  }
  .word {
    font-size:1.6rem;
    font-weight:600;
    margin-bottom:10px;
  }
  .feedback {
    margin-top:10px;
    font-weight:600;
  }
  .progress {
    margin:10px 0;
    font-size:0.95rem;
    color:#555;
  }
  .card.correct {
    animation:flashgreen 0.3s;
  }
  .card.wrong {
    animation:flashred 0.3s;
  }
  @keyframes flashgreen {
    from{background:#d4edda;}
    to{background:#fff;}
  }
  @keyframes flashred {
    from{background:#f8d7da;}
    to{background:#fff;}
  }
  #cardButtons button {
    padding:8px 16px;
    margin:4px;
    border:none;
    border-radius:10px;
    background:#e7ecf2;
    cursor:pointer;
    font-size:1rem;
  }
  #cardButtons button:hover {
    background:#dce5f3;
  }
  .footer {
    margin-top:25px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    flex-wrap:wrap;
  }
  .linkbtn, #restartBtn {
    background:linear-gradient(135deg,var(--accent-light),var(--accent));
    color:#fff;
    text-decoration:none;
    border:none;
    border-radius:var(--radius);
    padding:10px 16px;
    cursor:pointer;
    box-shadow:0 2px 8px rgba(0,0,0,.12);
  }
  .linkbtn:hover, #restartBtn:hover {
    transform:translateY(-2px);
  }
  #datasourceStatus {
    text-align:center;
    margin-top:10px;
    color:#555;
  }
  #lastAddedBox {
    text-align:left;
    margin-top:10px;
    background:#f3f5f9;
    border-radius:var(--radius);
    padding:12px;
  }
  #lastAddedList {display:none;}
  #lastAddedBox h3 {
    cursor:pointer;
    display:flex;
    align-items:center;
    justify-content:space-between;
  }
  #lastAddedBox.open #lastAddedList {display:block;}
</style>
</head>
<body>
<div class="app">
  <h1>üéØ Vokabeltrainer</h1>
  <div class="divider"></div>

  <div class="controls">
    <label>Kategorie:
      <select id="category">
        <option value="Alle">Alle</option>
      </select>
    </label>
    <label>Modus:
      <select id="mode">
        <option value="toGerman">Englisch ‚Üí Deutsch</option>
        <option value="toEnglish">Deutsch ‚Üí Englisch</option>
        <option value="mixed">Gemischt</option>
      </select>
    </label>
  </div>

  <div class="functions">
    <div class="kachel" id="learnBtn">‚úçÔ∏è Vokabel-Abfrage</div>
    <div class="kachel" id="last30Btn">üìö Letzte 30</div>
    <div class="kachel" id="cardsBtn">üß† Karteikarten</div>
  </div>

  <div class="settings">
    <label><input type="checkbox" id="feedbackToggle" checked> Sofortiges Feedback</label>
    <label>Delay:
      <select id="toastTime">
        <option value="1000">1 s</option>
        <option value="3000" selected>3 s</option>
        <option value="5000">5 s</option>
      </select>
    </label>
  </div>

  <div class="progress" id="progress" style="display:none;"></div>

  <div id="trainer" style="display:none;">
    <div class="card" id="card">
      <div id="word" class="word"></div>
      <input id="answerInput" type="text" placeholder="√úbersetzung eingeben..." style="display:none;">
      <div id="feedback" class="feedback"></div>
      <div id="cardButtons">
        <button id="rightBtn" style="display:none;">Richtig</button>
        <button id="wrongBtn" style="display:none;">Falsch</button>
        <button id="skipBtn" style="display:none;">√úberspringen</button>
      </div>
    </div>
  </div>

  <div id="result" style="display:none;" class="card"></div>

  <div class="footer">
    <button id="restartBtn">üîÑ Neustart</button>
    <a href="vokabeln.html" class="linkbtn">üìò Vokabeln</a>
  </div>

  <div id="lastAddedBox">
    <h3>üÜï Zuletzt hinzugef√ºgt <span>‚ñº</span></h3>
    <div id="lastAddedList"></div>
  </div>
</div>

<div id="datasourceStatus">üåê Datenquelle: GitHub (Online)</div>

<script>
document.addEventListener("DOMContentLoaded",()=>{
  const C={"Gelb":"Grundwerkzeuge Metallverarbeitung","Pink":"Werkzeugkasten Mechaniker","Blau":"Blech- / Kunststoffarbeiten","Gruen":"Drehen / Fr√§sen","HellesPink":"Hydraulik / Pneumatik","Orange":"Elektrotechnik","Dunkelgruen":"Flugger√§temechanik allgemein","Rot":"Verwechslungsgefahr"};
  const M={"Gelb":"#F4D03F","Pink":"#E91E63","Blau":"#1976D2","Gruen":"#1E8449","HellesPink":"#F54927","Orange":"#E67E22","Dunkelgruen":"#117A65","Rot":"#C0392B"};

  const cat=document.getElementById("category"),
        mSel=document.getElementById("mode"),
        fT=document.getElementById("feedbackToggle"),
        tT=document.getElementById("toastTime"),
        learn=document.getElementById("learnBtn"),
        cards=document.getElementById("cardsBtn"),
        last30=document.getElementById("last30Btn"),
        restart=document.getElementById("restartBtn"),
        word=document.getElementById("word"),
        feedback=document.getElementById("feedback"),
        right=document.getElementById("rightBtn"),
        wrong=document.getElementById("wrongBtn"),
        skip=document.getElementById("skipBtn"),
        progress=document.getElementById("progress"),
        trainer=document.getElementById("trainer"),
        result=document.getElementById("result"),
        ans=document.getElementById("answerInput"),
        card=document.getElementById("card");

  let list=[],round=[],i=0,errors=[],mode="mixed",game="learn",curr="",trap=false;

  async function sync(){
    try{
      const r=await fetch("https://beeferino.github.io/vokabeltrainer/vokabeln.json",{cache:"no-store"});
      const d=await r.json();
      list=d;
      localStorage.setItem("vokabeln",JSON.stringify(d));
      document.getElementById("datasourceStatus").textContent="üåê Datenquelle: GitHub (Online)";
    }catch{
      list=JSON.parse(localStorage.getItem("vokabeln")||"[]");
      document.getElementById("datasourceStatus").textContent="üíæ Datenquelle: Lokaler Speicher";
    }
  }

  function flash(cls){card.classList.add(cls);setTimeout(()=>card.classList.remove(cls),300);}
  function updateProg(){progress.style.display="block";progress.textContent=`Vokabel ${i+1}/${round.length} | Fehler: ${errors.length}`;}

  function start(sel,type,custom=null){
    if(!list.length){alert("Keine Vokabeln gefunden.");return;}
    mode=sel;game=type;
    let f=(cat.value==="Alle"?list:list.filter(v=>v[2]===cat.value));
    if(custom)f=custom;
    round=f.slice(0,15);
    i=0;errors=[];
    trainer.style.display="block";result.style.display="none";
    showNext();
  }

  function showNext(){
    if(i>=round.length){
      trainer.style.display="none";progress.style.display="none";
      let h="<h3>Runde beendet</h3>";
      if(errors.length){
        h+=`<p>${errors.length} Fehler:</p><ul>${errors.map(([q,a])=>`<li>${q} ‚Üí ${a}</li>`).join("")}</ul>`;
        h+=`<button id='repeatErrors'>üîÅ Fehler wiederholen</button>`;
      }else h+="<p>Keine Fehler üéâ</p>";
      result.innerHTML=h;result.style.display="block";
      const btn=document.getElementById("repeatErrors");
      if(btn)btn.onclick=()=>{round=errors.map(e=>[e[0],e[1],""]);errors=[];i=0;result.style.display="none";trainer.style.display="block";showNext();};
      return;
    }

    updateProg();
    const [en,de,catg]=round[i];
    let ask,answ;
    if(mode==="toGerman"){ask=en;answ=de;}
    else if(mode==="toEnglish"){ask=de;answ=en;}
    else{if(Math.random()<0.5){ask=en;answ=de;}else{ask=de;answ=en;}}

    trap=Math.random()<0.3;
    curr=trap?getWrong(answ):answ;
    const c=M[catg]||"#ccc";
    word.innerHTML=`<div style="padding:6px 12px;border-radius:12px;background:${c};color:#fff;display:inline-block">${C[catg]}</div><br><br><b>${ask}</b>`;
    feedback.textContent="";

    if(game==="learn"){
      ans.style.display="inline-block";right.style.display="none";wrong.style.display="none";skip.style.display="inline-block";
      ans.value="";ans.focus();
      ans.onkeydown=e=>{
        if(e.key==="Enter"){
          const ok=ans.value.trim().toLowerCase()===answ.toLowerCase();
          if(fT.checked){
            feedback.textContent=ok?"‚úÖ Richtig!":`‚ùå Falsch! Richtige Antwort: ${answ}`;
            flash(ok?"correct":"wrong");
          }
          if(!ok)errors.push([ask,answ]);
          i++;setTimeout(showNext,parseInt(tT.value,10));
        }
      };
      skip.onclick=()=>{i++;showNext();};
    } else {
      ans.style.display="none";right.style.display="inline-block";wrong.style.display="inline-block";skip.style.display="inline-block";
      card.classList.toggle("fake",trap);
      feedback.innerHTML=`üí° <b>${curr}</b>`;
      const buttons=[right,wrong];
      if(Math.random()<0.5)buttons.reverse();
      const parent=document.getElementById("cardButtons");
      parent.innerHTML="";buttons.forEach(b=>parent.appendChild(b));parent.appendChild(skip);

      right.onclick=()=>{handleAnswer(!trap,ask,answ);};
      wrong.onclick=()=>{handleAnswer(trap,ask,answ);};
      skip.onclick=()=>{i++;showNext();};
    }
  }

  function handleAnswer(ok,ask,answ){
    if(fT.checked){
      feedback.textContent=ok?"‚úÖ Richtig!":"‚ùå Falsch!";
      flash(ok?"correct":"wrong");
    }
    if(!ok)errors.push([ask,answ]);
    i++;setTimeout(showNext,parseInt(tT.value,10));
  }

  function getWrong(correct){
    const pool=list.map(v=>v[1]);
    let wrong;do{wrong=pool[Math.floor(Math.random()*pool.length)];}while(wrong===correct);
    return wrong;
  }

  learn.onclick=()=>start(mSel.value,"learn");
  cards.onclick=()=>start(mSel.value,"cards");
  last30.onclick=()=>{
    const last=list.slice(-30);
    const choice=confirm("üìö Letzte 30 Vokabeln:\nOK = Karteikarten\nAbbrechen = Eingabe");
    start(mSel.value,choice?"cards":"learn",last);
  };
  restart.onclick=()=>location.reload();

  function renderCats(){
    for(const k in C){
      const o=document.createElement("option");
      o.value=k;o.textContent=C[k];
      o.style.backgroundColor=M[k];o.style.color="#fff";
      cat.appendChild(o);
    }
  }

  function lastAdded(){
    const box=document.getElementById("lastAddedList"),
          all=JSON.parse(localStorage.getItem("vokabeln")||"[]");
    if(!all.length){box.textContent="Keine Vokabeln.";return;}
    const last=all.slice(-5).reverse();
    box.innerHTML=last.map(v=>`<div><b>${v[0]}</b> ‚Äì ${v[1]} <span style="color:${M[v[2]]}">(${C[v[2]]})</span></div>`).join("");
  }

  document.querySelector("#lastAddedBox h3").onclick=()=>{
    document.getElementById("lastAddedBox").classList.toggle("open");
  };

  (async()=>{
    await sync();
    renderCats();
    lastAdded();
  })();
});
</script>
</body>
</html>
