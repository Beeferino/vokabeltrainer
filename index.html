<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vokabeltrainer</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f7f9fb;
    margin: 0; padding: 0;
    text-align: center;
  }
  .app {
    max-width: 600px;
    margin: 60px auto;
    background: #fff;
    padding: 30px 25px;
    border-radius: 10px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
  }
  h1 { margin-top: 0; color: #222; }
  p { color: #555; }

  button {
    display: inline-block;
    background: #3498db;
    color: #fff;
    border: none;
    border-radius: 6px;
    padding: 12px 20px;
    font-size: 1rem;
    cursor: pointer;
    margin: 8px;
  }
  button:hover { background: #2980b9; }

  a.linkbtn {
    display: inline-block;
    padding: 10px 16px;
    border-radius: 6px;
    background: #74b9ff;
    color: #000;
    text-decoration: none;
    font-weight: 600;
    margin-top: 10px;
  }
  a.linkbtn:hover { background: #a6d4ff; }

  /* Zuletzt hinzugef√ºgt */
  #recentBox {
    margin-top: 25px;
    background: #f3f6fa;
    border-radius: 8px;
    padding: 15px;
    max-width: 520px;
    margin-inline: auto;
    border: 1px solid #e0e5ec;
  }
  #recentBox h3 {
    margin-top: 0;
    font-size: 1.1rem;
    color: #333;
  }
  #recentList {
    list-style: none;
    padding: 0;
    margin: 10px 0 0;
  }
  #recentList li {
    padding: 6px 0;
    border-bottom: 1px dashed #ccc;
    font-size: 0.95rem;
  }
  #recentList li:last-child { border-bottom: none; }
  .catLabel {
    font-size: 0.9rem;
    opacity: 0.8;
  }

  footer {
    margin-top: 40px;
    color: #777;
    font-size: 0.9rem;
  }
</style>
</head>
<body>
<div class="app">
  <h1>üß† Vokabeltrainer</h1>
  <p>W√§hle einen Modus:</p>

  <div>
    <button id="startQuiz">üìñ Vokabel-Abfrage starten</button>
    <button id="last30">‚è∞ Letzte 30 Vokabeln</button>
    <button id="cards">üóÇÔ∏è Karteikarten spielen</button>
  </div>

  <div style="margin-top:16px;">
    <a href="vokabeln.html" class="linkbtn">üìò Vokabel√ºbersicht √∂ffnen</a>
  </div>

  <!-- Zuletzt hinzugef√ºgt -->
  <div id="recentBox">
    <h3>üìú Zuletzt hinzugef√ºgt</h3>
    <ul id="recentList"><li><em>Keine Vokabeln vorhanden.</em></li></ul>
  </div>

  <footer>¬© 2025 @Beefi</footer>
</div>

<script>
(() => {
  const CATEGORY_NAMES = {
    Gelb:"Grundwerkzeuge Metallverarbeitung",
    Pink:"Werkzeugkasten Mechaniker",
    Blau:"Blech- / Kunststoffarbeiten",
    Gruen:"Drehen / Fr√§sen",
    HellesPink:"Hydraulik / Pneumatik",
    Orange:"Elektrotechnik",
    Dunkelgruen:"Flugger√§temechanik allgemein",
    Rot:"Verwechslungsgefahr"
  };
  const COLOR_MAP = {
    Gelb:"#F4D03F", Pink:"#E91E63", Blau:"#1976D2",
    Gruen:"#1E8449", HellesPink:"#F54927", Orange:"#E67E22",
    Dunkelgruen:"#117A65", Rot:"#C0392B"
  };

  const normalize = v => [v[0]||"", v[1]||"", v[2]||"Gelb", v[3]||"", v[4]||"", v[5]||new Date().toISOString()];
  const loadLocal = () => JSON.parse(localStorage.getItem("vokabeln") || "[]").map(normalize);
  const saveLocal = v => { localStorage.setItem("vokabeln", JSON.stringify(v)); localStorage.setItem("vokabeln_updated", new Date().toISOString()); };

  async function trySyncFromJson(){
    const urls=["./vokabeln.json","vokabeln.json",window.location.origin+"/vokabeln.json",window.location.origin+"/vokabeltrainer/vokabeln.json"];
    let remote=null;
    for(const u of urls){
      try{
        const r=await fetch(u,{cache:"no-store"});
        if(r.ok){ const d=await r.json(); if(Array.isArray(d)){remote=d;break;} }
      }catch{}
    }
    const local=loadLocal();
    if(!remote && local.length===0){
      const def=[["hammer","Hammer","Pink","","","2025-01-01T00:00:00Z"],["file","Feile","Gelb","","","2025-01-01T00:00:00Z"],["drill","Bohrer","Pink","","","2025-01-01T00:00:00Z"]];
      saveLocal(def);
    } else if(remote){
      const merged=merge(remote, local);
      saveLocal(merged);
    }
    renderRecent();
  }

  function merge(remote, local){
    const map=new Map();
    remote.map(normalize).forEach(v=>map.set(v[0].toLowerCase()+"|"+v[1].toLowerCase(),v));
    local.map(normalize).forEach(v=>{const k=v[0].toLowerCase()+"|"+v[1].toLowerCase();if(!map.has(k))map.set(k,v);});
    return Array.from(map.values());
  }

  function renderRecent(){
    const list=loadLocal();
    const last=list.slice(-5).reverse();
    const ul=document.getElementById("recentList");
    ul.innerHTML="";
    if(!last.length){
      ul.innerHTML="<li><em>Keine Vokabeln vorhanden.</em></li>";
      return;
    }
    last.forEach(([en,de,cat])=>{
      const li=document.createElement("li");
      li.innerHTML=`<b>${en}</b> ‚Äì ${de} <span class="catLabel" style="color:${COLOR_MAP[cat]||"#555"}">(${CATEGORY_NAMES[cat]||cat})</span>`;
      ul.appendChild(li);
    });
  }

  // ===== Navigation / Modi =====
  function startQuiz(){ window.location.href="vokabeln.html?mode=quiz"; }
  function startLast30(){ window.location.href="vokabeln.html?mode=last30"; }
  function startCards(){ window.location.href="vokabeln.html?mode=cards"; }

  document.getElementById("startQuiz").onclick=startQuiz;
  document.getElementById("last30").onclick=startLast30;
  document.getElementById("cards").onclick=startCards;

  trySyncFromJson();
})();
</script>
</body>
</html>
