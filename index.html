<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ğŸ¯ Vokabeltrainer</title>
<style>
  body {
    font-family: system-ui, sans-serif;
    background: #f5f8fc;
    color: #222;
    margin: 0;
    padding: 20px;
    text-align: center;
  }
  .app {
    max-width: 900px;
    margin: auto;
    background: #fff;
    border-radius: 14px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    padding: 25px;
  }
  h1 { margin-bottom: 15px; }

  .controls label { margin: 0 10px; font-size: 1rem; }
  select, input[type=text] {
    padding: 6px 8px;
    border-radius: 6px;
    border: 1px solid #ccc;
  }

  .functions {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 15px;
    margin: 20px 0;
  }
  .kachel {
    background: #1e6ed8;
    color: white;
    padding: 14px 22px;
    border-radius: 10px;
    cursor: pointer;
    transition: 0.2s;
    font-weight: 500;
  }
  .kachel:hover { background: #2980b9; transform: scale(1.04); }

  .progress {
    font-weight: bold;
    color: #1e6ed8;
    margin-top: 20px;
  }

  .card {
    background: #f8fafc;
    border-radius: 12px;
    padding: 25px 20px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    margin-top: 20px;
  }

  .category-badge {
    display: inline-block;
    padding: 6px 14px;
    border-radius: 20px;
    color: #fff;
    font-weight: 500;
    margin-bottom: 15px;
  }

  .word {
    font-size: 1.6rem;
    font-weight: 600;
    margin: 10px 0;
  }

  .feedback {
    font-size: 1.1rem;
    color: #333;
    margin: 12px 0;
    min-height: 28px;
  }

  #cardButtons { margin-top: 12px; }
  #cardButtons button {
    padding: 8px 18px;
    margin: 4px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    font-weight: 500;
    transition: 0.2s;
  }
  #cardButtons button:hover { transform: scale(1.05); }
  #rightBtn { background: #2ecc71; color: white; }
  #wrongBtn { background: #e74c3c; color: white; }
  #skipBtn { background: #bdc3c7; color: white; }

  .restart {
    background: #1e6ed8;
    color: #fff;
    border: none;
    padding: 10px 22px;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 500;
    cursor: pointer;
    margin-top: 25px;
    transition: 0.2s;
  }
  .restart:hover { background: #2980b9; transform: scale(1.05); }

  .footer { margin-top: 40px; font-size: 0.9rem; }
  .linkbtn { text-decoration: none; color: #1e6ed8; font-weight: 500; }
  #datasourceStatus { margin-top: 10px; color: #666; font-size: 0.9rem; }

  #lastAddedBox {
    margin-top: 25px;
    background: #f4f7fb;
    border-radius: 10px;
    padding: 10px;
  }
  #lastAddedList { transition: all 0.3s ease; }
</style>
</head>

<body>
<div class="app">
  <h1>ğŸ¯ Vokabeltrainer</h1>

  <div class="controls">
    <label>Kategorie:
      <select id="category">
        <option value="Alle">Alle (bunt gemischt)</option>
      </select>
    </label>
    <label>Modus:
      <select id="mode">
        <option value="toGerman">Englisch â†’ Deutsch</option>
        <option value="toEnglish">Deutsch â†’ Englisch</option>
        <option value="mixed">Gemischt</option>
      </select>
    </label>
  </div>

  <div class="functions">
    <div class="kachel" id="learnBtn">âœï¸ Vokabel-Abfrage</div>
    <div class="kachel" id="last30Btn">ğŸ“š Letzte 30</div>
    <div class="kachel" id="cardsBtn">ğŸ§  Karteikarten</div>
  </div>

  <div class="feedback-settings">
    <label><input type="checkbox" id="feedbackToggle" checked> Sofortiges Feedback</label>
    <label>Anzeigedauer:
      <select id="delayTime">
        <option value="3000" selected>3 Sekunden</option>
        <option value="5000">5 Sekunden</option>
      </select>
    </label>
  </div>

  <div class="progress" id="progress" style="display:none"></div>

  <div id="trainer" style="display:none">
    <div class="card" id="card">
      <div id="categoryBadge" class="category-badge"></div>
      <div id="word" class="word"></div>
      <div id="feedback" class="feedback"></div>
      <div id="cardButtons">
        <button id="rightBtn" style="display:none">Richtig</button>
        <button id="wrongBtn" style="display:none">Falsch</button>
        <button id="skipBtn" style="display:none">Ãœberspringen</button>
      </div>
    </div>
    <button class="restart" id="restartBtn">ğŸ”„ Neustart</button>
  </div>

  <div id="result" style="display:none" class="card"></div>

  <div class="footer">
    <a href="vokabeln.html" class="linkbtn">ğŸ“˜ VokabelÃ¼bersicht Ã¶ffnen</a><br><br>
    <small>Â© 2025 @Beefi</small>

    <div id="lastAddedBox">
      <h3>ğŸ†• Zuletzt hinzugefÃ¼gt â–¼</h3>
      <div id="lastAddedList">â€“</div>
    </div>
  </div>
</div>

<div id="datasourceStatus">ğŸ’¾ Datenquelle: Lokaler Speicher</div>

<script>
document.addEventListener("DOMContentLoaded",()=>{
  const C={"Gelb":"Grundwerkzeuge Metallverarbeitung","Pink":"Werkzeugkasten Mechaniker","Blau":"Blech-/ Kunststoffarbeiten","Gruen":"Drehen / FrÃ¤sen","HellesPink":"Hydraulik / Pneumatik","Orange":"Elektrotechnik","Dunkelgruen":"FluggerÃ¤temechanik allgemein","Rot":"Verwechslungsgefahr"};
  const M={"Gelb":"#F4D03F","Pink":"#E91E63","Blau":"#1976D2","Gruen":"#1E8449","HellesPink":"#F54927","Orange":"#E67E22","Dunkelgruen":"#117A65","Rot":"#C0392B"};

  const status=document.getElementById("datasourceStatus"),
        cat=document.getElementById("category"),
        mSel=document.getElementById("mode"),
        fT=document.getElementById("feedbackToggle"),
        dT=document.getElementById("delayTime"),
        learn=document.getElementById("learnBtn"),
        cards=document.getElementById("cardsBtn"),
        last30=document.getElementById("last30Btn"),
        restart=document.getElementById("restartBtn"),
        word=document.getElementById("word"),
        feedback=document.getElementById("feedback"),
        right=document.getElementById("rightBtn"),
        wrong=document.getElementById("wrongBtn"),
        skip=document.getElementById("skipBtn"),
        progress=document.getElementById("progress"),
        trainer=document.getElementById("trainer"),
        result=document.getElementById("result"),
        card=document.getElementById("card"),
        badge=document.getElementById("categoryBadge");

  let list=[],round=[],i=0,errors=[],skipped=[],mode="mixed",game="learn",curr="",trap=false;

  async function sync(){
    try{
      const r=await fetch("https://beeferino.github.io/vokabeltrainer/vokabeln.json",{cache:"no-store"});
      if(!r.ok) throw new Error();
      const d=await r.json();
      localStorage.setItem("vokabeln",JSON.stringify(d));
      localStorage.setItem("vokabeln_updated",new Date().toISOString());
      status.textContent="ğŸŒ Datenquelle: GitHub (Online)";
    }catch{
      status.textContent="ğŸ’¾ Datenquelle: Lokaler Speicher";
    }
  }

  const S=k=>JSON.parse(localStorage.getItem(k)||"[]");
  function flash(cls){if(!fT.checked)return;card.classList.add(cls);setTimeout(()=>card.classList.remove(cls),400);}
  function updateProg(){progress.style.display="block";progress.textContent=`Vokabel ${i+1}/${round.length} | Fehler: ${errors.length}`;}

  function start(sel,type,custom=null){
    list=S("vokabeln");
    if(!list.length){alert("Keine Vokabeln gefunden.");return;}
    mode=sel;game=type;
    let f=(cat.value==="Alle"?list:list.filter(v=>v[2]===cat.value));
    if(custom)f=custom;
    round=f.slice(0,15);
    i=0;errors=[];skipped=[];
    trainer.style.display="block";result.style.display="none";
    showNext();
  }

  function showNext(){
    const delay=parseInt(dT.value,10);
    if(i>=round.length){
      if(skipped.length){
        round=skipped;skipped=[];i=0;
        feedback.textContent="ğŸ“˜ Jetzt die Ã¼bersprungenen Vokabeln!";
        updateProg();showNext();return;
      }
      trainer.style.display="none";progress.style.display="none";
      let h="<h3>Runde beendet</h3>";
      h+=errors.length?`<p>${errors.length} Fehler:</p><ul>${errors.map(([q,a])=>`<li>${q} â†’ ${a}</li>`).join("")}</ul>`:"<p>Keine Fehler ğŸ‰</p>";
      h+='<button class="restart" onclick="location.reload()">ğŸ”„ Neue Runde</button>';
      result.innerHTML=h;result.style.display="block";return;
    }

    updateProg();
    const [en,de,catg]=round[i];
    let ask,answ;
    if(mode==="toGerman"){ask=en;answ=de;}
    else if(mode==="toEnglish"){ask=de;answ=en;}
    else{if(Math.random()<.5){ask=en;answ=de;}else{ask=de;answ=en;}}

    const c=M[catg]||"#ccc";
    badge.style.background=c;
    badge.textContent=C[catg];
    word.textContent=ask;
    feedback.textContent="";

    if(game==="learn"){
      right.style.display="none";wrong.style.display="none";skip.style.display="inline-block";
      feedback.innerHTML='<input id="answerInput" type="text" placeholder="Ãœbersetzung eingeben...">';
      const input=document.getElementById("answerInput");
      input.focus();
      input.onkeydown=e=>{
        if(e.key==="Enter"){
          const ok=input.value.trim().toLowerCase()===answ.toLowerCase();
          if(fT.checked){feedback.textContent=ok?"âœ… Richtig!":`âŒ Falsch! â†’ ${answ}`;flash(ok?"correct":"wrong");}
          if(!ok)errors.push([ask,answ]);
          i++;setTimeout(showNext,delay);
        }
      };
      skip.onclick=()=>{skipped.push([en,de,catg]);i++;showNext();};
    }else{
      right.style.display="inline-block";wrong.style.display="inline-block";skip.style.display="inline-block";
      trap=Math.random()<.3;curr=trap?getWrong(answ):answ;
      feedback.innerHTML=`ğŸ’¡ <b>${curr}</b>`;
      const parent=document.getElementById("cardButtons");
      if(Math.random()<.5)parent.insertBefore(wrong,right);else parent.insertBefore(right,wrong);

      right.onclick=()=>{const ok=!trap;if(fT.checked){feedback.textContent=ok?"âœ… Richtig!":"âŒ Falsch!";flash(ok?"correct":"wrong");}if(!ok)errors.push([ask,answ]);i++;setTimeout(showNext,delay);};
      wrong.onclick=()=>{const ok=trap;if(fT.checked){feedback.textContent=ok?"âœ… Richtig!":"âŒ Falsch!";flash(ok?"correct":"wrong");}if(!ok)errors.push([ask,answ]);i++;setTimeout(showNext,delay);};
      skip.onclick=()=>{skipped.push([en,de,catg]);i++;showNext();};
    }
  }

  function getWrong(correct){
    const pool=list.map(v=>v[1]);
    let wrong;do{wrong=pool[Math.floor(Math.random()*pool.length)];}while(wrong===correct);
    return wrong;
  }

  learn.onclick=()=>start(mSel.value,"learn");
  cards.onclick=()=>start(mSel.value,"cards");
  last30.onclick=()=>{const all=S("vokabeln");if(!all.length){alert("Keine Vokabeln.");return;}const last=all.slice(-30);const choice=confirm("ğŸ“š Letzte 30 Vokabeln:\nOK = Karteikarten\nAbbrechen = Eingabe");start(mSel.value,choice?"cards":"learn",last);};
  restart.onclick=()=>location.reload();

  function renderCats(){
    for(const k in C){
      const o=document.createElement("option");
      o.value=k;o.textContent=" "+C[k];
      o.style.backgroundColor=M[k];o.style.color="#fff";
      cat.appendChild(o);
    }
  }
  function lastAdded(){
    const box=document.getElementById("lastAddedList"),all=S("vokabeln");
    if(!all.length){box.textContent="Keine Vokabeln.";return;}
    const last=all.slice(-5).reverse();
    box.innerHTML=last.map(v=>`<div><b>${v[0]}</b> â€“ ${v[1]} <span style="color:${M[v[2]]}">(${C[v[2]]})</span></div>`).join("");
  }

  (async()=>{await sync();renderCats();lastAdded();})();

  // Einklappbare "Zuletzt hinzugefÃ¼gt"-Liste
  const header=document.querySelector("#lastAddedBox h3");
  const listBox=document.getElementById("lastAddedList");
  let open=false;
  header.style.cursor="pointer";
  header.onclick=()=>{
    open=!open;
    listBox.style.display=open?"block":"none";
    header.innerHTML=open?"ğŸ†• Zuletzt hinzugefÃ¼gt â–¼":"ğŸ†• Zuletzt hinzugefÃ¼gt â–²";
  };
});
</script>
</body>
</html>
