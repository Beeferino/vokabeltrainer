<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>🧠 Vokabeltrainer</title>
<style>
body {
  font-family: "Segoe UI", Roboto, sans-serif;
  background: #f7f9fb;
  color: #111;
  text-align: center;
  margin: 0;
  padding: 20px;
}
.app { max-width: 800px; margin: auto; }
h1 { font-size: 2rem; margin-bottom: 1rem; }
.section {
  background: #fff;
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
  box-shadow: 0 3px 8px rgba(0,0,0,0.05);
}
button {
  background: #5b9df9;
  color: #fff;
  border: none;
  border-radius: 8px;
  padding: 10px 16px;
  font-size: 1rem;
  cursor: pointer;
  transition: background 0.2s ease, transform 0.2s;
}
button:hover { background: #72b1ff; transform: translateY(-1px); }
button:disabled { opacity: .6; cursor: not-allowed; }

input[type=text] {
  font-size: 1rem;
  padding: 8px 12px;
  border: 1px solid #ccc;
  border-radius: 8px;
  width: 60%;
}

.category-buttons {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 6px;
  margin-bottom: 12px;
}
.category-buttons button {
  border: 1px solid #ccc;
  padding: 6px 10px;
  border-radius: 8px;
  color: #fff;
  font-weight: 600;
  cursor: pointer;
}
.category-buttons button.active {
  border: 2px solid #333;
  box-shadow: 0 0 6px rgba(0,0,0,0.2);
}

.hidden { display: none; }
.result { font-size: 1.1rem; margin-top: 10px; }
.feedback {
  font-size: 1.1rem;
  font-weight: 600;
  margin-top: 10px;
}
footer { margin-top: 25px; font-size: 0.9rem; color: #666; }
.lastAdded { background: #fff; border-radius: 12px; padding: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
.lastAdded div { margin: 3px 0; }
hr.divider { border: none; border-top: 2px solid #e3e7ef; margin: 20px 0; }
</style>
</head>

<body>
<div class="app">
  <h1>🧠 Vokabeltrainer</h1>

  <div class="section">
    <h2>📚 Kategorieauswahl</h2>
    <div id="catButtons" class="category-buttons"></div>
  </div>

  <div class="section">
    <h2>🎮 Spielmodus</h2>
    <div class="flex">
      <button id="startBtn">✍️ Vokabel-Abfrage starten</button>
      <button id="cardsBtn">🃏 Karteikarten spielen</button>
      <button id="last30Btn">⏮️ Letzte 30 Vokabeln</button>
    </div>
  </div>

  <div id="gameArea" class="section hidden">
    <h2 id="questionLabel">Frage 1/15</h2>
    <div id="vocabArea">
      <p id="wordDisplay" style="font-size:1.4rem;font-weight:600;"></p>
      <input id="answerInput" type="text" placeholder="Übersetzung eingeben">
      <div>
        <button id="checkBtn">Überprüfen</button>
        <button id="nextBtn" class="hidden">Nächste</button>
      </div>
      <div id="feedback" class="feedback"></div>
    </div>
    <div id="cardArea" class="hidden">
      <p id="cardWord" style="font-size:1.4rem;font-weight:600;"></p>
      <p id="cardTranslation" class="hidden"></p>
      <button id="showCardBtn">Antwort anzeigen</button>
      <button id="nextCardBtn" class="hidden">Nächste Karte</button>
    </div>
    <div class="result" id="resultInfo"></div>
  </div>

  <div class="section lastAdded">
    <h2>🧾 Zuletzt hinzugefügt</h2>
    <div id="lastAdded">–</div>
  </div>

  <hr class="divider">

  <div class="section">
    <button onclick="window.location.href='/vokabeltrainer/vokabeln.html'">📘 Zur Vokabelübersicht</button>
  </div>

  <footer>© 2025 @Beefi</footer>
</div>

<script>
(()=>{

const CATEGORY_NAMES={Gelb:"Grundwerkzeuge Metallverarbeitung",Pink:"Werkzeugkasten Mechaniker",Blau:"Blech- / Kunststoffarbeiten",Gruen:"Drehen / Fräsen",HellesPink:"Hydraulik / Pneumatik",Orange:"Elektrotechnik",Dunkelgruen:"Fluggerätemechanik allgemein",Rot:"Verwechslungsgefahr"};
const COLOR_MAP={Gelb:"#fae17a",Pink:"#f7a3c2",Blau:"#8ab4f9",Gruen:"#9ae3a2",HellesPink:"#ff9c92",Orange:"#ffc27a",Dunkelgruen:"#8ed1b2",Rot:"#f58a8a"};
const $=s=>document.querySelector(s);

let list=JSON.parse(localStorage.getItem("vokabeln")||"[]");
let filtered=[],mode="normal",index=0,correct=0,wrong=0,feedbackEnabled=true;
let activeCats=Object.keys(CATEGORY_NAMES);

function saveLocal(){localStorage.setItem("vokabeln",JSON.stringify(list));}
function updateLastAdded(){
  const div=$("#lastAdded");
  if(!list.length){div.textContent="–";return;}
  const last=list.slice(-5).reverse();
  div.innerHTML=last.map(v=>`<div><b>${v[0]}</b> – ${v[1]} <span style="color:${COLOR_MAP[v[2]]}">(${CATEGORY_NAMES[v[2]]})</span></div>`).join("");
}

// Kategorie-Buttons
function renderCatButtons(){
  const c=$("#catButtons");
  c.innerHTML="";
  for(const key in CATEGORY_NAMES){
    const b=document.createElement("button");
    b.textContent=`${CATEGORY_NAMES[key]}`;
    b.style.background=COLOR_MAP[key];
    b.dataset.cat=key;
    b.classList.add("active");
    b.onclick=()=>{
      if(b.classList.contains("active")){
        b.classList.remove("active");
        activeCats=activeCats.filter(c=>c!==key);
      }else{
        b.classList.add("active");
        activeCats.push(key);
      }
    };
    c.appendChild(b);
  }
}

// Filter Liste nach aktiven Kategorien
function getFilteredList(){
  return list.filter(v=>activeCats.includes(v[2]));
}

// Spiel starten
function startGame(type){
  mode=type;
  filtered=getFilteredList();
  if(!filtered.length)return alert("Keine passenden Vokabeln gefunden!");
  if(filtered.length>15)filtered=shuffle(filtered).slice(0,15);
  index=0;correct=0;wrong=0;
  $("#gameArea").classList.remove("hidden");
  $("#vocabArea").classList.toggle("hidden",type!=="normal");
  $("#cardArea").classList.toggle("hidden",type!=="cards");
  showNext();
  $("#resultInfo").textContent="";
}

// Shuffle helper
function shuffle(a){return a.map(v=>[Math.random(),v]).sort((a,b)=>a[0]-b[0]).map(v=>v[1]);}

// --- Vokabelabfrage ---
function showNext(){
  if(index>=filtered.length){
    $("#questionLabel").textContent="Fertig!";
    $("#vocabArea").classList.add("hidden");
    $("#resultInfo").textContent=`✅ ${correct} richtig | ❌ ${wrong} falsch`;
    return;
  }
  const [en,de]=filtered[index];
  $("#questionLabel").textContent=`Frage ${index+1}/${filtered.length}`;
  $("#wordDisplay").textContent=en;
  $("#answerInput").value="";
  $("#feedback").textContent="";
  $("#nextBtn").classList.add("hidden");
  $("#checkBtn").classList.remove("hidden");
}

$("#checkBtn").onclick=()=>{
  const ans=$("#answerInput").value.trim().toLowerCase();
  const correctAns=filtered[index][1].toLowerCase();
  const f=$("#feedback");
  if(ans===correctAns){
    f.textContent="✅ Richtig!";
    f.style.color="green";
    correct++;
  }else{
    f.textContent=`❌ Falsch! (${filtered[index][1]})`;
    f.style.color="red";
    wrong++;
  }
  $("#checkBtn").classList.add("hidden");
  $("#nextBtn").classList.remove("hidden");
  setTimeout(()=>{$("#nextBtn").click();},3000);
};

$("#nextBtn").onclick=()=>{
  index++;
  showNext();
};

// --- Karteikarten ---
let cardIndex=0;
function startCards(){
  mode="cards";
  filtered=getFilteredList();
  if(!filtered.length)return alert("Keine passenden Vokabeln!");
  if(filtered.length>15)filtered=shuffle(filtered).slice(0,15);
  cardIndex=0;
  $("#gameArea").classList.remove("hidden");
  $("#vocabArea").classList.add("hidden");
  $("#cardArea").classList.remove("hidden");
  showCard();
}
function showCard(){
  if(cardIndex>=filtered.length){
    $("#cardWord").textContent="Fertig!";
    $("#cardTranslation").textContent="";
    $("#showCardBtn").classList.add("hidden");
    $("#nextCardBtn").classList.add("hidden");
    return;
  }
  const [en,de]=filtered[cardIndex];
  $("#cardWord").textContent=en;
  $("#cardTranslation").textContent=de;
  $("#cardTranslation").classList.add("hidden");
  $("#showCardBtn").classList.remove("hidden");
  $("#nextCardBtn").classList.add("hidden");
}
$("#showCardBtn").onclick=()=>{
  $("#cardTranslation").classList.remove("hidden");
  $("#showCardBtn").classList.add("hidden");
  $("#nextCardBtn").classList.remove("hidden");
  setTimeout(()=>{$("#nextCardBtn").click();},3000);
};
$("#nextCardBtn").onclick=()=>{cardIndex++;showCard();};

// --- Letzte 30 ---
$("#last30Btn").onclick=()=>{
  list=JSON.parse(localStorage.getItem("vokabeln")||"[]");
  filtered=list.slice(-30);
  index=0;correct=0;wrong=0;
  $("#gameArea").classList.remove("hidden");
  $("#vocabArea").classList.remove("hidden");
  $("#cardArea").classList.add("hidden");
  showNext();
};

$("#startBtn").onclick=()=>startGame("normal");
$("#cardsBtn").onclick=()=>startCards();
renderCatButtons();
updateLastAdded();

})();
</script>
</body>
</html>
