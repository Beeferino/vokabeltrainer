<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>üéØ Vokabeltrainer</title>
<style>
  body {
    font-family: "Inter", sans-serif;
    background: #f7f9fb;
    margin: 0;
    padding: 20px;
  }
  .app {
    max-width: 900px;
    margin: auto;
    text-align: center;
  }
  h1 {
    font-size: 1.9rem;
    margin-bottom: 1rem;
  }
  h1::after {
    content: "";
    display: block;
    width: 60px;
    height: 3px;
    margin: 10px auto 0;
    background: linear-gradient(90deg,#3498db,#8e44ad);
    border-radius: 3px;
  }

  button, input, select {
    font-size: 1rem;
    padding: 8px 12px;
    border-radius: 10px;
    border: 1px solid #ccc;
    margin: 5px;
  }
  button {
    cursor: pointer;
    background: #2980b9;
    color: #fff;
    border: none;
    transition: background .2s ease, transform .1s ease;
  }
  button:hover {
    background: #3498db;
    transform: translateY(-1px);
  }

  .controls {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    align-items: center;
    justify-content: center;
    margin-bottom: 25px;
  }

  .functions {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 20px;
    margin: 20px 0 6px;
  }
  .kachel {
    flex: 1 1 280px;
    max-width: 360px;
    background: linear-gradient(145deg,#fff,#f0f4ff);
    border-radius: 14px;
    box-shadow: 0 3px 6px rgba(0,0,0,0.08);
    padding: 16px;
    text-align: center;
    font-size: 1.1rem;
    cursor: pointer;
    transition: all .25s ease;
    border: 1px solid #dce3ef;
  }
  .kachel:hover {
    background: linear-gradient(145deg,#e7f1ff,#ffffff);
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(0,0,0,0.12);
  }
  .kachel small {
    display: block;
    margin-top: 6px;
    opacity: .8;
    font-style: italic;
  }

  .feedback-settings {
    background: #f1f3f6;
    border-radius: 12px;
    padding: 12px 20px;
    margin: 16px auto 18px;
    max-width: 600px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.08);
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 15px;
    align-items: center;
  }

  /* === SPIELBEREICH === */
  .play-wrap {
    display: none;
    opacity: 0;
    max-width: 720px;
    margin: 0 auto 10px;
    border: 1px solid #e3eaf4;
    border-radius: 16px;
    background: rgba(255,255,255,0.8);
    backdrop-filter: blur(8px) saturate(1.2);
    box-shadow: 0 6px 16px rgba(40,60,90,.08);
    padding: 14px 14px 6px;
    transition: opacity .4s ease;
  }
  .play-wrap.show {
    display: block;
    opacity: 1;
  }

  .card {
    position: relative;
    background: #fff;
    padding: 20px;
    border-radius: 16px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    margin-top: 20px;
    transition: background-color .4s ease;
  }
  .card.correct { background-color: #d4edda; }
  .card.wrong { background-color: #f8d7da; }

  .word {
    font-size: 1.6rem;
    margin: 20px 0;
    font-weight: 600;
  }
  .feedback {
    font-size: 1.1rem;
    margin: 10px 0;
    min-height: 1.2em;
  }

  .input-wrap {
    position: relative;
    display: inline-block;
    width: min(520px, 90vw);
  }
  .input-wrap input {
    width: 100%;
    padding-right: 70px;
    box-shadow: inset 0 2px 6px rgba(0,0,0,0.08);
    background: #fff;
    border: 1px solid #cbd5e1;
  }
  .input-icon {
    position: absolute;
    top: 50%;
    right: 48px;
    transform: translateY(-52%);
    opacity: .55;
    pointer-events: none;
    font-size: 1.25rem;
    line-height: 1;
    height: 1.25rem;
    width: 1.25rem;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .send-btn {
    position: absolute;
    right: 6px;
    top: 50%;
    transform: translateY(-50%);
    border-radius: 10px;
    border: 1px solid #cbd5e1;
    background: #edf2ff;
    color: #0a58ca;
    padding: 6px 10px;
  }
  .send-btn:hover {
    background: #dbe7ff;
  }

  .progress {
    margin-top: 5px;
    font-weight: 600;
    font-size: 1.05rem;
    min-height: 1.2em;
  }

  #cardButtons {
    display: flex;
    gap: 12px;
    justify-content: center;
    align-items: center;
    margin-top: 12px;
  }
  #rightBtn { background: #2ECC71; color: #fff; }
  #wrongBtn { background: #E74C3C; color: #fff; }
  #skipBtn { background: #bdc3c7; color: #000; }

  .fake-flag {
    display: inline-block;
    padding: 4px 10px;
    border-radius: 999px;
    background: #fff1e6;
    color: #bf4b00;
    border: 1px solid #ffd9b8;
    font-weight: 700;
    font-size: .9rem;
    margin-bottom: 6px;
  }

  .footer {
    margin-top: 16px;
    font-size: 0.95rem;
    color: #555;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 12px;
    flex-wrap: wrap;
  }
  .footer .btn-link {
    display: inline-block;
    padding: 10px 16px;
    border-radius: 12px;
    background: #eef4ff;
    border: 1px solid #dce6ff;
    color: #0a58ca;
    text-decoration: none;
    font-weight: 700;
  }
  .footer .btn-link:hover {
    background: #e4edff;
  }

  .last-box {
    margin-top: 20px;
    text-align: center;
    transition: all .3s ease;
  }
  .last-box h3 {
    cursor: pointer;
    color: #1e6ed8;
  }
  .last-list {
    max-height: 0;
    overflow: hidden;
    transition: max-height .3s ease;
  }
  .last-list.open {
    max-height: 300px;
  }

  #datasourceStatus {
    margin-top: 14px;
    font-size: 0.9rem;
    color: #666;
  }
</style>
</head>

<body>
<div class="app">
  <h1>üéØ Vokabeltrainer</h1>

  <div class="controls">
    <label>Kategorie:
      <select id="category">
        <option value="Alle">Alle (bunt gemischt)</option>
      </select>
    </label>
    <label>Modus:
      <select id="mode">
        <option value="toGerman">Englisch ‚Üí Deutsch</option>
        <option value="toEnglish">Deutsch ‚Üí Englisch</option>
        <option value="mixed">Gemischt</option>
      </select>
    </label>
  </div>

  <div class="functions">
    <div class="kachel" id="learnBtn">‚úçÔ∏è Vokabel-Abfrage starten</div>
    <div class="kachel" id="last30Btn">üìö Letzte 30 Vokabeln<br><small>(wahlweise Abfrage oder Mitdenker-Modus)</small></div>
    <div class="kachel" id="cardsBtn">üß† Karteikarten starten<br><small>(Mitdenker-Edition)</small></div>
  </div>

  <div class="feedback-settings">
    <label><input type="checkbox" id="feedbackToggle" checked> Sofortiges Feedback anzeigen</label>
    <label>Delay-Dauer:
      <select id="toastTime">
        <option value="1000">1 s</option>
        <option value="3000" selected>3 s</option>
        <option value="5000">5 s</option>
      </select>
    </label>
  </div>

  <div class="play-wrap" id="playWrap">
    <div class="progress" id="progress" style="display:none;"></div>

    <div id="trainer" style="display:none;">
      <div class="card" id="card">
        <div id="word" class="word"></div>

        <div class="input-wrap" id="inputWrap" style="display:none;">
          <input id="answerInput" type="text" placeholder="√úbersetzung eingeben...">
          <div class="input-icon">‚å®Ô∏è</div>
          <button class="send-btn" id="sendBtn">OK</button>
        </div>

        <div id="feedback" class="feedback"></div>
        <div id="cardButtons">
          <button id="rightBtn" style="display:none;">Richtig</button>
          <button id="wrongBtn" style="display:none;">Falsch</button>
          <button id="skipBtn" style="display:none;">√úberspringen</button>
        </div>
      </div>
    </div>

    <div id="result" style="display:none;" class="card"></div>

    <div class="footer">
      <a href="vokabeln.html" class="btn-link">üìò Vokabeln</a>
      <button id="restartBtn">üîÑ Neustart</button>
    </div>
  </div>

  <div class="last-box">
    <h3 id="toggleLast">üÜï Zuletzt hinzugef√ºgt ‚ñæ</h3>
    <div id="lastAddedList" class="last-list"></div>
  </div>

  <div id="datasourceStatus">üåê Datenquelle: GitHub (Online)</div>
</div>

<script>
document.addEventListener("DOMContentLoaded",()=>{
  const C={"Gelb":"Grundwerkzeuge Metallverarbeitung","Pink":"Werkzeugkasten Mechaniker","Blau":"Blech- / Kunststoffarbeiten","Gruen":"Drehen / Fr√§sen","HellesPink":"Hydraulik / Pneumatik","Orange":"Elektrotechnik","Dunkelgruen":"Flugger√§temechanik allgemein","Rot":"Verwechslungsgefahr"};
  const M={"Gelb":"#F4D03F","Pink":"#E91E63","Blau":"#1976D2","Gruen":"#1E8449","HellesPink":"#F54927","Orange":"#E67E22","Dunkelgruen":"#117A65","Rot":"#C0392B"};

  const status=document.getElementById("datasourceStatus"),
        cat=document.getElementById("category"),
        mSel=document.getElementById("mode"),
        fT=document.getElementById("feedbackToggle"),
        tT=document.getElementById("toastTime"),
        learn=document.getElementById("learnBtn"),
        cards=document.getElementById("cardsBtn"),
        last30=document.getElementById("last30Btn"),
        restart=document.getElementById("restartBtn"),
        word=document.getElementById("word"),
        feedback=document.getElementById("feedback"),
        right=document.getElementById("rightBtn"),
        wrong=document.getElementById("wrongBtn"),
        skip=document.getElementById("skipBtn"),
        progress=document.getElementById("progress"),
        trainer=document.getElementById("trainer"),
        result=document.getElementById("result"),
        ans=document.getElementById("answerInput"),
        card=document.getElementById("card"),
        playWrap=document.getElementById("playWrap"),
        sendBtn=document.getElementById("sendBtn"),
        inputWrap=document.getElementById("inputWrap");

  let list=[],round=[],i=0,errors=[],skipped=[],mode="mixed",game="learn",curr="",trap=false;

  async function sync(){
    try{
      const r=await fetch("https://beeferino.github.io/vokabeltrainer/vokabeln.json",{cache:"no-store"});
      if(!r.ok) throw new Error(r.status);
      const d=await r.json();
      localStorage.setItem("vokabeln",JSON.stringify(d));
      status.textContent="üåê Datenquelle: GitHub (Online)";
      list=d;
    }catch(e){
      status.textContent="üíæ Datenquelle: Lokaler Speicher";
      list=JSON.parse(localStorage.getItem("vokabeln")||"[]");
    }
  }

  const S=k=>JSON.parse(localStorage.getItem(k)||"[]");
  function flash(cls){ if(!fT.checked) return; card.classList.add(cls); setTimeout(()=>card.classList.remove(cls),400); }
  function updateProg(){ progress.style.display="block"; progress.textContent=`Vokabel ${i+1}/${round.length} | Fehler: ${errors.length}`; }

  function start(sel,type,custom=null){
    playWrap.classList.add("show");
    list=S("vokabeln");
    if(!list.length){alert("Keine Vokabeln gefunden.");return;}
    mode=sel;game=type;
    let f=(cat.value==="Alle"?list:list.filter(v=>v[2]===cat.value));
    if(custom) f=custom;
    round=f.slice(0,15);
    i=0;errors=[];skipped=[];
    trainer.style.display="block";
    result.style.display="none";
    showNext();
  }

  function showNext(){
    if(i>=round.length){
      if(skipped.length){ round=skipped;skipped=[];i=0;feedback.textContent="üìò Jetzt die √ºbersprungenen Vokabeln!";updateProg();showNext();return; }
      trainer.style.display="none";progress.style.display="none";
      let h="<h3>Runde beendet</h3>";
      h+=errors.length?`<p>${errors.length} Fehler:</p><ul>${errors.map(([q,a])=>`<li>${q} ‚Üí ${a}</li>`).join("")}</ul>`:"<p>Keine Fehler üéâ</p>";
      h+='<button onclick="location.reload()">üîÑ Neue Runde</button>';
      result.innerHTML=h;result.style.display="block";return;
    }

    updateProg();
    const [en,de,catg]=round[i];
    let ask,answ;
    if(mode==="toGerman"){ask=en;answ=de;}
    else if(mode==="toEnglish"){ask=de;answ=en;}
    else { if(Math.random()<0.5){ask=en;answ=de;}else{ask=de;answ=en;} }

    const c=M[catg]||"#ccc";
    word.innerHTML=`<div style="display:inline-block;padding:6px 12px;border-radius:12px;background:${c};color:#fff;">${C[catg]}</div><br><br><b>${ask}</b>`;
    feedback.textContent="";

    if(game==="learn"){
      inputWrap.style.display="inline-block";
      right.style.display="none";wrong.style.display="none";skip.style.display="inline-block";
      ans.value="";ans.focus();
      const checkAnswer=()=>{
        const ok=ans.value.trim().toLowerCase()===answ.toLowerCase();
        if(fT.checked){ feedback.textContent=ok?"‚úÖ Richtig!":`‚ùå Falsch! Richtige Antwort: ${answ}`; flash(ok?"correct":"wrong"); }
        if(!ok) errors.push([ask,answ]);
        i++;setTimeout(showNext,parseInt(tT.value));
      };
      ans.onkeydown=e=>{if(e.key==="Enter")checkAnswer();};
      sendBtn.onclick=checkAnswer;
      skip.onclick=()=>{skipped.push([en,de,catg]);i++;showNext();};
    }else{
      inputWrap.style.display="none";
      right.style.display="inline-block";wrong.style.display="inline-block";skip.style.display="inline-block";
      trap=Math.random()<.3;
      curr=trap?getWrong(answ):answ;
      card.style.background=trap?"#fdf8f2":"#fff";
      feedback.innerHTML=trap?`<div class="fake-flag">T√§uschpaarung!</div>üí° <b>${curr}</b>`:`üí° <b>${curr}</b>`;
      const parent=document.getElementById("cardButtons");
      if(Math.random()<.5)parent.insertBefore(wrong,right);else parent.insertBefore(right,wrong);
      const okAction=(truth)=>{
        if(fT.checked){feedback.textContent=truth?"‚úÖ Richtig!":"‚ùå Falsch!";flash(truth?"correct":"wrong");}
        if(!truth)errors.push([ask,answ]);
        i++;setTimeout(showNext,parseInt(tT.value));
      };
      right.onclick=()=>okAction(!trap);
      wrong.onclick=()=>okAction(trap);
      skip.onclick=()=>{skipped.push([en,de,catg]);i++;showNext();};
    }
  }

  function getWrong(c){let p=list.map(v=>v[1]);let w;do{w=p[Math.floor(Math.random()*p.length)]}while(w===c);return w;}

  learn.onclick=()=>start(mSel.value,"learn");
  cards.onclick=()=>start(mSel.value,"cards");
  last30.onclick=()=>{
    const a=S("vokabeln");if(!a.length)return alert("Keine Vokabeln.");
    const l=a.slice(-30);
    const choice=confirm("üìö Letzte 30 Vokabeln:\nOK = Karteikarten\nAbbrechen = Eingabe");
    start(mSel.value,choice?"cards":"learn",l);
  };
  restart.onclick=()=>location.reload();

  document.getElementById("toggleLast").onclick=()=>{
    document.getElementById("lastAddedList").classList.toggle("open");
  };

  function renderCats(){
    for(const k in C){
      const o=document.createElement("option");
      o.value=k;o.textContent=" "+C[k];
      o.style.backgroundColor=M[k];o.style.color="#fff";
      cat.appendChild(o);
    }
  }
  function lastAdded(){
    const d=document.getElementById("lastAddedList"),a=S("vokabeln");
    if(!a.length)return d.textContent="Keine Vokabeln.";
    const l=a.slice(-5).reverse();
    d.innerHTML=l.map(v=>`<div><b>${v[0]}</b> ‚Äì ${v[1]} <span style='color:${M[v[2]]}'>(${C[v[2]]})</span></div>`).join("");
  }

  (async()=>{await sync();renderCats();lastAdded();})();
});
</script>
</body>
</html>
