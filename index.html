<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>üéØ Vokabeltrainer</title>
<style>
body{font-family:sans-serif;background:#f7f9fb;margin:0;padding:20px;}
.app{max-width:900px;margin:auto;text-align:center;}
h1{font-size:1.8rem;margin-bottom:1rem;}
button,input,select{font-size:1rem;padding:8px 12px;border-radius:8px;border:1px solid #ccc;margin:5px;}
button{cursor:pointer;background:#2980b9;color:#fff;border:none;transition:background .2s ease,transform .1s ease;}
button:hover{background:#3498db;transform:translateY(-1px);}
.card{position:relative;background:#fff;padding:20px;border-radius:16px;box-shadow:0 2px 6px rgba(0,0,0,0.1);margin-top:20px;transition:background-color .4s ease;}
.card.correct{background-color:#d4edda;}
.card.wrong{background-color:#f8d7da;}
.word{font-size:1.6rem;margin:20px 0;font-weight:600;}
.feedback{font-size:1.1rem;margin:10px 0;min-height:1.2em;}
.controls{display:flex;flex-wrap:wrap;gap:12px;align-items:center;justify-content:center;margin-bottom:25px;}
.controls label{display:flex;align-items:center;gap:6px;margin:5px 8px;}
.functions{display:flex;flex-wrap:wrap;justify-content:center;gap:20px;margin:30px 0 10px;}
.kachel{flex:1 1 300px;max-width:360px;background:linear-gradient(145deg,#fff,#f0f4ff);border-radius:14px;box-shadow:0 3px 6px rgba(0,0,0,0.08);padding:16px;text-align:center;font-size:1.1rem;cursor:pointer;transition:all .25s ease;border:1px solid #dce3ef;}
.kachel:hover{background:linear-gradient(145deg,#e7f1ff,#ffffff);transform:translateY(-2px);box-shadow:0 6px 12px rgba(0,0,0,0.12);}
.feedback-settings{background:#f1f3f6;border-radius:12px;padding:12px 20px;margin:25px auto;max-width:600px;box-shadow:0 2px 5px rgba(0,0,0,0.08);display:flex;flex-wrap:wrap;justify-content:center;gap:15px;align-items:center;}
.progress{margin-top:10px;font-weight:600;font-size:1.05rem;min-height:1.2em;}
#cardButtons{display:flex;gap:12px;justify-content:center;align-items:center;margin-top:15px;}
#rightBtn{background:#2ECC71;color:#fff;}
#wrongBtn{background:#E74C3C;color:#fff;}
#skipBtn{background:#bdc3c7;color:#000;}
.footer{margin-top:30px;font-size:0.95rem;color:#555;}
a.linkbtn{display:inline-block;padding:10px 16px;border-radius:8px;background:#74b9ff;color:#000;text-decoration:none;font-weight:600;}
a.linkbtn:hover{background:#a6d4ff;}
#datasourceStatus{position:fixed;right:12px;bottom:10px;font-size:.8rem;opacity:.75;color:#555;pointer-events:none;}
#lastAddedBox{margin-top:25px;}
#lastAddedToggle{cursor:pointer;color:#2980b9;font-weight:bold;}
#lastAddedList{display:none;margin-top:10px;background:#fff;padding:10px;border-radius:10px;box-shadow:0 2px 4px rgba(0,0,0,0.1);}
</style>
</head>
<body>
<div class="app">
<h1>üéØ Vokabeltrainer</h1>

<div class="controls">
<label>Kategorie:
<select id="category"><option value="Alle">Alle (bunt gemischt)</option></select></label>
<label>Modus:
<select id="mode">
<option value="toGerman">Englisch ‚Üí Deutsch</option>
<option value="toEnglish">Deutsch ‚Üí Englisch</option>
<option value="mixed">Gemischt</option> 
</select></label>
</div>

<div class="functions">
  <div class="kachel" id="learnBtn">‚úçÔ∏è Vokabel-Abfrage starten</div>
  <div class="kachel" id="last30Btn">üìö Letzte 30 Vokabeln</div>
  <div class="kachel" id="cardsBtn">üß† Karteikarten starten</div>
</div>

<div id="lastAddedBox">
  <div id="lastAddedToggle">üßæ Zuletzt hinzugef√ºgte Vokabeln anzeigen ‚ñº</div>
  <div id="lastAddedList"></div>
</div>

<div class="feedback-settings">
<label><input type="checkbox" id="feedbackToggle" checked> Sofortiges Feedback anzeigen</label>
<label>Toast-Dauer:
<select id="toastTime">
<option value="500"> 0,5 s</option>
<option value="1000" selected>1 s</option>
<option value="2000">2 s</option>
  <option value="5000"> 5 s</option>
</select></label>
</div>

<div class="progress" id="progress" style="display:none;"></div>

<div id="trainer" style="display:none;">
  <div class="card" id="card">
    <div id="word" class="word"></div>
    <input id="answerInput" type="text" placeholder="√úbersetzung eingeben..." style="display:none;">
    <div id="feedback" class="feedback"></div>
    <div id="cardButtons">
      <button id="rightBtn" style="display:none;">Richtig</button>
      <button id="wrongBtn" style="display:none;">Falsch</button>
      <button id="skipBtn" style="display:none;">√úberspringen</button>
    </div>
  </div>
  <button id="restartBtn" style="margin-top:10px;">üîÑ Neustart</button>
</div>

<div id="result" style="display:none;" class="card"></div>

<div class="footer">
<hr>
<a href="vokabeln.html" class="linkbtn">üìò Vokabel√ºbersicht √∂ffnen</a>
<br><br>
<small>¬© 2025 @Beefi</small>
</div>
</div>

<div id="datasourceStatus">üíæ Datenquelle: Lokaler Speicher</div>

<script>
(async function(){
const CATEGORY_NAMES={"Gelb":"Grundwerkzeuge Metallverarbeitung","Pink":"Werkzeugkasten Mechaniker","Blau":"Blech- / Kunststoffarbeiten","Gruen":"Drehen / Fr√§sen","HellesPink":"Hydraulik / Pneumatik","Orange":"Elektrotechnik","Dunkelgruen":"Flugger√§temechanik allgemein","Rot":"Verwechslungsgefahr"};
const COLOR_MAP={"Gelb":"#F4D03F","Pink":"#E91E63","Blau":"#1976D2","Gruen":"#1E8449","HellesPink":"#F54927","Orange":"#E67E22","Dunkelgruen":"#117A65","Rot":"#C0392B"};

// üîÑ Sync Funktion ‚Äì lokale Daten zuerst, sonst JSON laden
async function loadVokabeln() {
  let vokabeln = [];
  try {
    const localData = localStorage.getItem("vokabeln");
    if (localData) {
      vokabeln = JSON.parse(localData);
      document.getElementById("datasourceStatus").textContent = "üíæ Datenquelle: Lokaler Speicher";
    } else {
      const response = await fetch("vokabeln.json", { cache: "no-store" });
      if (response.ok) {
        vokabeln = await response.json();
        localStorage.setItem("vokabeln", JSON.stringify(vokabeln));
        localStorage.setItem("vokabeln_updated", new Date().toISOString());
        document.getElementById("datasourceStatus").textContent = "üåê Datenquelle: vokabeln.json (Online)";
      }
    }
  } catch (err) {
    console.error("Fehler beim Laden der Vokabeln:", err);
  }
  return vokabeln;
}

let list = await loadVokabeln();
if(!Array.isArray(list)||list.length===0){
  list=[["hammer","Hammer","Pink"],["file","Feile","Gelb"],["drill","Bohrer","Pink"],["ruler","Ma√üstab","Gelb"],["saw","S√§ge","Gelb"]];
  localStorage.setItem("vokabeln",JSON.stringify(list));
}

const catSel=document.getElementById("category"),
modeSel=document.getElementById("mode"),
feedbackToggle=document.getElementById("feedbackToggle"),
learnBtn=document.getElementById("learnBtn"),
cardsBtn=document.getElementById("cardsBtn"),
last30Btn=document.getElementById("last30Btn"),
restartBtn=document.getElementById("restartBtn"),
wordDiv=document.getElementById("word"),
feedback=document.getElementById("feedback"),
rightBtn=document.getElementById("rightBtn"),
wrongBtn=document.getElementById("wrongBtn"),
skipBtn=document.getElementById("skipBtn"),
progress=document.getElementById("progress"),
trainer=document.getElementById("trainer"),
result=document.getElementById("result"),
answerInput=document.getElementById("answerInput"),
card=document.getElementById("card");

function renderCats(){
catSel.innerHTML="<option value='Alle'>Alle (bunt gemischt)</option>";
for(const k in CATEGORY_NAMES){
const o=document.createElement("option");
o.value=k;o.textContent=" "+CATEGORY_NAMES[k];
o.style.backgroundColor=COLOR_MAP[k];o.style.color="#fff";
catSel.appendChild(o);
}}
renderCats();

let round=[],index=0,errors=[],skipped=[],mode="mixed",category="Alle",gameMode="learn",currentAnswer="",isTrap=false;

function flash(colorClass){
if(!feedbackToggle.checked) return;
card.classList.add(colorClass);
setTimeout(()=>card.classList.remove(colorClass),250);
}

function updateProgress(){
progress.style.display="block";
progress.textContent=`Vokabel ${index+1}/${round.length} | Fehler: ${errors.length}`;
}

function startRound(selectedMode,type,customList=null){
category=catSel.value;mode=selectedMode;gameMode=type;
let f=(category==="Alle")?list:list.filter(v=>v[2]===category);
if(customList) f=customList;
round=f.slice(0,15);
index=0;errors=[];skipped=[];
result.style.display="none";trainer.style.display="block";
feedback.textContent="";
updateProgress();
showNext();
}

function showNext(){
if(index>=round.length){
if(skipped.length>0){
round=skipped;skipped=[];index=0;
feedback.textContent="üìò Jetzt die √ºbersprungenen Vokabeln!";
updateProgress();
showNext();
return;}
trainer.style.display="none";progress.style.display="none";
let html=`<h3>Runde beendet</h3>`;
if(errors.length===0)html+="<p>Keine Fehler üéâ</p>";
else{html+=`<p>${errors.length} Fehler:</p><ul>`;
errors.forEach(([q,a])=>html+=`<li>${q} ‚Üí ${a}</li>`);html+="</ul>";}
html+="<button onclick='location.reload()'>üîÑ Neue Runde</button>";
result.innerHTML=html;result.style.display="block";return;}

updateProgress();
const [en,de,cat]=round[index];
let ask,answer;
if(mode==="toGerman"){ask=en;answer=de;}
else if(mode==="toEnglish"){ask=de;answer=en;}
else{if(Math.random()<0.5){ask=en;answer=de;}else{ask=de;answer=en;}}
const catColor=COLOR_MAP[cat]||"#ccc";
wordDiv.innerHTML=`<div style='display:inline-block;padding:6px 12px;border-radius:12px;background:${catColor};color:#fff;'>${CATEGORY_NAMES[cat]}</div><br><br><b>${ask}</b>`;
feedback.textContent="";

if (gameMode === "learn") {
  answerInput.style.display="inline-block";
  rightBtn.style.display="none";
  wrongBtn.style.display="none";
  skipBtn.style.display="inline-block";
  answerInput.value="";
  answerInput.focus();
  answerInput.onkeydown=e=>{
    if(e.key==="Enter"){
      const correct=answerInput.value.trim().toLowerCase()===answer.toLowerCase();
      if(feedbackToggle.checked){
        feedback.textContent=correct?"‚úÖ Richtig!":`‚ùå Falsch! Richtige Antwort: ${answer}`;
        flash(correct?"correct":"wrong");
      }
      if(!correct)errors.push([ask,answer]);
      index++;
      setTimeout(showNext,feedbackToggle.checked?800:0);
    }
  };
  skipBtn.onclick=function(){skipped.push([en,de,cat]);index++;showNext();};
}
else if (gameMode === "cards") {
  answerInput.style.display="none";
  rightBtn.style.display="inline-block";
  wrongBtn.style.display="inline-block";
  skipBtn.style.display="inline-block";
  isTrap=Math.random()<0.3;
  currentAnswer=isTrap?getRandomWrongAnswer(answer):answer;
  card.style.background=isTrap?"#f7f7f7":"#fff";
  const questionMark=isTrap?"<div style='position:absolute; top:10px; right:15px; font-size:1.3rem; color:#888;'>‚ùì</div>":"";
  feedback.innerHTML=`üí° <b>${currentAnswer}</b>`;
  wordDiv.innerHTML=`${questionMark}<div style='display:inline-block;padding:6px 12px;border-radius:12px;background:${catColor};color:#fff;'>${CATEGORY_NAMES[cat]}</div><br><br><b>${ask}</b>`;
  const parent=document.getElementById("cardButtons");
  if(Math.random()<0.5)parent.insertBefore(wrongBtn,rightBtn);else parent.insertBefore(rightBtn,wrongBtn);
  rightBtn.onclick=function(){const correct=!isTrap;if(feedbackToggle.checked){feedback.textContent=correct?"‚úÖ":"‚ùå";flash(correct?"correct":"wrong");}if(!correct)errors.push([ask,answer]);index++;setTimeout(showNext,350);};
  wrongBtn.onclick=function(){const correct=isTrap;if(feedbackToggle.checked){feedback.textContent=correct?"‚úÖ":"‚ùå";flash(correct?"correct":"wrong");}if(!correct)errors.push([ask,answer]);index++;setTimeout(showNext,350);};
  skipBtn.onclick=function(){skipped.push([en,de,cat]);index++;showNext();};
}
}

function getRandomWrongAnswer(correct){
let pool=list.map(v=>v[1]);let wrong;
do{wrong=pool[Math.floor(Math.random()*pool.length)];}while(wrong===correct);
return wrong;
}

learnBtn.onclick=()=>startRound(modeSel.value,"learn");
cardsBtn.onclick=()=>startRound(modeSel.value,"cards");
last30Btn.onclick=()=>{
const all=JSON.parse(localStorage.getItem("vokabeln")||"[]");
if(all.length===0){alert("Keine Vokabeln vorhanden.");return;}
const last30=all.slice(-30);
const choice=confirm("üìö Letzte 30 Vokabeln:\nOK = Karteikarten\nAbbrechen = Schreibabfrage");
startRound(modeSel.value,choice?"cards":"learn",last30);
};
restartBtn.onclick=()=>location.reload();

// üßæ Zuletzt hinzugef√ºgt (aufklappbar)
const lastAddedList=document.getElementById("lastAddedList");
const toggle=document.getElementById("lastAddedToggle");
toggle.onclick=()=>{
lastAddedList.style.display=lastAddedList.style.display==="none"?"block":"none";
toggle.textContent=lastAddedList.style.display==="none"?"üßæ Zuletzt hinzugef√ºgte Vokabeln anzeigen ‚ñº":"üßæ Zuletzt hinzugef√ºgte Vokabeln verbergen ‚ñ≤";
};
function renderLastAdded(){
const all=JSON.parse(localStorage.getItem("vokabeln")||"[]");
if(!all.length){lastAddedList.textContent="Keine Vokabeln vorhanden.";return;}
const last=all.slice(-5).reverse();
lastAddedList.innerHTML=last.map(v=>`<div><b>${v[0]}</b> ‚Äì ${v[1]} <span style="color:${COLOR_MAP[v[2]]}">(${CATEGORY_NAMES[v[2]]})</span></div>`).join("");
}
renderLastAdded();

})();
</script>
</body>
</html>
