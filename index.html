<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Vokabeltrainer</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --blue:#2563eb;--blue2:#1d4ed8;--ink:#0f172a;
  --glass:rgba(255,255,255,.88);
  --ok:#22c55e;--bad:#ef4444;--muted:#9ca3af
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter,system-ui,sans-serif;
  background:linear-gradient(145deg,#eef4ff,#dbeafe);
  color:var(--ink)
}
.app{
  max-width:960px;margin:32px auto;
  padding:22px;background:var(--glass);
  border-radius:22px;
  box-shadow:0 10px 32px rgba(0,0,0,.10);
  backdrop-filter:blur(8px)
}
h1{
  margin:0;text-align:center;
  font-size:2rem;font-weight:800;color:#1e3a8a
}
.hr{
  width:160px;height:4px;background:var(--blue);
  border-radius:4px;margin:10px auto 20px
}
.controls,.functions{
  display:flex;flex-wrap:wrap;justify-content:center;gap:12px
}
.controls label{display:flex;align-items:center;gap:6px}
select{
  padding:8px 12px;border:1px solid #d1d5db;
  border-radius:10px;font-size:1rem;min-width:180px
}

/* Kacheln */
.kachel{
  flex:1 1 240px;text-align:center;
  background:var(--blue);color:#fff;
  padding:18px;border-radius:14px;
  font-weight:700;cursor:pointer;
  box-shadow:0 6px 16px rgba(37,99,235,.25);
  transition:transform .15s,background .15s, box-shadow .2s
}
.kachel small{display:block;margin-top:6px;font-weight:600;opacity:.9}
.kachel:hover{transform:translateY(-1px);background:var(--blue2);box-shadow:0 8px 20px rgba(37,99,235,.35)}

/* Progress */
.progress{text-align:center;font-weight:700;margin:8px 0 12px;min-height:1.2em}

/* Stage / Spielkarte */
#stage{
  display:none;margin-top:14px;padding:28px;border-radius:20px;
  box-shadow:inset 0 0 10px rgba(0,0,0,.10);
  text-align:center; transition:background .25s ease, color .25s ease
}
.chip{display:inline-block;font-weight:800;padding:8px 14px;border-radius:999px;margin-bottom:10px;background:rgba(255,255,255,.25)}
.word{font-size:1.9rem;font-weight:800;margin:8px 0 6px}
.offer{font-size:1.12rem;color:#0f172a;margin:10px 0 14px;min-height:1.4em;font-weight:700}

/* Buttonzeile */
.btnrow{display:flex;justify-content:center;gap:12px;flex-wrap:wrap}
.btn{
  border:none;border-radius:12px;padding:10px 20px;
  font-weight:700;font-size:1rem;cursor:pointer
}
.ok{background:var(--ok);color:#fff}
.bad{background:var(--bad);color:#fff}
.skip{background:var(--muted);color:#fff}

/* Eingabereihe */
.inprow{
  display:none;gap:8px;justify-content:center;margin-top:12px
}
.inprow input{
  width:60%;min-width:260px;padding:10px 14px;
  border:1px solid #d1d5db;border-radius:12px;font-size:1rem
}
.inprow button{
  background:var(--blue);color:#fff;border:none;
  border-radius:12px;padding:10px 16px;font-weight:700
}

/* Feedback-Flash */
.flash-correct{animation:good .4s}
.flash-wrong{animation:bad .4s}
@keyframes good{from{filter:brightness(1.08)}to{filter:brightness(1)}}
@keyframes bad{from{outline:3px solid rgba(239,68,68,.4)}to{outline:0}}

/* Footer-Aktionen */
.footer-actions{display:flex;justify-content:space-between;gap:12px;margin-top:24px}
.footer-actions a,.footer-actions button{
  display:inline-flex;align-items:center;justify-content:center;gap:6px;
  background:linear-gradient(135deg,#eaf0ff,#f8faff);
  border:1px solid #dbe3ff;color:#1f2937;padding:10px 16px;border-radius:12px;
  font-weight:700;cursor:pointer;text-decoration:none;font-size:1rem;
  box-shadow:0 3px 8px rgba(0,0,0,0.05);transition:all .25s ease
}
.footer-actions a:hover,.footer-actions button:hover{
  background:linear-gradient(135deg,#e0e7ff,#f1f5ff);
  transform:translateY(-1px);
  box-shadow:0 5px 12px rgba(37,99,235,0.15)
}

/* Feedback-Toggle h√ºbsch */
.feedback-toggle{
  display:flex;align-items:center;justify-content:center;
  gap:10px;padding:12px 18px;border-radius:16px;
  background:linear-gradient(135deg,#f8fafc,#eef2ff);
  box-shadow:0 2px 8px rgba(0,0,0,.08);
  transition:all .25s ease;margin:6px 0 8px
}
.feedback-toggle:hover{box-shadow:0 4px 12px rgba(37,99,235,.15);transform:translateY(-1px)}
.feedback-toggle label{font-weight:700;color:#1e3a8a;font-size:1.05rem;letter-spacing:.3px;cursor:pointer}
#chkFeedback{appearance:none;width:44px;height:24px;background:#d1d5db;border-radius:999px;position:relative;outline:none;cursor:pointer;transition:background .3s ease}
#chkFeedback::before{content:"";position:absolute;top:3px;left:3px;width:18px;height:18px;background:#fff;border-radius:50%;transition:all .3s ease;box-shadow:0 1px 4px rgba(0,0,0,.2)}
#chkFeedback:checked{background:#2563eb}
#chkFeedback:checked::before{left:23px}

/* Trenner & Recent fancy glass */
.trenner{
  height:3px;width:60%;margin:50px auto 20px;
  background:linear-gradient(90deg,transparent,#93c5fd,#2563eb,#93c5fd,transparent);
  border-radius:2px;animation:shine 5s linear infinite
}
@keyframes shine{0%{background-position:0 0}100%{background-position:400px 0}}

details.recent-section{
  border-radius:20px;padding:22px;margin-top:10px;text-align:center;
  backdrop-filter:blur(10px);
  background:rgba(255,255,255,0.7);
  box-shadow:0 8px 28px rgba(0,0,0,.08);
  transition:all .3s ease;
}
details.recent-section[open]{background:rgba(255,255,255,0.9);box-shadow:0 10px 32px rgba(0,0,0,.15)}
details.recent-section summary{
  font-weight:800;font-size:1.15rem;color:#1e3a8a;cursor:pointer;list-style:none;
  letter-spacing:.5px;text-transform:uppercase;transition:color .3s ease;
}
details.recent-section summary:hover{color:#2563eb}
#recent{
  margin-top:18px;text-align:center;display:flex;flex-wrap:wrap;justify-content:center;
  gap:18px;transition:opacity .4s ease;
}
.recent-item{
  display:inline-block;min-width:160px;border-radius:18px;padding:14px 20px;
  font-weight:700;color:#111827;
  background:rgba(255,255,255,0.75);
  box-shadow:0 6px 18px rgba(0,0,0,.1);
  backdrop-filter:blur(8px);
  transition:all .25s ease;
  transform:translateY(0);
}
.recent-item:hover{
  transform:translateY(-5px) scale(1.04);
  box-shadow:0 10px 25px rgba(0,0,0,.15);
  filter:brightness(1.05);
}
.recent-item small{display:block;font-weight:500;font-size:.85rem;margin-top:4px;opacity:.85}
.foot{text-align:center;margin-top:14px;color:#6b7280;font-size:.92rem}

/* Mitdenker Hinweis */
.mitdenker{display:none;margin-top:8px;font-style:italic;font-weight:700;color:#1e3a8a;opacity:.95;text-align:center}
.mitdenker.on{display:block}

/* Mobile Tweaks */
@media (max-width:560px){
  .inprow input{width:100%}
}
</style>
</head>
<body>
<div class="app">
  <h1>üéØ Vokabeltrainer</h1>
  <div class="hr"></div>

  <div class="controls">
    <label>Kategorie:
      <select id="selCat"><option value="Alle">Alle (bunt gemischt)</option></select>
    </label>
    <label>Modus:
      <select id="selMode">
        <option value="mixed">Gemischt</option>
        <option value="toGerman">Englisch ‚Üí Deutsch</option>
        <option value="toEnglish">Deutsch ‚Üí Englisch</option>
      </select>
    </label>
    <label>Delay:
      <select id="selDelay">
        <option value="1000">1 s</option>
        <option value="3000" selected>3 s</option>
        <option value="5000">5 s</option>
      </select>
    </label>
  </div>

  <div class="feedback-toggle">
    <input type="checkbox" id="chkFeedback" checked>
    <label for="chkFeedback">Feedback anzeigen</label>
  </div>

  <div class="functions">
    <div id="btnLearn" class="kachel">‚úçÔ∏è Vokabel-Abfrage starten</div>
    <div id="btnLast30" class="kachel">üìó Letzte gelernte Vokabeln</div>
    <div id="btnCards" class="kachel">üß† Karteikarten<br><small><i>Mitdenker Edition</i></small></div>
  </div>

  <div id="progress" class="progress"></div>

  <section id="stage">
    <div id="chip" class="chip">Kategorie</div>
    <div id="q" class="word"></div>
    <div id="offer" class="offer"></div>

    <div id="rowButtons" class="btnrow">
      <button id="btnRight" class="btn ok">Richtig</button>
      <button id="btnWrong" class="btn bad">Falsch</button>
      <button id="btnDec" class="btn bad">T√§uschung erkannt</button>
      <button id="btnNext" class="btn skip">Weiter</button>
    </div>

    <div id="rowInput" class="inprow">
      <input id="inp" type="text" placeholder="√úbersetzung eingeben ‚Ä¶">
      <button id="btnSub">Eingabe</button>
    </div>

    <div id="mitdenkerNote" class="mitdenker">Mitdenker Edition</div>
  </section>

  <div class="footer-actions">
    <a href="vokabeln.html">üìÇ Vokabeln</a>
    <button id="btnRestart">üîÑ Neustart</button>
  </div>

  <div class="trenner"></div>

  <details class="recent-section" open>
    <summary>‚ú® Zuletzt hinzugef√ºgt</summary>
    <div id="recent">‚Äì</div>
  </details>

  <div class="foot">¬© 2025 Beeferino ‚Ä¢ Datenquelle: GitHub / lokal</div>
</div>

<script>
(function(){
/* Kategorien */
const CATS={
  Gelb:["Grundwerkzeuge Metallverarbeitung","#F4D03F","#000"],
  Pink:["Werkzeugkasten Mechaniker","#E91E63","#fff"],
  Blau:["Blech- / Kunststoffarbeiten","#1976D2","#fff"],
  Gruen:["Drehen / Fr√§sen","#1E8449","#fff"],
  HellesPink:["Hydraulik / Pneumatik","#F54927","#fff"],
  Orange:["Elektrotechnik","#E67E22","#fff"],
  Dunkelgruen:["Flugger√§temechanik allgemein","#117A65","#fff"],
  Rot:["Verwechslungsgefahr","#C0392B","#fff"]
};

/* El-Refs */
const $=id=>document.getElementById(id);
const selCat=$("selCat"), selMode=$("selMode"), selDelay=$("selDelay"), chkFeedback=$("chkFeedback");
const btnLearn=$("btnLearn"), btnCards=$("btnCards"), btnLast30=$("btnLast30"), btnRestart=$("btnRestart");
const stage=$("stage"), chip=$("chip"), q=$("q"), offer=$("offer"), progress=$("progress");
const rowButtons=$("rowButtons"), btnRight=$("btnRight"), btnWrong=$("btnWrong"), btnDec=$("btnDec"), btnNext=$("btnNext");
const rowInput=$("rowInput"), inp=$("inp"), btnSub=$("btnSub"), recent=$("recent"), mitdenkerNote=$("mitdenkerNote");

/* State */
let data=[], round=[], i=0, game="learn", delay=3000, trap=false, correct="";
let errors=[], repeating=false;

/* Helpers */
function colorizeSelect(){
  const v=selCat.value;
  if(v!=="Alle" && CATS[v]){
    selCat.style.background=CATS[v][1];
    selCat.style.color=CATS[v][2];
  }else{
    selCat.style.background="#fff";
    selCat.style.color="#000";
  }
}
function setStageTheme(catKey){
  const meta=CATS[catKey]||["","#ffffff","#000"];
  // ganze Karte in Kat-Farbe (leicht), Text bleibt gut lesbar
  stage.style.background = `linear-gradient(180deg, ${meta[1]}33, ${meta[1]}22)`;
  stage.style.color = "#0f172a";
  chip.style.background = "rgba(255,255,255,.25)";
  chip.style.color = meta[2];
}
function shuffle(a){for(let j=a.length-1;j>0;j--){const r=Math.floor(Math.random()*(j+1));[a[j],a[r]]=[a[r],a[j]];}}
function randomizeButtons(){
  // In Kartenmodus: Richtig, Falsch, T√§uschung erkannt, Weiter -> Reihenfolge mischen
  if(game==="cards"){
    const btns=[btnRight,btnWrong,btnDec,btnNext];
    const order=[0,1,2,3].sort(()=>Math.random()-0.5);
    rowButtons.innerHTML="";
    order.forEach(ix=>rowButtons.appendChild(btns[ix]));
  }else{
    // In Learn: nur Weiter sichtbar; Reihenfolge egal
    rowButtons.innerHTML="";
    rowButtons.appendChild(btnNext);
  }
}
function setProg(){
  progress.textContent = `Vokabel ${Math.min(i+1, round.length)}/${round.length} | Fehler: ${errors.length}`;
}
function showStage(show){ stage.style.display = show ? "block" : "none"; }
function flash(ok){
  if(!chkFeedback.checked){
    i++; next();
    return;
  }
  stage.classList.remove("flash-correct","flash-wrong");
  stage.offsetWidth; // reflow
  stage.classList.add(ok?"flash-correct":"flash-wrong");
  setTimeout(()=>{ i++; next(); }, delay);
}

/* Daten laden */
async function fetchRemote(){
  try{
    const r=await fetch("https://beeferino.github.io/vokabeltrainer/vokabeln.json",{cache:"no-store"});
    if(!r.ok) throw new Error("fetch failed");
    const j=await r.json();
    localStorage.setItem("vokabeln",JSON.stringify(j));
    localStorage.setItem("vokabeln_updated", new Date().toISOString());
    return j;
  }catch(e){
    return JSON.parse(localStorage.getItem("vokabeln")||"[]");
  }
}
function renderRecent(){
  const last = data.slice(-5).reverse();
  if(!last.length){recent.textContent="‚Äì";return;}
  recent.innerHTML = last.map(v=>{
    const c=CATS[v[2]]||["","#ccc","#000"];
    return `<div class="recent-item" style="background:${c[1]};color:${c[2]}">
      <b>${v[0]}</b> ‚Äì ${v[1]}<small>${c[0]}</small></div>`;
  }).join("");
}
function initCats(){
  for(const k in CATS){
    const o=document.createElement("option");
    o.value=k; o.textContent=CATS[k][0];
    o.style.background=CATS[k][1]; o.style.color=CATS[k][2];
    selCat.appendChild(o);
  }
  colorizeSelect();
}

/* Rundenlogik */
function pickBase(arr){
  if(selCat.value==="Alle"){ const c=[...arr]; shuffle(c); return c; }
  const f=arr.filter(v=>v[2]===selCat.value); shuffle(f); return f;
}
function startRound(type, customList=null){
  game = type;
  delay = parseInt(selDelay.value,10);
  errors = [];
  repeating=false;

  let base = customList ? [...customList] : pickBase(data);
  // Learn: 15 Items, Cards: 15 Items; bei Last30 (customList) alle durchlaufen
  if(!customList) base = base.slice(0,15);
  round = base;
  i=0;

  // UI
  if(game==="cards"){
    rowInput.style.display="none";
    btnRight.style.display="inline-block";
    btnWrong.style.display="inline-block";
    btnDec.style.display="inline-block";
    btnNext.style.display="inline-block";
  }else{ // learn
    rowInput.style.display="flex";
    btnRight.style.display="none";
    btnWrong.style.display="none";
    btnDec.style.display="none";
    btnNext.style.display="inline-block";
  }
  randomizeButtons();
  next();
}

function next(){
  // Ende-Logik
  if(i>=round.length){
    if(errors.length && !repeating){
      // Wiederholungsrunde nur mit Fehlern, ohne "Weiter"
      alert(`‚ùó ${errors.length} Fehler ‚Äì Wiederholungsrunde startet.`);
      round = errors.map(v=>v);
      errors = [];
      i=0; repeating=true;

      // In Wiederholung weiterhin Modus-spezifisch, aber "Weiter" deaktivieren
      btnNext.style.display="none";
      randomizeButtons();
      setProg();
      showStage(true);
    }else{
      // Abschluss
      showStage(false);
      if(errors.length){
        const list=errors.map(v=>`${v[0]} ‚Üí ${v[1]}`).join("\n");
        alert(`Runde beendet.\nFehler √ºbrig: ${errors.length}\n\n${list}`);
      }else{
        alert("üéâ Runde beendet ‚Äì alles korrekt!");
      }
      return;
    }
  }

  delay = parseInt(selDelay.value,10);
  setProg();

  const [en,de,cat] = round[i];
  const meta = CATS[cat]||["Kategorie","#ddd","#000"];
  chip.textContent = meta[0];
  chip.style.color = meta[2];
  setStageTheme(cat);

  const askEN = selMode.value==="toGerman" ? true : selMode.value==="toEnglish" ? false : Math.random()<0.5;
  const question = askEN ? en : de;
  const answer   = askEN ? de : en;
  correct = answer;

  q.textContent = question;
  offer.textContent = "";

  if(game==="cards"){
    // potentielle T√§uschung mit 30% Wahrscheinlichkeit
    trap = Math.random()<0.3;
    if(trap){
      const pool = data.map(v=> askEN ? v[1] : v[0]); // falsches Gegenst√ºck aus passender Sprache
      let wrong; do{ wrong = pool[Math.floor(Math.random()*pool.length)]; }while(wrong===answer);
      offer.textContent = "üí° " + wrong;
    }else{
      offer.textContent = "üí° " + answer;
    }
    rowInput.style.display="none";
    randomizeButtons();
    // Mitdenker-Hinweis nur in Kartenmodus & Feedback an
    mitdenkerNote.classList.toggle("on", chkFeedback.checked);
  }else{
    // Learn: keine T√§uschung, Eingabe
    trap=false;
    rowInput.style.display="flex";
    inp.value=""; inp.focus();
    offer.textContent = "";
    // Hinweis aus
    mitdenkerNote.classList.remove("on");
    // Buttons (nur Weiter), schon gesetzt
  }

  showStage(true);
}

/* Button-Aktionen */
btnRight.onclick = ()=>{
  if(game!=="cards"){ return; }
  const ok = !trap;
  if(!ok) errors.push(round[i]);
  flash(ok);
};
btnWrong.onclick = ()=>{
  if(game!=="cards"){ return; }
  const ok = trap; // ‚ÄûFalsch‚Äú gew√§hlt, wenn tats√§chlich T√§uschung vorliegt, ist es falsch ‚Äì aber Logik: Wrong = falsche Karte -> soll Fehler sein
  // Hier ist die Semantik: ‚ÄûFalsch‚Äú meint: das angebotene Paar ist falsch.
  // Wenn trap=true, ist das Paar tats√§chlich falsch -> Nutzer h√§tte ‚ÄûT√§uschung erkannt‚Äú dr√ºcken sollen.
  // Also werten wir ‚ÄûFalsch‚Äú-Button als *Nutzer meint die angebotene L√∂sung ist falsch und will einfach weiter*, wir werten das als Fehler.
  errors.push(round[i]);
  flash(false);
};
btnDec.onclick = ()=>{
  if(game!=="cards"){ return; }
  if(trap){
    // Eingabefeld √∂ffnen und pr√ºfen
    rowInput.style.display="flex";
    inp.value=""; inp.focus();
    btnSub.onclick = ()=>{
      const ok = inp.value.trim().toLowerCase() === correct.toLowerCase();
      if(ok){
        flash(true);
      }else{
        // L√∂sung zeigen, als Fehler werten
        offer.innerHTML = `‚ùå Richtige Antwort: <b>${correct}</b>`;
        errors.push(round[i]);
        setTimeout(()=>flash(false), parseInt(selDelay.value,10));
      }
    };
  }else{
    // Keine T√§uschung ‚Äì Fehler
    errors.push(round[i]);
    flash(false);
  }
};
btnNext.onclick = ()=>{
  // ‚ÄûWeiter‚Äú z√§hlt als Fehler, aber stoppt bei Ende (kein 15x sinnfrei)
  errors.push(round[i]);
  i++;
  next();
};

btnSub.onclick = ()=>{
  // Learn-Modus Eingabe
  if(game!=="learn") return;
  const ok = inp.value.trim().toLowerCase() === correct.toLowerCase();
  if(!ok){
    // bei Feedback richtige L√∂sung zeigen
    if(chkFeedback.checked){
      offer.innerHTML = `‚ùå Richtige Antwort: <b>${correct}</b>`;
    }
    errors.push(round[i]);
  }
  flash(ok);
};
inp.addEventListener("keydown",e=>{ if(e.key==="Enter") btnSub.click(); });

/* Kachel-Events */
btnLearn.addEventListener("click", ()=> startRound("learn"));
btnCards.addEventListener("click", ()=> startRound("cards"));
btnLast30.addEventListener("click", ()=>{
  if(!data.length){ alert("Keine Vokabeln vorhanden."); return; }
  const last = data.slice(-30);
  const useCards = confirm("Mitdenker Edition aktivieren?\nOK = Karteikarten ‚Ä¢ Abbrechen = Eingabe");
  startRound(useCards?"cards":"learn", last);
});
btnRestart.addEventListener("click", ()=> location.reload());

/* Select-Events */
selCat.addEventListener("change", colorizeSelect);

/* Init */
(async ()=>{
  initCats();
  // Daten laden
  data = await fetchRemote();
  renderRecent();
  colorizeSelect();
})();
})();
</script>
</body>
</html>
