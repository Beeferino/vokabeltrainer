<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>üìò Vokabel√ºbersicht ‚Äì Beeferino</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --ink:#0f172a;--muted:#6b7280;--bg:#f7f9fb;--card:#ffffff;
  --blue:#2563eb;--blue2:#1d4ed8;--ok:#16a34a;--bad:#ef4444;
  --border:#e5ebf3;--shadow:0 8px 26px rgba(0,0,0,.1)
}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,system-ui,sans-serif;background:linear-gradient(145deg,#eef4ff,#dbeafe);color:var(--ink)}
a{color:#1e3a8a;text-decoration:none}

.app{max-width:1100px;margin:20px auto;padding:16px}
h1{text-align:center;font-weight:800;color:#1e3a8a;margin:0}
.hr{width:160px;height:4px;background:#2563eb;border-radius:4px;margin:10px auto 20px}

/* Desktop Toolbar & Tabelle */
.toolbar{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin:10px 0}
.toolbar select,.toolbar input{padding:8px 12px;border:1px solid #cfd6e4;border-radius:10px}
.toolbar .btn{background:var(--blue);color:#fff;border:none;border-radius:10px;padding:8px 14px;font-weight:700;cursor:pointer}
.toolbar .warn{background:var(--bad)}
.table-wrap{background:#fff;border-radius:16px;box-shadow:var(--shadow);overflow:hidden}
table{width:100%;border-collapse:collapse}
th,td{padding:10px;border-bottom:1px solid var(--border);text-align:left;vertical-align:top}
tr:hover{background:#f8fbff}
th.sortable{cursor:pointer;user-select:none}
th.sortable:after{content:" ‚ü≤";color:#9aa3b2;font-weight:400}
.category-chip{padding:4px 10px;border-radius:999px;color:#fff;font-weight:700;font-size:.9rem;display:inline-block}

/* Desktop Count Footer */
.desk-info{margin:10px 0;text-align:right;color:#6b7280;font-size:.95rem}

/* ===== Mobile ===== */
.mobile-only{display:none}
.mobile-header{
  position:sticky;top:0;background:#eef4ff;border-bottom:1px solid #dbe3ff;
  padding:10px;z-index:12
}
.mob-title{display:flex;align-items:center;justify-content:space-between}
.mob-title h2{margin:0;font-size:1.1rem;font-weight:800;color:#1e3a8a}
.mob-actions{display:flex;gap:8px}
.iconbtn{width:40px;height:40px;border-radius:10px;border:1px solid #cfd6e4;background:#fff;display:flex;align-items:center;justify-content:center;cursor:pointer}

.mob-filters{display:none;gap:8px;padding:10px;background:#f9fbff;border-bottom:1px solid #e5ebf3}
.mob-filters select,.mob-filters input{flex:1;padding:10px;border:1px solid #cfd6e4;border-radius:10px}

.mob-list{padding:10px}
.card{
  background:#fff;border:1px solid #e5ebf3;border-radius:14px;padding:14px;margin-bottom:12px;
  box-shadow:0 4px 10px rgba(0,0,0,.06);transition:box-shadow .2s,border-color .2s;overflow:hidden
}
.card.selected{border-color:#60a5fa;box-shadow:0 0 0 3px rgba(37,99,235,.15)}
.card-top{display:flex;justify-content:space-between;align-items:flex-start;gap:10px}
.badge{
  display:inline-block;max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;
  padding:6px 12px;border-radius:999px;color:#fff;font-weight:800;font-size:.82rem
}
.card-title{margin-top:6px;font-weight:800;font-size:1.05rem;word-break:break-word;overflow-wrap:anywhere}
.card-sub{margin-top:6px;color:#111827;font-size:1rem;word-break:break-word;overflow-wrap:anywhere}
.card-actions{display:flex;justify-content:flex-end;margin-top:10px}
.small-btn{border:none;background:#eaf0ff;border:1px solid #dbe3ff;color:#1f2937;padding:8px 10px;border-radius:10px;font-weight:700}

/* Floating Add (nur im Anpassen-Modus) */
.fab-add{
  position:fixed;right:16px;bottom:84px;width:52px;height:52px;border-radius:50%;
  background:var(--blue);color:#fff;border:none;font-weight:900;font-size:24px;display:none;align-items:center;justify-content:center;z-index:20;
  box-shadow:0 8px 20px rgba(37,99,235,.35)
}

/* Bottom 3-Buttons */
.bottom-bar{
  position:sticky;bottom:0;background:rgba(255,255,255,.95);backdrop-filter:blur(6px);
  border-top:1px solid #e5ebf3;padding:10px;z-index:15
}
.bottom-grid{display:flex;gap:10px}
.bottom-grid .bbtn{flex:1;border:none;border-radius:12px;padding:12px;font-weight:800;color:#fff;cursor:pointer}
.bbtn.gray{background:#6b7280}.bbtn.blue{background:var(--blue)}.bbtn.warn{background:var(--bad)}

/* Modal Editor */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:50;padding:12px}
.panel{background:#fff;border-radius:14px;padding:18px;width:92%;max-width:520px;box-shadow:var(--shadow)}
.panel h3{margin:0 0 10px 0;font-weight:800}
.form-grid{display:grid;gap:10px}
.form-grid label{font-size:.92rem;font-weight:700;color:#374151;display:flex;flex-direction:column;gap:6px}
.form-grid input,.form-grid select,.form-grid textarea{width:100%;padding:10px;border:1px solid #cfd6e4;border-radius:10px;font:inherit}
.modal-actions{display:flex;gap:12px;justify-content:space-between;margin-top:16px}
.btn{border:none;border-radius:12px;padding:10px 14px;font-weight:800;cursor:pointer}
.btn.primary{background:var(--blue);color:#fff}
.btn.ghost{background:#eef4ff;color:#111}
.btn.danger{background:var(--bad);color:#fff}

/* Responsive Umschalter */
@media (max-width:900px){
  .desktop-only{display:none}
  .mobile-only{display:block}
}
</style>
</head>
<body>
<div class="app">
  <h1>üìò Vokabel√ºbersicht</h1>
  <div class="hr"></div>

  <!-- DESKTOP -->
  <div class="desktop-only">
    <div class="toolbar">
      <select id="filterCatDesk"></select>
      <input id="searchDesk" type="text" placeholder="Suchen‚Ä¶">
      <button id="resetDesk" class="btn">Reset</button>
      <button id="addDesk" class="btn">‚ûï Neue</button>
      <button id="delDesk" class="btn warn">üóëÔ∏è L√∂schen</button>
      <button id="syncDesk" class="btn">üì§ In Datenbank eintragen</button>
      <button id="tokenBtn" class="btn">‚öôÔ∏è Token</button>
      <a href="index.html" class="btn" style="background:#eaf0ff;color:#1f2937;border:1px solid #dbe3ff">‚¨ÖÔ∏è Zur√ºck</a>
    </div>

    <div class="table-wrap">
      <table id="tbl">
        <thead>
          <tr>
            <th style="width:44px">‚úì</th>
            <th class="sortable" data-col="0">Englisch</th>
            <th class="sortable" data-col="1">Deutsch</th>
            <th>Kategorie</th>
            <th style="width:120px">Aktion</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    <div class="desk-info" id="deskInfo">‚Äì</div>
  </div>

  <!-- MOBILE -->
  <div class="mobile-only">
    <div class="mobile-header">
      <div class="mob-title">
        <h2>Vokabeln</h2>
        <div class="mob-actions">
          <button class="iconbtn" id="btnMobBack" title="Zur√ºck">‚¨ÖÔ∏è</button>
          <button class="iconbtn" id="btnMobSearch" title="Suche">üîé</button>
          <button class="iconbtn" id="btnMobFilter" title="Filter">üß™</button>
        </div>
      </div>
    </div>

    <div class="mob-filters" id="mobFilters">
      <select id="filterCatMob"><option value="Alle">Alle (bunt gemischt)</option></select>
      <input id="searchMob" type="text" placeholder="Suchen‚Ä¶">
      <button id="resetMob" class="btn">Reset</button>
    </div>

    <div class="mob-list" id="mobList"></div>

    <button class="fab-add" id="fabAdd" title="Neue Vokabel">+</button>

    <div class="bottom-bar">
      <div class="bottom-grid">
        <button class="bbtn gray" id="bbBack">Zur√ºck</button>
        <button class="bbtn blue" id="bbAdjust">Anpassen</button>
        <button class="bbtn gray" id="bbSync">In DB</button>
      </div>
    </div>
  </div>

  <div style="text-align:center;margin-top:10px;color:#6b7280">¬© 2025 Beeferino ‚Ä¢ Datenquelle: GitHub / lokal</div>
</div>

<!-- Modal Editor -->
<div class="modal" id="modal">
  <div class="panel">
    <h3 id="modalTitle">Vokabel</h3>
    <div class="form-grid">
      <label>Englisch
        <input id="mEn" type="text" autocomplete="off">
      </label>
      <label>Deutsch
        <input id="mDe" type="text" autocomplete="off">
      </label>
      <label>Kategorie
        <select id="mCat"></select>
      </label>
      <label>Erstellt (nur Datum)
        <input id="mDate" type="date" readonly style="background:#f3f4f6">
      </label>
      <label>Gruppe / Variante
        <input id="mGroup" type="text" autocomplete="off">
      </label>
      <label>Hinweis
        <textarea id="mHint" rows="2"></textarea>
      </label>
    </div>
    <div class="modal-actions">
      <button class="btn ghost" id="mCancel" style="flex:1">Abbrechen</button>
      <div style="flex:1;display:flex;gap:10px;justify-content:flex-end">
        <button class="btn danger" id="mDelete" title="L√∂schen">L√∂schen</button>
        <button class="btn primary" id="mSave">Speichern</button>
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  const CATEGORY_NAMES={Gelb:"Grundwerkzeuge Metallverarbeitung",Pink:"Werkzeugkasten Mechaniker",Blau:"Blech- / Kunststoffarbeiten",Gruen:"Drehen / Fr√§sen",HellesPink:"Hydraulik / Pneumatik",Orange:"Elektrotechnik",Dunkelgruen:"Flugger√§temechanik allgemein",Rot:"Verwechslungsgefahr"};
  const COLOR_MAP={Gelb:"#F4D03F",Pink:"#E91E63",Blau:"#1976D2",Gruen:"#1E8449",HellesPink:"#F54927",Orange:"#E67E22",Dunkelgruen:"#117A65",Rot:"#C0392B"};
  const TEXT_ON={Gelb:"#000",Pink:"#fff",Blau:"#fff",Gruen:"#fff",HellesPink:"#fff",Orange:"#fff",Dunkelgruen:"#fff",Rot:"#fff"};

  const RAW_URL="https://beeferino.github.io/vokabeltrainer/vokabeln.json";
  const GH_OWNER="beeferino", GH_REPO="vokabeltrainer", GH_PATH="vokabeln.json";

  const $=s=>document.querySelector(s);
  const $$=s=>Array.from(document.querySelectorAll(s));
  const isMobile=()=>matchMedia("(max-width:900px)").matches;

  const tblBody=$("#tbl tbody");
  const deskInfo=$("#deskInfo");
  const filterCatDesk=$("#filterCatDesk"), filterCatMob=$("#filterCatMob");
  const searchDesk=$("#searchDesk"), searchMob=$("#searchMob");

  const modal=$("#modal"), mTitle=$("#modalTitle");
  const mEn=$("#mEn"), mDe=$("#mDe"), mCat=$("#mCat"), mDate=$("#mDate"), mGroup=$("#mGroup"), mHint=$("#mHint");
  const mDelete=$("#mDelete"), mSave=$("#mSave"), mCancel=$("#mCancel");

  const mobList=$("#mobList"), mobFilters=$("#mobFilters");
  const fabAdd=$("#fabAdd"), bbBack=$("#bbBack"), bbAdjust=$("#bbAdjust"), bbSync=$("#bbSync");
  const btnMobBack=$("#btnMobBack"), btnMobSearch=$("#btnMobSearch"), btnMobFilter=$("#btnMobFilter");

  let list=[], sortCol=0, sortDir=1, editIndex=null, mobileAdjust=false;

  const normalize=v=>[v[0]||"",v[1]||"",v[2]||"Gelb",v[3]||"",v[4]||"",v[5]||new Date().toISOString()];
  const loadLocal=()=>JSON.parse(localStorage.getItem("vokabeln")||"[]").map(normalize);
  const saveLocal=d=>localStorage.setItem("vokabeln",JSON.stringify(d));
  const fmtDate=(iso)=>{ try{ return new Date(iso).toISOString().slice(0,10);}catch{return ""; } };
  const idxOf=v=>list.findIndex(x=>x[0]===v[0]&&x[1]===v[1]&&x[2]===v[2]&&x[5]===v[5]);

  function fillCats(select, withAll){
    select.innerHTML=withAll?'<option value="Alle">Alle (bunt gemischt)</option>':"";
    Object.keys(CATEGORY_NAMES).forEach(k=>{
      const o=document.createElement("option");
      o.value=k; o.textContent=CATEGORY_NAMES[k];
      // farbig im Dropdown (Desktop / Mobile Filter nur Text, im Editor egal)
      if(select===mCat){ o.style.background=COLOR_MAP[k]; o.style.color=TEXT_ON[k]; }
      select.appendChild(o);
    });
  }

  async function loadData(){
    try{
      const r=await fetch(RAW_URL,{cache:"no-store"});
      const d=await r.json();
      list=d.map(normalize);
      saveLocal(list);
    }catch{
      list=loadLocal();
    }
    fillCats(filterCatDesk,true);
    fillCats(filterCatMob,true);
    fillCats(mCat,false);
    renderAll();
  }

  function currentFilter(){
    const cat=(isMobile()?filterCatMob.value:filterCatDesk.value)||"Alle";
    const q=(isMobile()?searchMob.value:searchDesk.value).trim().toLowerCase();
    return {cat,q};
  }
  function filtered(){
    const {cat,q}=currentFilter();
    let res=list.filter(v=>{
      const mc=(cat==="Alle"||v[2]===cat);
      const mq=!q || v[0].toLowerCase().includes(q) || v[1].toLowerCase().includes(q);
      return mc && mq;
    });
    res=res.slice().sort((a,b)=>a[sortCol].localeCompare(b[sortCol])*(sortDir));
    return res;
  }

  function renderDesktop(){
    const data=filtered();
    tblBody.innerHTML=data.map(v=>{
      const i=idxOf(v);
      return `<tr>
        <td><input type="checkbox" data-idx="${i}"></td>
        <td>${escapeHtml(v[0])}</td>
        <td>${escapeHtml(v[1])}</td>
        <td><span class="category-chip" style="background:${COLOR_MAP[v[2]]};color:${TEXT_ON[v[2]]}">${CATEGORY_NAMES[v[2]]}</span></td>
        <td><button class="btn" data-edit="${i}" style="padding:6px 10px">Bearbeiten</button></td>
      </tr>`;
    }).join("");
    $$('button[data-edit]').forEach(b=>b.onclick=()=>openEdit(+b.dataset.edit));
    const total=list.length, shown=data.length;
    deskInfo.textContent=`üìö Gesamt: ${total} ‚Ä¢ üîé Gefiltert: ${shown}`;
  }

  function renderMobile(){
    const data=filtered();
    mobList.innerHTML=data.map(v=>{
      const i=idxOf(v), cat=v[2];
      const bg=COLOR_MAP[cat], fg=TEXT_ON[cat], catName=CATEGORY_NAMES[cat];
      return `<div class="card" data-idx="${i}">
        <div class="card-top">
          <span class="badge" style="background:${bg};color:${fg}">${catName}</span>
          <button class="small-btn mob-edit" data-edit="${i}">Bearbeiten</button>
        </div>
        <div class="card-title">${escapeHtml(v[0])}</div>
        <div class="card-sub" style="margin-top:6px">${escapeHtml(v[1])}</div>
      </div>`;
    }).join("");

    $$('.mob-edit').forEach(b=>b.onclick=(e)=>{ e.stopPropagation(); openEdit(+b.dataset.edit); });

    $$('.card').forEach(card=>{
      card.onclick=()=>{
        if(!mobileAdjust) return;
        const i=+card.dataset.idx;
        if(confirm("Diesen Eintrag l√∂schen?")){
          list=list.filter((_,ix)=>ix!==i);
          saveLocal(list);
          renderAll();
        }
      }
    });

    // Anzeigen der Add-FAB im Anpassen-Modus
    fabAdd.style.display=mobileAdjust?'flex':'none';
  }

  function renderAll(){
    renderDesktop();
    renderMobile();
  }

  function openEdit(i=null){
    editIndex=i;
    if(i==null){
      mTitle.textContent="Neue Vokabel";
      mEn.value=""; mDe.value=""; mCat.value="Gelb";
      mGroup.value=""; mHint.value="";
      mDate.value=fmtDate(new Date().toISOString());
      mDelete.style.display="none";
    }else{
      const v=list[i];
      mTitle.textContent="Vokabel bearbeiten";
      mEn.value=v[0]; mDe.value=v[1]; mCat.value=v[2];
      mGroup.value=v[3]||""; mHint.value=v[4]||"";
      mDate.value=fmtDate(v[5]);
      mDelete.style.display="inline-block";
    }
    modal.style.display="flex";
  }
  function closeModal(){ modal.style.display="none"; }

  mCancel.onclick=closeModal;
  mSave.onclick=()=>{
    const en=mEn.value.trim(), de=mDe.value.trim();
    const cat=mCat.value, grp=mGroup.value.trim(), hint=mHint.value.trim();
    if(!en||!de){ alert("Bitte Englisch & Deutsch ausf√ºllen."); return; }
    if(editIndex==null){
      list.push([en,de,cat,grp,hint,new Date().toISOString()]);
    }else{
      const old=list[editIndex];
      list[editIndex]=[en,de,cat,grp,hint,old[5]||new Date().toISOString()];
    }
    saveLocal(list);
    closeModal(); renderAll();
  };
  mDelete.onclick=()=>{
    if(editIndex==null) return;
    if(!confirm("Diesen Eintrag l√∂schen?")) return;
    list.splice(editIndex,1);
    saveLocal(list);
    closeModal(); renderAll();
  };
  modal.addEventListener('click',e=>{ if(e.target===modal) closeModal(); });

  function resetFilters(){
    if(isMobile()){ filterCatMob.value="Alle"; searchMob.value=""; }
    else { filterCatDesk.value="Alle"; searchDesk.value=""; }
    renderAll();
  }

  $("#resetDesk").onclick=resetFilters;
  $("#resetMob").onclick=resetFilters;
  [filterCatDesk,filterCatMob,searchDesk,searchMob].forEach(el=>{
    if(!el) return;
    el.addEventListener('input',renderAll);
    el.addEventListener('change',renderAll);
  });

  $("#addDesk").onclick=()=>openEdit(null);
  fabAdd.onclick=()=>openEdit(null);

  $("#delDesk").onclick=()=>{
    const ids=$$('input[type="checkbox"][data-idx]:checked').map(x=>+x.dataset.idx);
    if(!ids.length) return alert("Bitte mindestens eine Zeile markieren.");
    if(!confirm(`${ids.length} Eintr√§ge l√∂schen?`)) return;
    list=list.filter((_,i)=>!ids.includes(i));
    saveLocal(list); renderAll();
  };

  $("#tokenBtn").onclick=()=>{ localStorage.removeItem('gh_token'); setTimeout(()=>getToken(),50); };

  async function githubSync(){
    const token=getToken(); if(!token) return;
    try{
      const api=`https://api.github.com/repos/${GH_OWNER}/${GH_REPO}/contents/${GH_PATH}`;
      const get=await fetch(api,{headers:{Authorization:`token ${token}`}});
      const meta=await get.json();
      const sha=meta && meta.sha ? meta.sha : undefined;
      const content=btoa(unescape(encodeURIComponent(JSON.stringify(list,null,2))));
      const res=await fetch(api,{
        method:"PUT",
        headers:{Authorization:`token ${token}`,"Content-Type":"application/json"},
        body:JSON.stringify({message:"Update via Vokabel-UI",content,sha})
      });
      if(!res.ok) throw new Error(await res.text());
      alert("‚úÖ Erfolgreich in Datenbank eingetragen.");
    }catch(e){
      console.error(e);
      alert("‚ùå Sync fehlgeschlagen.");
    }
  }
  $("#syncDesk").onclick=githubSync;
  $("#bbSync").onclick=githubSync;

  function getToken(){
    let t=localStorage.getItem('gh_token')||"";
    if(!t){
      t=prompt("GitHub Token (repo-Scope):","");
      if(t){ localStorage.setItem('gh_token',t); alert("Token gespeichert."); }
    }
    return t;
  }

  // Desktop Sortierung (Spalten 0 / 1)
  $$('th.sortable').forEach(th=>{
    th.onclick=()=>{
      const c=+th.dataset.col;
      if(sortCol===c) sortDir*=-1; else { sortCol=c; sortDir=1; }
      renderAll();
    };
  });

  // Mobile Header Buttons
  btnMobBack.onclick=()=>location.href="index.html";
  bbBack.onclick=()=>location.href="index.html";
  btnMobSearch.onclick=()=>{ mobFilters.style.display = mobFilters.style.display==='grid' ? 'none' : 'grid'; };
  btnMobFilter.onclick=()=>{ mobFilters.style.display = mobFilters.style.display==='grid' ? 'none' : 'grid'; };

  // Anpassen-Modus toggeln
  bbAdjust.onclick=()=>{
    mobileAdjust=!mobileAdjust;
    bbAdjust.textContent = mobileAdjust ? "Fertig" : "Anpassen";
    renderMobile(); // zeigt/hide FAB + setzt Tap-to-delete
  };

  // Hilfsfunktionen
  function escapeHtml(s){return (s||"").replace(/[&<>"']/g,m=>({ "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;" }[m]));}

  // Init
  loadData();
})();
</script>
</body>
</html>
