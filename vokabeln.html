<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>üìò Vokabel√ºbersicht ‚Äì Beeferino</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --ink:#0f172a;--muted:#6b7280;--bg:#f7f9fb;--card:#ffffff;
  --blue:#2563eb;--ok:#16a34a;--bad:#ef4444;
  --border:#e5ebf3;--shadow:0 8px 26px rgba(0,0,0,.1)
}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,system-ui,sans-serif;background:linear-gradient(145deg,#eef4ff,#dbeafe);color:var(--ink)}
a{color:#1e3a8a;text-decoration:none}

/* --- Container --- */
.app{max-width:1100px;margin:20px auto;padding:16px}
h1{text-align:center;font-weight:800;color:#1e3a8a}
.hr{width:160px;height:4px;background:#2563eb;border-radius:4px;margin:10px auto 20px}

/* --- Desktop Toolbar & Tabelle --- */
.toolbar{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin:10px 0}
.toolbar select,.toolbar input{padding:8px 12px;border:1px solid #cfd6e4;border-radius:10px}
.toolbar .btn{background:var(--blue);color:#fff;border:none;border-radius:10px;padding:8px 14px;font-weight:700;cursor:pointer}
.toolbar .warn{background:var(--bad)}
.table-wrap{background:#fff;border-radius:16px;box-shadow:var(--shadow);overflow:hidden}
table{width:100%;border-collapse:collapse}
th,td{padding:10px;border-bottom:1px solid var(--border);text-align:left}
tr:hover{background:#f8fbff}
.category-chip{padding:4px 10px;border-radius:999px;color:#fff;font-weight:700;font-size:.9rem}

/* --- Mobile --- */
.mobile-header{display:none;position:sticky;top:0;background:#eef4ff;padding:10px;border-bottom:1px solid #dbe3ff;z-index:10}
.mob-title{display:flex;align-items:center;justify-content:space-between}
.mob-actions{display:flex;gap:10px}
.iconbtn{
  width:40px;height:40px;border-radius:10px;border:1px solid #cfd6e4;
  background:#fff;display:flex;align-items:center;justify-content:center;cursor:pointer
}
.mob-filters{display:none;gap:8px;padding:10px;background:#f9fbff;border-bottom:1px solid #e5ebf3}
.mob-filters select,.mob-filters input{flex:1;padding:10px;border:1px solid #cfd6e4;border-radius:10px}
.mob-list{display:none;padding:10px}

/* --- Karten --- */
.card{
  background:#fff;border:1px solid #e5ebf3;border-radius:14px;padding:14px;margin-bottom:12px;
  box-shadow:0 4px 10px rgba(0,0,0,.06);transition:box-shadow .2s,border-color .2s;
}
.card.selected{border-color:#60a5fa;box-shadow:0 0 0 3px rgba(37,99,235,.15)}
.card-cat{
  display:inline-block;padding:4px 10px;border-radius:999px;color:#fff;font-weight:700;margin-bottom:8px;
}
.card-title{font-weight:800;font-size:1.05rem;margin-bottom:6px}
.card-sub{color:var(--muted);font-size:.95rem;margin-bottom:8px}
.card-row{text-align:right}
.card-row button{padding:6px 10px;border:none;border-radius:10px;font-weight:700;background:var(--blue);color:#fff;cursor:pointer;font-size:.9rem}

/* --- Action Bar --- */
.fab-row{display:none;position:sticky;bottom:0;background:rgba(255,255,255,.95);padding:10px;border-top:1px solid #e5ebf3}
.fabs{display:flex;gap:8px}
.fab{flex:1;padding:12px;border:none;border-radius:10px;font-weight:800;cursor:pointer;color:#fff}
.fab.gray{background:#6b7280}.fab.warn{background:var(--bad)}.fab.blue{background:var(--blue)}

/* --- Modal --- */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.4);display:none;align-items:center;justify-content:center;z-index:50}
.panel{background:#fff;border-radius:14px;padding:18px;width:92%;max-width:520px}
.form-grid{display:grid;gap:10px}
.form-grid input,.form-grid select,.form-grid textarea{width:100%;padding:10px;border:1px solid #cfd6e4;border-radius:10px}
.modal-actions{display:flex;gap:16px;justify-content:flex-end;margin-top:18px}
.btn{border:none;border-radius:10px;padding:10px 14px;font-weight:800;cursor:pointer}
.btn.primary{background:var(--blue);color:#fff}.btn.ghost{background:#eef4ff;color:#111}

/* --- Banner --- */
.banner{display:none;background:#2563eb;color:#fff;padding:8px 14px;text-align:center;font-weight:700;font-size:.9rem}

/* --- Responsive --- */
@media (max-width:900px){
  .toolbar,.table-wrap{display:none}
  .mobile-header,.mob-filters,.mob-list,.fab-row{display:block}
}
</style>
</head>
<body>
<div class="app">
  <h1>üìò Vokabel√ºbersicht</h1>
  <div class="hr"></div>

  <!-- Desktop Toolbar -->
  <div class="toolbar">
    <select id="filterCatDesk"></select>
    <input id="searchDesk" type="text" placeholder="Suchen‚Ä¶">
    <button id="resetDesk" class="btn">Reset</button>
    <button id="addDesk" class="btn">‚ûï Neue</button>
    <button id="delDesk" class="btn warn">üóëÔ∏è L√∂schen</button>
    <button id="syncDesk" class="btn">üì§ In Datenbank eintragen</button>
    <button id="tokenBtn" class="btn">‚öôÔ∏è Token</button>
    <button id="dateSort" class="btn" title="Nach Erstelldatum sortieren">üóìÔ∏è</button>

  </div>

  <!-- Desktop Counter -->
  <div id="countDesk" style="text-align:center;margin:8px 0;font-weight:600;color:#1e3a8a"></div>

  <!-- Desktop Tabelle -->
  <div class="table-wrap">
    <table id="tbl">
      <thead>
        <tr>
          <th>‚ü≤</th><th data-sort="0">Englisch</th><th data-sort="1">Deutsch</th><th>Kategorie</th><th style="display:none">Gruppe</th><th style="display:none">Hinweis</th><th>Aktion</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Mobile Header -->
  <div class="mobile-header">
    <div class="mob-title">
      <h2 style="margin:0">Vokabeln</h2>
      <div class="mob-actions">
        <button class="iconbtn" id="btnBack" title="Zur√ºck zum Trainer">‚¨ÖÔ∏è</button>
        <button class="iconbtn" id="btnAdjust" title="Anpassen">‚öôÔ∏è</button>
        <button class="iconbtn" id="btnSync" title="Synchronisieren">üîÑ</button>
      </div>
    </div>
  </div>

  <div class="banner" id="adjustBanner">
    üîß Anpassen aktiv ‚Äì tippe Vokabeln an zum Ausw√§hlen oder Hinzuf√ºgen
  </div>

  <div class="mob-filters" id="mobFilters">
    <select id="filterCatMob"><option value="Alle">Alle (bunt gemischt)</option></select>
    <input id="searchMob" type="text" placeholder="Suchen‚Ä¶">
    <button id="resetMob" class="btn">Reset</button>
  </div>

  <!-- Mobile Counter -->
  <div id="countMob" style="text-align:center;margin:8px 0;font-weight:600;color:#1e3a8a"></div>

  <div class="mob-list" id="mobList"></div>

  <div class="fab-row">
    <div class="fabs">
      <button class="fab gray" id="fabBack">Zur√ºck</button>
      <button class="fab blue" id="fabAdjust">Anpassen</button>
      <button class="fab gray" id="fabSync">Synchronisieren</button>
    </div>
  </div>

  <div class="footer" style="text-align:center;margin-top:20px">
    <a href="index.html" style="font-weight:700">‚¨ÖÔ∏è Zur√ºck zum Trainer</a>
    <div style="margin-top:6px;color:#6b7280">¬© 2025 Beeferino ‚Ä¢ Datenquelle: GitHub (Online)</div>
  </div>
</div>

<!-- Modal -->
<div class="modal" id="modal">
  <div class="panel">
    <h3 id="modalTitle" style="margin-top:0">Vokabel</h3>
    <div class="form-grid">
      <label>Englisch<input id="mEn" type="text"></label>
      <label>Deutsch<input id="mDe" type="text"></label>
      <label>Kategorie<select id="mCat"></select></label>
      <label>Erstellt<input id="mDate" type="date" readonly style="background:#f3f4f6"></label>
      <label>Gruppe / Variante<input id="mGroup" type="text"></label>
      <label>Hinweis<textarea id="mHint" rows="2"></textarea></label>
    </div>
    <div class="modal-actions">
      <button class="btn ghost" id="mCancel">Abbrechen</button>
      <button class="btn primary" id="mSave">Speichern</button>
    </div>
  </div>
</div>

<script>
(function(){
  const CATEGORY_NAMES={Gelb:"Grundwerkzeuge Metallverarbeitung",Pink:"Werkzeugkasten Mechaniker",Blau:"Blech- / Kunststoffarbeiten",Gruen:"Drehen / Fr√§sen",HellesPink:"Hydraulik / Pneumatik",Orange:"Elektrotechnik",Dunkelgruen:"Flugger√§temechanik allgemein",Rot:"Verwechslungsgefahr"};
  const COLOR_MAP={Gelb:"#F4D03F",Pink:"#E91E63",Blau:"#1976D2",Gruen:"#1E8449",HellesPink:"#F54927",Orange:"#E67E22",Dunkelgruen:"#117A65",Rot:"#C0392B"};
  const TEXT_ON={Gelb:"#000",Pink:"#fff",Blau:"#fff",Gruen:"#fff",HellesPink:"#fff",Orange:"#fff",Dunkelgruen:"#fff",Rot:"#fff"};

  const RAW_URL="https://beeferino.github.io/vokabeltrainer/vokabeln.json";
  const GH_OWNER="beeferino", GH_REPO="vokabeltrainer", GH_PATH="vokabeln.json";

  const $=s=>document.querySelector(s),$$=s=>Array.from(document.querySelectorAll(s)),isMobile=()=>matchMedia("(max-width:900px)").matches;

  const tbl=$('#tbl tbody'),mobList=$('#mobList'),banner=$('#adjustBanner'),modal=$('#modal'),
  mEn=$('#mEn'),mDe=$('#mDe'),mCat=$('#mCat'),mDate=$('#mDate'),mGroup=$('#mGroup'),mHint=$('#mHint'),
  filterCatDesk=$('#filterCatDesk'),filterCatMob=$('#filterCatMob'),searchDesk=$('#searchDesk'),searchMob=$('#searchMob');

  let list=[],editIndex=null,adjustMode=false,selected=new Set();

  const normalize=v=>[v[0]||"",v[1]||"",v[2]||"Gelb",v[3]||"",v[4]||"",v[5]||new Date().toISOString()];
  const loadLocal=()=>JSON.parse(localStorage.getItem("vokabeln")||"[]").map(normalize);
  const saveLocal=d=>localStorage.setItem("vokabeln",JSON.stringify(d));
  const idxInList=v=>list.findIndex(x=>x[0]===v[0]&&x[1]===v[1]&&x[2]===v[2]&&x[5]===v[5]);

  function fillCategorySelect(el,withAll=false){
    el.innerHTML=withAll?'<option value="Alle">Alle (bunt gemischt)</option>':"";
    Object.keys(CATEGORY_NAMES).forEach(k=>{
      const o=document.createElement("option");
      o.value=k;o.textContent=CATEGORY_NAMES[k];
      o.style.background=COLOR_MAP[k];o.style.color=TEXT_ON[k];
      el.appendChild(o);
    });
  }

  async function loadData(){
    try{
      const r=await fetch(RAW_URL,{cache:"no-store"});
      list=(await r.json()).map(normalize);
      saveLocal(list);
    }catch{list=loadLocal();}
    fillCategorySelect(filterCatDesk,true);
    fillCategorySelect(filterCatMob,true);
    fillCategorySelect(mCat,false);
    renderAll();
  }

  function currentFilter(){
    const cat=(isMobile()?filterCatMob.value:filterCatDesk.value)||"Alle";
    const q=(isMobile()?searchMob.value:searchDesk.value).trim().toLowerCase();
    return {cat,q};
  }
  function filtered(){
    const {cat,q}=currentFilter();
    return list.filter(v=>{
      const matchCat=(cat==="Alle"||v[2]===cat);
      const matchQ=!q||v[0].toLowerCase().includes(q)||v[1].toLowerCase().includes(q);
      return matchCat&&matchQ;
    });
  }

  function updateCount(){
    const data=filtered();
    const txt=`üìò ${data.length} Vokabel${data.length!==1?"n":""} gefunden`;
    if(isMobile()){
      $('#countMob').textContent=txt;
      $('#countDesk').textContent="";
    }else{
      $('#countDesk').textContent=txt;
      $('#countMob').textContent="";
    }
  }

  function renderDesktop(){
    const data=filtered();
    tbl.innerHTML=data.map(v=>{
      const i=idxInList(v);
      return `<tr>
        <td><input type="checkbox" data-idx="${i}"></td>
        <td>${v[0]}</td>
        <td>${v[1]}</td>
        <td><span class="category-chip" style="background:${COLOR_MAP[v[2]]};color:${TEXT_ON[v[2]]}">${CATEGORY_NAMES[v[2]]}</span></td>
        <td style="display:none">${v[3]}</td>
        <td style="display:none">${v[4]}</td>
        <td><button class="btn" data-edit="${i}">‚úèÔ∏è Bearbeiten</button></td>
      </tr>`;
    }).join("");
    $$('button[data-edit]').forEach(b=>b.onclick=()=>openEdit(+b.dataset.edit));
  }

  function renderMobile(){
    const data=filtered();
    mobList.innerHTML=data.map(v=>{
      const i=idxInList(v),sel=selected.has(i)?" selected":"";
      return `<div class="card${sel}" data-idx="${i}">
        <div class="card-cat" style="background:${COLOR_MAP[v[2]]};color:${TEXT_ON[v[2]]}">${CATEGORY_NAMES[v[2]]}</div>
        <div class="card-title">${v[0]}</div>
        <div class="card-sub">DE: ${v[1]}</div>
        <div class="card-row"><button class="mobEdit" data-edit="${i}">Bearbeiten</button></div>
      </div>`;
    }).join("");
    $$('.mobEdit').forEach(b=>b.onclick=()=>openEdit(+b.dataset.edit));
    $$('.card').forEach(c=>c.onclick=e=>{
      if(!adjustMode||e.target.classList.contains('mobEdit'))return;
      const i=+c.dataset.idx;
      if(selected.has(i))selected.delete(i);else selected.add(i);
      c.classList.toggle('selected');
    });
  }

  function renderAll(){renderDesktop();renderMobile();updateCount();}

  function openEdit(i=null){
    editIndex=i;
    if(i==null){
      mEn.value=mDe.value=mGroup.value=mHint.value="";
      mCat.value="Gelb";mDate.value=new Date().toISOString().slice(0,10);
    }else{
      const v=list[i];
      mEn.value=v[0];mDe.value=v[1];mCat.value=v[2];
      mGroup.value=v[3];mHint.value=v[4];
      mDate.value=new Date(v[5]).toISOString().slice(0,10);
    }
    mCat.style.background=COLOR_MAP[mCat.value];
    mCat.style.color=TEXT_ON[mCat.value];
    modal.style.display="flex";
  }
  function closeModal(){modal.style.display="none";}
  $('#mCancel').onclick=closeModal;
  $('#mSave').onclick=()=>{
    const en=mEn.value.trim(),de=mDe.value.trim();
    const cat=mCat.value,grp=mGroup.value.trim(),hint=mHint.value.trim();
    if(!en||!de){alert("Bitte Englisch & Deutsch ausf√ºllen.");return;}
    if(editIndex==null){list.push([en,de,cat,grp,hint,new Date().toISOString()]);}
    else{const old=list[editIndex];list[editIndex]=[en,de,cat,grp,hint,old[5]];}
    saveLocal(list);closeModal();renderAll();
  };
  mCat.onchange=()=>{mCat.style.background=COLOR_MAP[mCat.value];mCat.style.color=TEXT_ON[mCat.value];}
  modal.addEventListener('click',e=>{if(e.target===modal)closeModal();});

  function toggleAdjust(on){
    adjustMode=on;selected.clear();banner.style.display=on?'block':'none';
    const bar=$('.fabs');
    if(on){bar.innerHTML=`<button class="fab gray" id="fabEnd">Beenden</button><button class="fab warn" id="fabDelete">L√∂schen</button><button class="fab blue" id="fabNew">Neu</button>`;
      $('#fabEnd').onclick=()=>toggleAdjust(false);
      $('#fabDelete').onclick=()=>{if(!selected.size){alert("Keine Auswahl");return;}
        if(!confirm(`${selected.size} l√∂schen?`))return;
        list=list.filter((_,i)=>!selected.has(i));saveLocal(list);selected.clear();renderAll();
      };
      $('#fabNew').onclick=()=>openEdit(null);
    } else {
      bar.innerHTML=`<button class="fab gray" id="fabBack">Zur√ºck</button><button class="fab blue" id="fabAdjust">Anpassen</button><button class="fab gray" id="fabSync">Synchronisieren</button>`;
      $('#fabBack').onclick=()=>location.href="index.html";
      $('#fabAdjust').onclick=()=>toggleAdjust(true);
      $('#fabSync').onclick=githubSync;
    }
    renderMobile();
  }

  function getToken(){
    let t=localStorage.getItem('gh_token')||"";
    if(!t){t=prompt("GitHub Token (repo-Scope):","");if(t){localStorage.setItem('gh_token',t);alert("Token gespeichert.");}}
    return t;
  }

  async function githubSync(){
    const token=getToken();if(!token)return;
    try{
      const api=`https://api.github.com/repos/${GH_OWNER}/${GH_REPO}/contents/${GH_PATH}`;
      const get=await fetch(api,{headers:{Authorization:`token ${token}`}});
      const meta=await get.json();const sha=meta.sha;
      const content=btoa(unescape(encodeURIComponent(JSON.stringify(list,null,2))));
      const res=await fetch(api,{method:'PUT',headers:{Authorization:`token ${token}`,'Content-Type':'application/json'},body:JSON.stringify({message:'Update via Vokabel-UI',content,sha})});
      if(!res.ok)throw new Error(await res.text());
      alert("‚úÖ Erfolgreich in Datenbank eingetragen.");
    }catch(e){alert("‚ùå Sync fehlgeschlagen.");}
  }

  $('#addDesk').onclick=()=>openEdit(null);
  $('#delDesk').onclick=()=>{
    const ids=$$('input[type="checkbox"][data-idx]:checked').map(x=>+x.dataset.idx);
    if(!ids.length){alert("Bitte Zeilen markieren.");return;}
    if(!confirm(`${ids.length} Eintr√§ge l√∂schen?`))return;
    list=list.filter((_,i)=>!ids.includes(i));saveLocal(list);renderAll();
  };
  $('#syncDesk').onclick=githubSync;
  $('#tokenBtn').onclick=()=>{localStorage.removeItem('gh_token');getToken();};

  $('#resetDesk').onclick=()=>{filterCatDesk.value="Alle";searchDesk.value="";renderAll();}
  $('#resetMob').onclick=()=>{filterCatMob.value="Alle";searchMob.value="";renderAll();}
  [filterCatDesk,filterCatMob,searchDesk,searchMob].forEach(el=>{el.addEventListener('input',renderAll);el.addEventListener('change',renderAll);});

  $('#btnBack').onclick=()=>location.href="index.html";
  $('#btnSync').onclick=githubSync;
  $('#btnAdjust').onclick=()=>toggleAdjust(true);
  $('#fabBack').onclick=()=>location.href="index.html";
  $('#fabAdjust').onclick=()=>toggleAdjust(true);
  $('#fabSync').onclick=githubSync;
  // --- Desktop Sortierung (Spalte 1 & 2) ---
  let sortState = {col: null, dir: 1};

  $$('#tbl thead th[data-sort]').forEach(th => {
    th.style.cursor = "pointer";
    th.title = "Sortieren";
    th.onclick = () => {
      const col = parseInt(th.dataset.sort);
      if (sortState.col === col) sortState.dir *= -1; 
      else { sortState.col = col; sortState.dir = 1; }

      list.sort((a, b) => {
        const A = (a[col] || "").toLowerCase();
        const B = (b[col] || "").toLowerCase();
        return A.localeCompare(B) * sortState.dir;
      });
      saveLocal(list);
      renderAll();

      // visueller Hinweis
      $$('#tbl thead th').forEach(x => x.style.textDecoration = "none");
      th.style.textDecoration = sortState.dir === 1 ? "underline" : "overline";
    };
  });

  loadData();
    // --- Farbe im Desktop-Kategorie-Filter anzeigen ---
  const catSelect = document.getElementById('filterCatDesk');
  catSelect.addEventListener('change', function () {
    const val = this.value;
    if (val === "Alle" || !COLOR_MAP[val]) {
      this.style.background = "#fff";
      this.style.color = "#111";
    } else {
      this.style.background = COLOR_MAP[val];
      this.style.color = TEXT_ON[val];
    }
  });

  // Beim Laden gleich aktualisieren
  catSelect.dispatchEvent(new Event('change'));
  // --- Sortieren nach Erstelldatum (Desktop only) ---
  let dateSortDir = 1; // 1 = aufsteigend, -1 = absteigend

  const btnDateSort = document.getElementById('dateSort');
  btnDateSort.addEventListener('click', () => {
    list.sort((a, b) => {
      const A = new Date(a[5]);
      const B = new Date(b[5]);
      return (A - B) * dateSortDir;
    });
    dateSortDir *= -1; // Richtung wechseln
    saveLocal(list);
    renderAll();

    // kleiner visueller Effekt (Drehung)
    btnDateSort.style.transform = `rotate(${dateSortDir === 1 ? 0 : 180}deg)`;
    btnDateSort.style.transition = "transform 0.3s";
  });

})();
</script>
</body>
</html>
