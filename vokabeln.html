<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>üìò Vokabel√ºbersicht ‚Äì Beeferino</title>
<style>
:root{
  --blue:#2563eb;--blue2:#1d4ed8;--ink:#0f172a;--glass:rgba(255,255,255,.92);
  --ok:#22c55e;--bad:#ef4444;--muted:#9ca3af;--shadow:0 10px 32px rgba(0,0,0,.10)
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{margin:0;font-family:Inter,system-ui,sans-serif;background:linear-gradient(145deg,#eef4ff,#dbeafe);color:var(--ink)}
.app{max-width:1100px;margin:28px auto;padding:20px;background:var(--glass);border-radius:22px;box-shadow:var(--shadow);backdrop-filter:blur(8px)}
h1{text-align:center;margin:0;font-size:1.9rem;font-weight:800;color:#1e3a8a}
.hr{width:160px;height:4px;background:var(--blue);border-radius:4px;margin:10px auto 18px}

/* A‚ÄìZ (Desktop sichtbar, im Mobile nochmal im Slide-Header) */
.lexica{display:flex;flex-wrap:wrap;gap:6px;justify-content:center;margin:10px 0}
.lexica button{background:#ecf3ff;color:#1f3b76;border:1px solid #d6e4ff;padding:6px 10px;border-radius:999px;font-weight:700;cursor:pointer}
.lexica button.active{background:#1e6ed8;color:#fff}

/* Abschnitt/Tabelle */
.section{background:#fff;border-radius:18px;box-shadow:0 6px 18px rgba(0,0,0,.06);padding:16px;margin:16px 0}
table{width:100%;border-collapse:collapse}
th,td{padding:10px;border-bottom:1px solid #e8eef9;text-align:left;vertical-align:top}
th{background:#eef4ff;cursor:pointer;user-select:none}
th.sort-asc::after{content:" ‚Üë";color:#556} th.sort-desc::after{content:" ‚Üì";color:#556}
tr:hover{background:#f6faff}
.category-chip{display:inline-block;padding:6px 10px;border-radius:999px;font-weight:700}

/* Mobile Optimierungen */
@media (max-width:768px){
  th:last-child,td:last-child{display:none}
  td:first-child{cursor:pointer;color:#2563eb;font-weight:600}
  td:first-child:hover{text-decoration:underline}
  .mobile-toggle{position:fixed;bottom:20px;right:20px;background:var(--blue);color:#fff;border:none;width:52px;height:52px;border-radius:50%;font-size:1.5rem;box-shadow:0 4px 16px rgba(0,0,0,.2);z-index:1200}
}

/* Slide-In Header (nur Mobile) */
.mobile-header{display:none;position:fixed;top:0;left:0;right:0;z-index:1000;background:#fff;box-shadow:0 4px 12px rgba(0,0,0,.15);transform:translateY(-100%);transition:.3s ease;border-bottom-left-radius:14px;border-bottom-right-radius:14px;padding:12px}
.mobile-header.show{transform:translateY(0)}
.mobile-header h3{margin:0 0 8px;text-align:center;color:#1e3a8a}
.mobile-header input,.mobile-header select{width:100%;padding:8px 10px;border:1px solid #d5d9f2;border-radius:10px;margin-bottom:8px}
.mobile-header .lexica{margin-top:6px;justify-content:center;flex-wrap:wrap}
.mobile-header .lexica button{background:#eef4ff;color:#1e40af;border:none;padding:6px 9px;margin:2px;border-radius:999px;font-weight:600}

/* Modal */
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.45);align-items:center;justify-content:center;z-index:9999;padding:10px}
.modal-card{width:92%;max-width:520px;background:#fff;border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,.25);padding:20px;animation:fadeIn .25s ease}
@keyframes fadeIn{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}
.modal h3{text-align:center;margin-top:0;color:#1e3a8a}
.modal .grid{display:grid;gap:12px}
.modal .row{display:flex;gap:10px;justify-content:flex-end;margin-top:14px;flex-wrap:wrap}
.modal input,.modal select{padding:12px;border:1px solid #d6deee;border-radius:10px;font-size:1rem;width:100%;touch-action:manipulation}
.modal .info{font-size:.85rem;color:#555;text-align:center;margin-top:10px}

/* Buttons / Footer */
button{cursor:pointer;border:none;font-weight:700;border-radius:12px}
button.primary{background:var(--blue);color:#fff;padding:10px 16px}
button.secondary{background:#eaf0ff;color:#1f2937;padding:10px 16px}
button.danger{background:var(--bad);color:#fff;padding:10px 16px}
button.ghost{background:#f3f6ff;border:1px dashed #c7d2fe;color:#1f2937;padding:10px 16px}
.footer-actions{display:flex;justify-content:space-between;margin-top:18px;gap:12px;flex-wrap:wrap}
footer{text-align:center;margin-top:10px;color:#6b7280;font-size:.92rem}

/* Toast */
.toast{position:fixed;bottom:18px;left:50%;transform:translateX(-50%);background:#111827;color:#fff;padding:10px 16px;border-radius:12px;display:none;z-index:10000}
</style>
</head>
<body>
<div class="app">
  <h1>üìò Vokabel√ºbersicht</h1>
  <div class="hr"></div>

  <!-- Desktop A‚ÄìZ -->
  <div id="lexica" class="lexica"></div>

  <div class="section">
    <table id="tbl">
      <thead>
        <tr>
          <th data-col="0">Englisch</th>
          <th data-col="1">Deutsch</th>
          <th>Kategorie</th>
          <th>Aktion</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="footer-actions">
    <button id="btnAdd" class="ghost">‚ûï Neue Vokabel</button>
    <button id="btnSaveGithub" class="primary">üíæ In Datenbank eintragen</button>
    <a href="index.html" class="secondary">‚¨ÖÔ∏è Zur√ºck zum Trainer</a>
  </div>

  <footer>¬© 2025 Beeferino</footer>
</div>

<!-- Mobile Slide-In Header -->
<div id="mobileHeader" class="mobile-header">
  <h3>üîé Filter & A‚ÄìZ</h3>
  <select id="mobCat"><option value="Alle">Alle Kategorien</option></select>
  <input id="mobSearch" type="text" placeholder="Suchen (EN / DE)">
  <div id="mobLex" class="lexica"></div>
  <div style="text-align:center;margin-top:6px">
    <button id="mobReset" class="secondary" style="width:100%">üîÑ Zur√ºcksetzen</button>
  </div>
</div>
<button id="toggleHeader" class="mobile-toggle" aria-label="Filter √∂ffnen">üî†</button>

<!-- Modal Add/Edit -->
<div id="modal" class="modal" role="dialog" aria-modal="true">
  <div class="modal-card">
    <h3 id="modalTitle">‚ûï Neue Vokabel</h3>
    <div class="grid">
      <label>Englisch<input id="vEn" type="text" autocomplete="off"></label>
      <label>Deutsch<input id="vDe" type="text" autocomplete="off"></label>
      <label>Kategorie<select id="vCat"></select></label>
      <label>Gruppe / Variante<input id="vGrp" type="text" autocomplete="off"></label>
      <label>Hinweis<input id="vHint" type="text" autocomplete="off"></label>
      <div class="info" id="vDate"></div>
    </div>
    <div class="row">
      <button id="btnDel" class="danger" style="display:none">L√∂schen</button>
      <button id="btnSave" class="primary">Speichern</button>
      <button id="btnClose" class="secondary">Abbrechen</button>
    </div>
  </div>
</div>

<div id="toast" class="toast">Gespeichert</div>

<script>
(function(){
/* ===== Config & Utilities ===== */
const CATS={
  Gelb:["Grundwerkzeuge Metallverarbeitung","#F4D03F","#111"],
  Pink:["Werkzeugkasten Mechaniker","#E91E63","#fff"],
  Blau:["Blech- / Kunststoffarbeiten","#1976D2","#fff"],
  Gruen:["Drehen / Fr√§sen","#1E8449","#fff"],
  HellesPink:["Hydraulik / Pneumatik","#F54927","#fff"],
  Orange:["Elektrotechnik","#E67E22","#111"],
  Dunkelgruen:["Flugger√§temechanik allgemein","#117A65","#fff"],
  Rot:["Verwechslungsgefahr","#C0392B","#fff"]
};
const owner="Beeferino", repo="vokabeltrainer", pathFile="vokabeln.json", branch="main";
const $=s=>document.querySelector(s);
const $$=s=>document.querySelectorAll(s);
const toast=msg=>{const t=$("#toast");t.textContent=msg;t.style.display="block";setTimeout(()=>t.style.display="none",1400);}
function norm(v){return [v[0]||"",v[1]||"",v[2]||"Gelb",v[3]||"",v[4]||"",v[5]||new Date().toISOString()]}

/* ===== State ===== */
let list=[], filtered=[], letter="Alle", mobLetter="Alle", sortCol=null, sortDir=1, editIdx=null;

/* ===== Data Load ===== */
async function loadData(){
  try{
    const r=await fetch(`https://beeferino.github.io/vokabeltrainer/${pathFile}?_=${Date.now()}`,{cache:"no-store"});
    const d=await r.json();
    list=d.map(norm);
    localStorage.setItem("vokabeln",JSON.stringify(list));
  }catch(e){
    list=(JSON.parse(localStorage.getItem("vokabeln")||"[]")).map(norm);
  }
  applyFiltersAndRender();
}

/* ===== Filters ===== */
function applyFiltersAndRender(){
  const search=$("#mobSearch").value?.toLowerCase?.()||"";
  const catSel=$("#mobCat").value||"Alle";
  filtered=list.filter(v=>{
    if(letter!=="Alle" && (v[0]||"").toUpperCase().charAt(0)!==letter) return false;
    if(mobLetter!=="Alle" && (v[0]||"").toUpperCase().charAt(0)!==mobLetter) return false;
    if(catSel!=="Alle" && v[2]!==catSel) return false;
    if(search){
      const hay=(v[0]+" "+v[1]).toLowerCase();
      if(!hay.includes(search)) return false;
    }
    return true;
  });
  if(sortCol!==null){
    filtered.sort((a,b)=> (a[sortCol]||"").localeCompare(b[sortCol]||"") * sortDir);
  }
  renderTable();
}

/* ===== Render Table ===== */
function renderTable(){
  const tb=$("#tbl tbody"); tb.innerHTML="";
  filtered.forEach((v,i)=>{
    const idx=list.indexOf(v);
    const c=CATS[v[2]]||["","#ccc","#111"];
    tb.innerHTML+=`
      <tr>
        <td onclick="if(window.innerWidth<=768){editVokabel(${idx})}">${escapeHTML(v[0])}</td>
        <td>${escapeHTML(v[1])}</td>
        <td><span class="category-chip" style="background:${c[1]};color:${c[2]}">${c[0]}</span></td>
        <td><button class="secondary" onclick="editVokabel(${idx})">‚úèÔ∏è</button></td>
      </tr>`;
  });
}

/* ===== A‚ÄìZ Bars ===== */
function buildLexica(container, isMobile=false){
  container.innerHTML="";
  const btnAll=document.createElement("button");btnAll.textContent="Alle";
  btnAll.className=(isMobile? mobLetter:letter)==="Alle"?"active":"";
  btnAll.onclick=()=>{if(isMobile)mobLetter="Alle";else letter="Alle";applyFiltersAndRender();buildLexica(container,isMobile);}
  container.appendChild(btnAll);
  "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("").forEach(ch=>{
    const b=document.createElement("button");
    b.textContent=ch;
    b.className=((isMobile?mobLetter:letter)===ch)?"active":"";
    b.onclick=()=>{if(isMobile)mobLetter=ch;else letter=ch;applyFiltersAndRender();buildLexica(container,isMobile);}
    container.appendChild(b);
  });
}

/* ===== Modal Add/Edit ===== */
const modal=$("#modal"), vEn=$("#vEn"), vDe=$("#vDe"), vCat=$("#vCat"), vGrp=$("#vGrp"), vHint=$("#vHint"), vDate=$("#vDate");
function fillCatSelect(sel){sel.innerHTML="";for(const k in CATS){const o=document.createElement("option");o.value=k;o.textContent=CATS[k][0];sel.appendChild(o)}}
fillCatSelect(vCat);

window.editVokabel=function(i){
  editIdx=i;
  const v=list[i];
  $("#modalTitle").textContent="‚úèÔ∏è Vokabel bearbeiten";
  vEn.value=v[0]; vDe.value=v[1]; vCat.value=v[2]; vGrp.value=v[3]||""; vHint.value=v[4]||"";
  vDate.textContent=v[5] ? ("Erstellt am: " + new Date(v[5]).toLocaleString("de-DE")) : "";
  $("#btnDel").style.display="inline-block";
  modal.style.display="flex";
}
function openAdd(){
  editIdx=null;
  $("#modalTitle").textContent="‚ûï Neue Vokabel";
  vEn.value=""; vDe.value=""; vCat.value="Gelb"; vGrp.value=""; vHint.value=""; vDate.textContent="";
  $("#btnDel").style.display="none";
  modal.style.display="flex";
}
function saveLocal(){localStorage.setItem("vokabeln",JSON.stringify(list))}
function saveVokabel(){
  const en=vEn.value.trim(), de=vDe.value.trim(); if(!en||!de){toast("EN + DE erforderlich");return;}
  const obj=[en,de,vCat.value,vGrp.value.trim(),vHint.value.trim(), editIdx!==null && list[editIdx][5] ? list[editIdx][5] : new Date().toISOString()];
  if(editIdx!==null) list[editIdx]=obj; else list.push(obj);
  saveLocal(); applyFiltersAndRender(); modal.style.display="none"; toast("üíæ Gespeichert");
}
function delVokabel(){ if(editIdx===null)return; if(!confirm("Wirklich l√∂schen?"))return; list.splice(editIdx,1); saveLocal(); applyFiltersAndRender(); modal.style.display="none"; toast("üóëÔ∏è Gel√∂scht");}

$("#btnAdd").onclick=openAdd;
$("#btnSave").onclick=saveVokabel;
$("#btnDel").onclick=delVokabel;
$("#btnClose").onclick=()=>modal.style.display="none";

/* ===== Sorting (EN/DE) ===== */
$$("th[data-col]").forEach(th=>{
  th.addEventListener("click",()=>{
    const col=parseInt(th.dataset.col,10);
    if(sortCol===col) sortDir*=-1; else {sortCol=col; sortDir=1;}
    $$("th").forEach(h=>h.classList.remove("sort-asc","sort-desc"));
    th.classList.add(sortDir===1?"sort-asc":"sort-desc");
    applyFiltersAndRender();
  });
});

/* ===== Mobile Slide Header ===== */
const mobHeader=$("#mobileHeader"), mobBtn=$("#toggleHeader"), mobCat=$("#mobCat"), mobSearch=$("#mobSearch"), mobLex=$("#mobLex"), mobReset=$("#mobReset");
mobBtn.onclick=()=>mobHeader.classList.toggle("show");
(function fillMobCat(){ mobCat.innerHTML='<option value="Alle">Alle Kategorien</option>'+Object.keys(CATS).map(k=>`<option value="${k}">${CATS[k][0]}</option>`).join("");})();
mobCat.onchange=applyFiltersAndRender;
mobSearch.oninput=applyFiltersAndRender;
mobReset.onclick=()=>{mobCat.value="Alle"; mobSearch.value=""; mobLetter="Alle"; applyFiltersAndRender(); buildLexica(mobLex,true);}

/* ===== Desktop Lexica ===== */
buildLexica($("#lexica"), false);
/* ===== Mobile Lexica ===== */
buildLexica(mobLex, true);

/* ===== GitHub Sync (PUT file) ===== */
function b64(s){return btoa(unescape(encodeURIComponent(s)))}
async function getFileSha(){
  const r=await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${pathFile}?ref=${branch}`);
  if(!r.ok) return null; const j=await r.json(); return j.sha||null;
}
async function ensureToken(){
  let token=localStorage.getItem("gh_token");
  if(!token){
    token=prompt("GitHub Token eingeben (wird lokal gespeichert):","");
    if(!token) return null;
    localStorage.setItem("gh_token",token);
  }
  return token;
}
$("#btnSaveGithub").onclick=async()=>{
  const token=await ensureToken(); if(!token){toast("Kein Token vorhanden");return;}
  try{
    const sha=await getFileSha();
    const body={message:"Update vokabeln.json via UI",content:b64(JSON.stringify(list,null,2)),branch};
    if(sha) body.sha=sha;
    const r=await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${pathFile}`,{
      method:"PUT",
      headers:{Authorization:`Bearer ${token}`,"Content-Type":"application/json"},
      body:JSON.stringify(body)
    });
    if(!r.ok) throw 0;
    toast("‚úÖ In Datenbank eingetragen");
  }catch(e){toast("‚ùå Fehler beim Upload");}
};

/* ===== Helpers ===== */
function escapeHTML(s){return String(s).replace(/[&<>"']/g,m=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[m]))}

/* ===== Init ===== */
loadData();
})();
</script>
</body>
</html>
