<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Vokabelverwaltung – Beeferino</title>
<style>
:root{
  --blue:#2563eb;--blue2:#1d4ed8;--ink:#0f172a;
  --glass:rgba(255,255,255,.88);
  --ok:#22c55e;--bad:#ef4444;--muted:#9ca3af
}
body{
  margin:0;font-family:Inter,system-ui,sans-serif;
  background:linear-gradient(145deg,#eef4ff,#dbeafe);
  color:var(--ink);
}
.app{
  max-width:1000px;margin:32px auto;padding:22px;
  background:var(--glass);border-radius:22px;
  box-shadow:0 10px 32px rgba(0,0,0,.10);
  backdrop-filter:blur(8px)
}
h1{text-align:center;font-size:2rem;font-weight:800;color:#1e3a8a;margin-bottom:10px}
h2{color:#1e3a8a;margin-top:32px}
.section{margin-bottom:22px}
.flex{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
input,select,button{
  font-family:inherit;font-size:1rem;border-radius:10px;
  padding:8px 10px;border:1px solid #d1d5db
}
button{
  cursor:pointer;font-weight:700;transition:all .2s ease;
}
button:hover{transform:translateY(-1px)}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border-bottom:1px solid #e5e7eb;padding:8px 6px;text-align:left}
th{background:#f1f5ff;font-weight:700}
tr:hover{background:#f9fbff}
.pagination{text-align:center;margin-top:10px}
.divider{
  height:3px;width:60%;margin:40px auto 20px;
  background:linear-gradient(90deg,transparent,#93c5fd,#2563eb,#93c5fd,transparent);
  border-radius:2px;animation:shine 5s linear infinite
}
@keyframes shine{0%{background-position:0 0}100%{background-position:400px 0}}
#modal,#modalNew{
  position:fixed;top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,.4);display:none;align-items:center;justify-content:center;
}
#modalContent,#modalNewContent{
  background:#fff;padding:24px;border-radius:20px;max-width:420px;width:90%;
  box-shadow:0 8px 30px rgba(0,0,0,.25);text-align:center
}
#toast{
  position:fixed;bottom:20px;left:50%;transform:translateX(-50%);
  background:#22c55e;color:#fff;padding:10px 20px;border-radius:12px;
  display:none;font-weight:700;box-shadow:0 6px 20px rgba(0,0,0,.2)
}
.footer{
  display:flex;justify-content:space-between;align-items:center;
  margin-top:40px;flex-wrap:wrap;gap:10px
}
.link-trainer{
  border:none;
  padding:10px 18px;
  border-radius:14px;
  font-weight:700;
  color:#fff;
  background:linear-gradient(90deg,#2563eb,#1d4ed8);
  box-shadow:0 6px 18px rgba(37,99,235,.3);
  cursor:pointer;
  transition:background 0.3s ease,transform 0.2s ease;
}
.link-trainer:hover{
  background:linear-gradient(90deg,#1d4ed8,#2563eb);
  transform:translateY(-2px);
}
.src{text-align:center;flex:1 1 100%;margin-top:8px;color:#6b7280;font-size:.9rem}
#datasourceStatus{text-align:center;margin-top:12px;font-size:.9rem;color:#444}
.btn-add{
  display:block;margin:0 auto 20px;
  padding:12px 24px;
  border:none;
  border-radius:14px;
  background:linear-gradient(90deg,#1d4ed8,#2563eb);
  color:#fff;font-weight:700;
  box-shadow:0 6px 18px rgba(37,99,235,.25);
  cursor:pointer;
  transition:transform .2s ease;
}
.btn-add:hover{transform:translateY(-2px)}
</style>
</head>
<body>
<div class="app">
  <h1>📘 Vokabelübersicht</h1>

  <button id="btnNew" class="btn-add">➕ Neue Vokabel</button>

  <div class="section">
    <h2>🔍 Filter &amp; Suche</h2>
    <div class="flex">
      <label>Kategorie:
        <select id="filterCat"><option value="Alle">Alle (bunt gemischt)</option></select>
      </label>
      <input id="searchInput" type="text" placeholder="🔎 Suchen (EN / DE)">
      <button id="resetFilter">🔄 Zurücksetzen</button>
    </div>
  </div>

  <div class="section">
    <h2>📄 Vokabelliste</h2>
    <table id="vokabelTable">
      <thead><tr><th>Englisch</th><th>Deutsch</th><th>Kategorie</th><th style="width:100px;">Aktion</th></tr></thead>
      <tbody></tbody>
    </table>
    <div id="pagination" class="pagination"></div>
    <div id="infoFooter" style="margin-top:6px;font-size:.95rem;color:#555;"></div>
  </div>

  <hr class="divider">

  <details open class="section">
    <summary><strong>🧾 Zuletzt hinzugefügt</strong></summary>
    <div id="lastAdded">–</div>
  </details>

  <div class="footer">
    <button class="link-trainer" id="btnBack">⬅️ Zurück zum Trainer</button>
    <button id="btnCommit" class="link-trainer">📤 In Datenbank eintragen</button>
    <div class="src">© 2025 Beeferino</div>
  </div>

  <div id="datasourceStatus">🔄 JSON + lokale Ergänzungen (gemergt)</div>
</div>

<!-- Details Modal -->
<div id="modal">
  <div id="modalContent">
    <h3>🔍 Vokabel-Details</h3>
    <input id="editEn" type="text" placeholder="Englisch" readonly>
    <input id="editDe" type="text" placeholder="Deutsch" readonly>
    <select id="editCat" disabled></select>
    <input id="editGroup" type="text" placeholder="Gruppe / Variante" readonly>
    <input id="editHint" type="text" placeholder="Hinweis" readonly>
    <div class="flex" style="margin-top:10px;justify-content:center">
      <button id="toggleEdit">🔧 Bearbeiten</button>
      <button id="closeModal">❌ Schließen</button>
    </div>
  </div>
</div>

<!-- New Entry Modal -->
<div id="modalNew">
  <div id="modalNewContent">
    <h3>➕ Neue Vokabel</h3>
    <input id="newEn" type="text" placeholder="Englisch">
    <input id="newDe" type="text" placeholder="Deutsch">
    <select id="newCat"></select>
    <input id="newGroup" type="text" placeholder="Gruppe / Variante">
    <input id="newHint" type="text" placeholder="Hinweis">
    <div class="flex" style="margin-top:10px;justify-content:center">
      <button id="saveNew">💾 Speichern</button>
      <button id="closeNew">❌ Abbrechen</button>
    </div>
  </div>
</div>

<div id="toast">Gespeichert</div>

<script>
const CATS={
  Gelb:["Grundwerkzeuge Metallverarbeitung","#F4D03F","#000"],
  Pink:["Werkzeugkasten Mechaniker","#E91E63","#fff"],
  Blau:["Blech- / Kunststoffarbeiten","#1976D2","#fff"],
  Gruen:["Drehen / Fräsen","#1E8449","#fff"],
  HellesPink:["Hydraulik / Pneumatik","#F54927","#fff"],
  Orange:["Elektrotechnik","#E67E22","#fff"],
  Dunkelgruen:["Fluggerätemechanik allgemein","#117A65","#fff"],
  Rot:["Verwechslungsgefahr","#C0392B","#fff"]
};

const el=id=>document.getElementById(id);
const toast=t=>{const x=el("toast");x.textContent=t;x.style.display="block";setTimeout(()=>x.style.display="none",2000);};
const $=q=>document.querySelector(q);
let list=[];

for(const k in CATS){let o=document.createElement("option");o.value=k;o.textContent=CATS[k][0];o.style.background=CATS[k][1];o.style.color=CATS[k][2];el("filterCat").appendChild(o);el("newCat").appendChild(o.cloneNode(true));el("editCat").appendChild(o.cloneNode(true));}

function saveLocal(){localStorage.setItem("vokabeln",JSON.stringify(list));}
function loadLocal(){return JSON.parse(localStorage.getItem("vokabeln")||"[]");}
function dedup(arr){return Array.from(new Map(arr.map(v=>[v[0]+v[1],v])).values());}

async function loadGitHub(){
  try{
    const r=await fetch("https://beeferino.github.io/vokabeltrainer/vokabeln.json",{cache:"no-store"});
    const d=await r.json();
    list=dedup([...d,...loadLocal()]);
    render();
  }catch{list=loadLocal();render();}
}

function render(){
  const t=el("vokabelTable").querySelector("tbody");
  const q=el("searchInput").value.toLowerCase();
  const f=el("filterCat").value;
  let shown=list.filter(v=>(f==="Alle"||v[2]===f)&&(v[0].toLowerCase().includes(q)||v[1].toLowerCase().includes(q)));
  t.innerHTML=shown.map((v,i)=>{
    const c=CATS[v[2]]||["","#ddd","#000"];
    return `<tr>
      <td>${v[0]}</td><td>${v[1]}</td>
      <td style="color:${c[2]};font-weight:700;">${c[0]}</td>
      <td><button onclick="openModal(${i})">🔍</button></td>
    </tr>`;
  }).join("")||"<tr><td colspan=4>Keine Ergebnisse</td></tr>";
  el("infoFooter").textContent=`${shown.length} Einträge angezeigt`;
}

function openModal(i){
  const v=list[i];
  el("editEn").value=v[0];el("editDe").value=v[1];el("editCat").value=v[2];
  el("editGroup").value=v[3]||"";el("editHint").value=v[4]||"";
  el("modal").style.display="flex";
}
el("closeModal").onclick=()=>el("modal").style.display="none";

el("btnNew").onclick=()=>el("modalNew").style.display="flex";
el("closeNew").onclick=()=>el("modalNew").style.display="none";

el("saveNew").onclick=async()=>{
  const en=el("newEn").value.trim(),de=el("newDe").value.trim(),cat=el("newCat").value,group=el("newGroup").value.trim(),hint=el("newHint").value.trim();
  if(!en||!de)return alert("Bitte Englisch und Deutsch angeben");
  list.push([en,de,cat,group,hint]);
  saveLocal();render();await githubSyncUpload("Neue Vokabel");toast("✅ Gespeichert & synchronisiert");
  el("modalNew").style.display="none";
  el("newEn").value=el("newDe").value=el("newGroup").value=el("newHint").value="";
};

el("searchInput").oninput=render;
el("filterCat").onchange=render;
el("resetFilter").onclick=()=>{el("filterCat").value="Alle";el("searchInput").value="";render();};
$("#btnBack").onclick=()=>location.href="index.html";
$("#btnCommit").onclick=async()=>{await githubSyncUpload("Manuell eingetragen");toast("📤 In Datenbank eingetragen");};

async function githubSyncUpload(msg="Update"){
  const token=localStorage.getItem("gh_token");
  if(!token)return alert("Kein GitHub-Token gefunden");
  const body=JSON.stringify(list,null,2);
  const res=await fetch(`https://api.github.com/repos/beeferino/vokabeltrainer/contents/vokabeln.json`,{
    method:"PUT",
    headers:{Authorization:`token ${token}`,"Content-Type":"application/json"},
    body:JSON.stringify({message:msg,content:btoa(unescape(encodeURIComponent(body))),sha:undefined})
  });
  if(res.ok)toast("✅ Synchronisiert mit GitHub");
  else alert("Fehler beim Hochladen");
}
loadGitHub();
</script>
</body>
</html>
