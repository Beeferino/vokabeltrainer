<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>üìò Vokabel√ºbersicht ‚Äì Beeferino</title>

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

  <!-- ======== Grundlegendes Styling ======== -->
  <style>
    :root {
      --ink:#0f172a; --muted:#6b7280; --bg:#f7f9fb; --card:#ffffff;
      --blue:#2563eb; --ok:#16a34a; --bad:#ef4444; --amber:#f59e0b;
      --border:#e5ebf3; --shadow:0 8px 26px rgba(0,0,0,.08);
    }

    * { box-sizing: border-box; }
    body {
      margin:0;
      font-family: Inter, system-ui, sans-serif;
      background: linear-gradient(145deg,#eef4ff,#dbeafe);
      color: var(--ink);
    }

    a { color:#1e3a8a; text-decoration:none; }

    .app {
      max-width:1200px;
      margin:18px auto;
      padding:16px;
    }

    h1 {
      text-align:center;
      font-weight:800;
      color:#1e3a8a;
      margin:0;
    }

    .hr {
      width:160px;
      height:4px;
      background:#2563eb;
      border-radius:4px;
      margin:10px auto 18px;
    }

    /* ===== Toolbar oben ===== */
    .toolbar {
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:center;
      margin:12px 0;
    }

    .toolbar select, .toolbar input {
      padding:8px 12px;
      border:1px solid #cfd6e4;
      border-radius:10px;
      background:#fff;
    }

    .btn {
      background:var(--blue);
      color:#fff;
      border:none;
      border-radius:10px;
      padding:8px 14px;
      font-weight:700;
      cursor:pointer;
    }
    .btn.warn { background:var(--bad); }
    .btn.gray { background:#6b7280; }
    .btn.ghost { background:#eef4ff; color:#111; border:1px solid #dbe3ff; }
    .btn:disabled { opacity:.5; cursor:not-allowed; }

    /* ===== Schalter: Listen- oder Kachelansicht ===== */
    .view-toggle {
      display:flex;
      align-items:center;
      gap:8px;
      padding:8px 12px;
      border:1px solid #cfd6e4;
      border-radius:10px;
      background:#fff;
      font-weight:700;
    }

    .view-toggle .switch {
      position:relative;
      display:inline-block;
      width:56px;
      height:28px;
    }
    .view-toggle .switch input { opacity:0; width:0; height:0; }

    .view-toggle .slider {
      position:absolute;
      cursor:pointer;
      top:0; left:0; right:0; bottom:0;
      background:#cbd5e1;
      transition:.25s;
      border-radius:999px;
    }

    .view-toggle .slider:before {
      content:"";
      position:absolute;
      width:22px; height:22px;
      left:3px; top:3px;
      background:#fff;
      border-radius:50%;
      transition:.25s;
    }

    .view-toggle input:checked + .slider { background:#60a5fa; }
    .view-toggle input:checked + .slider:before { transform:translateX(28px); }

    /* ===== Tabellenansicht ===== */
    .table-wrap {
      background:#fff;
      border-radius:16px;
      box-shadow:var(--shadow);
      overflow:hidden;
    }

    table {
      width:100%;
      border-collapse:collapse;
    }

    th, td {
      padding:10px;
      border-bottom:1px solid var(--border);
      text-align:left;
    }

    tr:hover { background:#f8fbff; }

    .category-chip {
      padding:4px 10px;
      border-radius:999px;
      color:#fff;
      font-weight:700;
      font-size:.88rem;
      white-space:nowrap;
    }

    .red-flag {
      color:#b91c1c;
      font-weight:700;
      margin-left:6px;
      cursor:help;
    }

    /* ===== Kachelansicht (Grid) ===== */
    .grid {
      display:grid;
      gap:12px;
      grid-template-columns:repeat(2,minmax(0,1fr));
    }
    @media(min-width:1200px) {
      .grid { grid-template-columns:repeat(3,minmax(0,1fr)); }
    }

    .card {
      background:#fff;
      border:1px solid #e5ebf3;
      border-radius:14px;
      padding:14px;
      box-shadow:0 4px 10px rgba(0,0,0,.06);
      transition:box-shadow .2s,border-color .2s;
    }

    .card.selected {
      border-color:#60a5fa;
      box-shadow:0 0 0 3px rgba(37,99,235,.15);
    }

    .card.red-card {
      border-color:var(--bad);
      box-shadow:0 0 0 2px rgba(239,68,68,.18);
    }

    .card-cat {
      display:inline-block;
      padding:4px 10px;
      border-radius:999px;
      color:#fff;
      font-weight:700;
      margin-bottom:8px;
    }

    .kv {
      display:grid;
      grid-template-columns:110px 1fr;
      gap:12px 10px;
      font-size:.95rem;
    }

    .kv .k { color:var(--muted); }

    .badge-danger {
      display:inline-flex;
      align-items:center;
      gap:6px;
      background:#fee2e2;
      color:#991b1b;
      border:1px solid #fecaca;
      border-radius:12px;
      font-weight:800;
      padding:6px 10px;
      margin-bottom:6px;
    }

    .card-row {
      text-align:right;
      margin-top:10px;
    }

    .card-row button {
      padding:6px 10px;
      border:none;
      border-radius:10px;
      font-weight:700;
      background:var(--blue);
      color:#fff;
      cursor:pointer;
      font-size:.9rem;
    }

    /* ===== Pagination ===== */
    .pager {
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      margin:16px 0;
    }

    /* ===== Modal ===== */
    .modal {
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.4);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:50;
    }

    .panel {
      background:#fff;
      border-radius:14px;
      padding:18px;
      width:92%;
      max-width:540px;
      box-shadow:var(--shadow);
    }

    .form-grid {
      display:grid;
      gap:10px;
    }

    .form-grid input, .form-grid select, .form-grid textarea {
      width:100%;
      padding:10px;
      border:1px solid #cfd6e4;
      border-radius:10px;
      background:#fff;
    }

    .modal-actions {
      display:flex;
      gap:12px;
      justify-content:flex-end;
      margin-top:16px;
    }

    .confuse-toggle {
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:10px;
      border:1px solid #cfd6e4;
      border-radius:10px;
      background:#f9fafb;
      font-weight:600;
      color:#111;
    }

    .confuse-toggle .switch {
      position:relative;
      display:inline-block;
      width:52px;
      height:28px;
    }

    .confuse-toggle .switch input { opacity:0; width:0; height:0; }

    .confuse-toggle .slider {
      position:absolute;
      cursor:pointer;
      top:0; left:0; right:0; bottom:0;
      background:#cbd5e1;
      transition:.25s;
      border-radius:999px;
    }

    .confuse-toggle .slider:before {
      content:"";
      position:absolute;
      width:22px; height:22px;
      left:3px; top:3px;
      background:#fff;
      border-radius:50%;
      transition:.25s;
    }

    .confuse-toggle input:checked + .slider { background:#fca5a5; }
    .confuse-toggle input:checked + .slider:before { transform:translateX(24px); }
  </style>
</head>
<body>
<div class="app">
  <h1>üìò Vokabel√ºbersicht</h1>
  <div class="hr"></div>

  <!-- Toolbar mit Ansichtsschalter -->
  <div class="toolbar">
    <select id="filterCatDesk"></select>
    <input id="searchDesk" type="text" placeholder="Suchen‚Ä¶">
    <button id="resetDesk" class="btn gray">Reset</button>
    <span class="view-toggle">Ansicht
      <label class="switch">
        <input type="checkbox" id="viewSwitch">
        <span class="slider"></span>
      </label>
      <span id="viewLabel">Liste</span>
    </span>
    <button id="addDesk" class="btn">‚ûï Neu</button>
    <button id="delDesk" class="btn warn">üóëÔ∏è L√∂schen</button>
    <button id="syncDesk" class="btn">üì§ Sync</button>
  </div>

  <!-- Z√§hleranzeige -->
  <div id="countDesk" style="text-align:center;margin:8px 0;font-weight:600;color:#1e3a8a"></div>

  <!-- Tabellenansicht -->
  <div id="listView" class="table-wrap" style="display:block;">
    <table>
      <thead>
        <tr>
          <th>‚ü≤</th>
          <th>Englisch</th>
          <th>Deutsch</th>
          <th>Kategorie</th>
          <th>Aktion</th>
        </tr>
      </thead>
      <tbody id="tblBody"></tbody>
    </table>
  </div>
  <!-- Kachelansicht -->
  <div id="gridView" style="display:none;">
    <div id="grid" class="grid"></div>
  </div>

  <!-- Pagination unten -->
  <div id="pager" class="pager">
    <button class="btn" id="pgPrev">‚¨ÖÔ∏è Zur√ºck</button>
    <span id="pgInfo" style="font-weight:700">Seite 1 / 1</span>
    <button class="btn" id="pgNext">Weiter ‚û°Ô∏è</button>
  </div>
</div>

<!-- ===== Modal zur Bearbeitung / Neuanlage ===== -->
<div class="modal" id="modal">
  <div class="panel">
    <h3 id="modalTitle">Vokabel bearbeiten</h3>
    <div class="form-grid">
      <label>Englisch
        <input id="mEn" type="text" placeholder="englisches Wort">
      </label>
      <label>Deutsch
        <input id="mDe" type="text" placeholder="deutsche √úbersetzung">
      </label>
      <label>Kategorie
        <select id="mCat"></select>
      </label>
      <div class="confuse-toggle">
        <span>Verwechslungsgefahr</span>
        <label class="switch">
          <input type="checkbox" id="mConfuse">
          <span class="slider"></span>
        </label>
      </div>
      <label>Gruppe
        <input id="mGroup" type="text" placeholder="z. B. Lektion 5">
      </label>
      <label>Hinweis
        <textarea id="mHint" rows="2" placeholder="Optionaler Merksatz"></textarea>
      </label>
    </div>
    <div class="modal-actions">
      <button class="btn gray" id="mCancel">Abbrechen</button>
      <button class="btn" id="mSave">Speichern</button>
    </div>
  </div>
</div>

<!-- ===== Haupt-Skript ===== -->
<script>
(function(){
  /* ===============================
     KONSTANTEN UND BASISFUNKTIONEN
     =============================== */

  // Kategorienamen, Farben und Textfarben
  const CATEGORY_NAMES = {
    Gelb: "Grundwerkzeuge Metallverarbeitung",
    Pink: "Werkzeugkasten Mechaniker",
    Blau: "Blech- / Kunststoffarbeiten",
    Gruen: "Drehen / Fr√§sen",
    HellesPink: "Hydraulik / Pneumatik",
    Orange: "Elektrotechnik",
    Dunkelgruen: "Flugger√§temechanik allgemein"
  };
  const COLOR_MAP = {
    Gelb:"#F4D03F", Pink:"#E91E63", Blau:"#1976D2",
    Gruen:"#1E8449", HellesPink:"#F54927",
    Orange:"#E67E22", Dunkelgruen:"#117A65"
  };
  const TEXT_ON = {
    Gelb:"#000", Pink:"#fff", Blau:"#fff",
    Gruen:"#fff", HellesPink:"#fff",
    Orange:"#fff", Dunkelgruen:"#fff"
  };

  // Datenquelle (lokal / Remote)
  const RAW_URL = "https://beeferino.github.io/vokabeltrainer/vokabeln.json";

  // Hilfs-Shortcuts
  const $  = s => document.querySelector(s);
  const $$ = s => Array.from(document.querySelectorAll(s));

  /* ===== Referenzen auf DOM-Elemente ===== */
  const tblBody=$("#tblBody"), grid=$("#grid"),
        listView=$("#listView"), gridView=$("#gridView"),
        viewSwitch=$("#viewSwitch"), viewLabel=$("#viewLabel"),
        filterCatDesk=$("#filterCatDesk"), searchDesk=$("#searchDesk"),
        countDesk=$("#countDesk"), pgPrev=$("#pgPrev"),
        pgNext=$("#pgNext"), pgInfo=$("#pgInfo"),
        modal=$("#modal"), mEn=$("#mEn"), mDe=$("#mDe"),
        mCat=$("#mCat"), mConfuse=$("#mConfuse"),
        mGroup=$("#mGroup"), mHint=$("#mHint");

  /* ===== Programm-Status ===== */
  let list = [];            // Gesamte Vokabeln
  let editIndex = null;     // Aktueller Index bei Bearbeitung
  let selected = new Set(); // Auswahl f√ºr Mehrfach-Aktionen
  let viewMode = "list";    // "list" oder "grid"
  let currentPage = 1;      // Aktuelle Seite
  const PAGE_SIZE = 15;     // 15 Vokabeln / Seite

  /* ===== Hilfsfunktionen ===== */

  // Normalisierung eines Datensatzes (zur Sicherheit)
  const normalize = v => [
    v[0]||"", v[1]||"", v[2]||"Gelb",
    v[3]||"", v[4]||"", v[5]||new Date().toISOString(),
    v[6]?1:0, v[7]||String(Math.random()).slice(2)
  ];

  // LocalStorage-Verwaltung
  const loadLocal = () =>
    JSON.parse(localStorage.getItem("vokabeln")||"[]").map(normalize);
  const saveLocal = d =>
    localStorage.setItem("vokabeln", JSON.stringify(d));

  // Index in Liste finden √ºber eindeutige ID (v[7])
  const idxInList = v => list.findIndex(x => x[7] === v[7]);

  // Kategorien in Dropdowns schreiben
  function fillCategorySelect(el){
    el.innerHTML = "";
    Object.keys(CATEGORY_NAMES).forEach(k=>{
      const o=document.createElement("option");
      o.value=k;
      o.textContent=CATEGORY_NAMES[k];
      o.style.background=COLOR_MAP[k];
      o.style.color=TEXT_ON[k];
      el.appendChild(o);
    });
  }

  /* ==========================
     DATENLADEN UND INIT
     ========================== */
  async function loadData(){
    try{
      // Versuch: Remote-Quelle
      const r=await fetch(RAW_URL,{cache:"no-store"});
      const j=await r.json();
      list=j.map(normalize);
      saveLocal(list);
    }catch{
      // Fallback: Lokale Daten
      list=loadLocal();
    }
    fillCategorySelect(filterCatDesk);
    fillCategorySelect(mCat);
    renderAll();
  }

  /* ==========================
     FILTER, SUCHE, PAGINATION
     ========================== */
  function filtered(){
    const cat = filterCatDesk.value || "Alle";
    const q = searchDesk.value.trim().toLowerCase();
    return list.filter(v=>{
      const cOk = cat==="Alle" || v[2]===cat;
      const qOk = !q ||
        v[0].toLowerCase().includes(q) ||
        v[1].toLowerCase().includes(q) ||
        (v[4]||"").toLowerCase().includes(q);
      return cOk && qOk;
    });
  }

  function pageSlice(){
    const d = filtered();
    const pages = Math.max(1, Math.ceil(d.length/PAGE_SIZE));
    if(currentPage>pages) currentPage=pages;
    const s=(currentPage-1)*PAGE_SIZE;
    return d.slice(s,s+PAGE_SIZE);
  }

  function updatePager(){
    const p=Math.max(1,Math.ceil(filtered().length/PAGE_SIZE));
    pgInfo.textContent=`Seite ${currentPage} / ${p}`;
    pgPrev.disabled=currentPage<=1;
    pgNext.disabled=currentPage>=p;
  }

  pgPrev.onclick=()=>{currentPage=Math.max(1,currentPage-1);renderAll();};
  pgNext.onclick=()=>{currentPage++;renderAll();};
  /* ==========================
     DARSTELLUNG ‚Äì LISTE
     ========================== */
  function renderList(){
    const data = pageSlice();
    tblBody.innerHTML = data.map(v=>{
      const i = idxInList(v);
      const danger = v[6]==1 ? '<span class="red-flag" title="Verwechslungsgefahr">‚ö†Ô∏è</span>' : "";
      const catColor = COLOR_MAP[v[2]], catText = TEXT_ON[v[2]];
      return `
        <tr>
          <td><input type="checkbox" data-idx="${i}"></td>
          <td>${v[0]} ${danger}</td>
          <td>${v[1]}</td>
          <td><span class="category-chip" style="background:${catColor};color:${catText}">${CATEGORY_NAMES[v[2]]}</span></td>
          <td><button class="btn" data-edit="${i}">‚úèÔ∏è Bearbeiten</button></td>
        </tr>`;
    }).join("");

    // Event-Handler
    $$('button[data-edit]').forEach(b=>b.onclick=()=>openEdit(+b.dataset.edit));
  }

  /* ==========================
     DARSTELLUNG ‚Äì KACHELANSICHT
     ========================== */
  function renderGrid(){
    const data = pageSlice();
    grid.innerHTML = data.map(v=>{
      const i = idxInList(v);
      const danger = v[6]==1 ? `<div class="badge-danger">‚ö†Ô∏è Verwechslungsgefahr</div>` : "";
      const catColor = COLOR_MAP[v[2]], catText = TEXT_ON[v[2]];
      const hasHint = v[4] ? `<div class="kv"><div class="k">Hinweis:</div><div>${v[4]}</div></div>` : "";
      const hasGroup = v[3] ? `<div class="kv"><div class="k">Gruppe:</div><div>${v[3]}</div></div>` : "";
      return `
        <div class="card ${v[6]==1?"red-card":""}" data-idx="${i}">
          <div class="card-cat" style="background:${catColor};color:${catText}">${CATEGORY_NAMES[v[2]]}</div>
          ${danger}
          <div class="kv">
            <div class="k">Englisch:</div><div><strong>${v[0]}</strong></div>
            <div class="k">Deutsch:</div><div>${v[1]}</div>
          </div>
          ${hasGroup}
          ${hasHint}
          <div class="card-row">
            <button class="btn" data-edit="${i}">Bearbeiten</button>
          </div>
        </div>`;
    }).join("");

    $$('button[data-edit]').forEach(b=>b.onclick=()=>openEdit(+b.dataset.edit));
  }

  /* ==========================
     GESAMT-RENDER UND Z√ÑHLER
     ========================== */
  function renderAll(){
    updatePager();
    const d = filtered();
    const txt = `üìò ${d.length} Vokabel${d.length!==1?"n":""} gefunden`;
    countDesk.textContent = txt;

    if(viewMode==="list"){
      listView.style.display="block";
      gridView.style.display="none";
      renderList();
    }else{
      listView.style.display="none";
      gridView.style.display="block";
      renderGrid();
    }
  }

  /* ==========================
     ANSICHTS-UMSCHALTER
     ========================== */
  viewSwitch.addEventListener("change",()=>{
    viewMode = viewSwitch.checked ? "grid" : "list";
    viewLabel.textContent = viewMode==="grid" ? "Kacheln" : "Liste";
    renderAll();
  });

  /* ==========================
     MODAL-FUNKTIONEN
     ========================== */
  function openEdit(i=null){
    editIndex=i;
    if(i==null){
      // Neue Vokabel
      mEn.value=""; mDe.value=""; mGroup.value=""; mHint.value="";
      mCat.value="Gelb"; mConfuse.checked=false;
      $("#modalTitle").textContent="Neue Vokabel anlegen";
    }else{
      const v=list[i];
      mEn.value=v[0]; mDe.value=v[1];
      mCat.value=v[2]; mGroup.value=v[3]; mHint.value=v[4];
      mConfuse.checked=v[6]==1;
      $("#modalTitle").textContent="Vokabel bearbeiten";
    }
    mCat.style.background=COLOR_MAP[mCat.value];
    mCat.style.color=TEXT_ON[mCat.value];
    modal.style.display="flex";
  }

  function closeModal(){ modal.style.display="none"; }
  $("#mCancel").onclick=closeModal;

  $("#mSave").onclick=()=>{
    const en=mEn.value.trim(), de=mDe.value.trim();
    const cat=mCat.value, grp=mGroup.value.trim(), hint=mHint.value.trim(), conf=mConfuse.checked?1:0;
    if(!en||!de){alert("Bitte Englisch und Deutsch ausf√ºllen.");return;}
    if(editIndex==null)
      list.push([en,de,cat,grp,hint,new Date().toISOString(),conf,String(Math.random()).slice(2)]);
    else{
      const old=list[editIndex];
      list[editIndex]=[en,de,cat,grp,hint,old[5],conf,old[7]];
    }
    saveLocal(list);
    closeModal();
    renderAll();
  };

  mCat.onchange=()=>{
    mCat.style.background=COLOR_MAP[mCat.value];
    mCat.style.color=TEXT_ON[mCat.value];
  };
  modal.addEventListener("click",e=>{if(e.target===modal)closeModal();});

  /* ==========================
     FILTER & SUCHE-EVENTS
     ========================== */
  [filterCatDesk,searchDesk].forEach(el=>{
    el.addEventListener("input",()=>{currentPage=1;renderAll();});
    el.addEventListener("change",()=>{currentPage=1;renderAll();});
  });
  /* ==========================
     AKTIONEN: NEU, L√ñSCHEN, SYNC
     ========================== */
  $("#addDesk").onclick=()=>openEdit(null);

  $("#delDesk").onclick=()=>{
    const checked = $$("input[type='checkbox'][data-idx]:checked").map(x=>+x.dataset.idx);
    if(!checked.length){alert("Bitte Zeilen markieren.");return;}
    if(!confirm(`${checked.length} Vokabel${checked.length>1?"n":""} l√∂schen?`))return;
    list=list.filter((_,i)=>!checked.includes(i));
    saveLocal(list);
    renderAll();
  };

  $("#resetDesk").onclick=()=>{
    filterCatDesk.value="Alle";
    searchDesk.value="";
    currentPage=1;
    renderAll();
  };

  /* ===== GitHub Synchronisierung ===== */
  const GH_OWNER="beeferino", GH_REPO="vokabeltrainer", GH_PATH="vokabeln.json";
  function getToken(){
    let t=localStorage.getItem('gh_token')||"";
    if(!t){
      t=prompt("GitHub Token (repo-Scope):","");
      if(t){localStorage.setItem('gh_token',t);alert("Token gespeichert.");}
    }
    return t;
  }

  async function githubSync(){
    const token=getToken(); if(!token) return;
    try{
      const api=`https://api.github.com/repos/${GH_OWNER}/${GH_REPO}/contents/${GH_PATH}`;
      const meta=await fetch(api,{headers:{Authorization:`token ${token}`}}).then(r=>r.json());
      const sha=meta.sha;
      const content=btoa(unescape(encodeURIComponent(JSON.stringify(list,null,2))));
      const body={message:"Update via Vokabel-UI",content,sha};
      const res=await fetch(api,{
        method:"PUT",
        headers:{Authorization:`token ${token}`,"Content-Type":"application/json"},
        body:JSON.stringify(body)
      });
      if(!res.ok) throw new Error(await res.text());
      alert("‚úÖ Erfolgreich in GitHub-Datenbank eingetragen!");
    }catch(e){
      console.error(e);
      alert("‚ùå Fehler beim Sync: "+e.message);
    }
  }

  $("#syncDesk").onclick=githubSync;

  /* ==========================
     SERVICE WORKER REGISTER
     ========================== */
  if('serviceWorker' in navigator){
    try{
      navigator.serviceWorker.register('service-worker.js').catch(()=>{});
    }catch(e){
      console.warn("ServiceWorker konnte nicht registriert werden:", e);
    }
  }

  /* ==========================
     INIT
     ========================== */
  function initCategories(){
    filterCatDesk.innerHTML='<option value="Alle">Alle (bunt gemischt)</option>';
    Object.keys(CATEGORY_NAMES).forEach(k=>{
      const o=document.createElement("option");
      o.value=k;
      o.textContent=CATEGORY_NAMES[k];
      o.style.background=COLOR_MAP[k];
      o.style.color=TEXT_ON[k];
      filterCatDesk.appendChild(o);
    });
  }

  initCategories();
  loadData();

})(); // Ende der IIFE
</script>
</body>
</html>
