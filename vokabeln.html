<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>üìò Vokabel√ºbersicht ‚Äì Beeferino</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --ink:#0f172a;--muted:#6b7280;--bg:#f7f9fb;--card:#ffffff;
  --blue:#2563eb;--blue2:#1d4ed8;--ok:#16a34a;--bad:#ef4444;
  --border:#e5ebf3;--shadow:0 8px 26px rgba(0,0,0,.1)
}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,system-ui,sans-serif;background:linear-gradient(145deg,#eef4ff,#dbeafe);color:var(--ink)}
a{color:#1e3a8a;text-decoration:none}

.app{max-width:1100px;margin:20px auto;padding:16px}
h1{text-align:center;font-weight:800;color:#1e3a8a;margin:8px 0 4px}
.hr{width:160px;height:4px;background:#2563eb;border-radius:4px;margin:10px auto 20px}

/* ======== DESKTOP: fixiert, nie anr√ºhren ======== */
.toolbar{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin:10px 0}
.toolbar select,.toolbar input{padding:8px 12px;border:1px solid #cfd6e4;border-radius:10px}
.toolbar .btn{background:var(--blue);color:#fff;border:none;border-radius:10px;padding:8px 14px;font-weight:700;cursor:pointer}
.toolbar .warn{background:var(--bad)}
.toolbar .ghost{background:#eef4ff;color:#111}
.table-wrap{background:#fff;border-radius:16px;box-shadow:var(--shadow);overflow:hidden}
table{width:100%;border-collapse:collapse}
th,td{padding:10px;border-bottom:1px solid var(--border);text-align:left}
th.sortable{cursor:pointer;user-select:none}
th.sortable:hover{background:#f3f6ff}
tr:hover{background:#f8fbff}
.category-chip{padding:4px 10px;border-radius:999px;color:#fff;font-weight:700;font-size:.9rem}
.status-line{display:flex;justify-content:space-between;gap:10px;align-items:center;margin:10px 2px;color:#6b7280;font-size:.95rem}
.toast{position:fixed;left:50%;bottom:18px;transform:translateX(-50%);
  background:#111827;color:#fff;padding:10px 14px;border-radius:10px;opacity:0;pointer-events:none;transition:opacity .25s;z-index:9999}
.toast.show{opacity:1}

/* ======== MODAL (Editor) ======== */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:50}
.panel{background:#fff;border-radius:14px;padding:18px;width:92%;max-width:520px;box-shadow:var(--shadow)}
.panel h3{margin:0 0 10px 0}
.form-grid{display:grid;gap:10px}
.form-grid label{font-weight:700;font-size:.95rem}
.form-grid input,.form-grid select,.form-grid textarea{width:100%;padding:10px;border:1px solid #cfd6e4;border-radius:10px}
.modal-actions{display:flex;gap:10px;justify-content:space-between;margin-top:14px}
.btn{border:none;border-radius:10px;padding:10px 14px;font-weight:800;cursor:pointer}
.btn.primary{background:var(--blue);color:#fff}.btn.ghost{background:#eef4ff;color:#111}
.btn.warn{background:var(--bad);color:#fff}

/* ======== MOBILE VIEW ======== */
.mobile-only{display:none}
.mob-header{position:sticky;top:0;background:#eef4ff;padding:10px;border-bottom:1px solid #dbe3ff;z-index:5;text-align:center;font-weight:800}
.mob-list{padding:12px}
.card{
  background:#fff;border:1px solid #e5ebf3;border-radius:14px;padding:14px;margin-bottom:16px;
  box-shadow:0 4px 10px rgba(0,0,0,.06);transition:box-shadow .2s,border-color .2s;overflow:hidden
}
.card.selected{border-color:#60a5fa;box-shadow:0 0 0 3px rgba(37,99,235,.15)}
.card-top{display:flex;justify-content:space-between;align-items:flex-start;gap:6px;flex-wrap:wrap}
.card-cat{display:inline-block;max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;
  padding:4px 10px;border-radius:999px;color:#fff;font-weight:700;margin-bottom:8px}
.card-title{font-weight:800;font-size:1.05rem;word-break:break-word;overflow-wrap:anywhere;margin-bottom:6px}
.card-sub{color:var(--muted);margin-bottom:10px}
.card-row{text-align:right}
.card-row .btn{background:var(--blue);color:#fff;font-size:.85rem;padding:6px 10px;border-radius:8px}

/* ======== Floating Bottom Buttons ======== */
.fab-row{position:sticky;bottom:0;background:rgba(255,255,255,.95);
  padding:10px;border-top:1px solid #e5ebf3;display:none}
.fabs{display:flex;gap:8px}
.fab{flex:1;padding:12px;border:none;border-radius:10px;font-weight:800;cursor:pointer;color:#fff}
.fab.gray{background:#6b7280}.fab.warn{background:var(--bad)}.fab.blue{background:var(--blue)}

/* ======== Floating Speed Dial (unten rechts) ======== */
.dial{position:fixed;right:14px;bottom:20px;display:none;z-index:20;display:flex;flex-direction:column;align-items:flex-end}
.dial button{
  width:48px;height:48px;border-radius:50%;border:none;margin-top:8px;box-shadow:0 8px 20px rgba(0,0,0,.15);
  display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:20px;transition:transform .2s,box-shadow .2s
}
.dial button:hover{transform:translateY(-2px);box-shadow:0 6px 18px rgba(0,0,0,.2)}
.dial .back{background:#1f2937;color:#fff}
.dial .find{background:#2563eb;color:#fff}
.dial .gear{background:#10b981;color:#fff}

/* ======== Slide-in Filter ======== */
.slide{position:fixed;left:0;right:0;top:0;background:#fff;border-bottom:1px solid #e5ebf3;
  transform:translateY(-110%);transition:transform .25s ease;z-index:25;padding:12px}
.slide.show{transform:translateY(0)}
.slide .row{display:flex;gap:8px}
.slide select,.slide input{flex:1;padding:10px;border:1px solid #cfd6e4;border-radius:10px}
.slide .btn{white-space:nowrap}

/* ======== Footer ======== */
.footer{text-align:center;margin-top:14px;color:#6b7280;font-size:.92rem}

/* ======== Responsive Umschalter ======== */
@media (max-width:900px){
  .desktop-only{display:none}
  .mobile-only{display:block}
  .dial{display:flex}
  .fab-row{display:block}
}
</style>
</head>
<body>
<div class="app">
  <h1>üìò Vokabel√ºbersicht</h1>
  <div class="hr"></div>

  <!-- DESKTOP (gesperrt, bleibt unver√§ndert) -->
  <div class="toolbar desktop-only">
    <select id="filterCatDesk"></select>
    <input id="searchDesk" type="text" placeholder="Suchen‚Ä¶">
    <button id="resetDesk" class="btn ghost">Reset</button>
    <button id="addDesk" class="btn">‚ûï Neue</button>
    <button id="delDesk" class="btn warn">üóëÔ∏è L√∂schen</button>
    <button id="syncDesk" class="btn">üì§ In Datenbank eintragen</button>
    <button id="tokenBtn" class="btn">‚öôÔ∏è Token</button>
  </div>
  <div class="table-wrap desktop-only">
    <table id="tbl">
      <thead>
        <tr>
          <th style="width:44px">‚ü≤</th>
          <th class="sortable" data-col="0">Englisch</th>
          <th class="sortable" data-col="1">Deutsch</th>
          <th>Kategorie</th>
          <th style="display:none">Gruppe</th>
          <th style="display:none">Hinweis</th>
          <th>Aktion</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  <div class="status-line desktop-only">
    <div id="sourceInfo">Datenquelle: ‚Äì</div>
    <div id="countInfo">Gefunden 0 von 0</div>
  </div>

  <!-- MOBILE HEADER -->
  <div class="mob-header mobile-only">Vokabeln</div>

  <!-- MOBILE SLIDE FILTER -->
  <div class="slide mobile-only" id="slideFilter">
    <div class="row" style="margin-bottom:8px">
      <select id="filterCatMob"><option value="Alle">Alle (bunt gemischt)</option></select>
      <input id="searchMob" type="text" placeholder="Suchen‚Ä¶">
      <button id="resetMob" class="btn ghost">Reset</button>
    </div>
  </div>

  <!-- MOBILE LIST -->
  <div class="mob-list mobile-only" id="mobList"></div>

  <!-- MOBILE BOTTOM BAR -->
  <div class="fab-row mobile-only">
    <div class="fabs">
      <button class="fab gray" id="fabSelect">Auswahl</button>
      <button class="fab warn" id="fabDelete">L√∂schen</button>
      <button class="fab blue" id="fabAdd">Hinzuf√ºgen</button>
      <button class="fab gray" id="fabSync">In DB</button>
    </div>
    <div class="status-line" style="margin:6px 2px 0">
      <div id="countInfoMob">Gefunden 0 von 0</div>
    </div>
  </div>

  <!-- MOBILE FLOATING DIAL -->
  <div class="dial mobile-only">
    <button class="back" id="dialBack" title="Zur√ºck zum Trainer">‚üµ</button>
    <button class="find" id="dialFind" title="Suche / Filter">üîé</button>
    <button class="gear" id="dialGear" title="Token / Sync">‚öôÔ∏è</button>
  </div>

  <div class="footer desktop-only">
    <a href="index.html">‚¨ÖÔ∏è Zur√ºck zum Trainer</a>
    <div style="margin-top:6px">¬© 2025 Beeferino ‚Ä¢ <span id="sourceInfoFoot">Datenquelle: ‚Äì</span></div>
  </div>
</div>

<!-- MODAL -->
<div class="modal" id="modal">
  <div class="panel">
    <h3 id="modalTitle">Vokabel</h3>
    <div class="form-grid">
      <div><label>Englisch</label><input id="mEn" type="text"></div>
      <div><label>Deutsch</label><input id="mDe" type="text"></div>
      <div><label>Kategorie</label><select id="mCat"></select></div>
      <div><label>Erstellt</label><input id="mDate" type="date" readonly style="background:#f3f4f6"></div>
      <div><label>Gruppe / Variante</label><input id="mGroup" type="text"></div>
      <div><label>Hinweis</label><textarea id="mHint" rows="2"></textarea></div>
    </div>
    <div class="modal-actions">
      <button class="btn warn" id="mDelete">L√∂schen</button>
      <div>
        <button class="btn ghost" id="mCancel">Abbrechen</button>
        <button class="btn primary" id="mSave">Speichern</button>
      </div>
    </div>
  </div>
</div>

<div id="toast" class="toast">Gespeichert</div>

  <script>
(function(){
  // ===== Kategorien & Farben =====
  const CATEGORY_NAMES={
    Gelb:"Grundwerkzeuge Metallverarbeitung",Pink:"Werkzeugkasten Mechaniker",Blau:"Blech- / Kunststoffarbeiten",
    Gruen:"Drehen / Fr√§sen",HellesPink:"Hydraulik / Pneumatik",Orange:"Elektrotechnik",
    Dunkelgruen:"Flugger√§temechanik allgemein",Rot:"Verwechslungsgefahr"
  };
  const COLOR_MAP={Gelb:"#F4D03F",Pink:"#E91E63",Blau:"#1976D2",Gruen:"#1E8449",HellesPink:"#F54927",
    Orange:"#E67E22",Dunkelgruen:"#117A65",Rot:"#C0392B"};
  const TEXT_ON={Gelb:"#000",Pink:"#fff",Blau:"#fff",Gruen:"#fff",HellesPink:"#fff",Orange:"#fff",Dunkelgruen:"#fff",Rot:"#fff"};

  const RAW_URL="https://beeferino.github.io/vokabeltrainer/vokabeln.json";
  const GH_OWNER="beeferino", GH_REPO="vokabeltrainer", GH_PATH="vokabeln.json";

  const $=s=>document.querySelector(s);const $$=s=>Array.from(document.querySelectorAll(s));
  const isMobile=()=>matchMedia("(max-width:900px)").matches;
  const toast=(m="Gespeichert")=>{const t=$("#toast");t.textContent=m;t.classList.add("show");setTimeout(()=>t.classList.remove("show"),1500)};
  const dateOnly=iso=>{try{return new Date(iso).toISOString().slice(0,10)}catch{return""}};
  const normalize=v=>[v[0]||"",v[1]||"",v[2]||"Gelb",v[3]||"",v[4]||"",v[5]||new Date().toISOString()];

  let list=[],sortCol=0,sortAsc=true,editIndex=null,selectMode=false,selected=new Set(),editModeActive=false;

  const tbl=$("#tbl tbody"),countInfo=$("#countInfo"),countInfoMob=$("#countInfoMob"),
        sourceInfo=$("#sourceInfo"),sourceInfoFoot=$("#sourceInfoFoot"),
        filterCatDesk=$("#filterCatDesk"),searchDesk=$("#searchDesk"),
        filterCatMob=$("#filterCatMob"),searchMob=$("#searchMob"),
        modal=$("#modal"),mTitle=$("#modalTitle"),
        mEn=$("#mEn"),mDe=$("#mDe"),mCat=$("#mCat"),mDate=$("#mDate"),mGroup=$("#mGroup"),mHint=$("#mHint"),
        mobList=$("#mobList"),slideFilter=$("#slideFilter");

  const loadLocal=()=>JSON.parse(localStorage.getItem("vokabeln")||"[]").map(normalize);
  const saveLocal=d=>localStorage.setItem("vokabeln",JSON.stringify(d));

  function getToken(){
    let t=localStorage.getItem("gh_token")||"";
    if(!t){t=prompt("GitHub Token (repo-Scope):","");if(t){localStorage.setItem("gh_token",t);toast("Token gespeichert");}}
    return t;
  }
  function clearToken(){localStorage.removeItem("gh_token");toast("Token gel√∂scht ‚Äì neu setzen!");}

  async function loadData(){
    try{
      const r=await fetch(RAW_URL,{cache:"no-store"});
      const d=await r.json();list=d.map(normalize);saveLocal(list);
      sourceInfo.textContent="Datenquelle: GitHub (Online)";
      sourceInfoFoot.textContent="Datenquelle: GitHub (Online)";
    }catch{list=loadLocal();sourceInfo.textContent="Datenquelle: Lokaler Speicher";sourceInfoFoot.textContent="Datenquelle: Lokaler Speicher";}
    fillCategorySelect(filterCatDesk,true);fillCategorySelect(filterCatMob,true);fillCategorySelect(mCat,false);
    ensureFilterDefaults();renderAll();
  }

  function fillCategorySelect(el,withAll=false){
    el.innerHTML=withAll?'<option value="Alle">Alle (bunt gemischt)</option>':"";
    Object.keys(CATEGORY_NAMES).forEach(k=>{
      const o=document.createElement("option");o.value=k;o.textContent=CATEGORY_NAMES[k];
      o.style.background=COLOR_MAP[k];o.style.color=TEXT_ON[k];el.appendChild(o);
    });
  }
  function ensureFilterDefaults(){if(!filterCatDesk.value)filterCatDesk.value="Alle";if(!filterCatMob.value)filterCatMob.value="Alle";}

  function currentFilter(){const cat=isMobile()?(filterCatMob.value||"Alle"):(filterCatDesk.value||"Alle");const q=(isMobile()?searchMob:searchDesk).value.trim().toLowerCase();return{cat,q};}
  function filtered(){
    const{cat,q}=currentFilter();
    let data=list.filter(v=>{
      const okC=(cat==="Alle"||v[2]===cat);
      const okQ=!q||v[0].toLowerCase().includes(q)||v[1].toLowerCase().includes(q);
      return okC&&okQ;
    });
    data.sort((a,b)=>{
      const A=(a[sortCol]||"").toLowerCase(),B=(b[sortCol]||"").toLowerCase();
      if(A<B)return sortAsc?-1:1;if(A>B)return sortAsc?1:-1;return 0;
    });
    return data;
  }

  function renderDesktop(){
    const data=filtered();
    tbl.innerHTML=data.map(v=>{
      const i=indexOf(v),c=v[2];
      return `<tr>
        <td><input type="checkbox" data-idx="${i}"></td>
        <td>${escapeHtml(v[0])}</td><td>${escapeHtml(v[1])}</td>
        <td><span class="category-chip" style="background:${COLOR_MAP[c]};color:${TEXT_ON[c]}">${CATEGORY_NAMES[c]}</span></td>
        <td style="display:none">${escapeHtml(v[3]||"")}</td><td style="display:none">${escapeHtml(v[4]||"")}</td>
        <td><button class="btn" data-edit="${i}">‚úèÔ∏è Bearbeiten</button></td></tr>`;
    }).join("");
    $$('button[data-edit]').forEach(b=>b.onclick=()=>openEdit(+b.dataset.edit));
    countInfo.textContent=`Gefunden ${data.length} von ${list.length}`;
  }

  function renderMobile(){
    const data=filtered();
    mobList.innerHTML=data.map(v=>{
      const i=indexOf(v),cat=v[2],sel=selected.has(i)?" selected":"";
      return `<div class="card${sel}" data-idx="${i}">
        <div class="card-top">
          <div class="card-cat" style="background:${COLOR_MAP[cat]};color:${TEXT_ON[cat]}">${CATEGORY_NAMES[cat]}</div>
          <div class="card-title">${escapeHtml(v[0])}</div>
        </div>
        <div class="card-sub">DE: ${escapeHtml(v[1])}</div>
        <div class="card-row"><button class="btn mobEdit" data-edit="${i}" style="padding:6px 10px;font-size:.85rem">Ansehen</button></div>
      </div>`;
    }).join("");
    $$('.mobEdit').forEach(b=>b.onclick=(e)=>{e.stopPropagation();openEdit(+b.dataset.edit);});
    $$('.card').forEach(c=>{
      c.onclick=e=>{
        const i=+c.dataset.idx;
        if(selectMode){selected.has(i)?selected.delete(i):selected.add(i);c.classList.toggle("selected");}
      };
    });
    countInfoMob.textContent=`Gefunden ${data.length} von ${list.length}`;
  }

  function renderAll(){renderDesktop();renderMobile();}

  const escapeHtml=s=>(s||"").replace(/[&<>"']/g,m=>({ "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;" }[m]));
  const indexOf=v=>list.findIndex(x=>x[0]===v[0]&&x[1]===v[1]&&x[2]===v[2]&&(x[5]||"")===(v[5]||""));

  // ===== Editor mit Bearbeiten-Button =====
  function setEditable(on){
    [mEn,mDe,mCat,mGroup,mHint].forEach(inp=>{
      inp.readOnly=!on;
      inp.style.background=on?"#fff":"#f3f4f6";
    });
    mCat.disabled=!on;
  }

  function openEdit(i=null){
    editIndex=i;
    editModeActive=false;
    if(i==null){
      mTitle.textContent="Neue Vokabel";
      mEn.value="";mDe.value="";mCat.value="Gelb";mGroup.value="";mHint.value="";
      mDate.value=dateOnly(new Date().toISOString());
      setEditable(true);
    }else{
      const v=list[i];
      mTitle.textContent="Vokabel anzeigen";
      mEn.value=v[0];mDe.value=v[1];mCat.value=v[2];
      mGroup.value=v[3]||"";mHint.value=v[4]||"";mDate.value=dateOnly(v[5]);
      setEditable(false);
    }
    // F√ºge Edit-Toggle ein, wenn nicht vorhanden
    if(!$("#mEditToggle")){
      const btn=document.createElement("button");
      btn.id="mEditToggle";
      btn.className="btn ghost";
      btn.textContent="Bearbeiten aktivieren ‚úèÔ∏è";
      btn.style.marginTop="10px";
      btn.onclick=()=>{
        editModeActive=true;
        setEditable(true);
        btn.disabled=true;
        btn.textContent="Bearbeitung aktiv";
      };
      $(".modal-actions").prepend(btn);
    }else{
      const b=$("#mEditToggle");
      b.disabled=false;b.textContent="Bearbeiten aktivieren ‚úèÔ∏è";
    }
    modal.style.display="flex";
  }
  function closeModal(){modal.style.display="none";}
  $("#mCancel").onclick=closeModal;
  modal.addEventListener("click",e=>{if(e.target===modal)closeModal();});

  $("#mSave").onclick=()=>{
    const en=mEn.value.trim(),de=mDe.value.trim();
    if(!en||!de){alert("Bitte Englisch & Deutsch ausf√ºllen.");return;}
    const cat=mCat.value,grp=mGroup.value.trim(),hint=mHint.value.trim();
    if(editIndex==null){list.push([en,de,cat,grp,hint,new Date().toISOString()]);}
    else{const old=list[editIndex];list[editIndex]=[en,de,cat,grp,hint,old[5]||new Date().toISOString()];}
    saveLocal(list);toast("Gespeichert");closeModal();renderAll();
  };
  $("#mDelete").onclick=()=>{
    if(editIndex==null){closeModal();return;}
    if(!confirm("Eintrag wirklich l√∂schen?"))return;
    list.splice(editIndex,1);saveLocal(list);toast("Gel√∂scht");closeModal();renderAll();
  };

  // ===== Desktop + Mobile Basisfunktionen bleiben =====
  $("#addDesk").onclick=()=>openEdit(null);
  $("#delDesk").onclick=()=>{const ids=$$('input[data-idx]:checked').map(x=>+x.dataset.idx);if(!ids.length)return alert("Bitte markieren.");if(!confirm(`${ids.length} l√∂schen?`))return;list=list.filter((_,i)=>!ids.includes(i));saveLocal(list);toast("Gel√∂scht");renderAll();};
  $$('th.sortable').forEach(th=>th.onclick=()=>{const c=+th.dataset.col;if(sortCol===c)sortAsc=!sortAsc;else{sortCol=c;sortAsc=true;}renderAll();});
  $("#fabAdd").onclick=()=>openEdit(null);
  $("#fabSelect").onclick=()=>{selectMode=!selectMode;selected.clear();renderMobile();toast(selectMode?"Auswahl aktiv":"Auswahl aus");};
  $("#fabDelete").onclick=()=>{if(!selected.size)return alert("Keine Auswahl.");if(!confirm(`${selected.size} l√∂schen?`))return;list=list.filter((_,i)=>!selected.has(i));selected.clear();saveLocal(list);toast("Gel√∂scht");renderAll();};
  $("#dialBack").onclick=()=>location.href="index.html";
  $("#dialFind").onclick=()=>{slideFilter.classList.toggle("show");if(slideFilter.classList.contains("show"))setTimeout(()=>$("#searchMob").focus(),50);};
  $("#dialGear").onclick=()=>{clearToken();getToken();};
  function resetFilters(){(isMobile()?filterCatMob:filterCatDesk).value="Alle";(isMobile()?searchMob:searchDesk).value="";renderAll();}
  $("#resetDesk").onclick=resetFilters;$("#resetMob").onclick=resetFilters;
  [filterCatDesk,searchDesk,filterCatMob,searchMob].forEach(e=>{e.oninput=renderAll;e.onchange=renderAll;});
  async function githubSync(){
    const t=getToken();if(!t)return;
    try{
      const api=`https://api.github.com/repos/${GH_OWNER}/${GH_REPO}/contents/${GH_PATH}`;
      const meta=await fetch(api,{headers:{Authorization:`token ${t}`}}).then(r=>r.json());
      const content=btoa(unescape(encodeURIComponent(JSON.stringify(list,null,2))));
      await fetch(api,{method:"PUT",headers:{Authorization:`token ${t}`,"Content-Type":"application/json"},
        body:JSON.stringify({message:"Update via Vokabel-UI",content,sha:meta.sha})});
      toast("In Datenbank eingetragen");
    }catch(e){console.error(e);alert("‚ùå Sync fehlgeschlagen");}
  }
  $("#syncDesk").onclick=githubSync;$("#fabSync").onclick=githubSync;$("#tokenBtn").onclick=()=>{clearToken();getToken();};

  loadData();
})();
</script>
