<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>📘 Vokabelübersicht</title>
<style>
body{font-family:"Segoe UI",Roboto,sans-serif;background:#f7f9fb;color:#111;margin:0;padding:20px;text-align:center;}
.app{max-width:1100px;margin:auto;}
h1{font-size:1.8rem;margin-bottom:0.5rem;}
h2{font-size:1.1rem;margin:0.5rem 0 0.8rem;}
.section{background:#fff;padding:16px 20px;border-radius:16px;box-shadow:0 3px 6px rgba(0,0,0,0.05);margin-bottom:18px;}
.flex{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;align-items:center;}
button,input,select{font-size:1rem;padding:8px 12px;border-radius:8px;border:1px solid #ccd4e2;margin:5px;}
button{background:#5b9df9;color:#fff;border:none;box-shadow:0 2px 5px rgba(0,0,0,0.1);}
button:hover{background:#72b1ff;transform:translateY(-1px);}
input[type=text],select{background:#fff;}
table{width:100%;border-collapse:collapse;margin-top:10px;font-size:.95rem;}
th,td{padding:10px;border-bottom:1px solid #e2e6ec;text-align:left;}
th{background:#eef4ff;cursor:pointer;user-select:none;}
th.sort-asc::after{content:"▲";margin-left:5px;color:#5b9df9;}
th.sort-desc::after{content:"▼";margin-left:5px;color:#5b9df9;}
tr:hover{background:#f3f7ff;}
.chip{display:inline-block;padding:4px 8px;border-radius:10px;color:#fff;font-size:.85rem;}
.pagination{display:flex;justify-content:center;gap:8px;margin-top:10px;}
.pagination button{background:#eef4ff;color:#111;}
.pagination button.active{background:#5b9df9;color:#fff;}
.lexica{display:flex;flex-wrap:wrap;justify-content:center;gap:6px;margin-bottom:12px;}
.lexica button{background:#f0f3f8;border:1px solid #d2dae6;color:#333;font-weight:600;padding:6px 9px;border-radius:8px;}
.lexica button.active{background:#5b9df9;color:#fff;}
hr.divider{border:none;border-top:2px solid #e3e7ef;margin:22px 0;}
.footer{margin-top:15px;font-size:.95rem;color:#555;}
.footer button{background:#74b9ff;color:#000;}
.footer button:hover{background:#a6d4ff;}
#modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:999;}
#modalContent{background:#fff;border-radius:16px;padding:20px;box-shadow:0 5px 20px rgba(0,0,0,.2);width:90%;max-width:420px;text-align:left;}
#modalContent h3{text-align:center;margin-top:0;}
.toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:#5cb85c;color:#fff;padding:10px 16px;border-radius:8px;display:none;z-index:1000;}
#datasourceStatus{position:fixed;right:12px;bottom:10px;font-size:.8rem;opacity:.75;color:#555;pointer-events:none;}
.last-change{margin-top:10px;font-size:.9rem;color:#666;}
@media(max-width:768px){body{padding:12px;}th,td{padding:8px;}.section{padding:12px;}}
</style>
</head>
<body>
<div class="app">
<h1>📘 Vokabelübersicht</h1>
<div id="lexica" class="lexica"></div>

<div class="section">
<h2>🔍 Filter & Suche</h2>
<div class="flex">
<label>Kategorie:
<select id="filterCat"><option value="Alle">Alle (bunt gemischt)</option></select>
</label>
<input id="searchInput" type="text" placeholder="🔎 Suchen (EN / DE)">
<button id="resetFilter">🔄 Filter zurücksetzen</button>
</div>
</div>

<div class="section">
<h2>📄 Vokabelliste</h2>
<table id="vokabelTable">
<thead>
<tr><th data-col="0">Englisch</th><th data-col="1">Deutsch</th><th data-col="2">Kategorie</th><th style="width:100px;">Aktion</th></tr>
</thead>
<tbody></tbody>
</table>
<div id="pagination" class="pagination"></div>
<div id="infoFooter" style="margin-top:6px;font-size:.95rem;color:#555;"></div>
</div>

<div class="section">
<h2>➕ Neue Vokabel hinzufügen</h2>
<div class="flex">
<input id="newEn" type="text" placeholder="Englisch">
<input id="newDe" type="text" placeholder="Deutsch">
<select id="newCat"></select>
<input id="newGroup" type="text" placeholder="Gruppe / Variante">
<input id="newHint" type="text" placeholder="Hinweis">
<button id="addBtn">Hinzufügen</button>
</div>
</div>

<hr class="divider">

<div class="section">
<h2>💾 JSON & Synchronisierung</h2>
<div class="flex">
<button id="syncBtn">🔄 Von GitHub neu laden</button>
<button id="downloadBtn">💾 vokabeln.json herunterladen</button>
</div>
<p id="syncInfo" style="font-size:.9rem;color:#666;margin-top:8px;">Quelle: – | Letzter Abgleich: –</p>
</div>

<hr class="divider">

<div class="section">
<h2>🧾 Zuletzt hinzugefügt</h2>
<div id="lastAdded">–</div>
</div>

<div class="footer">
<button onclick="window.location.href='/vokabeltrainer/index.html'">⬅️ Zurück zum Trainer</button>
<div class="last-change" id="lastChange">📅 Letzte Änderung: –</div>
<p>© 2025 @Beefi</p>
</div>
</div>

<!-- Modal -->
<div id="modal">
<div id="modalContent">
<h3>🔍 Vokabel-Details</h3>
<input id="editEn" type="text" placeholder="Englisch">
<input id="editDe" type="text" placeholder="Deutsch">
<select id="editCat"></select>
<input id="editGroup" type="text" placeholder="Gruppe / Variante">
<input id="editHint" type="text" placeholder="Hinweis">
<div class="flex" style="margin-top:10px;">
<button id="saveEdit">💾 Speichern</button>
<button id="closeModal">❌ Schließen</button>
</div>
</div>
</div>

<div id="toast" class="toast">Gespeichert</div>
<div id="datasourceStatus" aria-live="polite">🔄 JSON + lokale Ergänzungen (gemergt)</div>

<script>
(()=>{

const CATEGORY_NAMES={Gelb:"Grundwerkzeuge Metallverarbeitung",Pink:"Werkzeugkasten Mechaniker",Blau:"Blech- / Kunststoffarbeiten",Gruen:"Drehen / Fräsen",HellesPink:"Hydraulik / Pneumatik",Orange:"Elektrotechnik",Dunkelgruen:"Fluggerätemechanik allgemein",Rot:"Verwechslungsgefahr"};
const COLOR_MAP={Gelb:"#fae17a",Pink:"#f7a3c2",Blau:"#8ab4f9",Gruen:"#9ae3a2",HellesPink:"#ff9c92",Orange:"#ffc27a",Dunkelgruen:"#8ed1b2",Rot:"#f58a8a"};
const $=s=>document.querySelector(s);
const $$=s=>document.querySelectorAll(s);
const toast=m=>{const t=$("#toast");t.textContent=m;t.style.display="block";setTimeout(()=>t.style.display="none",1500);};

let list=[];
let currentPage=1,sortCol=0,sortDir="asc",searchTerm="",filterCat="Alle";
const perPage=15;

function normalize(v){return[v[0]||"",v[1]||"",v[2]||"Gelb",v[3]||"",v[4]||"",v[5]||new Date().toISOString()];}
function loadLocal(){return JSON.parse(localStorage.getItem("vokabeln")||"[]").map(normalize);}
function saveLocal(v){localStorage.setItem("vokabeln",JSON.stringify(v));localStorage.setItem("vokabeln_updated",new Date().toISOString());}

async function syncFromGitHub(){
try{
const r=await fetch("/vokabeltrainer/vokabeln.json",{cache:"no-store"});
if(!r.ok)throw 0;
const remote=await r.json();
const local=loadLocal();
const merged=mergeLists(remote,local);
saveLocal(merged);
list=merged;
$("#syncInfo").textContent="Quelle: GitHub + lokal | Letzter Abgleich: "+new Date().toLocaleString("de-DE");
toast("🔄 Synchronisiert");
render();
}catch(e){list=loadLocal();$("#syncInfo").textContent="💾 Offline-Modus (lokal)";}
}

function mergeLists(remote,local){
const map=new Map();
remote.map(normalize).forEach(v=>map.set((v[0]+"|"+v[1]).toLowerCase(),v));
local.map(normalize).forEach(v=>map.set((v[0]+"|"+v[1]).toLowerCase(),v));
return Array.from(map.values());
}

function render(){
const filtered=list.filter(v=>{
if(filterCat!=="Alle"&&v[2]!==filterCat)return false;
if(searchTerm){const s=searchTerm.toLowerCase();if(!v.join(" ").toLowerCase().includes(s))return false;}
return true;
});
filtered.sort((a,b)=>{
const A=a[sortCol].toLowerCase(),B=b[sortCol].toLowerCase();
if(A<B)return sortDir==="asc"?-1:1;
if(A>B)return sortDir==="asc"?1:-1;
return 0;
});
const pages=Math.ceil(filtered.length/perPage);
if(currentPage>pages)currentPage=pages||1;
const start=(currentPage-1)*perPage;
const rows=filtered.slice(start,start+perPage);
const tb=$("#vokabelTable tbody");
tb.innerHTML=rows.map((v,i)=>`<tr>
<td>${v[0]}</td>
<td>${v[1]}</td>
<td><span class="chip" style="background:${COLOR_MAP[v[2]]}">${CATEGORY_NAMES[v[2]]}</span></td>
<td><button class="viewBtn" data-i="${start+i}">🔍</button></td></tr>`).join("");
const pag=$("#pagination");
pag.innerHTML="";
for(let i=1;i<=pages;i++){const b=document.createElement("button");b.textContent=i;if(i===currentPage)b.classList.add("active");b.onclick=()=>{currentPage=i;render();};pag.appendChild(b);}
$("#infoFooter").textContent=`📚 Gesamt: ${list.length} | 🔤 Angezeigt: ${rows.length} | Seite ${currentPage}/${pages||1}`;
renderLast();
$$(".viewBtn").forEach(b=>b.onclick=()=>openModal(b.dataset.i));
$$("th[data-col]").forEach(th=>th.onclick=()=>{const c=parseInt(th.dataset.col);if(sortCol===c)sortDir=sortDir==="asc"?"desc":"asc";else{sortCol=c;sortDir="asc";}render();});
}

function renderLast(){
const last=$("#lastAdded");
if(!list.length){last.textContent="–";return;}
const l=list.slice(-5).reverse();
last.innerHTML=l.map(v=>`<div><b>${v[0]}</b> – ${v[1]} <span style="color:${COLOR_MAP[v[2]]}">(${CATEGORY_NAMES[v[2]]})</span></div>`).join("");
}

function fillCats(sel){
sel.innerHTML="";
for(const k in CATEGORY_NAMES){
const o=document.createElement("option");
o.value=k;o.textContent=CATEGORY_NAMES[k];o.style.background=COLOR_MAP[k];sel.appendChild(o);
}
}

function openModal(i){
const v=list[i];
$("#editEn").value=v[0];
$("#editDe").value=v[1];
$("#editCat").value=v[2];
$("#editGroup").value=v[3]||"";
$("#editHint").value=v[4]||"";
$("#saveEdit").onclick=()=>{
v[0]=$("#editEn").value.trim();
v[1]=$("#editDe").value.trim();
v[2]=$("#editCat").value;
v[3]=$("#editGroup").value.trim();
v[4]=$("#editHint").value.trim();
saveLocal(list);
toast("💾 Gespeichert");
$("#modal").style.display="none";
render();
};
$("#modal").style.display="flex";
}

$("#closeModal").onclick=()=>$("#modal").style.display="none";

$("#addBtn").onclick=()=>{
const en=$("#newEn").value.trim(),de=$("#newDe").value.trim(),cat=$("#newCat").value,grp=$("#newGroup").value.trim(),hint=$("#newHint").value.trim();
if(!en||!de)return alert("Bitte Englisch und Deutsch ausfüllen!");
list.push([en,de,cat,grp,hint,new Date().toISOString()]);
saveLocal(list);
$("#newEn").value=$("#newDe").value=$("#newGroup").value=$("#newHint").value="";
render();
toast("➕ Hinzugefügt");
};

$("#resetFilter").onclick=()=>{$("#filterCat").value="Alle";$("#searchInput").value="";filterCat="Alle";searchTerm="";render();};
$("#searchInput").oninput=e=>{searchTerm=e.target.value;render();};
$("#filterCat").onchange=e=>{filterCat=e.target.value;render();};
$("#syncBtn").onclick=syncFromGitHub;
$("#downloadBtn").onclick=()=>{const blob=new Blob([JSON.stringify(loadLocal(),null,2)],{type:"application/json"});const a=document.createElement("a");a.href=URL.createObjectURL(blob);a.download="vokabeln.json";a.click();};

function init(){
list=loadLocal();
fillCats($("#filterCat"));
fillCats($("#newCat"));
fillCats($("#editCat"));
render();
$("#lastChange").textContent="📅 Letzte Änderung: "+(localStorage.getItem("vokabeln_updated")?new Date(localStorage.getItem("vokabeln_updated")).toLocaleString("de-DE"):"–");
}
init();

})();
</script>
</body>
</html>
