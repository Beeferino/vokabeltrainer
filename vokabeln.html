<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>📘 Vokabelübersicht</title>
<style>
body{font-family:sans-serif;background:#f7f9fb;margin:0;padding:20px;text-align:center;}
.app{max-width:1100px;margin:auto;}
h1{font-size:1.8rem;margin-bottom:1rem;}
table{width:100%;border-collapse:collapse;margin-top:15px;}
th,td{padding:10px;border-bottom:1px solid #ddd;text-align:left;}
th{background:#eef3ff;cursor:pointer;user-select:none;position:relative;}
th:hover{background:#dce6ff;}
th.sort-asc::after{content:"▲";position:absolute;right:8px;color:#2980b9;}
th.sort-desc::after{content:"▼";position:absolute;right:8px;color:#2980b9;}
tr:hover{background:#f4f9ff;}
.category-chip{display:inline-block;padding:5px 10px;border-radius:10px;color:#fff;}
button,input,select{padding:8px 10px;font-size:1rem;border-radius:6px;border:1px solid #ccc;margin:5px;}
button{cursor:pointer;background:#2980b9;color:#fff;border:none;transition:background .2s ease,transform .1s ease;}
button:hover{background:#3498db;transform:translateY(-1px);}
.section{background:#fff;padding:16px 20px;border-radius:14px;box-shadow:0 2px 6px rgba(0,0,0,0.08);margin-bottom:25px;}
.section h2{text-align:center;font-size:1.2rem;margin-bottom:10px;}
.flex{display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:center;}
input[type="text"]{flex:1 1 160px;}
.footer{text-align:center;margin-top:20px;font-size:0.95rem;color:#555;}
#infoFooter{margin-top:5px;font-size:.9rem;color:#555;}
#datasourceStatus{position:fixed;right:12px;bottom:10px;font-size:.8rem;opacity:.75;color:#555;}
#modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:none;align-items:center;justify-content:center;z-index:1000;}
#modalContent{background:#fff;padding:20px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.3);min-width:280px;text-align:center;}
.toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:#2ecc71;color:#fff;padding:10px 16px;border-radius:8px;display:none;z-index:999;}
hr{border:0;border-top:1px solid #ddd;margin:20px 0;}
#lastAdded{background:#f8fafc;padding:10px;border-radius:10px;margin-top:8px;text-align:center;}
.viewBtn{background:#8e44ad;}
.viewBtn:hover{background:#9b59b6;}
</style>
</head>
<body>
<div class="app">
<h1>📘 Vokabelübersicht</h1>

<div class="section">
  <h2>🔍 Filter & Suche</h2>
  <div class="flex">
    <label>Kategorie:
      <select id="filterCat"><option value="Alle">Alle (bunt gemischt)</option></select>
    </label>
    <input type="text" id="searchInput" placeholder="🔎 Suchen (EN / DE)">
    <button id="resetFilter">🔄 Filter zurücksetzen</button>
  </div>
</div>

<div class="section">
  <h2>📄 Vokabelliste</h2>
  <table id="vokabelTable">
    <thead>
      <tr>
        <th onclick="sortList(0)">Englisch</th>
        <th onclick="sortList(1)">Deutsch</th>
        <th onclick="sortList(2)">Kategorie</th>
        <th>Aktion</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <div id="pagination" class="flex" style="margin-top:10px;"></div>
  <div id="infoFooter"></div>
</div>

<div class="section">
  <h2>➕ Neue Vokabel hinzufügen</h2>
  <div class="flex">
    <input id="en" type="text" placeholder="Englisch">
    <input id="de" type="text" placeholder="Deutsch">
    <select id="cat"></select>
    <input id="group" type="text" placeholder="Gruppe / Variante">
    <input id="hint" type="text" placeholder="Hinweis">
    <button id="addBtn">Hinzufügen</button>
  </div>
</div>

<hr>

<div class="section">
  <h2>💾 Datei- & JSON-Verwaltung</h2>
  <div class="flex">
    <button id="exportBtn">📤 Exportieren</button>
    <button id="importBtn">📥 Importieren</button>
    <button id="downloadJson">💾 vokabeln.json herunterladen</button>
    <button id="syncBtn">🔄 JSON aktualisieren (merge)</button>
  </div>
</div>

<hr>

<div class="section">
  <h2>🧾 Zuletzt hinzugefügt</h2>
  <div id="lastAdded">Keine Vokabeln vorhanden.</div>
</div>

<div class="footer">
  <button onclick="location.href='index.html'">⬅️ Zurück zum Trainer</button>
  <p>© 2025 @Beefi</p>
</div>
</div>

<!-- 🔍 Ansehen / Bearbeiten Modal -->
<div id="modal">
  <div id="modalContent">
    <h3>🔍 Vokabel-Details</h3>
    <input id="editEn" type="text" placeholder="Englisch" readonly><br><br>
    <input id="editDe" type="text" placeholder="Deutsch" readonly><br><br>
    <select id="editCat" disabled></select><br><br>
    <input id="editGroup" type="text" placeholder="Gruppe / Variante" readonly><br><br>
    <input id="editHint" type="text" placeholder="Hinweis" readonly><br><br>
    <div class="flex">
      <button id="toggleEdit">🔧 Bearbeiten</button>
      <button id="cancelEdit">❌ Schließen</button>
    </div>
  </div>
</div>

<div id="toast" class="toast">Gespeichert</div>
<div id="datasourceStatus">💾 Datenquelle: Lokaler Speicher</div>

<script>
(async()=>{
const CATEGORY_NAMES={"Gelb":"Grundwerkzeuge Metallverarbeitung","Pink":"Werkzeugkasten Mechaniker","Blau":"Blech- / Kunststoffarbeiten","Gruen":"Drehen / Fräsen","HellesPink":"Hydraulik / Pneumatik","Orange":"Elektrotechnik","Dunkelgruen":"Fluggerätemechanik allgemein","Rot":"Verwechslungsgefahr"};
const COLOR_MAP={"Gelb":"#F4D03F","Pink":"#E91E63","Blau":"#1976D2","Gruen":"#1E8449","HellesPink":"#F54927","Orange":"#E67E22","Dunkelgruen":"#117A65","Rot":"#C0392B"};
let list=[];const perPage=15;let currentPage=1;let editIndex=null;
let sortColumn=0;let sortAsc=true;
const $=s=>document.querySelector(s);const $$=s=>document.querySelectorAll(s);

async function loadVokabeln(){
  let vokabeln=[];
  const local=localStorage.getItem("vokabeln");
  if(local){vokabeln=JSON.parse(local);} 
  else{
    const r=await fetch("vokabeln.json",{cache:"no-store"});
    if(r.ok){vokabeln=await r.json();}
  }
  if(!Array.isArray(vokabeln))vokabeln=[];
  return vokabeln;
}

function toast(msg,color="#2ecc71"){const t=$("#toast");t.textContent=msg;t.style.background=color;t.style.display="block";setTimeout(()=>t.style.display="none",1500);}
function saveLocal(){localStorage.setItem("vokabeln",JSON.stringify(list));localStorage.setItem("vokabeln_updated",new Date().toISOString());render(false);}

window.sortList=function(colIndex){
  const ths=$$("th");ths.forEach(th=>th.classList.remove("sort-asc","sort-desc"));
  if(sortColumn===colIndex){sortAsc=!sortAsc;}else{sortColumn=colIndex;sortAsc=true;}
  const activeTh=ths[colIndex];activeTh.classList.add(sortAsc?"sort-asc":"sort-desc");
  list.sort((a,b)=>{
    const x=(a[colIndex]||"").toLowerCase();
    const y=(b[colIndex]||"").toLowerCase();
    if(x<y)return sortAsc?-1:1;
    if(x>y)return sortAsc?1:-1;
    return 0;
  });
  render(false);
};

function render(resetPage=true){
  const tb=$("#vokabelTable tbody");
  const search=$("#searchInput").value.toLowerCase();
  const cat=$("#filterCat").value;
  let filtered=list.filter(v=>{
    const matchCat=(cat==="Alle"||v[2]===cat);
    const matchSearch=(v[0].toLowerCase().includes(search)||v[1].toLowerCase().includes(search));
    return matchCat&&matchSearch;
  });
  const pages=Math.ceil(filtered.length/perPage)||1;
  if(resetPage)currentPage=1;
  const start=(currentPage-1)*perPage;
  const rows=filtered.slice(start,start+perPage);
  tb.innerHTML=rows.map((v,i)=>`<tr>
    <td>${v[0]}</td><td>${v[1]}</td>
    <td><span class="category-chip" style="background:${COLOR_MAP[v[2]]}">${CATEGORY_NAMES[v[2]]}</span></td>
    <td><button class="viewBtn" data-idx="${list.indexOf(v)}">🔍</button><button class="delBtn" data-idx="${list.indexOf(v)}">🗑️</button></td></tr>`).join("");

  const pag=$("#pagination");pag.innerHTML="";
  for(let i=1;i<=pages;i++){const b=document.createElement("button");b.textContent=i;if(i===currentPage)b.style.background="#6ca0f8";b.onclick=()=>{currentPage=i;render(false);};pag.appendChild(b);}
  const upd=localStorage.getItem("vokabeln_updated");
  $("#infoFooter").textContent=`📅 Letzte Änderung: ${upd?new Date(upd).toLocaleString("de-DE"):"–"} | 📚 Gesamt: ${list.length} | 🔍 Gefiltert: ${filtered.length} | 📄 Seite ${currentPage}/${pages}`;
  renderLastAdded();
  $$(".viewBtn").forEach(b=>b.onclick=()=>openView(b.dataset.idx));
  $$(".delBtn").forEach(b=>b.onclick=()=>{if(confirm("Löschen?")){list.splice(b.dataset.idx,1);saveLocal();toast("🗑️ Gelöscht","#e74c3c");}});
}

function renderLastAdded(){
  const div=$("#lastAdded");
  if(!list.length){div.textContent="Keine Vokabeln vorhanden.";return;}
  const last=list.slice(-5).reverse();
  div.innerHTML=last.map(v=>`<div><b>${v[0]}</b> – ${v[1]} <span style="color:${COLOR_MAP[v[2]]}">(${CATEGORY_NAMES[v[2]]})</span></div>`).join("");
}

function openView(i){
  editIndex=i;
  const v=list[i];
  $("#editEn").value=v[0];
  $("#editDe").value=v[1];
  $("#editCat").value=v[2];
  $("#editGroup").value=v[3]||"";
  $("#editHint").value=v[4]||"";
  setReadonly(true);
  $("#toggleEdit").textContent="🔧 Bearbeiten";
  $("#modal").style.display="flex";
}

function setReadonly(state){
  $("#editEn").readOnly=state;
  $("#editDe").readOnly=state;
  $("#editGroup").readOnly=state;
  $("#editHint").readOnly=state;
  $("#editCat").disabled=state;
}

$("#toggleEdit").onclick=()=>{
  if($("#toggleEdit").textContent.includes("Bearbeiten")){
    setReadonly(false);
    $("#toggleEdit").textContent="💾 Speichern";
  } else {
    const v=list[editIndex];
    v[0]=$("#editEn").value.trim();
    v[1]=$("#editDe").value.trim();
    v[2]=$("#editCat").value;
    v[3]=$("#editGroup").value.trim();
    v[4]=$("#editHint").value.trim();
    saveLocal();
    setReadonly(true);
    $("#toggleEdit").textContent="🔧 Bearbeiten";
    toast("💾 Gespeichert");
  }
};
$("#cancelEdit").onclick=()=>$("#modal").style.display="none";
$("#addBtn").onclick=()=>{const en=$("#en").value.trim(),de=$("#de").value.trim(),cat=$("#cat").value,grp=$("#group").value.trim(),hint=$("#hint").value.trim();if(!en||!de)return alert("Bitte ausfüllen!");list.push([en,de,cat,grp,hint]);saveLocal();$("#en").value=$("#de").value=$("#group").value=$("#hint").value="";toast("➕ Hinzugefügt");};
$("#resetFilter").onclick=()=>{$("#filterCat").value="Alle";$("#searchInput").value="";render();};
$("#filterCat").onchange=()=>render(false);
$("#searchInput").oninput=()=>render(false);

list=await loadVokabeln();
list.sort((a,b)=>a[0].localeCompare(b[0]));
$$("th")[0].classList.add("sort-asc");
const filterCat=$("#filterCat");
for(const k in CATEGORY_NAMES){const o=document.createElement("option");o.value=k;o.textContent=CATEGORY_NAMES[k];o.style.background=COLOR_MAP[k];o.style.color="#fff";filterCat.appendChild(o);}
function fillCats(sel){sel.innerHTML="";for(const k in CATEGORY_NAMES){const o=document.createElement("option");o.value=k;o.textContent=CATEGORY_NAMES[k];o.style.background=COLOR_MAP[k];o.style.color="#fff";sel.appendChild(o);}}
fillCats($("#cat"));fillCats($("#editCat"));
render();
})();
</script>
</body>
</html>
