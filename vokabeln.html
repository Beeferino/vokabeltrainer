<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>üìò Vokabel√ºbersicht ‚Äì Beeferino</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --ink:#0f172a;--muted:#6b7280;--bg:#f7f9fb;--card:#ffffff;
  --blue:#2563eb;--ok:#16a34a;--bad:#ef4444;
  --border:#e5ebf3;--shadow:0 8px 26px rgba(0,0,0,.1)
}
body.dark{
  --ink:#e2e8f0;--muted:#94a3b8;--bg:#0f172a;--card:#1e293b;
  --border:#334155;--shadow:0 8px 26px rgba(0,0,0,.5)
}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,system-ui,sans-serif;background:var(--bg);color:var(--ink);transition:background .4s,color .4s}
a{color:var(--blue);text-decoration:none}
.app{max-width:1100px;margin:20px auto;padding:16px}
h1{text-align:center;font-weight:800;color:var(--blue)}
.hr{width:160px;height:4px;background:var(--blue);border-radius:4px;margin:10px auto 20px}
.toolbar{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin:10px 0}
.toolbar select,.toolbar input{padding:8px 12px;border:1px solid #cfd6e4;border-radius:10px}
.toolbar .btn{background:var(--blue);color:#fff;border:none;border-radius:10px;padding:8px 14px;font-weight:700;cursor:pointer}
.toolbar .warn{background:var(--bad)}
.table-wrap{background:var(--card);border-radius:16px;box-shadow:var(--shadow);overflow:hidden}
table{width:100%;border-collapse:collapse}
th,td{padding:10px;border-bottom:1px solid var(--border);text-align:left}
tr:hover{background:rgba(37,99,235,.05)}
.category-chip{padding:4px 10px;border-radius:999px;color:#fff;font-weight:700;font-size:.9rem}
.red-flag{color:var(--bad);font-weight:700;margin-left:6px}
.mob-list{display:none;padding:10px}
.card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px;margin-bottom:12px;box-shadow:var(--shadow)}
.fab-row{display:none;position:sticky;bottom:0;background:rgba(255,255,255,.95);padding:10px;border-top:1px solid var(--border)}
.fabs{display:flex;gap:8px}
.fab{flex:1;padding:12px;border:none;border-radius:10px;font-weight:800;cursor:pointer;color:#fff}
.fab.gray{background:#6b7280}.fab.warn{background:var(--bad)}.fab.blue{background:var(--blue)}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.4);display:none;align-items:center;justify-content:center;z-index:50}
.panel{background:var(--card);border-radius:14px;padding:18px;width:92%;max-width:520px;box-shadow:var(--shadow)}
.form-grid{display:grid;gap:10px}
.form-grid input,.form-grid select,.form-grid textarea{width:100%;padding:10px;border:1px solid var(--border);border-radius:10px;background:var(--bg);color:var(--ink)}
.confuse-toggle{display:flex;align-items:center;justify-content:space-between;padding:10px 14px;border:1px solid var(--border);border-radius:10px;background:var(--bg);font-weight:600;color:var(--ink)}
.confuse-toggle .switch{position:relative;display:inline-block;width:48px;height:26px}
.confuse-toggle .switch input{opacity:0;width:0;height:0}
.confuse-toggle .slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#ccc;transition:0.3s;border-radius:34px}
.confuse-toggle .slider:before{position:absolute;content:"";height:20px;width:20px;left:3px;bottom:3px;background-color:white;transition:0.3s;border-radius:50%}
.confuse-toggle input:checked + .slider{background-color:var(--bad);box-shadow:0 0 5px rgba(239,68,68,0.6)}
.confuse-toggle input:checked + .slider:before{transform:translateX(22px)}
/* Checkbox-Sperre */
input[type="checkbox"][data-id]{cursor:pointer;transition:opacity .2s ease}
body:not(.adjusting) input[type="checkbox"][data-id]{pointer-events:none;opacity:.4;cursor:not-allowed}
/* Mobile Optimierung */
@media(max-width:900px){
  table th:nth-child(5), table td:nth-child(5),
  table th:nth-child(6), table td:nth-child(6),
  table th:nth-child(7), table td:nth-child(7){display:none!important}
  td:nth-child(2){cursor:pointer;color:var(--blue);font-weight:600}
  td:nth-child(2):hover{text-decoration:underline}
  body{font-size:.9rem}
  table{display:block;width:100%;overflow-x:auto}
  th,td{padding:6px 8px;font-size:.85rem}
  .category-chip{font-size:.75rem;padding:3px 8px}
  .toolbar .btn,.fab{padding:8px 10px;font-size:.9rem;border-radius:8px}
  h1{font-size:1.4rem}
  .hr{width:120px;height:3px}
  .panel{padding:14px;width:94%}
}
</style>
</head>
<body>
<div class="app">
  <h1>üìò Vokabel√ºbersicht</h1>
  <div class="hr"></div>
  <div class="toolbar">
    <select id="filterCatDesk"></select>
    <input id="searchDesk" type="text" placeholder="Suchen‚Ä¶">
    <button id="resetDesk" class="btn">Reset</button>
    <button id="addDesk" class="btn">‚ûï Neue</button>
    <button id="delDesk" class="btn warn">üóëÔ∏è L√∂schen</button>
    <button id="syncDesk" class="btn">üì§ Sync</button>
    <button id="darkModeToggle" class="btn">üåô Dark Mode</button>
  </div>
  <div id="countDesk" style="text-align:center;margin:8px 0;font-weight:600;color:var(--blue)">üìò 0 Vokabeln</div>
  <div class="table-wrap">
    <table id="tbl"><thead><tr>
      <th>‚ü≤</th><th data-sort="0">Englisch</th><th data-sort="1">Deutsch</th><th>Kategorie</th>
      <th>Gruppe</th><th>Hinweis</th><th>Aktion</th>
    </tr></thead><tbody></tbody></table>
  </div>
  <div id="pagination" style="text-align:center;margin:16px 0;"></div>
  <div class="fab-row">
    <div class="fabs">
      <button class="fab gray" id="fabBack">Zur√ºck</button>
      <button class="fab blue" id="fabAdjust">Anpassen</button>
      <button class="fab gray" id="fabSync">Sync</button>
    </div>
  </div>
  <div class="footer" style="text-align:center;margin-top:20px">
    <a href="index.html" style="font-weight:700">‚¨ÖÔ∏è Zur√ºck zum Trainer</a>
  </div>
</div>
  <!-- === Modal f√ºr Vokabeldetails === -->
<div class="modal" id="modal">
  <div class="panel">
    <h3 id="modalTitle" style="margin-top:0">Vokabel bearbeiten</h3>
    <div class="form-grid">
      <label>Englisch<input id="mEn" type="text"></label>
      <label>Deutsch<input id="mDe" type="text"></label>
      <label>Kategorie
        <select id="mCat"></select>
      </label>
      <div class="confuse-toggle">
        <span>Verwechslungsgefahr</span>
        <label class="switch">
          <input type="checkbox" id="mConfuse">
          <span class="slider"></span>
        </label>
      </div>
      <label>Gruppe / Variante<input id="mGroup" type="text"></label>
      <label>Hinweis<textarea id="mHint" rows="2"></textarea></label>
    </div>
    <div class="modal-actions" style="display:flex;justify-content:flex-end;gap:10px;margin-top:16px">
      <button class="btn ghost" id="mCancel">Abbrechen</button>
      <button class="btn primary" id="mSave">Speichern</button>
    </div>
  </div>
</div>

<script>
(function(){

/* ===== Konstanten & Hilfsfunktionen ===== */
const CATEGORY_NAMES={
  Gelb:"Grundwerkzeuge Metallverarbeitung",
  Pink:"Werkzeugkasten Mechaniker",
  Blau:"Blech- / Kunststoffarbeiten",
  Gruen:"Drehen / Fr√§sen",
  HellesPink:"Hydraulik / Pneumatik",
  Orange:"Elektrotechnik",
  Dunkelgruen:"Flugger√§temechanik allgemein"
};
const COLOR_MAP={Gelb:"#F4D03F",Pink:"#E91E63",Blau:"#1976D2",Gruen:"#1E8449",HellesPink:"#F54927",Orange:"#E67E22",Dunkelgruen:"#117A65"};
const TEXT_ON={Gelb:"#000",Pink:"#fff",Blau:"#fff",Gruen:"#fff",HellesPink:"#fff",Orange:"#fff",Dunkelgruen:"#fff"};

const $=s=>document.querySelector(s), $$=s=>Array.from(document.querySelectorAll(s));
const RAW_URL="https://beeferino.github.io/vokabeltrainer/vokabeln.json";

let list=[], selectedIds=new Set(), adjustMode=false;
let currentPage=1, PAGE_SIZE=15;

/* ===== DOM-Elemente ===== */
const tblBody=$("#tbl tbody");
const modal=$("#modal");
const mEn=$("#mEn"), mDe=$("#mDe"), mCat=$("#mCat"), mConfuse=$("#mConfuse"), mGroup=$("#mGroup"), mHint=$("#mHint");

/* ===== Dark-Mode Toggle ===== */
const darkToggle=$("#darkModeToggle");
if(localStorage.getItem("darkMode")==="1") document.body.classList.add("dark");
darkToggle.onclick=()=>{
  document.body.classList.toggle("dark");
  const on=document.body.classList.contains("dark");
  localStorage.setItem("darkMode",on?"1":"0");
};

/* ===== Kategorien f√ºllen ===== */
function fillCategorySelect(){
  mCat.innerHTML="";
  for(const [key,val] of Object.entries(CATEGORY_NAMES)){
    const o=document.createElement("option");
    o.value=key; o.textContent=val;
    o.style.background=COLOR_MAP[key]; o.style.color=TEXT_ON[key];
    mCat.appendChild(o);
  }
}

/* ===== Daten laden ===== */
async function loadData(){
  try{
    const r=await fetch(RAW_URL,{cache:"no-store"});
    list=await r.json();
  }catch{
    list=JSON.parse(localStorage.getItem("vokabeln")||"[]");
  }
  localStorage.setItem("vokabeln",JSON.stringify(list));
  fillCategorySelect();
  renderAll();
}

/* ===== Filter & Pagination ===== */
function filtered(){
  const cat=$("#filterCatDesk").value||"Alle";
  const q=$("#searchDesk").value.trim().toLowerCase();
  return list.filter(v=>{
    const matchCat=cat==="Alle"||v[2]===cat||(cat==="confuse"&&v[6]);
    const matchQ=!q||v[0].toLowerCase().includes(q)||v[1].toLowerCase().includes(q);
    return matchCat&&matchQ;
  });
}
function totalPages(){return Math.ceil(filtered().length/PAGE_SIZE)||1;}
function pageSlice(){const data=filtered();const start=(currentPage-1)*PAGE_SIZE;return data.slice(start,start+PAGE_SIZE);}
function changePage(d){currentPage+=d;if(currentPage<1)currentPage=1;if(currentPage>totalPages())currentPage=totalPages();renderAll();}
function renderPagination(){
  const pages=totalPages();
  const container=$("#pagination");
  if(pages<=1){container.innerHTML="";return;}
  container.innerHTML=`
    <button class="btn" ${currentPage===1?"disabled":""} id="pgPrev">‚¨ÖÔ∏è Zur√ºck</button>
    <span style="margin:0 10px;font-weight:600;">Seite ${currentPage} / ${pages}</span>
    <button class="btn" ${currentPage===pages?"disabled":""} id="pgNext">Weiter ‚û°Ô∏è</button>
  `;
  $("#pgPrev")?.addEventListener("click",()=>changePage(-1));
  $("#pgNext")?.addEventListener("click",()=>changePage(1));
}
/* ===== Tabellen-Rendering ===== */
function renderList(){
  const rows = pageSlice();
  tblBody.innerHTML = rows.map(v=>{
    const [en,de,cat,group,hint,created,confuse,id] = v;
    const chip = `<span class="category-chip" style="background:${COLOR_MAP[cat]};color:${TEXT_ON[cat]}">${CATEGORY_NAMES[cat]}</span>`;
    const checked = selectedIds.has(id) ? ' checked' : '';
    const confuseIcon = confuse ? ' <span class="red-flag" title="Verwechslungsgefahr">üî¥</span>' : '';

    return `
      <tr data-id="${id}">
        <td><input type="checkbox" data-id="${id}"${checked}></td>
        <td data-view="${id}">${en}${confuseIcon}</td>
        <td>${de}</td>
        <td>${chip}</td>
        <td>${group||""}</td>
        <td>${hint||""}</td>
        <td><button class="btn" data-edit="${id}">‚úèÔ∏è Bearbeiten</button></td>
      </tr>`;
  }).join("");

  // Checkboxen reagieren nur im Anpassmodus
  $$('input[type="checkbox"][data-id]').forEach(cb=>{
    cb.onchange = ()=>{
      const id = cb.dataset.id;
      if(!adjustMode) return; // Sicherung
      if(cb.checked) selectedIds.add(id); else selectedIds.delete(id);
    };
  });

  // Editieren (Desktop)
  $$('button[data-edit]').forEach(b=>{
    b.onclick = ()=> openEdit(b.dataset.edit);
  });

  // Mobile: Klick auf Englisch √∂ffnet Detailansicht
  $$('td[data-view]').forEach(td=>{
    td.onclick = ()=>{
      openEdit(td.dataset.view);
    };
  });
}

/* ===== Modal-Steuerung ===== */
function openEdit(id){
  const v = list.find(x=>x[7]===id);
  if(!v) return;
  mEn.value = v[0]; mDe.value = v[1]; mCat.value=v[2];
  mGroup.value=v[3]; mHint.value=v[4]; mConfuse.checked=!!v[6];
  modal.style.display="flex";
}
function closeModal(){ modal.style.display="none"; }
$("#mCancel").onclick=closeModal;
$("#mSave").onclick=()=>{
  const en=mEn.value.trim(), de=mDe.value.trim();
  if(!en||!de){ alert("Bitte Englisch & Deutsch angeben."); return; }
  const cat=mCat.value, group=mGroup.value.trim(), hint=mHint.value.trim(), confuse=mConfuse.checked?1:0;
  const id = crypto.randomUUID();
  list.push([en,de,cat,group,hint,new Date().toISOString(),confuse,id]);
  localStorage.setItem("vokabeln",JSON.stringify(list));
  closeModal(); renderAll();
};
modal.addEventListener("click",e=>{if(e.target===modal)closeModal();});

/* ===== Anpassmodus-Toggle ===== */
function toggleAdjust(on){
  adjustMode = on;
  document.body.classList.toggle("adjusting", on);
  selectedIds.clear();
  renderAll();

  const bar = document.querySelector(".fabs");
  if(on){
    bar.innerHTML = `
      <button class="fab gray" id="fabEnd">Beenden</button>
      <button class="fab warn" id="fabDelete">L√∂schen</button>
      <button class="fab blue" id="fabNew">Neu</button>`;
    $("#fabEnd").onclick = ()=> toggleAdjust(false);
    $("#fabDelete").onclick = ()=> deleteSelected();
    $("#fabNew").onclick = ()=> openEdit(null);
  }else{
    bar.innerHTML = `
      <button class="fab gray" id="fabBack">Zur√ºck</button>
      <button class="fab blue" id="fabAdjust">Anpassen</button>
      <button class="fab gray" id="fabSync">Sync</button>`;
    $("#fabBack").onclick = ()=> location.href="index.html";
    $("#fabAdjust").onclick = ()=> toggleAdjust(true);
    $("#fabSync").onclick = ()=> githubSync();
  }
}

/* ===== L√∂schen markierter Eintr√§ge ===== */
function deleteSelected(){
  if(!selectedIds.size){ alert("Keine Auswahl."); return; }
  if(!confirm(`${selectedIds.size} Vokabel(n) l√∂schen?`)) return;
  list = list.filter(v=>!selectedIds.has(v[7]));
  localStorage.setItem("vokabeln",JSON.stringify(list));
  selectedIds.clear();
  renderAll();
}
/* ===== Filter & Reset ===== */
function fillFilterSelect(){
  const sel = $("#filterCatDesk");
  sel.innerHTML = `
    <option value="Alle">Alle (bunt gemischt)</option>
    ${Object.entries(CATEGORY_NAMES).map(([k,v]) =>
      `<option value="${k}" style="background:${COLOR_MAP[k]};color:${TEXT_ON[k]}">${v}</option>`).join("")}
    <option value="confuse" style="background:#ffe4e6;color:#b91c1c;">‚ö†Ô∏è Verwechslungsgefahr</option>
  `;
}
function resetFilters(){
  $("#filterCatDesk").value = "Alle";
  $("#searchDesk").value = "";
  currentPage = 1;
  renderAll();
}
$("#resetDesk").onclick = resetFilters;
["change","input"].forEach(evt=>{
  $("#filterCatDesk").addEventListener(evt,()=>{currentPage=1;renderAll();});
  $("#searchDesk").addEventListener(evt,()=>{currentPage=1;renderAll();});
});

/* ===== Sync Stub (Platzhalter f√ºr sp√§ter) ===== */
async function githubSync(){
  alert("Sync-Funktion ist derzeit deaktiviert (Placeholder).");
}

/* ===== Rendering-Helfer ===== */
function updateCount(){
  const data = filtered();
  const txt = `üìò ${data.length} Vokabel${data.length!==1?"n":""} gefunden`;
  $("#countDesk").textContent = txt;
}
function renderAll(){
  renderList();
  updateCount();
  renderPagination();
}

/* ===== Initialisierung ===== */
$("#addDesk").onclick = ()=> openEdit(null);
$("#delDesk").onclick = deleteSelected;
$("#syncDesk").onclick = githubSync;
$("#fabAdjust").onclick = ()=> toggleAdjust(true);
$("#fabBack").onclick = ()=> location.href="index.html";
$("#fabSync").onclick = githubSync;

/* ===== Start ===== */
fillFilterSelect();
loadData();

})(); // Ende Hauptfunktion
</script>
</body>
</html>

