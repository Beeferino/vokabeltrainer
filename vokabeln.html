<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ğŸ“˜ VokabelÃ¼bersicht</title>
  <style>
    body{font-family:sans-serif;background:#f7f9fb;margin:0;padding:20px;text-align:center;}
    .app{max-width:1100px;margin:auto;}
    h1{font-size:1.8rem;margin-bottom:.6rem;}
    table{width:100%;border-collapse:collapse;margin-top:15px;}
    th,td{padding:10px;border-bottom:1px solid #ddd;text-align:left;}
    th{background:#eef2f7;cursor:pointer;user-select:none;}
    th.sort-asc::after{content:" â†‘";color:#666;}
    th.sort-desc::after{content:" â†“";color:#666;}
    tr:hover{background:#f0f7ff;}
    .category-chip{display:inline-block;padding:5px 10px;border-radius:10px;color:#fff;}
    input,select,button{padding:8px 10px;font-size:1rem;border-radius:6px;border:1px solid #cfd6e4;margin:5px;}
    button{cursor:pointer;background:#2980b9;color:#fff;border:none;}
    button:hover{background:#3498db;}
    a.linkbtn{display:inline-block;padding:10px 16px;border-radius:8px;background:#74b9ff;color:#000;text-decoration:none;font-weight:600;}
    a.linkbtn:hover{background:#a6d4ff;}
    .info-footer{margin-top:16px;font-size:.95rem;color:#555;text-align:center;}
    .lexica{display:flex;flex-wrap:wrap;gap:6px;justify-content:center;margin:10px 0;}
    .lexica button{background:#ecf0f1;color:#333;border:1px solid #ccc;font-weight:600;padding:6px 9px;}
    .lexica button.active{background:#2980b9;color:#fff;}
    .filter-bar{margin-top:10px;display:flex;justify-content:center;gap:14px;flex-wrap:wrap;align-items:center;}
    .searchbox{min-width:260px;}
    .pagination{display:flex;justify-content:center;gap:8px;margin-top:10px;}
    .pagination button{background:#ecf0f1;color:#333;border:1px solid #ccc;padding:6px 10px;}
    .pagination button.active{background:#2980b9;color:#fff;}
    .toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:#2ecc71;color:#fff;padding:10px 16px;border-radius:8px;display:none;z-index:999;}
    .edit-btn{background:#f39c12;}
    .save-btn{background:#27ae60;}
    .save-btn:hover{background:#2ecc71;}
    .colored{transition:background .4s ease;}
    #datasourceStatus{font-size:.9rem;margin-top:10px;color:#555;}
    #reloadJson{background:#8e44ad;margin-top:5px;}
    #reloadJson:hover{background:#9b59b6;}
    .section{background:#fff;box-shadow:0 2px 6px rgba(0,0,0,0.05);border-radius:12px;padding:20px;margin-top:24px;text-align:left;}
    .section h2{margin-top:0;color:#2c3e50;border-bottom:2px solid #e3e7ef;padding-bottom:6px;font-size:1.2rem;}
    footer{margin-top:35px;padding-top:15px;border-top:2px solid #e3e7ef;color:#555;text-align:center;}
    .new-entry h3{background:#ecf0f1;padding:10px 15px;border-radius:8px;color:#2c3e50;display:inline-block;}
    footer button{margin:6px;}
    .recent-list{list-style:none;padding-left:0;margin-top:10px;}
    .recent-list li{background:#f7f9fb;border-left:4px solid #2980b9;margin:6px 0;padding:8px 10px;border-radius:6px;}
    .recent-list span{display:inline-block;font-weight:bold;color:#2c3e50;}
  </style>
</head>
<body>
  <div class="app">
    <h1>ğŸ“˜ VokabelÃ¼bersicht</h1>

    <div class="section">
      <h2>ğŸ”¤ Filter & Alphabet</h2>
      <div id="lexica" class="lexica"></div>
      <div class="filter-bar">
        <label>Kategorie:<select id="filterCategory" class="colored"><option value="Alle">Alle</option></select></label>
        <label>Gruppe:<select id="filterGroup"><option value="Alle">Alle</option></select></label>
        <input id="searchInput" class="searchbox" type="text" placeholder="ğŸ” Suche...">
        <button id="resetFilter">ğŸ”„ Reset</button>
      </div>
    </div>

    <div class="section">
      <h2>ğŸ“‹ Vokabeltabelle</h2>
      <table id="vocabTable">
        <thead>
          <tr><th></th><th data-key="en">Englisch</th><th data-key="de">Deutsch</th><th data-key="cat">Kategorie</th><th data-key="grp">Gruppe</th><th data-key="hint">Hinweis</th><th>Aktion</th></tr>
        </thead>
        <tbody></tbody>
      </table>
      <div id="pagination" class="pagination"></div>
      <div id="infoFooter" class="info-footer"></div>
    </div>

    <div class="section">
      <h2>ğŸ•’ Zuletzt hinzugefÃ¼gt</h2>
      <ul id="recentList" class="recent-list"></ul>
    </div>

    <div class="section">
      <h2>âš™ï¸ Verwaltung</h2>
      <div>
        <input id="newEnglish" placeholder="Englisch" disabled>
        <input id="newGerman" placeholder="Deutsch" disabled>
        <select id="newCategory" class="colored" disabled></select>
        <input id="newGroup" placeholder="Gruppe" disabled>
        <input id="newHint" placeholder="Hinweis" disabled>
        <button id="addBtn" disabled>â• HinzufÃ¼gen</button>
      </div>
      <div>
        <button id="toggleAdd">âœï¸ Eingabe aktivieren</button>
        <button id="deleteSelected">ğŸ—‘ï¸ LÃ¶schen</button>
      </div>
      <footer>
        <div>
          <button id="exportBtn">ğŸ“¤ Export</button>
          <input type="file" id="importFile" accept=".json" style="display:none;">
          <button id="importBtn">ğŸ“¥ Import</button>
        </div>
        <div style="margin-top:22px;">
          <a href="index.html" class="linkbtn">â¬…ï¸ ZurÃ¼ck</a>
        </div>
        <div id="datasourceStatus">ğŸ“‚ Datenquelle: wird geprÃ¼ft...</div>
        <button id="reloadJson">ğŸ”„ JSON aktualisieren</button>
      </footer>
    </div>
  </div>

  <div id="toast" class="toast"></div>

  <script>
  (() => {
    const CATEGORY_NAMES={Gelb:"Grundwerkzeuge Metallverarbeitung",Pink:"Werkzeugkasten Mechaniker",Blau:"Blech-/Kunststoffarbeiten",Gruen:"Drehen/FrÃ¤sen",Orange:"Elektrotechnik",Rot:"Verwechslungsgefahr"};
    const COLOR_MAP={Gelb:"#F4D03F",Pink:"#E91E63",Blau:"#1976D2",Gruen:"#1E8449",Orange:"#E67E22",Rot:"#C0392B"};
    const labelForCategory=k=>`${CATEGORY_NAMES[k]||k}`;
    const $=s=>document.querySelector(s),$$=s=>[...document.querySelectorAll(s)];
    const toast=m=>{const t=$("#toast");t.textContent=m;t.style.display="block";setTimeout(()=>t.style.display="none",2000);};
    const normalize=v=>[v[0]||"",v[1]||"",v[2]||"Gelb",v[3]||"",v[4]||"",v[5]||new Date().toISOString()];
    const loadLocal=()=>JSON.parse(localStorage.getItem("vokabeln")||"[]").map(normalize);
    const saveLocal=v=>{localStorage.setItem("vokabeln",JSON.stringify(v));localStorage.setItem("vokabeln_updated",new Date().toISOString());};

    // ğŸ§© JSON Sync mit Update-PrÃ¼fung
    async function trySyncFromJson(force=false){
      const status=$("#datasourceStatus");
      const urls=["./vokabeln.json","vokabeln.json",window.location.origin+"/vokabeltrainer/vokabeln.json"];
      let newestData=null,newestDate=0,usedUrl="";
      for(const url of urls){
        try{
          const r=await fetch(url,{cache:"no-store"});
          if(!r.ok)continue;
          const txt=await r.text();
          const data=JSON.parse(txt);
          if(!Array.isArray(data))continue;
          const remoteDate=new Date(r.headers.get("last-modified")||0).getTime();
          if(remoteDate>newestDate){newestDate=remoteDate;newestData=data;usedUrl=url;}
        }catch(e){continue;}
      }
      const localUpdate=new Date(localStorage.getItem("vokabeln_updated")||0).getTime();
      if(newestData&&newestDate>localUpdate&&!force){
        if(confirm("Eine neuere Vokabelliste ist verfÃ¼gbar. Jetzt laden?")){
          saveLocal(newestData.map(normalize));
          status.textContent="ğŸ“‚ Datenquelle: "+usedUrl;
          toast("ğŸ”„ Online-Version geladen");
        }else{
          status.textContent="ğŸ’¾ Lokale Version behalten";
        }
      }else if(force&&newestData){
        saveLocal(newestData.map(normalize));
        status.textContent="ğŸ“‚ Manuell aktualisiert";
        toast("âœ… JSON neu geladen");
      }else if(localStorage.getItem("vokabeln")){
        status.textContent="ğŸ’¾ Lokaler Speicher aktiv";
      }else{
        const def=[["hammer","Hammer","Pink","","","2025-10-26T12:00:00Z"]];
        saveLocal(def);
        status.textContent="âœ¨ Standardliste verwendet";
      }
    }

    let list=[];
    const perPage=15;let currentLetter="Alle",filterCat="Alle",filterGrp="Alle",searchTerm="",currentPage=1,sortKey="en",sortDir="asc";

    const setSelectColor=(s,v)=>{s.style.background=v&&v!=="Alle"?COLOR_MAP[v]:"#fff";s.style.color=v&&v!=="Alle"?"#fff":"#111";};

    function renderCategorySelect(sel){sel.innerHTML="";Object.keys(CATEGORY_NAMES).forEach(k=>{const o=document.createElement("option");o.value=k;o.textContent=labelForCategory(k);sel.appendChild(o);});setSelectColor(sel,sel.value);sel.onchange=()=>setSelectColor(sel,sel.value);}

    function renderRecent(){const ul=$("#recentList");const sorted=[...list].sort((a,b)=>new Date(b[5])-new Date(a[5]));const last5=sorted.slice(0,5);ul.innerHTML=last5.map(v=>`<li><span>${v[0]}</span> â†’ ${v[1]} <small style="color:#777;">(${new Date(v[5]).toLocaleString("de-DE")})</small></li>`).join("")||"<li><em>Keine EintrÃ¤ge</em></li>";}

    async function init(){
      await trySyncFromJson();
      list=loadLocal();
      renderCategorySelect($("#newCategory"));
      renderRecent();
      $("#reloadJson").onclick=async()=>{await trySyncFromJson(true);list=loadLocal();renderRecent();};
    }
    init();
  })();
  </script>
</body>
</html>
