<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>📘 Vokabelübersicht</title>
<style>
:root {
  --bg-light: #f7f9fb;
  --card-light: #ffffff;
  --text-light: #111;
  --border-light: #ddd;

  --bg-dark: #0f1116;
  --card-dark: #181b21;
  --text-dark: #e5e5e5;
  --border-dark: #2b2f36;

  --accent: #2980b9;
  --accent-hover: #3498db;
  --shadow-light: rgba(0,0,0,0.08);
  --shadow-dark: rgba(0,0,0,0.6);
}

/* Darkmode */
@media (prefers-color-scheme: dark) {
  body {
    background: var(--bg-dark);
    color: var(--text-dark);
  }
  .section {
    background: var(--card-dark);
    color: var(--text-dark);
    box-shadow: 0 2px 10px var(--shadow-dark);
  }
  th, td { border-color: var(--border-dark); }
  th { background: #1f232a; }
  tr:hover { background: #20242d; }
  button { background: var(--accent); color: #fff; }
  .category-chip { filter: brightness(1.1); }
} 

/* Lightmode */
@media (prefers-color-scheme: light) {
  body {
    background: var(--bg-light);
    color: var(--text-light);
  }
  .section {
    background: var(--card-light);
    color: var(--text-light);
    box-shadow: 0 2px 6px var(--shadow-light);
  }
  th, td { border-color: var(--border-light); }
  th { background: #eef3ff; }
  tr:hover { background: #f4f9ff; }
}

body {
  margin: 0;
  padding: 20px;
  font-family: "Segoe UI", Roboto, sans-serif;
  text-align: center;
}

.app {
  max-width: 1100px;
  margin: auto;
}

h1 { font-size: 1.8rem; margin-bottom: 1rem; }

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
  border-radius: 8px;
  overflow: hidden;
}

th, td {
  padding: 10px;
  text-align: left;
  transition: background 0.2s ease;
}

th {
  cursor: pointer;
  position: relative;
  user-select: none;
}

th.sort-asc::after { content: "▲"; position: absolute; right: 8px; color: var(--accent); }
th.sort-desc::after { content: "▼"; position: absolute; right: 8px; color: var(--accent); }

.category-chip {
  display: inline-block;
  padding: 5px 10px;
  border-radius: 10px;
  color: #fff;
  font-size: 0.9rem;
}

.section { border-radius: 14px; padding: 18px 20px; margin-bottom: 25px; }
.flex { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; justify-content: center; }

button, input, select {
  font-size: 1rem;
  border-radius: 6px;
  border: 1px solid #ccc;
  padding: 8px 10px;
}

button {
  background: var(--accent);
  color: #fff;
  cursor: pointer;
  transition: background 0.2s ease, transform 0.1s ease;
}

button:hover { background: var(--accent-hover); transform: translateY(-1px); }
.viewBtn { background: #8e44ad; } .viewBtn:hover { background: #9b59b6; }
.footer { text-align: center; margin-top: 20px; font-size: 0.95rem; opacity: 0.9; }

#modal {
  position: fixed; top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.5);
  display: none; align-items: center; justify-content: center;
  z-index: 1000;
}
#modalContent {
  background: var(--card-light);
  padding: 20px;
  border-radius: 12px;
  min-width: 280px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
}
@media (prefers-color-scheme: dark) {
  #modalContent { background: var(--card-dark); color: var(--text-dark); }
}

.toast {
  position: fixed; bottom: 20px; left: 50%;
  transform: translateX(-50%);
  background: #2ecc71; color: #fff;
  padding: 10px 16px; border-radius: 8px;
  display: none; z-index: 999;
}

/* Mobile */
@media (max-width: 768px) {
  body { padding: 10px; }
  table { font-size: 0.9rem; }
  th, td { padding: 6px; }
  button, input, select { font-size: 0.9rem; }
  .section { padding: 14px 10px; }
}
</style>
</head>
<body>
<div class="app">
<h1>📘 Vokabelübersicht</h1>

<div class="section">
  <h2>🔍 Filter & Suche</h2>
  <div class="flex">
    <label>Kategorie:
      <select id="filterCat"><option value="Alle">Alle (bunt gemischt)</option></select>
    </label>
    <input type="text" id="searchInput" placeholder="🔎 Suchen (EN / DE)">
    <button id="resetFilter">🔄 Filter zurücksetzen</button>
  </div>
</div>

<div class="section">
  <h2>📄 Vokabelliste</h2>
  <table id="vokabelTable">
    <thead>
      <tr>
        <th onclick="sortList(0)">Englisch</th>
        <th onclick="sortList(1)">Deutsch</th>
        <th onclick="sortList(2)">Kategorie</th>
        <th>Aktion</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <div id="pagination" class="flex" style="margin-top:10px;"></div>
  <div id="infoFooter"></div>
</div>

<div class="section">
  <h2>➕ Neue Vokabel hinzufügen</h2>
  <div class="flex">
    <input id="en" type="text" placeholder="Englisch">
    <input id="de" type="text" placeholder="Deutsch">
    <select id="cat"></select>
    <input id="group" type="text" placeholder="Gruppe / Variante">
    <input id="hint" type="text" placeholder="Hinweis">
    <button id="addBtn">Hinzufügen</button>
  </div>
</div>

<hr>

<div class="section">
  <h2>💾 Datei- & JSON-Verwaltung</h2>
  <div class="flex">
    <button id="exportBtn">📤 Exportieren</button>
    <button id="importBtn">📥 Importieren</button>
    <button id="downloadJson">💾 vokabeln.json herunterladen</button>
    <button id="syncBtn">🔄 JSON aktualisieren (merge)</button>
  </div>
</div>

<hr>

<div class="section">
  <h2>🧾 Zuletzt hinzugefügt</h2>
  <div id="lastAdded">Keine Vokabeln vorhanden.</div>
</div>

<div class="footer">
  <button onclick="location.href='index.html'">⬅️ Zurück zum Trainer</button>
  <p>© 2025 @Beefi</p>
</div>
</div>

<!-- 🔍 Modal -->
<div id="modal">
  <div id="modalContent">
    <h3>🔍 Vokabel-Details</h3>
    <input id="editEn" type="text" readonly><br><br>
    <input id="editDe" type="text" readonly><br><br>
    <select id="editCat" disabled></select><br><br>
    <input id="editGroup" type="text" readonly><br><br>
    <input id="editHint" type="text" readonly><br><br>
    <div class="flex">
      <button id="toggleEdit">🔧 Bearbeiten</button>
      <button id="cancelEdit">❌ Schließen</button>
    </div>
  </div>
</div>

<div id="toast" class="toast">Gespeichert</div>

<script>
(async()=>{
const CATEGORY_NAMES={
 "Gelb":"Grundwerkzeuge Metallverarbeitung",
 "Pink":"Werkzeugkasten Mechaniker",
 "Blau":"Blech- / Kunststoffarbeiten",
 "Gruen":"Drehen / Fräsen",
 "HellesPink":"Hydraulik / Pneumatik",
 "Orange":"Elektrotechnik",
 "Dunkelgruen":"Fluggerätemechanik allgemein",
 "Rot":"Verwechslungsgefahr"
};
const COLOR_MAP={
 "Gelb":"#F4D03F","Pink":"#E91E63","Blau":"#1976D2",
 "Gruen":"#1E8449","HellesPink":"#F54927","Orange":"#E67E22",
 "Dunkelgruen":"#117A65","Rot":"#C0392B"
};
let list=[];const perPage=15;let currentPage=1;let editIndex=null;
let sortColumn=0;let sortAsc=true;
const $=s=>document.querySelector(s);const $$=s=>document.querySelectorAll(s);

async function loadVokabeln(){
 let vokabeln=[];
 const local=localStorage.getItem("vokabeln");
 if(local){vokabeln=JSON.parse(local);}
 else{
   const r=await fetch("vokabeln.json",{cache:"no-store"});
   if(r.ok)vokabeln=await r.json();
 }
 return Array.isArray(vokabeln)?vokabeln:[];
}

function toast(msg,c="#2ecc71"){const t=$("#toast");t.textContent=msg;t.style.background=c;t.style.display="block";setTimeout(()=>t.style.display="none",1500);}
function saveLocal(){localStorage.setItem("vokabeln",JSON.stringify(list));localStorage.setItem("vokabeln_updated",new Date().toISOString());render(false);}

window.sortList=function(col){
 const ths=$$("th");ths.forEach(th=>th.classList.remove("sort-asc","sort-desc"));
 if(sortColumn===col){sortAsc=!sortAsc;}else{sortColumn=col;sortAsc=true;}
 const activeTh=ths[col];activeTh.classList.add(sortAsc?"sort-asc":"sort-desc");
 list.sort((a,b)=>a[col].localeCompare(b[col])* (sortAsc?1:-1));render(false);
};

function render(resetPage=true){
 const tb=$("#vokabelTable tbody");
 const search=$("#searchInput").value.toLowerCase();
 const cat=$("#filterCat").value;
 let filtered=list.filter(v=>{
   const matchCat=(cat==="Alle"||v[2]===cat);
   const matchSearch=(v[0].toLowerCase().includes(search)||v[1].toLowerCase().includes(search));
   return matchCat&&matchSearch;
 });
 const pages=Math.ceil(filtered.length/perPage)||1;
 if(resetPage)currentPage=1;
 const start=(currentPage-1)*perPage;
 const rows=filtered.slice(start,start+perPage);
 tb.innerHTML=rows.map((v,i)=>`<tr>
 <td>${v[0]}</td><td>${v[1]}</td>
 <td><span class="category-chip" style="background:${COLOR_MAP[v[2]]}">${CATEGORY_NAMES[v[2]]}</span></td>
 <td><button class="viewBtn" data-idx="${list.indexOf(v)}">🔍</button>
     <button class="delBtn" data-idx="${list.indexOf(v)}">🗑️</button></td></tr>`).join("");

 const pag=$("#pagination");pag.innerHTML="";
 for(let i=1;i<=pages;i++){const b=document.createElement("button");b.textContent=i;if(i===currentPage)b.style.background="#6ca0f8";b.onclick=()=>{currentPage=i;render(false);};pag.appendChild(b);}
 const upd=localStorage.getItem("vokabeln_updated");
 $("#infoFooter").textContent=`📅 Letzte Änderung: ${upd?new Date(upd).toLocaleString("de-DE"):"–"} | 📚 Gesamt: ${list.length} | 🔍 Gefiltert: ${filtered.length} | 📄 Seite ${currentPage}/${pages}`;
 renderLastAdded();
 $$(".viewBtn").forEach(b=>b.onclick=()=>openView(b.dataset.idx));
 $$(".delBtn").forEach(b=>b.onclick=()=>{if(confirm("Löschen?")){list.splice(b.dataset.idx,1);saveLocal();toast("🗑️ Gelöscht","#e74c3c");}});
}

function renderLastAdded(){
 const div=$("#lastAdded");
 if(!list.length){div.textContent="Keine Vokabeln vorhanden.";return;}
 const last=list.slice(-5).reverse();
 div.innerHTML=last.map(v=>`<div><b>${v[0]}</b> – ${v[1]} <span style="color:${COLOR_MAP[v[2]]}">(${CATEGORY_NAMES[v[2]]})</span></div>`).join("");
}

function openView(i){
 editIndex=i;const v=list[i];
 $("#editEn").value=v[0];$("#editDe").value=v[1];
 $("#editCat").value=v[2];$("#editGroup").value=v[3]||"";$("#editHint").value=v[4]||"";
 setReadonly(true);$("#toggleEdit").textContent="🔧 Bearbeiten";$("#modal").style.display="flex";
}

function setReadonly(s){["editEn","editDe","editGroup","editHint"].forEach(id=>$(`
#${id}`).readOnly=s);$("#editCat").disabled=s;}

$("#toggleEdit").onclick=()=>{if($("#toggleEdit").textContent.includes("Bearbeiten")){setReadonly(false);$("#toggleEdit").textContent="💾 Speichern";}else{const v=list[editIndex];v[0]=$("#editEn").value.trim();v[1]=$("#editDe").value.trim();v[2]=$("#editCat").value;v[3]=$("#editGroup").value.trim();v[4]=$("#editHint").value.trim();saveLocal();setReadonly(true);$("#toggleEdit").textContent="🔧 Bearbeiten";toast("💾 Gespeichert");}};
$("#cancelEdit").onclick=()=>$("#modal").style.display="none";
$("#addBtn").onclick=()=>{const en=$("#en").value.trim(),de=$("#de").value.trim(),cat=$("#cat").value,grp=$("#group").value.trim(),hint=$("#hint").value.trim();if(!en||!de)return alert("Bitte ausfüllen!");list.push([en,de,cat,grp,hint]);saveLocal();$("#en").value=$("#de").value=$("#group").value=$("#hint").value="";toast("➕ Hinzugefügt");};
$("#resetFilter").onclick=()=>{$("#filterCat").value="Alle";$("#searchInput").value="";render();};
$("#filterCat").onchange=()=>render(false);$("#searchInput").oninput=()=>render(false);

list=await loadVokabeln();
list.sort((a,b)=>a[0].localeCompare(b[0]));
const filterCat=$("#filterCat");
for(const k in CATEGORY_NAMES){const o=document.createElement("option");o.value=k;o.textContent=CATEGORY_NAMES[k];o.style.background=COLOR_MAP[k];o.style.color="#fff";filterCat.appendChild(o);}
function fillCats(sel){sel.innerHTML="";for(const k in CATEGORY_NAMES){const o=document.createElement("option");o.value=k;o.textContent=CATEGORY_NAMES[k];o.style.background=COLOR_MAP[k];o.style.color="#fff";sel.appendChild(o);}}
fillCats($("#cat"));fillCats($("#editCat"));
render();
})();
</script>
</body>
</html>
