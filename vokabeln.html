<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Vokabeln ‚Äì Beeferino</title>
<style>
:root{
  --blue:#2563eb;--ok:#22c55e;--bad:#ef4444;--muted:#9ca3af;
  --glass:rgba(255,255,255,0.85)
}
body{
  font-family:Inter,system-ui,sans-serif;
  background:linear-gradient(145deg,#eef4ff,#dbeafe);
  margin:0;padding:20px;color:#111;
}
.app{
  max-width:960px;margin:0 auto;
  background:var(--glass);padding:22px;
  border-radius:22px;box-shadow:0 10px 32px rgba(0,0,0,.1);
  backdrop-filter:blur(8px)
}
h1{text-align:center;color:#1e3a8a;font-weight:800;margin:0}
.hr{width:160px;height:4px;background:var(--blue);border-radius:4px;margin:10px auto 20px}

.topbar{
  display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px
}
button{
  border:none;padding:10px 16px;border-radius:12px;cursor:pointer;
  font-weight:700;font-size:1rem;transition:all .2s ease;
}
.addBtn{
  background:linear-gradient(90deg,#22c55e,#16a34a);
  color:#fff;animation:pulse 2s infinite alternate;
}
@keyframes pulse{from{box-shadow:0 0 0 rgba(34,197,94,0)}to{box-shadow:0 0 12px rgba(34,197,94,.5)}}
.syncBtn{
  background:linear-gradient(90deg,#3b82f6,#2563eb);color:#fff
}
.syncBtn:hover{transform:scale(1.02)}
input,select{
  padding:8px 12px;border:1px solid #ccc;border-radius:10px;font-size:1rem
}

table{
  width:100%;border-collapse:collapse;margin-top:14px;
}
th,td{
  text-align:left;padding:8px 10px;border-bottom:1px solid #eee;
}
th{background:#f1f5f9;}
.categoryTag{
  font-weight:700;padding:6px 12px;border-radius:12px;color:#fff;display:inline-block
}

.actions button{
  padding:6px 10px;font-size:.9rem;margin-right:6px
}

footer{
  text-align:center;margin-top:22px;color:#6b7280;font-size:.9rem
}

/* Pop-up */
#popupOverlay{
  position:fixed;top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,.4);display:none;align-items:center;justify-content:center;z-index:999
}
#popup{
  background:#fff;border-radius:18px;padding:22px;max-width:420px;width:90%;
  box-shadow:0 10px 28px rgba(0,0,0,.3);text-align:center;
}
#popup h2{margin-top:0;color:#1e3a8a}
#popup input,#popup select{
  width:100%;margin:6px 0;padding:10px;border-radius:10px;border:1px solid #ccc;font-size:1rem
}
.popupBtns{display:flex;justify-content:space-between;margin-top:14px}
.popupBtns button{flex:1;margin:0 4px}

</style>
</head>
<body>
<div class="app">
  <h1>üìö Vokabelverwaltung</h1>
  <div class="hr"></div>

  <div class="topbar">
    <div>
      üî† Sortierung:
      <select id="sortMode" onchange="sortVokabeln()">
        <option value="az">A ‚Üí Z</option>
        <option value="za">Z ‚Üí A</option>
      </select>
    </div>
    <input id="search" placeholder="üîç Suche oder Filter ‚Ä¶" oninput="searchVokabeln()">
    <button class="addBtn" onclick="openPopup()">+ Neue Vokabel</button>
  </div>

  <table id="vokabelTable">
    <thead>
      <tr><th><input type="checkbox" id="checkAll" onchange="toggleAll(this)"></th><th>Englisch</th><th>Deutsch</th><th>Kategorie</th><th>Aktionen</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <div style="margin-top:10px;text-align:right">
    <button onclick="deleteSelected()" style="background:var(--bad);color:#fff">üóëÔ∏è Mehrfach l√∂schen</button>
  </div>

  <div style="text-align:center;margin-top:18px">
    <button id="btnSync" class="syncBtn" onclick="uploadJSON()">üì§ In Datenbank eintragen</button>
  </div>

  <footer>¬© 2025 Beeferino ‚Ä¢ Datenquelle: GitHub (Online)</footer>
</div>

<!-- Pop-up f√ºr neue Vokabel -->
<div id="popupOverlay">
  <div id="popup">
    <h2>‚ûï Neue Vokabel</h2>
    <input id="enInput" placeholder="Englisch">
    <input id="deInput" placeholder="Deutsch">
    <select id="catInput">
      <option value="Grundwerkzeuge Metallverarbeitung">Grundwerkzeuge Metallverarbeitung</option>
      <option value="Werkzeugkasten Mechaniker">Werkzeugkasten Mechaniker</option>
      <option value="Blech- / Kunststoffarbeiten">Blech- / Kunststoffarbeiten</option>
      <option value="Drehen / Fr√§sen">Drehen / Fr√§sen</option>
      <option value="Hydraulik / Pneumatik">Hydraulik / Pneumatik</option>
      <option value="Elektrotechnik">Elektrotechnik</option>
      <option value="Flugger√§temechanik allgemein">Flugger√§temechanik allgemein</option>
      <option value="Verwechslungsgefahr">Verwechslungsgefahr</option>
    </select>
    <div class="popupBtns">
      <button onclick="saveVokabel()" style="background:var(--ok);color:#fff">Speichern</button>
      <button onclick="closePopup()" style="background:var(--muted);color:#fff">Abbrechen</button>
    </div>
  </div>
</div>

<script>
const CATS={
  "Grundwerkzeuge Metallverarbeitung":"#F4D03F",
  "Werkzeugkasten Mechaniker":"#E91E63",
  "Blech- / Kunststoffarbeiten":"#1976D2",
  "Drehen / Fr√§sen":"#1E8449",
  "Hydraulik / Pneumatik":"#F54927",
  "Elektrotechnik":"#E67E22",
  "Flugger√§temechanik allgemein":"#117A65",
  "Verwechslungsgefahr":"#C0392B"
};
let vokabeln=[];

// Daten laden
(async function(){
  try{
    const r=await fetch("https://beeferino.github.io/vokabeltrainer/vokabeln.json",{cache:"no-store"});
    vokabeln=await r.json();
    localStorage.setItem("vokabeln",JSON.stringify(vokabeln));
  }catch{
    vokabeln=JSON.parse(localStorage.getItem("vokabeln")||"[]");
  }
  renderTable();
})();

// Render
function renderTable(list=vokabeln){
  const tb=document.querySelector("#vokabelTable tbody");
  tb.innerHTML=list.map((v,i)=>{
    const c=CATS[v[2]]||"#ccc";
    return `<tr>
      <td><input type="checkbox" class="rowChk" data-idx="${i}"></td>
      <td>${v[0]}</td>
      <td>${v[1]}</td>
      <td><span class="categoryTag" style="background:${c}">${v[2]}</span></td>
      <td class="actions">
        <button onclick="editVokabel(${i})">‚úèÔ∏è</button>
        <button onclick="deleteVokabel(${i})" style="background:var(--bad);color:#fff">üóëÔ∏è</button>
      </td>
    </tr>`;
  }).join("");
}

function sortVokabeln(){
  const m=document.getElementById("sortMode").value;
  vokabeln.sort((a,b)=>m==="az"?a[0].localeCompare(b[0]):b[0].localeCompare(a[0]));
  localStorage.setItem("vokabeln",JSON.stringify(vokabeln));
  renderTable();
}
function searchVokabeln(){
  const s=document.getElementById("search").value.toLowerCase();
  const f=vokabeln.filter(v=>v[0].toLowerCase().includes(s)||v[1].toLowerCase().includes(s)||v[2].toLowerCase().includes(s));
  renderTable(f);
}
function toggleAll(cb){
  document.querySelectorAll(".rowChk").forEach(x=>x.checked=cb.checked);
}
function deleteSelected(){
  const ids=[...document.querySelectorAll(".rowChk:checked")].map(x=>+x.dataset.idx);
  if(!ids.length)return alert("Keine Auswahl");
  if(!confirm("Sicher l√∂schen?"))return;
  vokabeln=vokabeln.filter((_,i)=>!ids.includes(i));
  localStorage.setItem("vokabeln",JSON.stringify(vokabeln));
  renderTable();autoSync();
}
function deleteVokabel(i){
  if(confirm("Wirklich l√∂schen?")){
    vokabeln.splice(i,1);
    localStorage.setItem("vokabeln",JSON.stringify(vokabeln));
    renderTable();autoSync();
  }
}
function editVokabel(i){
  const v=vokabeln[i];
  openPopup(v,i);
}
function openPopup(v=null,i=null){
  document.getElementById("popupOverlay").style.display="flex";
  document.getElementById("enInput").value=v?v[0]:"";
  document.getElementById("deInput").value=v?v[1]:"";
  document.getElementById("catInput").value=v?v[2]:"Grundwerkzeuge Metallverarbeitung";
  document.getElementById("popup").dataset.edit=i;
}
function closePopup(){
  document.getElementById("popupOverlay").style.display="none";
  document.getElementById("popup").dataset.edit="";
}
function saveVokabel(){
  const en=enInput.value.trim(),de=deInput.value.trim(),cat=catInput.value;
  if(!en||!de)return alert("Beide Felder ausf√ºllen");
  const i=document.getElementById("popup").dataset.edit;
  if(i) vokabeln[i]=[en,de,cat]; else vokabeln.push([en,de,cat]);
  localStorage.setItem("vokabeln",JSON.stringify(vokabeln));
  closePopup();renderTable();autoSync();
}

// --- GitHub Sync ---
async function uploadJSON(auto=false){
  try{
    const content=JSON.stringify(vokabeln,null,2);
    const btn=document.getElementById("btnSync");
    if(btn && !auto){btn.textContent="üîÑ Synchronisiere...";btn.disabled=true;}
    const r=await fetch("https://api.github.com/repos/beeferino/vokabeltrainer/dispatches",{
      method:"POST",
      headers:{
        "Accept":"application/vnd.github.everest-preview+json",
        "Content-Type":"application/json",
        "Authorization":"Bearer ghp_dummy_placeholder"
      },
      body:JSON.stringify({event_type:"update_vokabeln",client_payload:{content}})
    });
    if(r.ok){
      console.log("‚úÖ Sync erfolgreich gestartet");
      if(btn && !auto){btn.textContent="‚úÖ In Datenbank eingetragen";setTimeout(()=>{btn.textContent="üì§ In Datenbank eintragen";btn.disabled=false;},2000);}
    }else throw new Error(r.status);
  }catch(e){console.error(e);if(!auto)alert("Fehler beim Synchronisieren");}
}
function autoSync(){uploadJSON(true);}
</script>
</body>
</html>
