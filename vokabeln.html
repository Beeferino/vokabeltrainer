<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>üìò Vokabel√ºbersicht ‚Äì Beeferino</title>
<style>
:root{
  --accent:#3b82f6;--accent2:#1d4ed8;--ok:#22c55e;--bad:#ef4444;--dark:#1e293b;
}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,system-ui,sans-serif;background:linear-gradient(135deg,#e0e7ff,#f8fafc);color:var(--dark)}
.app{max-width:1100px;margin:32px auto 120px;padding:24px;background:rgba(255,255,255,.95);border-radius:22px;box-shadow:0 10px 25px rgba(0,0,0,.1)}
h1{margin:0 0 6px;text-align:center;color:var(--accent)}
hr{border:none;border-top:2px solid #e5e7eb;margin:16px 0}
.flex{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
input,select,button{padding:10px 14px;border-radius:12px;border:1px solid #d1d5db;font-size:1rem}
button{background:var(--accent);color:#fff;font-weight:700;cursor:pointer;transition:.15s}
button:hover{background:var(--accent2)}
/* Lexikon */
#lexikon{display:grid;grid-template-columns:repeat(auto-fit,minmax(38px,1fr));gap:8px;margin:16px 0}
#lexikon button{background:#e2e8f0;border:none;border-radius:10px;padding:8px 0;font-weight:600}
#lexikon button.active{background:var(--accent);color:#fff;transform:scale(1.05)}
/* Grid-Kacheln */
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px}
.card{
  position:relative;background:#fff;border-radius:16px;padding:14px 14px 12px;
  box-shadow:0 6px 16px rgba(0,0,0,.08);transition:transform .15s, box-shadow .15s;border:3px solid #e5e7eb;
}
.card:hover{transform:translateY(-2px);box-shadow:0 10px 22px rgba(0,0,0,.12)}
.card .check{position:absolute;top:10px;left:10px;transform:scale(1.2)}
.badge{
  position:absolute;top:10px;right:10px;border-radius:999px;padding:5px 10px;
  font-size:.8rem;font-weight:700;box-shadow:0 1px 4px rgba(0,0,0,.12);background:#eef2ff;color:#1e293b
}
.word{font-size:1.15rem;font-weight:800;margin:10px 0 4px}
.trans{font-size:1rem;color:#334155;margin:0 0 10px}
.actions{display:flex;gap:8px;justify-content:flex-end;margin-top:8px}
.actions button{border-radius:10px;padding:8px 10px}
.actions .edit{background:#10b981} .actions .edit:hover{background:#0ea371}
.actions .del{background:#ef4444} .actions .del:hover{background:#d83737}
/* Floating Buttons */
#settingsBtn{position:fixed;right:22px;bottom:98px;background:#64748b;border:none;color:#fff;width:48px;height:48px;border-radius:50%;font-size:1.3rem;box-shadow:0 6px 14px rgba(0,0,0,.18);z-index:1000}
/* Bottom Bar */
.bottom-bar{
  position:fixed;left:0;right:0;bottom:0;z-index:999;
  background:rgba(255,255,255,.9);backdrop-filter:blur(6px);border-top:1px solid #e5e7eb;
  display:flex;align-items:center;justify-content:space-between;gap:10px;padding:12px 16px;
}
.bottom-left,.bottom-center,.bottom-right{display:flex;align-items:center;gap:10px}
#bulkDelete{display:none;background:var(--bad)}
/* Toast / Modals */
.toast{position:fixed;bottom:62px;right:22px;background:var(--ok);color:#fff;padding:12px 18px;border-radius:12px;opacity:0;transition:opacity .3s;z-index:1001}
.toast.show{opacity:1}
.modal, .settingsModal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.45);backdrop-filter:blur(6px);z-index:1002;align-items:center;justify-content:center}
.modal-box{background:#fff;padding:28px;border-radius:18px;width:95%;max-width:620px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
.modal-box h3{margin:0 0 12px;text-align:center;color:var(--accent)}
.modal-box input,.modal-box select{width:100%;margin:.35rem 0}
.modal-box .row{display:flex;gap:10px;justify-content:space-between;flex-wrap:wrap}
</style>
</head>
<body>
<div class="app">
  <h1>üìò Vokabel√ºbersicht</h1>
  <hr>
  <div class="flex">
    <label>Sortierung:
      <select id="sortABC">
        <option value="en">A‚ÄìZ Englisch</option>
        <option value="de">A‚ÄìZ Deutsch</option>
        <option value="cat">Nach Kategorie</option>
      </select>
    </label>
    <label>Kategorie:
      <select id="filterCat"><option value="Alle">Alle</option></select>
    </label>
    <input id="searchInput" type="text" placeholder="üîé Suchen ‚Ä¶">
    <button id="resetFilter">üîÑ Reset</button>
  </div>

  <div id="lexikon"></div>

  <div id="cards" class="grid"></div>
</div>

<!-- Bottom Bar -->
<div class="bottom-bar">
  <div class="bottom-left">
    <button id="backBtn" style="background:#e2e8f0;color:#111827;border:1px solid #cbd5e1">‚¨ÖÔ∏è Zur√ºck zum Trainer</button>
  </div>
  <div class="bottom-center">
    <button id="bulkDelete">üóëÔ∏è Auswahl l√∂schen (<span id="selCount">0</span>)</button>
  </div>
  <div class="bottom-right">
    <button id="syncNow" style="background:var(--accent2)">üîÑ Jetzt synchronisieren</button>
  </div>
</div>

<button id="settingsBtn" title="Einstellungen">‚öôÔ∏è</button>

<!-- Modal: Einstellungen -->
<div id="settingsModal" class="settingsModal">
  <div class="modal-box">
    <h3>‚öôÔ∏è Einstellungen</h3>
    <p style="text-align:center;margin-top:-6px;color:#475569">GitHub-Token (ghp_‚Ä¶ oder github_pat_‚Ä¶) ‚Äì wird nur lokal gespeichert.</p>
    <input id="tokenInput" type="password" placeholder="github_pat_...">
    <div class="row">
      <button id="saveTokenBtn">üíæ Speichern</button>
      <button id="clearTokenBtn" style="background:var(--bad)">‚ùå L√∂schen</button>
      <button id="closeSettings">Abbrechen</button>
    </div>
  </div>
</div>

<!-- Modal: Neu/Bearbeiten -->
<div id="modal" class="modal">
  <div class="modal-box">
    <h3 id="modalTitle">‚ûï Neue Vokabel</h3>
    <input id="newEn" type="text" placeholder="Englisch">
    <input id="newDe" type="text" placeholder="Deutsch">
    <select id="newCat"></select>
    <input id="newGroup" type="text" placeholder="Gruppe / Variante">
    <input id="newHint" type="text" placeholder="Hinweis">
    <div class="row">
      <button id="saveVocab">Speichern</button>
      <button id="deleteVocab" style="background:var(--bad)">L√∂schen</button>
      <button id="cancelModal">Abbrechen</button>
    </div>
  </div>
</div>

<div id="toast" class="toast">Gespeichert</div>

<script>
(async()=>{
const $=id=>document.getElementById(id);
const cards=$("cards"), lex=$("lexikon"), toast=$("toast");
const search=$("searchInput"), sortSel=$("sortABC"), catSel=$("filterCat"), resetBtn=$("resetFilter");
const modal=$("modal"), modalTitle=$("modalTitle"), saveBtn=$("saveVocab"), delBtn=$("deleteVocab"), cancelBtn=$("cancelModal");
const enIn=$("newEn"), deIn=$("newDe"), catIn=$("newCat"), grpIn=$("newGroup"), hintIn=$("newHint");
const settingsBtn=$("settingsBtn"), settingsModal=$("settingsModal"), tokenIn=$("tokenInput"), saveTok=$("saveTokenBtn"), clearTok=$("clearTokenBtn"), closeSettings=$("closeSettings");
const syncNow=$("syncNow"), backBtn=$("backBtn"), bulkDelete=$("bulkDelete"), selCount=$("selCount");

let data=[];          // [{_id,en,de,cat,group,hint}]
let editId=null;      // _id der aktuell zu bearbeitenden Karte
let selected=new Set(); // _id ausgew√§hlter Karten

const GITHUB_REPO="beeferino/vokabeltrainer";
const FILE_PATH="vokabeln.json";

const CATS={
  Gelb:["Grundwerkzeuge Metallverarbeitung","#F4D03F","#000"],
  Pink:["Werkzeugkasten Mechaniker","#E91E63","#fff"],
  Blau:["Blech- / Kunststoffarbeiten","#1976D2","#fff"],
  Gruen:["Drehen / Fr√§sen","#1E8449","#fff"],
  HellesPink:["Hydraulik / Pneumatik","#F54927","#fff"],
  Orange:["Elektrotechnik","#E67E22","#fff"],
  Dunkelgruen:["Flugger√§temechanik allgemein","#117A65","#fff"],
  Rot:["Verwechslungsgefahr","#C0392B","#fff"]
};

/* Kategorie-Selects f√ºllen */
for(const k in CATS){
  const o=document.createElement("option");
  o.value=k;o.textContent=CATS[k][0];o.style.background=CATS[k][1];o.style.color=CATS[k][2];
  catIn.appendChild(o); catSel.appendChild(o.cloneNode(true));
}

/* Lexikon A‚ÄìZ */
const LETTERS="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
lex.innerHTML='<button class="active" data-letter="Alle">Alle</button>'+LETTERS.map(l=>`<button data-letter="${l}">${l}</button>`).join("");
lex.querySelectorAll("button").forEach(btn=>{
  btn.onclick=()=>{lex.querySelectorAll("button").forEach(b=>b.classList.remove("active"));btn.classList.add("active");render();};
});

/* Laden */
async function loadData(){
  try{
    const r=await fetch(`https://beeferino.github.io/vokabeltrainer/${FILE_PATH}`,{cache:"no-store"});
    const arr=await r.json(); // array-of-arrays
    data=arr.map(x=>({_id:crypto.randomUUID(),en:x[0],de:x[1],cat:x[2],group:x[3]||"",hint:x[4]||""}));
  }catch{
    const arr=JSON.parse(localStorage.getItem("vokabeln")||"[]");
    data=arr.map(x=>Array.isArray(x)?({_id:crypto.randomUUID(),en:x[0],de:x[1],cat:x[2],group:x[3]||"",hint:x[4]||""}):x);
  }
  persistLocal();
  render();
}

/* Speichern lokal */
function persistLocal(){
  const arr=data.map(v=>[v.en,v.de,v.cat,v.group||"",v.hint||""]);
  localStorage.setItem("vokabeln",JSON.stringify(arr));
}

/* Render Cards */
function render(){
  const s=search.value.toLowerCase();
  const cat=catSel.value;
  const letter=lex.querySelector("button.active").dataset.letter;

  let view=data.filter(v=>{
    const en=v.en.toLowerCase(), de=v.de.toLowerCase();
    const byCat=(cat==="Alle"||v.cat===cat);
    const bySearch=(en.includes(s)||de.includes(s));
    const byLetter=(letter==="Alle"||en.startsWith(letter.toLowerCase()));
    return byCat&&bySearch&&byLetter;
  });

  if(sortSel.value==="en") view.sort((a,b)=>a.en.localeCompare(b.en));
  if(sortSel.value==="de") view.sort((a,b)=>a.de.localeCompare(b.de));
  if(sortSel.value==="cat") view.sort((a,b)=>a.cat.localeCompare(b.cat));

  cards.innerHTML=view.map(v=>{
    const c=CATS[v.cat]||["","#e5e7eb","#000"];
    const checked=selected.has(v._id)?"checked":"";
    return `<div class="card" style="border-color:${c[1]}">
      <input class="check" type="checkbox" ${checked} onchange="toggleSel('${v._id}')">
      <span class="badge" style="background:${c[1]}20;color:${c[2]}">${c[0]}</span>
      <div class="word">${v.en}</div>
      <div class="trans">${v.de}</div>
      ${v.group?`<div style="font-size:.85rem;color:#64748b;margin-top:-4px">Gruppe: ${v.group}</div>`:""}
      ${v.hint?`<div style="font-size:.85rem;color:#64748b;margin-top:2px">Hinweis: ${v.hint}</div>`:""}
      <div class="actions">
        <button class="edit" onclick="editCard('${v._id}')">‚úèÔ∏è Bearbeiten</button>
        <button class="del" onclick="delCard('${v._id}')">üóëÔ∏è L√∂schen</button>
      </div>
    </div>`;
  }).join("");

  // Bulk-Button ein/aus
  const count=selected.size;
  selCount.textContent=String(count);
  bulkDelete.style.display = count>0 ? "inline-flex" : "none";
}

/* Auswahl togglen (global gemacht) */
window.toggleSel=(id)=>{ selected.has(id)?selected.delete(id):selected.add(id); render(); };

/* Einzel-Operationen */
window.delCard=(id)=>{ const i=data.findIndex(v=>v._id===id); if(i>-1){data.splice(i,1); persistLocal(); render();}};
window.editCard=(id)=>{ editId=id; const v=data.find(x=>x._id===id);
  if(!v) return; modalTitle.textContent="‚úèÔ∏è Vokabel bearbeiten";
  enIn.value=v.en; deIn.value=v.de; catIn.value=v.cat; grpIn.value=v.group||""; hintIn.value=v.hint||"";
  modal.style.display="flex";
};

/* Bulk Delete */
bulkDelete.onclick=()=>{
  if(selected.size===0) return;
  if(!confirm(`Auswahl wirklich l√∂schen? (${selected.size} Eintr√§ge)`)) return;
  data=data.filter(v=>!selected.has(v._id));
  selected.clear(); persistLocal(); render();
};

/* Neu / Speichern / L√∂schen im Modal */
$("backBtn").onclick=()=>{location.href='index.html';};
$("newVocabBtn")?.addEventListener?.("click",()=>{editId=null; modalTitle.textContent="‚ûï Neue Vokabel"; enIn.value=deIn.value=grpIn.value=hintIn.value=""; modal.style.display="flex";});
$("cancelModal").onclick=()=>modal.style.display="none";
saveBtn.onclick=()=>{
  if(!enIn.value||!deIn.value||!catIn.value) return;
  const obj={_id:editId??crypto.randomUUID(), en:enIn.value.trim(), de:deIn.value.trim(), cat:catIn.value, group:grpIn.value||"", hint:hintIn.value||""};
  const i=data.findIndex(v=>v._id===editId);
  if(i>-1) data[i]=obj; else data.push(obj);
  modal.style.display="none"; persistLocal(); render();
};
delBtn.onclick=()=>{
  if(!editId) return;
  const i=data.findIndex(v=>v._id===editId);
  if(i>-1) data.splice(i,1);
  modal.style.display="none"; persistLocal(); render();
};

/* Filter-Events */
search.oninput=render; sortSel.onchange=render; catSel.onchange=render;
resetBtn.onclick=()=>{ search.value=""; catSel.value="Alle"; lex.querySelectorAll("button").forEach(b=>b.classList.remove("active")); lex.querySelector("[data-letter='Alle']").classList.add("active"); render(); };

/* Settings */
settingsBtn.onclick=()=>{ tokenIn.value=localStorage.getItem("GH_TOKEN")||""; settingsModal.style.display="flex"; };
closeSettings.onclick=()=>settingsModal.style.display="none";
saveTok.onclick=()=>{ const v=(tokenIn.value||"").trim(); if(!v.startsWith("ghp_") && !v.startsWith("github_pat_")){alert("‚ùå Ung√ºltiger Token ‚Äì ghp_ oder github_pat_.");return;} localStorage.setItem("GH_TOKEN",v); settingsModal.style.display="none"; showToast("‚úÖ Token gespeichert"); };
clearTok.onclick=()=>{ localStorage.removeItem("GH_TOKEN"); settingsModal.style.display="none"; showToast("üóëÔ∏è Token gel√∂scht"); };

/* Manuell syncen */
syncNow.onclick=()=>pushToGitHub();

/* GitHub Sync */
async function pushToGitHub(){
  const token=localStorage.getItem("GH_TOKEN");
  if(!token){alert("‚ö†Ô∏è Kein GitHub-Token gesetzt (‚öôÔ∏è).");return;}
  const url=`https://api.github.com/repos/${GITHUB_REPO}/contents/${FILE_PATH}`;
  const content=btoa(unescape(encodeURIComponent(JSON.stringify(
    data.map(v=>[v.en,v.de,v.cat,v.group||"",v.hint||""]), null, 2
  ))));
  try{
    const current=await fetch(url,{headers:{Authorization:`Bearer ${token}`,Accept:"application/vnd.github+json","User-Agent":"Beeferino-VokabelApp"}}).then(r=>r.json());
    const res=await fetch(url,{
      method:"PUT",
      headers:{Authorization:`Bearer ${token}`,Accept:"application/vnd.github+json","Content-Type":"application/json","User-Agent":"Beeferino-VokabelApp"},
      body:JSON.stringify({message:"Manuelle Synchronisierung (Cards UI)",content,sha:current.sha||null})
    });
    const out=await res.json();
    if(!res.ok){console.error("‚ùå GitHub-Fehler",res.status,out);showToast("‚ùå GitHub Sync fehlgeschlagen");return;}
    console.log("‚úÖ Commit:",out.commit?.sha); showToast("‚úÖ GitHub synchronisiert!");
  }catch(e){console.error("‚ùå Sync-Ausnahme:",e);showToast("‚ùå GitHub Sync fehlgeschlagen");}
}

/* Toast helper */
function showToast(msg){ toast.textContent=msg; toast.classList.add("show"); setTimeout(()=>toast.classList.remove("show"),1600); }

/* Start */
await loadData();
})();
</script>
</body>
</html>
