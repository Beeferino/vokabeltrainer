<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>üìò Vokabel√ºbersicht</title>

<style>
  :root{
    --ink:#222; --muted:#555; --soft:#eef2f7; --soft2:#e5ebf3;
    --btn:#2980b9; --btn2:#3498db; --ok:#27ae60; --warn:#f39c12; --danger:#e74c3c;
  }
  body{font-family:system-ui,sans-serif;background:#f7f9fb;margin:0;padding:20px;text-align:center;color:var(--ink);}
  .app{max-width:1100px;margin:auto;background:#fff;border-radius:14px;box-shadow:0 2px 10px rgba(0,0,0,.08);padding:20px;}
  h1{font-size:1.8rem;margin-bottom:10px;}
  h2{font-size:1.25rem;color:#1e6ed8;margin:14px 0 8px;}
  .flex{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;align-items:center}
  input,select,button{padding:8px 10px;font-size:1rem;border-radius:8px;border:1px solid #cfd6e4;margin:4px}
  button{cursor:pointer;background:var(--btn);color:#fff;border:none;transition:.2s}
  button:hover{background:var(--btn2)}
  .btn-plain{background:#ecf0f1;color:#333;border:1px solid #ccc}
  .btn-ok{background:var(--ok)}
  .btn-danger{background:var(--danger)}
  .searchbox{min-width:240px}
  table{width:100%;border-collapse:collapse;margin-top:10px}
  th,td{padding:10px;border-bottom:1px solid #e0e6ef;text-align:left}
  th{background:#eef4ff;cursor:pointer;user-select:none}
  tr:hover{background:#f4f9ff}
  .category-chip{display:inline-block;padding:4px 10px;border-radius:10px;color:#fff}
  .lexica{display:flex;flex-wrap:wrap;gap:6px;justify-content:center;margin:10px 0}
  .lexica button{background:#ecf0f1;color:#333;border:1px solid #ccc;font-weight:600;padding:6px 9px}
  .lexica button.active{background:#2980b9;color:#fff}
  .pagination{display:flex;justify-content:center;gap:8px;margin-top:10px}
  .pagination button.active{background:#2980b9;color:#fff}
  .divider{margin:22px 0;border-top:3px solid var(--soft2)}
  .fab{position:fixed;right:18px;bottom:82px;background:#22c55e;color:#fff;border:none;border-radius:999px;width:56px;height:56px;font-size:28px;line-height:56px;box-shadow:0 8px 22px rgba(0,0,0,.2);cursor:pointer;animation:pulse 2.2s infinite}
  @keyframes pulse{0%{box-shadow:0 0 0 0 rgba(34,197,94,.5)}70%{box-shadow:0 0 0 16px rgba(34,197,94,0)}100%{box-shadow:0 0 0 0 rgba(34,197,94,0)}}
  .toast{position:fixed;bottom:22px;left:50%;transform:translateX(-50%);background:#2ecc71;color:#fff;padding:10px 16px;border-radius:8px;display:none;z-index:999}
  #syncOverlay{position:fixed;right:12px;bottom:12px;background:#1e6ed8;color:#fff;border-radius:10px;padding:10px 14px;box-shadow:0 4px 14px rgba(0,0,0,.2);display:none;z-index:999}
  #recent{margin-top:12px;display:flex;flex-wrap:wrap;justify-content:center;gap:12px}
  .recent-item{display:inline-block;min-width:160px;border-radius:14px;padding:12px 18px;font-weight:700;color:#111827;box-shadow:0 4px 12px rgba(0,0,0,.1)}
  .recent-item small{display:block;font-weight:500;font-size:.85rem;margin-top:4px;opacity:.85}
  .footer-nav{margin-top:18px}
  .linkbtn{display:inline-block;padding:10px 16px;border-radius:10px;background:#eaf0ff;border:1px solid #dbe3ff;color:#1f2937;text-decoration:none;font-weight:700}
  #modal,#modalAdd{display:none;position:fixed;inset:0;background:rgba(0,0,0,.4);align-items:center;justify-content:center;z-index:9999}
  .modal-card{background:#fff;padding:18px;border-radius:12px;box-shadow:0 6px 22px rgba(0,0,0,.25);width:92%;max-width:520px;text-align:left}
  .modal-card h3{margin:0 0 8px}
  .modal-row{display:flex;gap:10px;flex-wrap:wrap}
  .modal-row label{font-size:.92rem;color:#333}
  .modal-row input,.modal-row select{width:100%}
  .modal-actions{display:flex;gap:8px;justify-content:flex-end;margin-top:10px}
  .info-footer{margin-top:10px;font-size:.95rem;color:#555}
</style>
</head>
<body>

<div class="app">
  <h1>üìò Vokabel√ºbersicht</h1>
  <div id="lexica" class="lexica"></div>

  <div>
    <label>Kategorie:
      <select id="filterCat"><option value="Alle">Alle (bunt gemischt)</option></select>
    </label>
    <input id="searchInput" class="searchbox" type="text" placeholder="üîé Suchen (EN / DE)">
    <button id="btnReset" class="btn-plain">üîÑ Reset</button>
  </div>

  <table id="vokabelTable">
    <thead>
      <tr>
        <th class="chk">&nbsp;</th>
        <th data-col="0">Englisch</th>
        <th data-col="1">Deutsch</th>
        <th data-col="2">Kategorie</th>
        <th style="width:100px;">Aktion</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div id="pagination" class="pagination"></div>
  <div id="infoFooter" class="info-footer">‚Äî</div>
  <button id="btnDeleteSel" class="btn-danger">üóëÔ∏è Ausgew√§hlte l√∂schen</button>

  <div class="divider"></div>

  <h2>üíæ Datenbank</h2>
  <button id="btnPush" class="btn-ok">‚úÖ In Datenbank eintragen</button>
  <button id="btnPull" class="btn-plain">üîÑ Von GitHub neu laden</button>

  <div class="divider"></div>

  <h2>üßæ Zuletzt hinzugef√ºgt</h2>
  <div id="recent">‚Äì</div>

  <div class="footer-nav">
    <a href="index.html" class="linkbtn">‚¨ÖÔ∏è Zur√ºck zum Trainer</a>
  </div>
  <p style="margin-top:10px;color:#6b7280;font-size:.92rem">¬© 2025 Beeferino</p>
</div>

<!-- Add FAB -->
<button id="fabAdd" class="fab">Ôºã</button>

<!-- Edit Modal -->
<div id="modal">
  <div class="modal-card">
    <h3>üîç Vokabel bearbeiten</h3>
    <div class="modal-row">
      <label>Englisch<input type="text" id="editEn"></label>
      <label>Deutsch<input type="text" id="editDe"></label>
      <label>Kategorie<select id="editCat"></select></label>
      <label>Gruppe<input type="text" id="editGroup"></label>
      <label>Hinweis<input type="text" id="editHint"></label>
    </div>
    <div class="modal-actions">
      <button id="btnDelRow" class="btn-danger">üóëÔ∏è L√∂schen</button>
      <button id="btnSaveRow" class="btn-ok">üíæ Speichern</button>
      <button id="btnClose" class="btn-plain">‚ùå Schlie√üen</button>
    </div>
  </div>
</div>

<!-- Add Modal -->
<div id="modalAdd">
  <div class="modal-card">
    <h3>‚ûï Neue Vokabel</h3>
    <div class="modal-row">
      <label>Englisch<input type="text" id="newEn"></label>
      <label>Deutsch<input type="text" id="newDe"></label>
      <label>Kategorie<select id="newCat"></select></label>
      <label>Gruppe<input type="text" id="newGroup"></label>
      <label>Hinweis<input type="text" id="newHint"></label>
    </div>
    <div class="modal-actions">
      <button id="btnAddSave" class="btn-ok">üíæ Speichern</button>
      <button id="btnAddClose" class="btn-plain">‚ùå Abbrechen</button>
    </div>
  </div>
</div>

<div id="toast" class="toast">Gespeichert</div>
<div id="syncOverlay">üîÅ Synchronisiere ‚Ä¶</div>

<script>
(() => {
  const CATS={
    Gelb:["Grundwerkzeuge Metallverarbeitung","#F4D03F","#000"],
    Pink:["Werkzeugkasten Mechaniker","#E91E63","#fff"],
    Blau:["Blech- / Kunststoffarbeiten","#1976D2","#fff"],
    Gruen:["Drehen / Fr√§sen","#1E8449","#fff"],
    HellesPink:["Hydraulik / Pneumatik","#F54927","#fff"],
    Orange:["Elektrotechnik","#E67E22","#fff"],
    Dunkelgruen:["Flugger√§temechanik allgemein","#117A65","#fff"],
    Rot:["Verwechslungsgefahr","#C0392B","#fff"]
  };

  const GH_OWNER="beeferino",GH_REPO="vokabeltrainer",GH_PATH="vokabeln.json",GH_BRANCH="main";
  const $=s=>document.querySelector(s),$$=s=>[...document.querySelectorAll(s)];
  const toast=(m,t=1500)=>{const e=$("#toast");e.textContent=m;e.style.display="block";setTimeout(()=>e.style.display="none",t);};
  const syncing=on=>$("#syncOverlay").style.display=on?"block":"none";

  let list=[],currentPage=1,sortCol=0,sortDir=1,letter="Alle",filterCat="Alle",searchTerm="",editIndex=-1;
  const perPage=15;
  const tblBody=$("#vokabelTable tbody"),pagination=$("#pagination"),infoFooter=$("#infoFooter");

  const normalize=v=>[v[0]||"",v[1]||"",v[2]||"Gelb",v[3]||"",v[4]||"",v[5]||new Date().toISOString()];
  const keyOf=v=>`${(v[0]||"").toLowerCase()}|${(v[1]||"").toLowerCase()}`;
  const loadLocal=()=>JSON.parse(localStorage.getItem("vokabeln")||"[]").map(normalize);
  const saveLocal=v=>{localStorage.setItem("vokabeln",JSON.stringify(v));localStorage.setItem("vokabeln_updated",new Date().toISOString());};

  const githubGetFileSHA=async()=>{const t=localStorage.getItem("gh_pat")||"",u=`https://api.github.com/repos/${GH_OWNER}/${GH_REPO}/contents/${GH_PATH}?ref=${GH_BRANCH}`,r=await fetch(u,{headers:t?{Authorization:`Bearer ${t}`}:{}});if(!r.ok)return null;return(await r.json()).sha;};
  const githubPush=async(c)=>{const t=localStorage.getItem("gh_pat")||"";if(!t){alert("Kein GitHub Token.");return false;}syncing(true);try{const sha=await githubGetFileSHA();const u=`https://api.github.com/repos/${GH_OWNER}/${GH_REPO}/contents/${GH_PATH}`;const body={message:"Update via UI",content:btoa(unescape(encodeURIComponent(c))),branch:GH_BRANCH};if(sha)body.sha=sha;const r=await fetch(u,{method:"PUT",headers:{"Authorization":`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(body)});if(!r.ok)throw 0;return true;}catch(e){alert("Sync Fehler.");return false;}finally{syncing(false);}};

  const githubPull=async()=>{try{const r=await fetch(`https://raw.githubusercontent.com/${GH_OWNER}/${GH_REPO}/${GH_BRANCH}/${GH_PATH}?_=${Date.now()}`,{cache:"no-store"});if(!r.ok)throw 0;const d=(await r.json()).map(normalize);saveLocal(d);list=d;renderAll();toast("üîÑ Von GitHub geladen");}catch(e){list=loadLocal();renderAll();}};

  const fillCats=s=>{s.innerHTML="";for(const k in CATS){const o=document.createElement("option");o.value=k;o.textContent=CATS[k][0];o.style.background=CATS[k][1];o.style.color=CATS[k][2];s.appendChild(o);}};

  const buildLexica=()=>{const e=$("#lexica");e.innerHTML="";["Alle",..."ABCDEFGHIJKLMNOPQRSTUVWXYZ"].forEach(L=>{const b=document.createElement("button");b.textContent=L;if(L===letter)b.classList.add("active");b.onclick=()=>{letter=L;currentPage=1;renderTable();buildLexica();};e.appendChild(b);});};

  const filtered=()=>list.filter(([en,de,cat])=>{
    if(letter!=="Alle"&&!en.toUpperCase().startsWith(letter))return false;
    if(filterCat!=="Alle"&&cat!==filterCat)return false;
    if(searchTerm&&!`${en} ${de}`.toLowerCase().includes(searchTerm))return false;
    return true;
  });

  const renderTable=()=>{
    const all=filtered().slice().sort((a,b)=>{const A=(a[sortCol]||"").toLowerCase(),B=(b[sortCol]||"").toLowerCase();return A<B?-1*sortDir:A>B?1*sortDir:0;});
    const pages=Math.max(1,Math.ceil(all.length/perPage));if(currentPage>pages)currentPage=pages;
    const rows=all.slice((currentPage-1)*perPage,(currentPage-1)*perPage+perPage);
    tblBody.innerHTML="";
    rows.forEach(v=>{const idx=list.indexOf(v);const c=CATS[v[2]]||["","#aaa","#000"];
      tblBody.innerHTML+=`<tr><td><input type="checkbox" data-idx="${idx}"></td><td>${v[0]}</td><td>${v[1]}</td><td><span class="category-chip" style="background:${c[1]};color:${c[2]}">${c[0]}</span></td><td><button class="btn-plain" data-edit="${idx}">üîç</button></td></tr>`;
    });
    pagination.innerHTML="";for(let p=1;p<=pages;p++){const b=document.createElement("button");b.textContent=p;if(p===currentPage)b.classList.add("active");b.onclick=()=>{currentPage=p;renderTable();};pagination.appendChild(b);}
    infoFooter.textContent=`Gesamt: ${list.length} | Angezeigt: ${rows.length} | Seite ${currentPage}/${pages}`;
    $$("[data-edit]").forEach(b=>b.onclick=()=>openEdit(parseInt(b.dataset.edit)));
  };

  const renderRecent=()=>{const r=$("#recent");if(!list.length){r.textContent="‚Äì";return;}r.innerHTML=list.slice(-5).reverse().map(v=>{const c=CATS[v[2]]||["","#ccc","#000"];return `<div class="recent-item" style="background:${c[1]};color:${c[2]}"><b>${v[0]}</b> ‚Äì ${v[1]}<br><small>${c[0]}</small></div>`;}).join("");};

  const renderAll=()=>{buildLexica();renderTable();renderRecent();};

  // --- Kategorie Reset ---
  $("#filterCat").onchange=e=>{filterCat=e.target.value;currentPage=1;if(filterCat==="Alle"){letter="Alle";searchTerm="";$("#searchInput").value="";}renderTable();};

  // --- Mehrfach l√∂schen + Autosync ---
  $("#btnDeleteSel").onclick=async()=>{
    const picks=[...document.querySelectorAll('input[data-idx]:checked')];
    if(!picks.length)return alert("Bitte Vokabeln ausw√§hlen.");
    if(!confirm(`Wirklich ${picks.length} l√∂schen?`))return;
    const ids=picks.map(i=>+i.dataset.idx).sort((a,b)=>b-a);
    ids.forEach(i=>list.splice(i,1));
    saveLocal(list);renderAll();toast("üóëÔ∏è Gel√∂scht");
    const ok=await githubPush(JSON.stringify(list,null,2));if(ok)toast("‚úÖ Datenbank aktualisiert");
  };

  // --- Edit Modal ---
  const openEdit=i=>{editIndex=i;const v=list[i];$("#editEn").value=v[0];$("#editDe").value=v[1];$("#editCat").value=v[2];$("#editGroup").value=v[3];$("#editHint").value=v[4];$("#modal").style.display="flex";};
  const closeEdit=()=>$("#modal").style.display="none";

  $("#btnSaveRow").onclick=async()=>{
    if(editIndex<0)return;
    const en=$("#editEn").value.trim(),de=$("#editDe").value.trim(),cat=$("#editCat").value,grp=$("#editGroup").value.trim(),hint=$("#editHint").value.trim();
    if(!en||!de)return alert("Bitte Englisch & Deutsch ausf√ºllen.");
    list[editIndex]=[en,de,cat,grp,hint,new Date().toISOString()];
    saveLocal(list);closeEdit();renderAll();toast("üíæ Gespeichert");
    const ok=await githubPush(JSON.stringify(list,null,2));if(ok)toast("‚úÖ Datenbank aktualisiert");
  };

  $("#btnDelRow").onclick=async()=>{
    if(editIndex<0)return;if(!confirm("Diese Vokabel l√∂schen?"))return;
    list.splice(editIndex,1);saveLocal(list);closeEdit();renderAll();toast("üóëÔ∏è Gel√∂scht");
    const ok=await githubPush(JSON.stringify(list,null,2));if(ok)toast("‚úÖ Datenbank aktualisiert");
  };
  $("#btnClose").onclick=closeEdit;

  // --- Add Modal ---
  const openAdd=()=>{$("#modalAdd").style.display="flex";};
  const closeAdd=()=>$("#modalAdd").style.display="none";
  $("#fabAdd").onclick=openAdd;
  $("#btnAddClose").onclick=closeAdd;

  $("#btnAddSave").onclick=async()=>{
    const en=$("#newEn").value.trim(),de=$("#newDe").value.trim(),cat=$("#newCat").value,grp=$("#newGroup").value.trim(),hint=$("#newHint").value.trim();
    if(!en||!de)return alert("Bitte Englisch & Deutsch ausf√ºllen.");
    list.push([en,de,cat,grp,hint,new Date().toISOString()]);
    saveLocal(list);closeAdd();renderAll();toast("‚ûï Hinzugef√ºgt");
    const ok=await githubPush(JSON.stringify(list,null,2));if(ok)toast("‚úÖ Datenbank aktualisiert");
  };

  $("#btnReset").onclick=()=>{letter="Alle";filterCat="Alle";searchTerm="";$("#filterCat").value="Alle";$("#searchInput").value="";renderAll();};

  $("#searchInput").oninput=e=>{searchTerm=e.target.value.toLowerCase();renderTable();};
  $("#btnPull").onclick=githubPull;
  $("#btnPush").onclick=async()=>{const ok=await githubPush(JSON.stringify(list,null,2));if(ok)toast("‚úÖ Datenbank aktualisiert");};

  // Init
  const init=()=>{fillCats($("#filterCat"));fillCats($("#editCat"));fillCats($("#newCat"));githubPull().catch(()=>{});list=loadLocal();renderAll();};
  init();
})();
</script>
</body>
</html>
