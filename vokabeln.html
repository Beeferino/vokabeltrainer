<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>üìò Vokabel√ºbersicht ‚Äì Beeferino</title>

<!-- ====== Styling ====== -->
<style>
:root{
  --ink:#0f172a; --muted:#6b7280;
  --bg:#f7f9fb; --panel:#ffffff; --line:#e5ebf3;
  --blue:#2563eb; --blue2:#1d4ed8; --ok:#22c55e; --warn:#ef4444;
  --chip:#111827;
}
*{box-sizing:border-box}
body{
  margin:0; font-family:Inter,system-ui,sans-serif; background:#eef4ff; color:var(--ink);
}
.app{
  max-width:1100px; margin:22px auto; padding:18px;
}
.header{
  background:#fff; border-radius:16px; padding:16px 18px;
  box-shadow:0 4px 16px rgba(0,0,0,.08);
  display:flex; align-items:center; justify-content:space-between; gap:12px;
}
.header h1{ margin:0; font-size:1.6rem }
.actions{
  display:flex; gap:8px; flex-wrap:wrap; align-items:center;
}
.actions button,.actions a{
  border:1px solid #dbe3ff; background:#eaf0ff; color:#1f2937; padding:8px 12px;
  border-radius:12px; font-weight:700; cursor:pointer; text-decoration:none;
}
.actions button:hover,.actions a:hover{ background:#dce7ff }
.counter{
  font-weight:800; color:#1e3a8a; margin-left:8px;
}

.panel{
  background:#fff; border-radius:16px; padding:14px 16px;
  box-shadow:0 4px 16px rgba(0,0,0,.06); margin-top:14px;
}

.controls{ display:flex; flex-wrap:wrap; gap:10px; align-items:center; }
.controls label{ display:flex; align-items:center; gap:6px; }
.controls input, .controls select, .controls button{
  padding:8px 10px; border-radius:10px; border:1px solid #cfd6e4; font-size:1rem;
}
.controls button{ background:#1e6ed8; color:#fff; border:none; cursor:pointer }
.controls button:hover{ background:#2563eb }

.abc{ display:flex; flex-wrap:wrap; gap:6px; margin:6px 0 8px; }
.abc button{
  background:#ecf0f9; border:1px solid #d9e2f2; color:#1f2937; padding:6px 9px; border-radius:999px; font-weight:700; cursor:pointer;
}
.abc button.active{ background:#2563eb; color:#fff; border-color:#2563eb }

.table-wrap{ overflow:auto; border:1px solid var(--line); border-radius:12px }
table{ width:100%; border-collapse:collapse; min-width:680px }
th,td{ padding:10px; border-bottom:1px solid var(--line); text-align:left; white-space:nowrap }
th{ background:#eef4ff; user-select:none; cursor:pointer; position:sticky; top:0; z-index:1 }
th.sort-asc::after{ content:" ‚Üë"; color:#666 }
th.sort-desc::after{ content:" ‚Üì"; color:#666 }
tr:hover td{ background:#f7fbff }
td .chip{
  display:inline-block; padding:4px 10px; border-radius:999px; color:#111; font-weight:700; background:#eef2ff; border:1px solid #e0e7ff
}
.cat-chip{ color:#fff; font-weight:800; padding:4px 10px; border-radius:999px }

.rowlink{ color:#2563eb; font-weight:800; cursor:pointer }
.rowlink:hover{ text-decoration:underline }

.footerbar{
  display:flex; justify-content:space-between; align-items:center; gap:10px; margin-top:12px;
}
.footerbar .danger{
  background:linear-gradient(135deg,#ff7b7b,#ef4444); color:#fff; border:none; padding:10px 14px; border-radius:12px; font-weight:800; cursor:pointer;
}
.footerbar .danger:disabled{ opacity:.5; cursor:not-allowed }
.footerbar .right{
  display:flex; gap:8px; flex-wrap:wrap;
}
.footerbar .ghost{
  border:1px solid #dbe3ff; background:#eaf0ff; color:#1f2937; padding:10px 14px; border-radius:12px; font-weight:700; cursor:pointer
}
.footerbar .ghost:hover{ background:#dce7ff }

/* Zuletzt hinzugef√ºgt */
.trenner{
  height:3px; width:60%; margin:26px auto 10px;
  background:linear-gradient(90deg,transparent,#93c5fd,#2563eb,#93c5fd,transparent); border-radius:2px;
}
details.recent{
  background:#fff; border-radius:16px; padding:16px; box-shadow:0 4px 16px rgba(0,0,0,.08);
}
details.recent summary{
  font-weight:800; font-size:1.05rem; color:#1e3a8a; cursor:pointer; list-style:none;
}
#recentBox{
  display:flex; flex-wrap:wrap; gap:10px; justify-content:center; margin-top:10px;
}
.recent-item{
  padding:10px 14px; border-radius:14px; min-width:200px; text-align:center; box-shadow:0 4px 12px rgba(0,0,0,.08);
}
.recent-item small{ display:block; opacity:.9; margin-top:2px }

/* Toast + Banner */
.toast{
  position:fixed; top:14px; left:50%; transform:translateX(-50%);
  background:#22c55e; color:#fff; padding:10px 16px; border-radius:10px; display:none; z-index:9999; font-weight:800;
}
.banner{
  position:fixed; top:0; left:0; right:0; display:none;
  background:#16a34a; color:#fff; text-align:center; padding:10px; font-weight:800; z-index:9998;
}

/* Modal */
.modal{
  position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.45); z-index:10000;
}
.modal .sheet{
  width:92%; max-width:520px; background:#fff; border-radius:16px; padding:18px; box-shadow:0 10px 30px rgba(0,0,0,.25);
}
.modal h3{ margin:0 0 10px 0 }
.form-row{ display:flex; gap:8px; flex-wrap:wrap }
.form-row .w50{ flex:1 1 240px }
.form-row .w100{ flex:1 1 100% }
.sheet input, .sheet select, .sheet textarea{
  width:100%; padding:10px 12px; border:1px solid #d1d5db; border-radius:10px; font-size:1rem;
}
.sheet .hint{ font-size:.9rem; color:var(--muted) }
.sheet .rowend{ display:flex; justify-content:space-between; gap:10px; margin-top:12px }
.sheet .rowend .danger{ background:#ef4444; color:#fff; border:none; border-radius:10px; padding:10px 14px; font-weight:800; }
.sheet .rowend .primary{ background:#2563eb; color:#fff; border:none; border-radius:10px; padding:10px 14px; font-weight:800; }
.sheet .rowend .ghost{ border:1px solid #dbe3ff; background:#eaf0ff; color:#1f2937; border-radius:10px; padding:10px 14px; font-weight:800; }

/* Mobile optimierungen */
@media (max-width: 700px){
  .header{ flex-direction:column; align-items:flex-start; gap:10px }
  .actions{ width:100%; justify-content:space-between }
  .controls{ gap:8px }
  .footerbar{ flex-direction:column; align-items:flex-start }
  table{ min-width:600px }
}
</style>
</head>
<body>
<div class="app">

  <!-- Kopf -->
  <div class="header">
    <h1>üìò Vokabel√ºbersicht</h1>
    <div class="actions">
      <button id="btnSettings">‚öôÔ∏è Einstellungen</button>
      <a href="index.html" title="Zur√ºck zum Trainer">üè† Zur√ºck zum Trainer</a>
      <span class="counter" id="liveCounter">‚Äì</span>
    </div>
  </div>

  <!-- Filter & Suche -->
  <div class="panel">
    <div class="controls">
      <label>Kategorie:
        <select id="filterCat">
          <option value="Alle">Alle (bunt gemischt)</option>
        </select>
      </label>
      <input id="searchBox" type="text" placeholder="üîé Suchen (EN / DE / Gruppe / Hinweis)" />
      <button id="btnReset">üîÑ Reset</button>
      <button id="btnSync" title="vokabeln.json von GitHub laden">üîΩ Von GitHub laden</button>
      <button id="btnPush" title="In Datenbank eintragen (GitHub)">‚¨ÜÔ∏è In Datenbank eintragen</button>
    </div>
    <div class="abc" id="abcBar"></div>
  </div>

  <!-- Tabelle -->
  <div class="panel table-wrap">
    <table id="vokTable">
      <thead>
        <tr>
          <th style="width:42px;">&nbsp;</th>
          <th data-col="0">Englisch</th>
          <th data-col="1">Deutsch</th>
          <th data-col="2">Kategorie</th>
          <th style="width:70px;">Aktion</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>

  <!-- Fu√üleiste -->
  <div class="footerbar">
    <button id="btnDeleteSel" class="danger" disabled>üóëÔ∏è L√∂schen</button>
    <div class="right">
      <button id="btnAdd" class="ghost">‚ûï Neue Vokabel</button>
      <button id="btnExport" class="ghost">üì§ Export</button>
    </div>
  </div>

  <div class="trenner"></div>

  <!-- Zuletzt -->
  <details class="recent" id="recentDetails">
    <summary>üßæ Zuletzt hinzugef√ºgt</summary>
    <div id="recentBox"></div>
  </details>

  <div style="text-align:center; color:#6b7280; margin-top:10px;">
    ¬© 2025 @Beefi
  </div>
</div>

<!-- Toast + Banner -->
<div id="toast" class="toast">Gespeichert</div>
<div id="banner" class="banner">‚úÖ Synchronisiert</div>

<!-- Modal: Einstellungen -->
<div class="modal" id="modalSettings">
  <div class="sheet">
    <h3>‚öôÔ∏è Einstellungen</h3>
    <div class="form-row">
      <div class="w100">
        <label>GitHub Token (wird lokal gespeichert)
          <input id="ghToken" type="password" placeholder="ghp_‚Ä¶" />
        </label>
      </div>
      <div class="w50">
        <label>Owner
          <input id="ghOwner" type="text" value="beeferino" />
        </label>
      </div>
      <div class="w50">
        <label>Repo
          <input id="ghRepo" type="text" value="vokabeltrainer" />
        </label>
      </div>
      <div class="w100">
        <label>Pfad
          <input id="ghPath" type="text" value="vokabeln.json" />
        </label>
      </div>
      <div class="w100 hint">Hinweis: Token nur mit Repo-Rechten nutzen. Die Daten werden in <code>localStorage</code> abgelegt.</div>
    </div>
    <div class="rowend">
      <button class="ghost" id="closeSettings">Schlie√üen</button>
      <button class="primary" id="saveSettings">Token speichern</button>
    </div>
  </div>
</div>

<!-- Modal: Edit/Create -->
<div class="modal" id="modalEdit">
  <div class="sheet">
    <h3 id="editTitle">‚úèÔ∏è Vokabel bearbeiten</h3>
    <div class="form-row">
      <div class="w50">
        <label>Englisch
          <input id="eEn" type="text" />
        </label>
      </div>
      <div class="w50">
        <label>Deutsch
          <input id="eDe" type="text" />
        </label>
      </div>
      <div class="w50">
        <label>Kategorie
          <select id="eCat"></select>
        </label>
      </div>
      <div class="w50">
        <label>Gruppe / Variante
          <input id="eGrp" type="text" />
        </label>
      </div>
      <div class="w100">
        <label>Hinweis
          <textarea id="eHint" rows="2" placeholder="Zusatzinfo"></textarea>
        </label>
      </div>
      <div class="w100 hint">
        Anlage: <span id="eDate">‚Äì</span>
      </div>
    </div>
    <div class="rowend">
      <button class="danger" id="eDelete">üóëÔ∏è L√∂schen</button>
      <div>
        <button class="ghost" id="eCancel">Abbrechen</button>
        <button class="primary" id="eSave">Speichern</button>
      </div>
    </div>
  </div>
</div>

<script>
(() => {
  // ======= Kategorien =======
  const CATEGORY_NAMES = {
    Gelb:"Grundwerkzeuge Metallverarbeitung",
    Pink:"Werkzeugkasten Mechaniker",
    Blau:"Blech- / Kunststoffarbeiten",
    Gruen:"Drehen / Fr√§sen",
    HellesPink:"Hydraulik / Pneumatik",
    Orange:"Elektrotechnik",
    Dunkelgruen:"Flugger√§temechanik allgemein",
    Rot:"Verwechslungsgefahr"
  };
  const COLOR_MAP = {
    Gelb:"#F4D03F", Pink:"#E91E63", Blau:"#1976D2", Gruen:"#1E8449",
    HellesPink:"#F54927", Orange:"#E67E22", Dunkelgruen:"#117A65", Rot:"#C0392B"
  };
  const TEXT_ON = (k) => (["Gelb"].includes(k) ? "#000" : "#fff");

  // ======= State / Helper =======
  const $ = (s)=>document.querySelector(s);
  const $$ = (s)=>Array.from(document.querySelectorAll(s));
  const toast = (m)=>{ const t=$("#toast"); t.textContent=m; t.style.display="block"; setTimeout(()=>t.style.display="none",1400); };
  const banner = (m)=>{ const b=$("#banner"); b.textContent=m||"‚úÖ Synchronisiert"; b.style.display="block"; setTimeout(()=>b.style.display="none",1600); };

  const normalize = (v)=>[v[0]||"", v[1]||"", v[2]||"Gelb", v[3]||"", v[4]||"", v[5]||new Date().toISOString()];
  const keyOf = (v)=>`${(v[0]||"").toLowerCase().trim()}|${(v[1]||"").toLowerCase().trim()}`;

  function saveLocal(data){
    localStorage.setItem("vokabeln", JSON.stringify(data));
    localStorage.setItem("vokabeln_updated", new Date().toISOString());
  }
  function loadLocal(){ return (JSON.parse(localStorage.getItem("vokabeln")||"[]")||[]).map(normalize); }

  // GitHub settings
  function loadSettings(){
    return {
      token: localStorage.getItem("gh_token")||"",
      owner: localStorage.getItem("gh_owner")||"beeferino",
      repo:  localStorage.getItem("gh_repo") ||"vokabeltrainer",
      path:  localStorage.getItem("gh_path") ||"vokabeln.json",
    };
  }
  function saveSettings(s){
    localStorage.setItem("gh_token", s.token||"");
    localStorage.setItem("gh_owner", s.owner||"beeferino");
    localStorage.setItem("gh_repo",  s.repo ||"vokabeltrainer");
    localStorage.setItem("gh_path",  s.path ||"vokabeln.json");
  }

  // ======= UI refs =======
  const filterCat = $("#filterCat");
  const searchBox = $("#searchBox");
  const btnReset  = $("#btnReset");
  const abcBar    = $("#abcBar");
  const tbody     = $("#tbody");
  const liveCounter = $("#liveCounter");

  const btnDeleteSel = $("#btnDeleteSel");
  const btnAdd = $("#btnAdd");
  const btnExport = $("#btnExport");
  const btnSync = $("#btnSync");
  const btnPush = $("#btnPush");

  const modalSettings = $("#modalSettings");
  const btnSettings = $("#btnSettings");
  const ghToken=$("#ghToken"), ghOwner=$("#ghOwner"), ghRepo=$("#ghRepo"), ghPath=$("#ghPath");
  const saveSettingsBtn=$("#saveSettings"), closeSettings=$("#closeSettings");

  const modalEdit = $("#modalEdit");
  const editTitle=$("#editTitle");
  const eEn=$("#eEn"), eDe=$("#eDe"), eCat=$("#eCat"), eGrp=$("#eGrp"), eHint=$("#eHint"), eDate=$("#eDate");
  const eCancel=$("#eCancel"), eSave=$("#eSave"), eDelete=$("#eDelete");

  const recentDetails = $("#recentDetails");
  const recentBox = $("#recentBox");

  // ======= State =======
  let list = [];
  let letter = "Alle";
  let sortCol = 0, sortDir = 1; // 0=en,1=de,2=cat
  let currentEditIndex = -1;

  // ======= Init selects =======
  function fillCategorySelect(sel, includeAll=false){
    sel.innerHTML = includeAll ? "<option value='Alle'>Alle (bunt gemischt)</option>" : "";
    for(const k in CATEGORY_NAMES){
      const o=document.createElement("option");
      o.value=k; o.textContent=CATEGORY_NAMES[k];
      o.style.background=COLOR_MAP[k]; o.style.color=TEXT_ON(k);
      sel.appendChild(o);
    }
  }
  fillCategorySelect(filterCat, true);
  fillCategorySelect(eCat, false);

  // ABC Leiste
  function renderABC(){
    const letters = ["Alle",..."ABCDEFGHIJKLMNOPQRSTUVWXYZ"];
    abcBar.innerHTML = "";
    letters.forEach(L=>{
      const b=document.createElement("button");
      b.textContent=L; if(L===letter) b.classList.add("active");
      b.onclick=()=>{ letter=L; renderTable(); };
      abcBar.appendChild(b);
    });
  }

  // Z√§hler
  function updateCounter(filteredCount){
    const total = list.length;
    const selected = $$("input.rowchk:checked").length;
    liveCounter.textContent = `üìö Gesamt: ${total} | üîé Gefiltert: ${filteredCount} | ‚úÖ Markiert: ${selected}`;
    btnDeleteSel.disabled = selected===0;
  }

  // Zuletzt hinzugef√ºgt
  function renderRecent(){
    const last = list.slice(-5).reverse();
    recentBox.innerHTML = last.map(v=>{
      const cat=v[2]; const bg=COLOR_MAP[cat]; const fg=TEXT_ON(cat);
      return `<div class="recent-item" style="background:${bg};color:${fg}">
        <b>${v[0]}</b> ‚Äì ${v[1]}<small>${CATEGORY_NAMES[cat]}</small>
      </div>`;
    }).join("");
  }

  // Sortieren
  function setSortHeaders(){
    $$("#vokTable thead th").forEach(th=>{ th.classList.remove("sort-asc","sort-desc"); });
    const th = $(`#vokTable thead th[data-col="${sortCol}"]`);
    if(th) th.classList.add(sortDir===1?"sort-asc":"sort-desc");
  }

  // Filtern
  function getFiltered(){
    const term = (searchBox.value||"").toLowerCase().trim();
    let arr = list.filter(([en,de,cat,grp,hint])=>{
      if(letter!=="Alle" && !String(en).toUpperCase().startsWith(letter)) return false;
      if(filterCat.value!=="Alle" && cat!==filterCat.value) return false;
      if(term){
        const hay = (en+" "+de+" "+(grp||"")+" "+(hint||"")).toLowerCase();
        if(!hay.includes(term)) return false;
      }
      return true;
    });
    // sort
    arr.sort((a,b)=>{
      const A = (a[sortCol]||"").toString().toLowerCase();
      const B = (b[sortCol]||"").toString().toLowerCase();
      if(A<B) return -1*sortDir;
      if(A>B) return  1*sortDir;
      return 0;
    });
    return arr;
  }

  // Tabelle rendern
  function renderTable(){
    const filtered = getFiltered();
    tbody.innerHTML = filtered.map((v, idx)=>{
      const i = list.indexOf(v); // original index
      const cat=v[2]; const bg=COLOR_MAP[cat]; const fg=TEXT_ON(cat);
      return `<tr>
        <td><input type="checkbox" class="rowchk" data-i="${i}"/></td>
        <td><span class="rowlink" data-open="${i}">${v[0]}</span></td>
        <td>${v[1]}</td>
        <td><span class="cat-chip" style="background:${bg};color:${fg}">${CATEGORY_NAMES[cat]}</span></td>
        <td style="text-align:center;"><button class="ghost" data-open="${i}">üîç</button></td>
      </tr>`;
    }).join("");
    // Events
    $$("button[data-open], .rowlink[data-open]").forEach(x=>{
      x.onclick = ()=> openEdit(parseInt(x.dataset.open,10));
    });
    $$(".rowchk").forEach(chk=> chk.onchange = ()=> updateCounter(filtered.length) );
    updateCounter(filtered.length);
    setSortHeaders();
  }

  // Reset
  btnReset.onclick = ()=>{ searchBox.value=""; filterCat.value="Alle"; letter="Alle"; renderABC(); renderTable(); };

  // Suche live
  searchBox.addEventListener("input", ()=> renderTable());
  filterCat.onchange = ()=> renderTable();

  // Sort header
  $$("#vokTable thead th[data-col]").forEach(th=>{
    th.onclick = ()=>{
      const col = parseInt(th.dataset.col,10);
      if(sortCol===col){ sortDir = -sortDir; } else { sortCol=col; sortDir=1; }
      renderTable();
    };
  });

  // Export
  btnExport.onclick = ()=>{
    const data = JSON.stringify(list, null, 2);
    const a=document.createElement("a");
    a.href=URL.createObjectURL(new Blob([data],{type:"application/json"}));
    a.download="vokabeln.json";
    a.click();
  };

  // Delete selected
  btnDeleteSel.onclick = ()=>{
    const sel = $$("input.rowchk:checked").map(c=>parseInt(c.dataset.i,10)).sort((a,b)=>b-a);
    if(!sel.length) return;
    if(!confirm(`Ausgew√§hlte Vokabeln l√∂schen (${sel.length})?`)) return;
    sel.forEach(i=> list.splice(i,1));
    saveLocal(list);
    toast("üóëÔ∏è Gel√∂scht");
    renderRecent(); renderTable();
  };

  // Add new
  btnAdd.onclick = ()=> openEdit(-1);

  // Edit modal
  function openEdit(i){
    currentEditIndex = i;
    editTitle.textContent = i<0 ? "‚ûï Neue Vokabel" : "‚úèÔ∏è Vokabel bearbeiten";
    if(i>=0){
      const v=list[i];
      eEn.value=v[0]; eDe.value=v[1]; eCat.value=v[2]; eGrp.value=v[3]||""; eHint.value=v[4]||"";
      eDate.textContent = v[5] ? new Date(v[5]).toLocaleString("de-DE") : "‚Äì";
      eDelete.style.display="inline-block";
    } else {
      eEn.value=""; eDe.value=""; eCat.value="Gelb"; eGrp.value=""; eHint.value="";
      eDate.textContent = "Wird beim Speichern gesetzt";
      eDelete.style.display="none";
    }
    modalEdit.style.display="flex";
  }
  eCancel.onclick = ()=> modalEdit.style.display="none";
  eDelete.onclick = ()=>{
    if(currentEditIndex<0) return;
    if(!confirm("Diese Vokabel endg√ºltig l√∂schen?")) return;
    list.splice(currentEditIndex,1);
    saveLocal(list); modalEdit.style.display="none";
    toast("üóëÔ∏è Gel√∂scht"); renderRecent(); renderTable();
  };
  eSave.onclick = ()=>{
    const en=eEn.value.trim(), de=eDe.value.trim(), cat=eCat.value, grp=eGrp.value.trim(), hint=eHint.value.trim();
    if(!en || !de){ alert("Bitte Englisch & Deutsch ausf√ºllen."); return; }
    if(currentEditIndex<0){
      list.push([en,de,cat,grp,hint,new Date().toISOString()]);
    } else {
      const prev = list[currentEditIndex];
      list[currentEditIndex] = [en,de,cat,grp,hint, prev[5]||new Date().toISOString()];
    }
    saveLocal(list);
    modalEdit.style.display="none";
    toast("üíæ Gespeichert");
    renderRecent(); renderTable();
  };

  // Settings modal
  btnSettings.onclick = ()=>{
    const s=loadSettings();
    ghToken.value=s.token; ghOwner.value=s.owner; ghRepo.value=s.repo; ghPath.value=s.path;
    modalSettings.style.display="flex";
  };
  closeSettings.onclick = ()=> modalSettings.style.display="none";
  saveSettingsBtn.onclick = ()=>{
    saveSettings({ token:ghToken.value.trim(), owner:ghOwner.value.trim(), repo:ghRepo.value.trim(), path:ghPath.value.trim() });
    modalSettings.style.display="none";
    toast("üîê Token gespeichert");
  };

  // GitHub: Laden (GET raw)
  async function fetchFromGitHub(){
    try{
      const s=loadSettings();
      const url = `https://raw.githubusercontent.com/${encodeURIComponent(s.owner)}/${encodeURIComponent(s.repo)}/main/${s.path}?_=${Date.now()}`;
      const r = await fetch(url,{cache:"no-store"});
      if(!r.ok) throw new Error(r.status);
      const data = await r.json();
      if(!Array.isArray(data)) throw new Error("Ung√ºltiges JSON");
      list = data.map(normalize);
      saveLocal(list);
      renderRecent(); renderTable();
      banner("‚¨áÔ∏è Von GitHub geladen");
    }catch(e){
      alert("Laden von GitHub fehlgeschlagen. Nutze lokalen Stand.\n"+e);
      list = loadLocal();
      renderRecent(); renderTable();
    }
  }
  btnSync.onclick = ()=> fetchFromGitHub();

  // GitHub: Schreiben (PUT /contents)
  async function pushToGitHub(){
    const s=loadSettings();
    if(!s.token){ alert("Bitte zun√§chst einen GitHub Token in den Einstellungen speichern."); return; }
    const api = `https://api.github.com/repos/${encodeURIComponent(s.owner)}/${encodeURIComponent(s.repo)}/contents/${s.path}`;
    try{
      // SHA holen
      let sha = null;
      {
        const r = await fetch(api);
        if(r.ok){ const j=await r.json(); sha=j.sha; }
      }
      const content = btoa(unescape(encodeURIComponent(JSON.stringify(list,null,2))));
      const body = {
        message:`Update ${s.path} (via UI)`,
        content, sha
      };
      const r2 = await fetch(api,{
        method:"PUT",
        headers:{
          "Authorization":"Bearer "+s.token,
          "Accept":"application/vnd.github+json",
          "Content-Type":"application/json"
        },
        body: JSON.stringify(body)
      });
      if(!r2.ok){ const t=await r2.text(); throw new Error(t); }
      banner("‚úÖ In Datenbank eingetragen");
    }catch(e){
      alert("Fehler beim Schreiben in das Repo:\n"+e.message);
    }
  }
  btnPush.onclick = ()=> pushToGitHub();

  // Load initial (GitHub ‚Üí fallback local)
  async function init(){
    try{
      await fetchFromGitHub();
    }catch{
      list = loadLocal();
      renderRecent(); renderTable();
    }
    renderABC();
    // Zuletzt: standardm√§√üig zu
    recentDetails.open = false;
  }
  init();
})();
</script>
</body>
</html>
