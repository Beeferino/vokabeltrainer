<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>📘 Vokabelübersicht</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet"/>

  <style>
    :root{
      --bg: #eef3f9;
      --card: rgba(255,255,255,.75);
      --card-solid: #fff;
      --text: #222;
      --muted: #5b6b81;
      --primary: #1e6ed8;
      --primary-2: #2c7ef0;
      --ring: rgba(30,110,216,.25);
      --border: #dee6f2;
      --shadow: 0 8px 24px rgba(16,24,40,.08);
    }
    *{box-sizing:border-box}
    body{
      margin:0;padding:22px;
      font-family:Inter,system-ui,sans-serif;
      color:var(--text);
      background:linear-gradient(180deg,#f7f9fc 0%,#f0f4fa 100%);
    }
    .app{max-width:1100px;margin:auto;background:var(--card);border-radius:18px;padding:22px;box-shadow:var(--shadow);backdrop-filter:blur(10px);}
    .header{text-align:center;margin-bottom:16px;}
    .title{font-size:1.9rem;font-weight:800;}
    .subline{margin:8px auto 18px;width:92%;height:3px;border-radius:3px;background:linear-gradient(90deg,var(--primary),var(--primary-2));}
    .controls{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;align-items:center;background:var(--card-solid);border:1px solid var(--border);border-radius:14px;padding:12px;}
    select,input,button{font:inherit;border-radius:10px;border:1px solid var(--border);padding:10px 12px;background:#fff;outline:none;}
    button{cursor:pointer;background:var(--primary);color:#fff;border:none;font-weight:700;}
    button:hover{background:var(--primary-2);}
    table{width:100%;border-collapse:collapse;}
    th,td{padding:10px;border-bottom:1px solid var(--border);}
    th{background:#f4f7ff;font-weight:700;cursor:pointer;}
    tr:hover td{background:#f8fbff;}
    .category-chip{display:inline-block;padding:4px 10px;border-radius:10px;color:#fff;font-weight:700;font-size:.9rem;}
    .pagination{display:flex;justify-content:center;gap:8px;margin-top:12px;}
    .pagination button{background:#fff;color:#1c3553;border:1px solid var(--border);}
    .pagination button.active{background:var(--primary);color:#fff;}
    .input-card{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px;background:var(--card-solid);border:1px solid var(--border);border-radius:14px;padding:12px;}
    .footer{text-align:center;margin-top:20px;color:var(--muted);}
    #modal{display:none;position:fixed;inset:0;background:rgba(20,30,50,.45);backdrop-filter:blur(6px);align-items:center;justify-content:center;z-index:9999;padding:14px;}
    #modalContent{background:#fff;border:1px solid var(--border);border-radius:16px;padding:16px;max-width:480px;width:100%;box-shadow:var(--shadow);}
    #modalContent h3{text-align:center;margin-top:0;}
    .modal-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
    .modal-grid-1{display:grid;grid-template-columns:1fr;gap:10px;margin-top:8px;}
    .modal-actions{display:flex;justify-content:center;gap:10px;margin-top:10px;}
    #datasourceStatus{position:fixed;right:12px;bottom:10px;font-size:.85rem;background:#fff;border:1px solid var(--border);border-radius:10px;padding:6px 10px;box-shadow:var(--shadow);}
    .toast{position:fixed;left:50%;bottom:18px;transform:translateX(-50%);background:#1abc9c;color:#fff;padding:10px 14px;border-radius:10px;display:none;z-index:99999;}
    .multi-delete{display:none;justify-content:center;margin-bottom:10px;}
    .multi-delete button{background:#e74c3c;}
    .multi-delete button:hover{background:#c0392b;}
  </style>
</head>
<body>
<div class="app">
  <div class="header">
    <div class="title">📘 Vokabelübersicht</div>
    <div class="subline"></div>
  </div>

  <div id="lexica" class="lexica"></div>

  <div class="section">
    <h2>🔍 Filter & Suche</h2>
    <div class="controls">
      <label>Kategorie:
        <select id="filterCat"><option value="Alle">Alle</option></select>
      </label>
      <input id="searchInput" type="text" placeholder="🔎 Suchen...">
      <button id="resetFilter">🔄 Zurücksetzen</button>
    </div>
  </div>

  <div class="section">
    <h2>📄 Vokabelliste</h2>
    <div class="multi-delete"><button id="deleteSelected">🗑️ Ausgewählte löschen</button></div>
    <div class="card">
      <table id="vokabelTable">
        <thead><tr>
          <th></th><th data-col="0">Englisch</th><th data-col="1">Deutsch</th><th data-col="2">Kategorie</th><th>Aktion</th>
        </tr></thead>
        <tbody></tbody>
      </table>
      <div id="pagination" class="pagination"></div>
    </div>
  </div>

  <div class="section">
    <h2>➕ Neue Vokabel hinzufügen</h2>
    <div class="input-card">
      <input id="newEn" placeholder="Englisch">
      <input id="newDe" placeholder="Deutsch">
      <select id="newCat"></select>
      <input id="newGroup" placeholder="Gruppe / Variante">
      <input id="newHint" placeholder="Hinweis">
      <button id="addBtn">Hinzufügen</button>
    </div>
  </div>

  <div class="footer">
    <button onclick="window.location.href='index.html'">⬅️ Zurück</button>
    <p>© 2025 @Beefi</p>
  </div>
</div>

<div id="modal">
  <div id="modalContent">
    <h3>🔍 Vokabel-Details</h3>
    <div class="modal-grid">
      <input id="editEn" placeholder="Englisch">
      <input id="editDe" placeholder="Deutsch">
    </div>
    <div class="modal-grid-1">
      <select id="editCat"></select>
      <input id="editGroup" placeholder="Gruppe / Variante">
      <input id="editHint" placeholder="Hinweis">
    </div>
    <div class="modal-actions">
      <button id="saveEdit">💾 Speichern</button>
      <button id="deleteSingle">🗑️ Löschen</button>
      <button id="closeModal">❌ Schließen</button>
    </div>
  </div>
</div>

<div id="toast" class="toast">Gespeichert</div>
<div id="datasourceStatus">🔄 JSON geladen</div>

<script>
(() => {
  const C = {
    Gelb:"Grundwerkzeuge Metallverarbeitung",
    Pink:"Werkzeugkasten Mechaniker",
    Blau:"Blech- / Kunststoffarbeiten",
    Gruen:"Drehen / Fräsen",
    HellesPink:"Hydraulik / Pneumatik",
    Orange:"Elektrotechnik",
    Dunkelgruen:"Fluggerätemechanik allgemein",
    Rot:"Verwechslungsgefahr"
  };
  const M = {
    Gelb:"#F4D03F", Pink:"#E91E63", Blau:"#1976D2", Gruen:"#1E8449",
    HellesPink:"#F54927", Orange:"#E67E22", Dunkelgruen:"#117A65", Rot:"#C0392B"
  };
  const GITHUB_JSON = "https://beeferino.github.io/vokabeltrainer/vokabeln.json";
  let list = [];

  const $ = s => document.querySelector(s);
  const $$ = s => [...document.querySelectorAll(s)];
  const toast = m => {const t=$("#toast");t.textContent=m;t.style.display="block";setTimeout(()=>t.style.display="none",1400);};

  function normalize(v){return [v[0]||"",v[1]||"",v[2]||"Gelb",v[3]||"",v[4]||""];}

  async function sync(){
    const r = await fetch(GITHUB_JSON+"?t="+Date.now(),{cache:"no-store"});
    const d = await r.json();
    list = d.map(normalize);
    localStorage.setItem("vokabeln",JSON.stringify(list));
    render();
  }

  function render(){
    const tb=$("#vokabelTable tbody");
    tb.innerHTML=list.map((v,i)=>`
      <tr>
        <td><input type="checkbox" class="rowChk" data-i="${i}"></td>
        <td>${v[0]}</td>
        <td>${v[1]}</td>
        <td><span class="category-chip" style="background:${M[v[2]]}">${C[v[2]]}</span></td>
        <td><button class="viewBtn" data-i="${i}">🔍</button></td>
      </tr>`).join("");

    $$("#vokabelTable .viewBtn").forEach(b=>b.onclick=()=>openEdit(b.dataset.i));
    $$("#vokabelTable .rowChk").forEach(chk=>chk.onchange=checkMultiDelete);
  }

  function checkMultiDelete(){
    const any=$$("#vokabelTable .rowChk:checked").length>0;
    $(".multi-delete").style.display=any?"flex":"none";
  }

  $("#deleteSelected").onclick=()=>{
    const sel=$$("#vokabelTable .rowChk:checked").map(c=>+c.dataset.i);
    if(!sel.length) return;
    if(!confirm("Diese "+sel.length+" Vokabel(n) wirklich löschen?"))return;
    list=list.filter((_,i)=>!sel.includes(i));
    localStorage.setItem("vokabeln",JSON.stringify(list));
    render(); toast("🗑️ Gelöscht");
    $(".multi-delete").style.display="none";
  };

  let editIndex=-1;
  function openEdit(i){
    editIndex=i; const v=list[i]; if(!v)return;
    $("#editEn").value=v[0];$("#editDe").value=v[1];
    $("#editCat").value=v[2];$("#editGroup").value=v[3];$("#editHint").value=v[4];
    $("#modal").style.display="flex";
  }
  $("#saveEdit").onclick=()=>{
    if(editIndex<0)return;
    const v=list[editIndex];
    v[0]=$("#editEn").value.trim();
    v[1]=$("#editDe").value.trim();
    v[2]=$("#editCat").value;
    v[3]=$("#editGroup").value.trim();
    v[4]=$("#editHint").value.trim();
    localStorage.setItem("vokabeln",JSON.stringify(list));
    render(); toast("💾 Gespeichert");
    $("#modal").style.display="none";
  };
  $("#deleteSingle").onclick=()=>{
    if(editIndex<0)return;
    if(!confirm("Diese Vokabel wirklich löschen?"))return;
    list.splice(editIndex,1);
    localStorage.setItem("vokabeln",JSON.stringify(list));
    render(); toast("🗑️ Gelöscht");
    $("#modal").style.display="none";
  };
  $("#closeModal").onclick=()=>$("#modal").style.display="none";

  $("#addBtn").onclick=()=>{
    const en=$("#newEn").value.trim(),de=$("#newDe").value.trim(),cat=$("#newCat").value,grp=$("#newGroup").value.trim(),hint=$("#newHint").value.trim();
    if(!en||!de)return alert("Bitte Englisch und Deutsch eingeben");
    list.push([en,de,cat,grp,hint]);
    localStorage.setItem("vokabeln",JSON.stringify(list));
    render(); toast("➕ Hinzugefügt");
    $("#newEn").value=$("#newDe").value=$("#newGroup").value=$("#newHint").value="";
  };

  function fillCats(sel,withAll=false){
    sel.innerHTML=withAll?"<option value='Alle'>Alle</option>":"";
    for(const k in C){
      const o=document.createElement("option");
      o.value=k;o.textContent=C[k];o.style.background=M[k];o.style.color="#fff";
      sel.appendChild(o);
    }
  }

  fillCats($("#filterCat"),true);
  fillCats($("#newCat"));
  fillCats($("#editCat"));
  sync();
})();
</script>
</body>
</html>
